<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="flattr:id" content="9yl9ry">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (or emacs &middot; irrelevant)
    
  </title>

  <link rel="canonical" href="https://oremacs.com/page29/" />

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/donate/">Donate</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://licensebuttons.net/l/by-sa/4.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/18/sprucing-up-org-download/">
        Sprucing up org-download
      </a>
    </h1>

    <span class="post-date">18 Jan 2015</span>

    <p>My interest in <a href="https://github.com/abo-abo/org-download">org-download</a>
was renewed today with
<a href="http://thread.gmane.org/gmane.emacs.orgmode/93964">this thread</a> on
<code>org-mode</code>&#39;s mailing list.</p>

<p><code>org-download</code> allows you to drag-and-drop an image from e.g. Firefox
or your own file system to an <code>org-mode</code> buffer. When I originally
wrote it, I was taking a Chemistry course on
<a href="https://www.edx.org/">edX</a>, which included homework and exams with a
lot of images. Doing the homework in a literate style with <code>org-mode</code>,
I wanted the problems to be completely self-contained, and for that I
needed to save all the images from the website, preferably quickly, to
an <code>org-mode</code> buffer. With a few hacks and some advice and
contributions from more experienced hackers, <code>org-download</code> came to
be.</p>

<h2 id="todays-commits">Today&#39;s commits</h2>

<p>The main contribution from today&#39;s commits was adding the code that
un-aliases images that point to HTML. I see a lot of these from the
people that I&#39;m following on my Twitter,
<a href="https://twitter.com/_abo_abo">@&#95;abo&#95;abo</a>. Here&#39;s the code:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defcustom</span> <span class="nv">org-download-img-regex-list</span>
  <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;&lt;img +src=\&quot;&quot;</span> <span class="s">&quot;&lt;img +\\(class=\&quot;[^\&quot;]+\&quot;\\)? *src=\&quot;&quot;</span><span class="p">)</span>
  <span class="s">&quot;This regex is used to unalias links that look like images.</span>
<span class="s">The html to which the links points will be searched for these</span>
<span class="s">regexes, one by one, until one succeeds.  The found image address</span>
<span class="s">will be used.&quot;</span>
  <span class="nb">:group</span> <span class="ss">&#39;org-download</span><span class="p">)</span>
</code></pre></div>
<p>and in <code>(org-download-image link)</code>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">image-type-from-file-name</span> <span class="nv">link</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">with-current-buffer</span>
        <span class="p">(</span><span class="nv">url-retrieve-synchronously</span> <span class="nv">link</span> <span class="no">t</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">regexes</span> <span class="nv">org-download-img-regex-list</span><span class="p">)</span>
            <span class="nv">lnk</span><span class="p">)</span>
        <span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nv">not</span> <span class="nv">lnk</span><span class="p">)</span> <span class="nv">regexes</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
          <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="p">(</span><span class="nb">pop</span> <span class="nv">regexes</span><span class="p">)</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">backward-char</span><span class="p">)</span>
            <span class="p">(</span><span class="k">setq</span> <span class="nv">lnk</span> <span class="p">(</span><span class="nf">read</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">)))))</span>
        <span class="p">(</span><span class="k">if</span> <span class="nv">lnk</span>
            <span class="p">(</span><span class="k">setq</span> <span class="nv">link</span> <span class="nv">lnk</span><span class="p">)</span>
          <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;link %s does not point to an image&quot;</span> <span class="nv">link</span><span class="p">)))))</span>
</code></pre></div>
<p>Here, <code>image-type-from-file-name</code> is a built-in from <code>image.el</code> that
decides if <code>link</code> looks like an image file or not.</p>

<p>As you can see, since I intend to use <code>link</code> right after to be
transformed right now, I&#39;m using <code>url-retrieve-synchronously</code>, instead
of the asynchronous <code>url-retrieve</code>. The other one is used by default
to download the actual image.</p>

<p>Note the use of the <code>while</code> / <code>pop</code> combination for traversing a list.
I&#39;ve seen it used in some places in the Emacs core, and I think it&#39;s
pretty neat.</p>

<p>Arranging the regular expressions into a list is necessary to give
priority to some regexes. For instance, the first element of
<code>org-download-img-regex-list</code> should match e.g. an actual referred
image on Twitter, while the second element will match at least a
profile picture in the case when there is no referred image.</p>

<h2 id="visual-demo">Visual demo</h2>

<p>I think that I might have over-engineered the custom options of
<code>org-download</code> a bit. Just to keep you motivated enough to figure them
out, here&#39;s a link to
<a href="https://www.youtube.com/watch?v=dAojpHR-6Uo">a Youtube demo</a> of the
fast clickety-clicking (the mouse usage), that comes after some
clackety-clacking (the customization).</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/17/setting-up-ediff/">
        Setting up Ediff
      </a>
    </h1>

    <span class="post-date">17 Jan 2015</span>

    <p>Once you make Ediff bearable, it becomes wonderful.  At least this was
my experience. It&#39;s a very good tool, but some of the defaults look
very poor to me.</p>

<h2 id="customizing-the-customize">Customizing the <code>customize</code></h2>

<p>First of all, I&#39;ll list a macro that I&#39;ve started to use for setting
custom variables:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defmacro</span> <span class="nv">csetq</span> <span class="p">(</span><span class="nv">variable</span> <span class="nv">value</span><span class="p">)</span>
  <span class="o">`</span><span class="p">(</span><span class="nf">funcall</span> <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nf">get</span> <span class="ss">&#39;,variable</span> <span class="ss">&#39;custom-set</span><span class="p">)</span>
                <span class="ss">&#39;set-default</span><span class="p">)</span>
            <span class="ss">&#39;,variable</span> <span class="o">,</span><span class="nv">value</span><span class="p">))</span>
</code></pre></div>
<p>This macro I&#39;ve put together myself after searching though the code
base and not finding something similar; <code>custom-set-variables</code> comes
close to what I want, or maybe <code>custom-initialize-changed</code>.  Basically
all I want is a <code>setq</code> that is aware of the <code>custom-set</code> property of a
variable. If you know such a macro, please let me know.</p>

<h2 id="changing-some-ediff-options">Changing some Ediff options</h2>

<p>Now, that I&#39;ve explained the custom setter (by the way, using
<code>custom-set-variables</code> is absolutely equivalent to <code>csetq</code>), here are
my changes:</p>

<ol>
<li><p>Don&#39;t use the weird setup with the control panel in a separate
frame.  I can manage windows in Emacs much better than my desktop
(Unity or Gnome Shell) can manage the Emacs frames.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>(csetq ediff-window-setup-function &#39;ediff-setup-windows-plain)
</code></pre></div></li>
<li><p>Split the windows horizontally instead of vertically. This way, it&#39;s
much easier to follow the changes.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>(csetq ediff-split-window-function &#39;split-window-horizontally)
</code></pre></div></li>
<li><p>Ignore white space. I don&#39;t write a lot of Python, so I don&#39;t care
about the white space in the diffs. At the same time, I re-format any
LISP code that I edit to my liking, and I want to see only the
important changes in the diff, and not the whitespace nonsense.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>(csetq ediff-diff-options &quot;-w&quot;)
</code></pre></div></li>
</ol>

<h2 id="changing-some-ediff-key-bindings">Changing some Ediff key bindings</h2>

<p>This is just the standard stuff that I like to do for each mode that
does not self-insert: assign <kbd>j</kbd> to move down, and
<kbd>k</kbd> to move up.</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">ora-ediff-hook</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">ediff-setup-keymap</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">ediff-mode-map</span> <span class="s">&quot;j&quot;</span> <span class="ss">&#39;ediff-next-difference</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">ediff-mode-map</span> <span class="s">&quot;k&quot;</span> <span class="ss">&#39;ediff-previous-difference</span><span class="p">))</span>

<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;ediff-mode-hook</span> <span class="ss">&#39;ora-ediff-hook</span><span class="p">)</span>
</code></pre></div>
<h2 id="restoring-the-windows-after-ediff-quits">Restoring the windows after Ediff quits</h2>

<p>When you quit an Ediff session with <kbd>q</kbd>, it just leaves the
two diff windows around, instead of restoring the window configuration
from when Ediff was started. Here&#39;s the (slightly hacky) code to
restore the old window configuration:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">winner-mode</span><span class="p">)</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;ediff-after-quit-hook-internal</span> <span class="ss">&#39;winner-undo</span><span class="p">)</span>
</code></pre></div>
<h2 id="list-of-ways-that-i-use-to-invoke-ediff">List of ways that I use to invoke Ediff</h2>

<h3 id="from-magit">from <code>magit</code></h3>

<p>In 80% of the cases, I call Ediff with <kbd>e</kbd> (<code>magit-ediff</code>) from
<code>magit-status-mode</code>. This gives me a better overview of the changes,
especially when I want to revert stuff with either <kbd>a</kbd>
(<code>ediff-copy-A-to-B</code>) or <kbd>b</kbd> (<code>ediff-copy-B-to-A</code>). Probably
with <kbd>a</kbd>, since <a href="https://github.com/magit/magit">magit</a> seems
to consistently put the <code>@{index}</code> file into the <code>A</code> diff window, and
the current file into the <code>B</code> window.</p>

<p>So if I&#39;m looking at a diff (to which I navigated with
<kbd>j</kbd>/<kbd>k</kbd>), I can revert it with <kbd>a</kbd>. At this
point, the diff region in the current file will become equal to that
of the index file. But it will not be saved yet. If I want to save the
current file in the <code>B</code> window, I can do it with <kbd>wb</kbd>
(<code>ediff-save-buffer</code>). After a revert, it&#39;s also useful to call
<kbd>!</kbd>(<code>ediff-update-diffs</code>), which will remove the zero-length
diffs and update the diff-count in the mode-line.</p>

<h3 id="other-methods">other methods</h3>

<ol>
<li><code>ediff-buffers</code> will diff two (different) buffers. If you happen to
have only two windows open with the appropriate buffers, you get them
as defaults and can choose them quickly with <kbd>RET</kbd> <kbd>RET</kbd>.</li>
<li><code>ediff-files</code> is similar, but works on files instead. I like to just mark the appropriate files
in <code>dired</code> with <kbd>m</kbd>, then they also get auto-selected by <code>ediff-files</code>.</li>
<li><code>ediff-current-file</code> is useful to see the unsaved changes to the current file.
I rarely use it, since I have a compulsion to save every file every chance I get. There is little hope
to recover from this addiction, unless someone implements an analogue of <a href="https://github.com/bbatsov/guru-mode">guru-mode</a>
that annoys you when you try to save a file. Actually, it&#39;s not a bad idea - <kbd>C-x C-s</kbd>:</li>
</ol>

<blockquote>
<p>Oleh, you have saved this file <code>40 times</code> in the last hour; the last
save was <code>0 minutes 34 seconds ago</code>; since then, you&#39;ve changed <code>27
bytes</code> of information. Are you <strong>sure</strong> you want to save <code>[y/N]</code>?</p>
</blockquote>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/16/compile-savely/">
        Save before compile
      </a>
    </h1>

    <span class="post-date">16 Jan 2015</span>

    <p>Here&#39;s a very simplistic function that I was using for a while:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">save-and-compile</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">save-buffer</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">compile</span> <span class="s">&quot;make -j4&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">pop-to-buffer</span> <span class="nv">next-error-last-buffer</span><span class="p">))</span>
</code></pre></div>
<p>It will save the current buffer, run <code>compile</code> and switch to
compilation buffer.</p>

<h2 id="compilation-customization">Compilation customization</h2>

<p>Turns out that there&#39;s no need to save, since I get away with this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>(setq compilation-ask-about-save nil)
</code></pre></div>
<p>The documentation says:</p>

<blockquote>
<p>Non-nil means M-x <code>compile</code> asks which buffers to save before
compiling.  Otherwise, it saves all modified buffers without asking.</p>
</blockquote>

<h2 id="select-compilation-target">Select compilation target</h2>

<p>A year ago, I wrote a package that looks for a <code>Makefile</code> in the
current directory, parses the available targets and allows you to
choose one with <a href="https://github.com/emacs-helm/helm">helm</a>.  It&#39;s
called <a href="https://github.com/abo-abo/helm-make">helm-make</a>.  It&#39;s almost
the same as <kbd>M-x</kbd> <code>compile</code> (which also has completion for
targets), and it wraps around <code>compile</code>, but I just find it to be more
convenient.</p>

<p>This package is as simple as it sounds, the only customization that
you can do is to set <code>helm-make-do-save</code> to save all open buffers
visiting the <code>Makefile</code>&#39;s directory. It also provides, in addition to
the plain <code>helm-make</code> command, a <code>helm-make-projectile</code> command, which
is almost the same, except the <code>Makefile</code> should come not from the
current directory but from <code>projectile-project-root</code>.</p>

<h2 id="some-error-navigation-to-go-with-your-compilation">Some error navigation to go with your compilation</h2>

<p>I&#39;ve had these bindings for a very long time, just making sure
that you&#39;re aware of these commands:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">[</span><span class="nv">f6</span><span class="p">]</span> <span class="ss">&#39;next-error</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">[</span><span class="nv">C-f6</span><span class="p">]</span> <span class="ss">&#39;previous-error</span><span class="p">)</span>
</code></pre></div>
<p>These bindings work for <kbd>M-x</kbd> <code>occur</code> and <code>rgrep</code> as well.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/15/c++-smart-dot/">
        C++ - a dot inserts last var plus dot
      </a>
    </h1>

    <span class="post-date">15 Jan 2015</span>

    <p>It is very much in the spirit of C++ to pull an object into existence
with e.g. a constructor definition and then poke and prod it with
various method calls. Most of the time, the dot will have the object
name on the left. So why not automatically insert the object name each
time I press the dot? Below, I&#39;ll show a code that does exactly that.</p>

<h2 id="the-dot-command">The dot command</h2>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">c++-smart-dot</span> <span class="p">()</span>
  <span class="s">&quot;Insert a dot or an object name plus dot when appropriate.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">var-name</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nv">looking-back</span> <span class="s">&quot;^[ \t]*&quot;</span><span class="p">)</span>
             <span class="p">(</span><span class="k">setq</span> <span class="nv">var-name</span> <span class="p">(</span><span class="nv">c++-get-recent-var</span><span class="p">)))</span>
        <span class="p">(</span><span class="nf">insert</span> <span class="nv">var-name</span> <span class="s">&quot;.&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">insert</span> <span class="s">&quot;.&quot;</span><span class="p">))))</span>
</code></pre></div>
<p>This one is pretty simple: if we are at the beginning of the line,
optionally with some spaces or (ugh) tabs before the point, then try
to insert the object name along with a dot.</p>

<p>Here&#39;s how to bind it:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">eval-after-load</span> <span class="s">&quot;cc-mode&quot;</span>
  <span class="o">`</span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">c++-mode-map</span> <span class="s">&quot;.&quot;</span> <span class="ss">&#39;c++-smart-dot</span><span class="p">))</span>
</code></pre></div>
<h2 id="how-to-get-the-recent-variable">How to get the recent variable</h2>

<p>This code doesn&#39;t aim to be thorough, it&#39;s just a hack that
works reasonably well.</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">defconst</span> <span class="nv">c++-var-regex</span> <span class="s">&quot;[A-Za-z][A-Za-z0-9_]*&quot;</span>
  <span class="s">&quot;The regex for C++ variable name.&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">c++-get-recent-var</span> <span class="p">()</span>
  <span class="s">&quot;Return the closest thing that looks like an object.</span>
<span class="s">The search is performed backwards through code.&quot;</span>
  <span class="p">(</span><span class="k">save-excursion</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="k">or</span>
           <span class="c1">;; variable dot chain</span>
           <span class="p">(</span><span class="nv">looking-back</span>
            <span class="p">(</span><span class="nf">format</span> <span class="s">&quot; \\(%s\\)\\.%s.*\n[\t ]*&quot;</span>
                    <span class="nv">c++-var-regex</span>
                    <span class="nv">c++-var-regex</span><span class="p">))</span>
           <span class="c1">;; variable constructor init</span>
           <span class="p">(</span><span class="nv">looking-back</span>
            <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;[\t ]+\\(%s\\)\\(?:([^)]*)\\)?;[\t\n ]*&quot;</span>
                    <span class="nv">c++-var-regex</span><span class="p">))</span>
           <span class="c1">;; variable dot, first on line</span>
           <span class="p">(</span><span class="nf">re-search-backward</span>
            <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;^[ \t]*\\(%s\\)\\.&quot;</span> <span class="nv">c++-var-regex</span><span class="p">)</span> <span class="no">nil</span> <span class="no">t</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">match-string-no-properties</span> <span class="mi">1</span><span class="p">))))</span>
</code></pre></div>
<p>If you&#39;re a stickler for performance and you don&#39;t want to call format a bunch of times,
you can amend the code like this:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defalias</span> <span class="ss">&#39;c++-get-recent-var</span>
    <span class="p">(</span><span class="nv">byte-compile</span>
     <span class="o">`</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
        <span class="p">(</span><span class="k">save-excursion</span>
          <span class="p">(</span><span class="nb">when</span>
              <span class="p">(</span><span class="k">or</span>
               <span class="c1">;; variable dot chain</span>
               <span class="p">(</span><span class="nv">looking-back</span>
                <span class="o">,</span><span class="p">(</span><span class="nf">format</span>
                  <span class="s">&quot; \\(%s\\)\\.%s.*\n[\t ]*&quot;</span>
                  <span class="nv">c++-var-regex</span>
                  <span class="nv">c++-var-regex</span><span class="p">))</span>
               <span class="c1">;; variable constructor init</span>
               <span class="p">(</span><span class="nv">looking-back</span>
                <span class="o">,</span><span class="p">(</span><span class="nf">format</span>
                  <span class="s">&quot;[\t ]+\\(%s\\)\\(?:([^)]*)\\)?;[\t\n ]*&quot;</span>
                  <span class="nv">c++-var-regex</span><span class="p">))</span>
               <span class="c1">;; variable dot, first on line</span>
               <span class="p">(</span><span class="nf">re-search-backward</span>
                <span class="o">,</span><span class="p">(</span><span class="nf">format</span> <span class="s">&quot;^[ \t]*\\(%s\\)\\.&quot;</span> <span class="nv">c++-var-regex</span><span class="p">)</span> <span class="no">nil</span> <span class="no">t</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">match-string-no-properties</span> <span class="mi">1</span><span class="p">)))))</span>
  <span class="s">&quot;Return the closest thing that looks like an object.</span>
<span class="s">The search is performed backwards through code.&quot;</span><span class="p">)</span>
</code></pre></div>
<p>The thing above looks slightly ugly. I&#39;m open to suggestions to make
it look nicer.</p>

<h2 id="the-sample-application">The sample application</h2>

<p>For the happy people that have never seen C++:</p>
<div class="highlight"><pre><code class="language-C++" data-lang="C++"><span></span><span class="n">DataOut</span><span class="o">&lt;</span><span class="n">dim</span><span class="o">&gt;</span> <span class="n">data_out</span><span class="p">;</span>
<span class="n">data_out</span><span class="p">.</span><span class="n">attach_dof_handler</span><span class="p">(</span><span class="n">dof_handler</span><span class="p">);</span>
<span class="n">data_out</span><span class="p">.</span><span class="n">add_data_vector</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="s">&quot;u&quot;</span><span class="p">);</span>
<span class="n">data_out</span><span class="p">.</span><span class="n">build_patches</span><span class="p">();</span>
</code></pre></div>
<p>Here, after defining an object <code>data_out</code>, I insert it subsequently
with just <kbd>.</kbd>.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/14/repeatable-commands/">
        Zoom in / out with style
      </a>
    </h1>

    <span class="post-date">14 Jan 2015</span>

    <p>I don&#39;t usually zoom a lot, typically I do it to size up other
people&#39;s functions. Then, I zoom-out a couple times in a row until the
function fits on the screen. Sometimes, I overshoot the zoom-out, and
I have to zoom-in instead. I have <code>text-scale-increase</code> bound to
<kbd>&lt;f2&gt; g</kbd> and <code>text-scale-decrease</code> bound to
<kbd>&lt;f2&gt; l</kbd>.</p>

<p>Below, I&#39;ll demonstrate how to call those two commands interchangeably
with e.g. <kbd>&lt;f2&gt; g g g l g g l</kbd>, i.e. omitting the
<kbd>&lt;f2&gt;</kbd> prefix.</p>

<h2 id="define-repeatable-command">Define repeatable command</h2>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">def-rep-command</span> <span class="p">(</span><span class="nv">alist</span><span class="p">)</span>
  <span class="s">&quot;Return a lambda that calls the first function of ALIST.</span>
<span class="s">It sets the transient map to all functions of ALIST.&quot;</span>
  <span class="p">(</span><span class="nb">lexical-let</span> <span class="p">((</span><span class="nv">keymap</span> <span class="p">(</span><span class="nf">make-sparse-keymap</span><span class="p">))</span>
                <span class="p">(</span><span class="nv">func</span> <span class="p">(</span><span class="nv">cdar</span> <span class="nv">alist</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">mapc</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">define-key</span> <span class="nv">keymap</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">x</span><span class="p">)))</span>
          <span class="nv">alist</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">arg</span><span class="p">)</span>
      <span class="p">(</span><span class="k">interactive</span> <span class="s">&quot;p&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">funcall</span> <span class="nv">func</span> <span class="nv">arg</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">set-transient-map</span> <span class="nv">keymap</span> <span class="no">t</span><span class="p">))))</span>
</code></pre></div>
<p>This is a pretty simple function that takes an alist of keys and
commands, and returns a lambda that calls the first command and sets
the transient map to call the first and other commands.  The way the
transient map works, it takes priority over almost all maps, but
disappears as soon as you press something that doesn&#39;t belong to it.</p>

<h2 id="the-zoom-in-zoom-out-use-case">The zoom-in / zoom-out use case</h2>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;&lt;f2&gt; g&quot;</span><span class="p">)</span>
                <span class="p">(</span><span class="nv">def-rep-command</span>
                    <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;g&quot;</span> <span class="o">.</span> <span class="nv">text-scale-increase</span><span class="p">)</span>
                      <span class="p">(</span><span class="s">&quot;l&quot;</span> <span class="o">.</span> <span class="nv">text-scale-decrease</span><span class="p">))))</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;&lt;f2&gt; l&quot;</span><span class="p">)</span>
                <span class="p">(</span><span class="nv">def-rep-command</span>
                    <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;l&quot;</span> <span class="o">.</span> <span class="nv">text-scale-decrease</span><span class="p">)</span>
                      <span class="p">(</span><span class="s">&quot;g&quot;</span> <span class="o">.</span> <span class="nv">text-scale-increase</span><span class="p">))))</span>
</code></pre></div>
<p>And this is it. A nice thing about this setup is that I don&#39;t have to
think about the zoom state and quitting it: I&#39;ll quit it automatically
as soon as I press anything other than <kbd>l</kbd> or <kbd>g</kbd>.
Moreover, the command that exited the zoom state will be executed as
usual.</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page30">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page28">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
