<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (or emacs &middot; irrelevant)
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://i.creativecommons.org/l/by-nc-sa/2.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/04/01/lispy.0.25.0-is-out/">
        lispy 0.25.0 is out
      </a>
    </h1>

    <span class="post-date">01 Apr 2015</span>

    <p>Seriously, check <a href="https://github.com/abo-abo/lispy/releases/tag/0.25.0">the release notes</a> if you
don&#39;t believe me.</p>

<h2 id="fixes">Fixes</h2>

<ul>
<li>Add <code>minibuffer-inactive-mode</code> to the <code>lispy-elisp-modes</code> list. It means that you can eval there if you want.</li>
<li><kbd>V</kbd> (<code>lispy-visit</code>) should turn on <code>projectile-global-mode</code> if it&#39;s not on.</li>
<li><kbd>M</kbd> (<code>lispy-multiline</code>) works better for Clojure: the regexes for vectors, maps and sets have been improved.</li>
<li><kbd>C-k</kbd> should not delete only the string when located at start of string.</li>
<li><kbd>M</kbd> will not turn vectors into lists any more.</li>
<li>the backquote bug for <kbd>i</kbd> and <kbd>M</kbd> was fixed.</li>
<li>you can flatten Elisp closures as well, at least the plain ones.</li>
</ul>

<h2 id="new-features">New Features</h2>

<h3 id="b-calls-lispy-back"><kbd>b</kbd> calls <code>lispy-back</code></h3>

<p>The movement commands, such as:</p>

<ul>
<li>the arrows <kbd>hjkl</kbd> (<code>lispy-left</code>, <code>lispy-down</code> etc.)</li>
<li><kbd>f</kbd> (<code>lispy-flow</code>)</li>
<li><kbd>q</kbd> (<code>lispy-ace-paren</code>)</li>
<li><kbd>i</kbd> (<code>lispy-tab</code>), only when called for an active region</li>
</ul>

<p>will not store each movement in the point-and-mark history. You can press <kbd>b</kbd> to go back in
history. This is especially useful for <kbd>h</kbd>, <kbd>l</kbd>, and <kbd>f</kbd>, since they are
not trivially reversible.</p>

<p><kbd>b</kbd> was previously bound to <code>lispy-store-region-and-buffer</code>, so you could do Ediff with
<kbd>b</kbd> and <kbd>B</kbd>. Now it&#39;s bound to <kbd>xB</kbd>.</p>

<h3 id="hungry-comment-delete">Hungry comment delete</h3>

<p><kbd>C-d</kbd> (<code>lispy-delete</code>) when positioned at the start of a comment, and with only whitespace
before the start of the line, will delete the whole comment.</p>

<p>If you want to un-comment, just use <kbd>C-u ;</kbd> from any point in the comment.</p>

<h3 id="added-flatten-operation-for-clojure">Added flatten operation for Clojure</h3>

<p><kbd>xf</kbd> (<code>lispy-flatten</code>) now also works for Clojure, before it was only for Elisp.</p>

<h4 id="example-1-(flatten-a-macro):">Example 1 (flatten a macro):</h4>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="err">|</span><span class="p">(</span><span class="nf">-&gt;&gt;</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">]</span>
     <span class="p">(</span><span class="nb">map </span><span class="nv">sqr</span><span class="p">)</span>
     <span class="p">(</span><span class="nb">filter </span><span class="nv">odd?</span><span class="p">))</span>
</code></pre></div>
<p>When you press <kbd>xf</kbd> you get this:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="err">|</span><span class="p">(</span><span class="nb">filter </span><span class="nv">odd?</span> <span class="p">(</span><span class="nb">map </span><span class="nv">sqr</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">]))</span>
</code></pre></div>
<h4 id="example-2-(flatten-a-standard-function):">Example 2 (flatten a standard function):</h4>

<p>Start with:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="err">|</span><span class="p">(</span><span class="nb">map </span><span class="nv">odd?</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">])</span>
</code></pre></div>
<p>After <kbd>xf</kbd>:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">f</span> <span class="nv">odd?</span> <span class="nv">coll</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">]]</span>
  <span class="p">(</span><span class="nf">lazy-seq</span> <span class="p">(</span><span class="nb">when-let </span><span class="p">[</span><span class="nv">s</span> <span class="p">(</span><span class="nb">seq </span><span class="nv">coll</span><span class="p">)]</span>
              <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">chunked-seq?</span> <span class="nv">s</span><span class="p">)</span>
                <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">c</span> <span class="p">(</span><span class="nf">chunk-first</span> <span class="nv">s</span><span class="p">)</span>
                      <span class="nv">size</span> <span class="p">(</span><span class="nb">int </span><span class="p">(</span><span class="nb">count </span><span class="nv">c</span><span class="p">))</span>
                      <span class="nv">b</span> <span class="p">(</span><span class="nf">chunk-buffer</span> <span class="nv">size</span><span class="p">)]</span>
                  <span class="p">(</span><span class="nb">dotimes </span><span class="p">[</span><span class="nv">i</span> <span class="nv">size</span><span class="p">]</span>
                    <span class="p">(</span><span class="nf">chunk-append</span> <span class="nv">b</span> <span class="p">(</span><span class="nf">f</span> <span class="p">(</span><span class="nf">.nth</span> <span class="nv">c</span> <span class="nv">i</span><span class="p">))))</span>
                  <span class="p">(</span><span class="nf">chunk-cons</span> <span class="p">(</span><span class="nf">chunk</span> <span class="nv">b</span><span class="p">)</span>
                              <span class="p">(</span><span class="nb">map </span><span class="nv">f</span> <span class="p">(</span><span class="nf">chunk-rest</span> <span class="nv">s</span><span class="p">))))</span>
                <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">f</span> <span class="p">(</span><span class="nb">first </span><span class="nv">s</span><span class="p">))</span>
                      <span class="p">(</span><span class="nb">map </span><span class="nv">f</span> <span class="p">(</span><span class="nb">rest </span><span class="nv">s</span><span class="p">)))))))</span>
</code></pre></div>
<p>A bit of a gibberish, but at least we can confirm that <code>map</code> is indeed lazy.</p>

<h4 id="example-3-(flatten-your-own-function):">Example 3 (flatten your own function):</h4>

<p>Example function:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="kd">defn </span><span class="nv">sqr</span> <span class="p">[</span><span class="nv">x</span><span class="p">]</span>
  <span class="p">(</span><span class="nb">* </span><span class="nv">x</span> <span class="nv">x</span><span class="p">))</span>
</code></pre></div>
<p>This one requires the function to be properly loaded with <kbd>C-c C-l</kbd> (<code>cider-load-file</code>),
otherwise Clojure will not know the location of the function.</p>

<p>Example statement:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="nb">+ </span><span class="err">|</span><span class="p">(</span><span class="nf">sqr</span> <span class="mi">10</span><span class="p">)</span> <span class="mi">20</span><span class="p">)</span>
</code></pre></div>
<p>After <kbd>xf</kbd>:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="nb">+ </span><span class="err">|</span><span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">x</span> <span class="mi">10</span><span class="p">]</span>
     <span class="p">(</span><span class="nb">* </span><span class="nv">x</span> <span class="nv">x</span><span class="p">))</span> <span class="mi">20</span><span class="p">)</span>
</code></pre></div>
<h3 id="added-lax-eval-for-clojure">Added lax eval for Clojure</h3>

<p>This is similar to the lax eval for Elisp. If you mark an expression with a region:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">asdf [1 2 3]
</code></pre></div>
<p>and press <kbd>e</kbd>, you will actually eval this:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="k">do </span><span class="p">(</span><span class="k">def </span><span class="nv">asdf</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">])</span>
    <span class="nv">asdf</span><span class="p">)</span>
</code></pre></div>
<p>You can do this for let bindings, it&#39;s super-useful for debugging.  The rule is that if the first
element of the region is a symbol, and there&#39;s more stuff in the region besides the symbol, a lax
eval will be performed.</p>

<h3 id="e-will-auto-start-cider"><kbd>e</kbd> will auto-start CIDER</h3>

<p>If CIDER isn&#39;t live, <kbd>e</kbd> will start it and properly eval the current statement.</p>

<h3 id="2f-will-search-for-variables-first"><kbd>2F</kbd> will search for variables first</h3>

<p>Since Elisp is a LISP-2, there can be a function and a variable with the same name.  <kbd>F</kbd>
(<code>lispy-follow</code>) prefers functions, but now <kbd>2F</kbd> will prefer variables.</p>

<h3 id="2e-will-eval-and-insert-the-commented-result"><kbd>2e</kbd> will eval and insert the commented result</h3>

<p>Starting with:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="err">|</span><span class="p">(</span><span class="nb">filter </span><span class="nv">odd?</span> <span class="p">(</span><span class="nb">map </span><span class="nv">sqr</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">]))</span>
</code></pre></div>
<p>Pressing <kbd>2e</kbd> gives:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="nb">filter </span><span class="nv">odd?</span> <span class="p">(</span><span class="nb">map </span><span class="nv">sqr</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">]))</span>
<span class="c1">;; =&gt;</span>
<span class="c1">;; (1 9 25)</span>
</code></pre></div>
<p>This works for all dialects, so you can also have:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nf">symbol-function</span> <span class="ss">&#39;exit-minibuffer</span><span class="p">)</span>
<span class="c1">;; =&gt;</span>
<span class="c1">;; (closure (t)</span>
<span class="c1">;;          nil &quot;Terminate this minibuffer argument.&quot; (interactive)</span>
<span class="c1">;;          (setq deactivate-mark nil)</span>
<span class="c1">;;          (throw (quote exit)</span>
<span class="c1">;;            nil))</span>
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><code class="language-cl" data-lang="cl"><span class="vg">*MODULES*</span>
<span class="c1">;; =&gt;</span>
<span class="c1">;; (&quot;SWANK-ARGLISTS&quot; &quot;SWANK-FANCY-INSPECTOR&quot; &quot;SWANK-FUZZY&quot; </span>
<span class="c1">;;                   &quot;SWANK-UTIL&quot; &quot;SWANK-PRESENTATIONS&quot; </span>
<span class="c1">;;                   &quot;SWANK-TRACE-DIALOG&quot; &quot;SB-CLTL2&quot;)</span>
</code></pre></div>
<p>To do the last eval you need to be in special.
It means that you first have to mark the symbol <code>*MODULES*</code> with a region.
A convenient function to mark the current symbol is <kbd>M-m</kbd> (<code>lispy-mark-symbol</code>).</p>

<h3 id="y-(lispy-occur)-now-has-an-ivy-back-end"><kbd>y</kbd> (<code>lispy-occur</code>) now has an <code>ivy</code> back end</h3>

<p><code>lispy-occur</code> launches an interactive search within the current top-level expression, usually a
defun. This is useful to see where a variable is used in a function, or to quickly navigate to a
statement.</p>

<p>You can customize <code>lispy-occur-backend</code> to either <code>ivy</code> (the default) or <code>helm</code> (if you have it,
since it&#39;s no longer a dependency of <code>lispy</code>).</p>

<h3 id="add-ivy-back-end-to-lispy-completion-method">Add ivy back end to <code>lispy-completion-method</code></h3>

<p>Now it&#39;s the default one for navigating to tags. You can select alternatively <code>helm</code> or <code>ido</code> if you
wish.</p>

<h3 id="remove-the-dependency-on-ace-jump-mode">Remove the dependency on <code>ace-jump-mode</code></h3>

<p>Instead the dependency on <code>ace-window</code> will be re-used. This allows for a lot of code
simplifications and better tests.</p>

<p>New custom variables:</p>

<ul>
<li><code>lispy-avy-style-char</code>: choose where the overlay appears for <kbd>Q</kbd> (<code>lispy-ace-char</code>)</li>
<li><code>lispy-avy-style-paren</code>: choose where the overlay appears for <kbd>q</kbd> (<code>lispy-ace-paren</code>)</li>
<li><code>lispy-avy-style-symbol</code>: choose where the overlay appears for <kbd>a</kbd> (<code>lispy-ace-symbol</code>)
and <kbd>-</kbd> (<code>lispy-ace-subword</code>) and <kbd>H</kbd> (<code>ace-symbol-replace</code>).</li>
</ul>

<p>There&#39;s also <code>lispy-avy-keys</code>, which is <code>a</code> ... <code>z</code> by default.</p>

<h3 id="add-lispy-compat">Add <code>lispy-compat</code></h3>

<p>This is a list of compatibility features with other packages, such as <code>edebug</code> and <code>god-mode</code>.
They add overhead, so you might want to turn them off if you don&#39;t use the mentioned packages.</p>

<h3 id="f-works-for-scheme"><kbd>F</kbd> works for Scheme</h3>

<p>You can navigate to a symbol definition in Scheme with <kbd>F</kbd>. This feature was already
in place for Elisp, Clojure and CL.</p>

<h2 id="outro">Outro</h2>

<p>Looks like a great batch of features, but I&#39;m the most happy about the stupid backquote bug being
fixed.</p>

<p>Up next: pre-defined key binding <a href="https://github.com/abo-abo/lispy/issues/57">themes</a>, featuring:</p>

<ul>
<li>the beloved <code>default</code>.</li>
<li>the old-school <code>paredit</code>.</li>
<li>the special-only <code>minimal</code>.</li>
<li>and maybe one more.</li>
</ul>

<p>Feel free to chime in, if you&#39;ve got a key setup that you think other people will like. Happy
hacking!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/03/30/elisp-ert-travis/">
        An update to my Elisp ERT / Travis CI setup
      </a>
    </h1>

    <span class="post-date">30 Mar 2015</span>

    <p>This post might be interesting to people who use Travis CI to test their Elisp packages.</p>

<p>I&#39;ve noticed a few days ago that my tests on Travis CI started failing randomly.  Turns out that the
widely used <a href="https://launchpad.net/%7Ecassou/+archive/ubuntu/emacs">ppa:cassou/emacs</a> has become
deprecated. It still sort of works, but sometimes <code>apt-get update</code> just times out, and I get a build
error.</p>

<p>Since it was the only one that I was using, I had to find another one. I went with <code>emacs-snapshot</code>
from <a href="https://launchpad.net/%7Eubuntu-elisp/+archive/ppa">ppa:ubuntu-elisp</a>.</p>

<p>Here&#39;s my current <a href="https://github.com/abo-abo/lispy/blob/master/.travis.yml">.travis.yml</a>:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">language: emacs-lisp
env:
  matrix:
    - emacs=emacs-snapshot

before_install:
  - sudo add-apt-repository -y ppa:ubuntu-elisp
  - sudo apt-get update -qq
  - sudo apt-get install -qq $emacs
  - curl -fsSkL --max-time 10 --retry 10 --retry-delay 10 https://raw.github.com/cask/cask/master/go | python

script:
  - make cask
  - make test
</code></pre></div>
<p>I&#39;ve adopted one more change in the above code: <code>EMACS</code> is replaced by <code>emacs</code>.
The reason for this is that both <code>ansi-term</code> and <code>compile</code>
for legacy reasons set <code>EMACS</code> to <a href="https://lists.gnu.org/archive/html/emacs-devel/2015-03/msg00994.html">strange values</a>,
like <code>&quot;24.4.91.2 (term:0.96)&quot;</code>.
So if you have in your Makefile:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">EMACS ?= emacs
</code></pre></div>
<p>you&#39;re going to have a bad time. So I changed my <a href="https://github.com/abo-abo/lispy/blob/master/Makefile">Makefile</a> to:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">emacs ?= emacs
</code></pre></div>
<p>And now I can compile and test while inside Emacs with no issues.  The only issue left is that I
don&#39;t yet know which PPA I should use for a stable Emacs. Maybe someone has a suggestion.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/03/28/recenter/">
        recenter-positions, that's not how gravity works!
      </a>
    </h1>

    <span class="post-date">28 Mar 2015</span>

    <p>Yesterday, I&#39;ve added a new binding to <code>swiper-map</code>: <kbd>C-l</kbd> will now call
<code>swiper-recenter-top-bottom</code>.
The implementation is really easy, almost nothing to write home about:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">swiper-recenter-top-bottom</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">arg</span><span class="p">)</span>
  <span class="s">&quot;Call (`recenter-top-bottom&#39; ARG) in `swiper--window&#39;.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span> <span class="s">&quot;P&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">with-selected-window</span> <span class="nv">swiper--window</span>
    <span class="p">(</span><span class="nv">recenter-top-bottom</span> <span class="nv">arg</span><span class="p">)))</span>
</code></pre></div>
<p>An interesting thing that I want to mention though is the customization of the default
<code>recenter-top-bottom</code> behavior. This is the default one:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">recenter-positions</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">middle</span> <span class="nv">top</span> <span class="nv">bottom</span><span class="p">))</span>
</code></pre></div>
<p>And this is the logical one that I&#39;m using:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">recenter-positions</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">top</span> <span class="nv">middle</span> <span class="nv">bottom</span><span class="p">))</span>
</code></pre></div>
<p>Try it out, and see if it makes sense to you. For me, when I&#39;ve just jumped to a function
definition, which usually means that the point is on the first line of the function, the first
recenter position has to be <code>top</code>, since that will maximize the amount of the function body that&#39;s
displayed on the screen.</p>

<p>Another use-case is when I&#39;m reading an info or a web page. After a recenter to top, all that I have
read is scrolled out of view, and I can continue from the top.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/03/26/hydra-ivy-swiper/">
        A Hydra for ivy/swiper
      </a>
    </h1>

    <span class="post-date">26 Mar 2015</span>

    <p>Today I&#39;ll share a Hydra that I&#39;ve been working on that&#39;s similar to Lit Wakefield&#39;s original idea
for <a href="http://angelic-sedition.github.io/blog/2015/02/03/a-more-evil-helm/">a helm hydra</a>.</p>

<h2 id="the-code">The Code</h2>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defhydra</span> <span class="nv">hydra-ivy</span> <span class="p">(</span><span class="nb">:hint</span> <span class="no">nil</span>
                     <span class="nb">:color</span> <span class="nv">pink</span><span class="p">)</span>
  <span class="s">&quot;</span>
<span class="s">^^^^^^          ^Actions^    ^Dired^     ^Quit^</span>
<span class="s">^^^^^^--------------------------------------------</span>
<span class="s">^ ^ _k_ ^ ^     _._ repeat   _m_ark      _i_: cancel</span>
<span class="s">_h_ ^✜^ _l_     _r_eplace    _,_ unmark  _o_: quit</span>
<span class="s">^ ^ _j_ ^ ^     _u_ndo  </span>
<span class="s">&quot;</span>
  <span class="c1">;; arrows</span>
  <span class="p">(</span><span class="s">&quot;h&quot;</span> <span class="nv">ivy-beginning-of-buffer</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;j&quot;</span> <span class="nv">ivy-next-line</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;k&quot;</span> <span class="nv">ivy-previous-line</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;l&quot;</span> <span class="nv">ivy-end-of-buffer</span><span class="p">)</span>
  <span class="c1">;; actions</span>
  <span class="p">(</span><span class="s">&quot;.&quot;</span> <span class="nv">hydra-repeat</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;r&quot;</span> <span class="nv">ivy-replace</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;u&quot;</span> <span class="nv">ivy-undo</span><span class="p">)</span>
  <span class="c1">;; dired</span>
  <span class="p">(</span><span class="s">&quot;m&quot;</span> <span class="nv">ivy-dired-mark</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;,&quot;</span> <span class="nv">ivy-dired-unmark</span><span class="p">)</span>
  <span class="c1">;; exit</span>
  <span class="p">(</span><span class="s">&quot;o&quot;</span> <span class="nv">keyboard-escape-quit</span> <span class="nb">:exit</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;i&quot;</span> <span class="no">nil</span><span class="p">))</span>
</code></pre></div>
<p>Here&#39;s how I bind it:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">ivy-minibuffer-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-o&quot;</span><span class="p">)</span> <span class="ss">&#39;hydra-ivy/body</span><span class="p">)</span>
</code></pre></div>
<p>And here are the auxiliaries:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">ivy-dired-mark</span> <span class="p">(</span><span class="nv">arg</span><span class="p">)</span>
  <span class="p">(</span><span class="k">interactive</span> <span class="s">&quot;p&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">dotimes</span> <span class="p">(</span><span class="nv">_i</span> <span class="nv">arg</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">with-selected-window</span> <span class="nv">swiper--window</span>
      <span class="p">(</span><span class="nv">dired-mark</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">ivy-next-line</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">ivy--exhibit</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">ivy-dired-unmark</span> <span class="p">(</span><span class="nv">arg</span><span class="p">)</span>
  <span class="p">(</span><span class="k">interactive</span> <span class="s">&quot;p&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">dotimes</span> <span class="p">(</span><span class="nv">_i</span> <span class="nv">arg</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">with-selected-window</span> <span class="nv">swiper--window</span>
      <span class="p">(</span><span class="nv">dired-unmark</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">ivy-next-line</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">ivy--exhibit</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">ivy-replace</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">from</span> <span class="p">(</span><span class="nb">with-selected-window</span> <span class="nv">swiper--window</span>
                <span class="p">(</span><span class="nv">move-beginning-of-line</span> <span class="no">nil</span><span class="p">)</span>
                <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">re-search-forward</span>
                       <span class="p">(</span><span class="nv">ivy--regex</span> <span class="nv">ivy-text</span><span class="p">)</span> <span class="p">(</span><span class="nf">line-end-position</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
                  <span class="p">(</span><span class="nv">match-string</span> <span class="mi">0</span><span class="p">)))))</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">null</span> <span class="nv">from</span><span class="p">)</span>
        <span class="p">(</span><span class="ne">user-error</span> <span class="s">&quot;No match&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">rep</span> <span class="p">(</span><span class="nf">read-string</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;Replace [%s] with: &quot;</span> <span class="nv">from</span><span class="p">))))</span>
        <span class="p">(</span><span class="nb">with-selected-window</span> <span class="nv">swiper--window</span>
          <span class="p">(</span><span class="nf">undo-boundary</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">replace-match</span> <span class="nv">rep</span> <span class="no">t</span> <span class="no">t</span><span class="p">))))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">ivy-undo</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">with-selected-window</span> <span class="nv">swiper--window</span>
    <span class="p">(</span><span class="nv">undo</span><span class="p">)))</span>
</code></pre></div>
<h2 id="the-dired-operations">The dired operations</h2>

<p>There&#39;s actually an outstanding <a href="https://github.com/abo-abo/hydra/issues/86">issue</a> to make the hydra
heads appear conditionally. This would be quite useful for the <kbd>m</kbd> and <kbd>,</kbd> bindings, since
they don&#39;t work outside a <code>dired</code> buffer. Maybe I&#39;ll get to it on the weekend.
Meanwhile, here&#39;s a screenshot for marking files in <code>dired</code> using <a href="https://github.com/abo-abo/swiper">swiper</a>:</p>

<p><img src="/download/hydra-ivy-dired.png" alt="hydra-ivy-dired.png"></p>

<p>Since the input is <code>&quot;mar 10&quot;</code>, <code>swiper</code> transforms it into the regex <code>&quot;(mar).*(10)&quot;</code>.
What I do next:</p>

<ul>
<li><kbd>C-o</kbd> to get into the hydra state.</li>
<li><kbd>99m</kbd> to mark everything. Normally, it would mark 99 candidates, but since there are only 17, that means all of them.</li>
<li><kbd>h</kbd> to go to the first candidate.</li>
<li><kbd>j,</kbd> to to skip one candidate and unmark, then unmark some more, using this method.</li>
</ul>

<p>If I wanted to move two candidates down at once, I could press <kbd>2j.....</kbd>. The <kbd>.</kbd>
will repeat the previous command with the previous argument. You can also set the argument later,
e.g.  <kbd>j.2.3..</kbd> etc.</p>

<h2 id="the-exit-points">The exit points</h2>

<p>There are two:</p>

<ul>
<li><kbd>i</kbd> will bring you back to <code>ivy</code>, so that you can edit the input.</li>
<li><kbd>o</kbd> will quit everything and bring you to the <code>dired</code> buffer.</li>
</ul>

<p>So you could first mark <code>Mar 10</code>, exit with <kbd>i</kbd>, edit the input to <code>Mar 17</code>, press
<kbd>C-o</kbd> and mark some more. Then finally exit with <kbd>o</kbd>.</p>

<h2 id="the-replace-and-undo-operations">The replace and undo operations</h2>

<p>These two I&#39;ve added the latest, so they are still a bit off.  The <code>ivy-replace</code> option is similar
to vim&#39;s <kbd>r</kbd> (I did <code>vimtutor</code> yesterday). It lets you replace the selected candidate.  And
<kbd>u</kbd> simply calls undo. Strangely, at the moment it will undo several <code>ivy-replace</code>
operations at once, even though I call <code>undo-boundary</code> in <code>ivy-replace</code>.</p>

<h2 id="outro">Outro</h2>

<p>I think <code>ivy</code> and the <code>hydra</code> docstring blend in together quite nicely, like
<a href="http://i.imgur.com/QblQ8cO.gifv">old dogs and new tricks</a>. I don&#39;t know which is which.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/03/25/swiper-0.2.0/">
        Swiper 0.2.0 is out
      </a>
    </h1>

    <span class="post-date">25 Mar 2015</span>

    <p>I forgot to mark the <code>0.1.0</code> release, so I&#39;m giving an overview of all the fixes and new features
since the first commit in <a href="https://github.com/abo-abo/swiper/releases/0.2.0">the release notes</a>.</p>

<h2 id="fixes">Fixes</h2>

<h3 id="fix-font-locking-in-certain-modes">Fix font locking in certain modes</h3>

<p>Some major modes try to optimize the font locking (highlighting text with various faces) by only
doing it for the visible portion of the text. But since <code>swiper</code> needs to access all lines at once,
it&#39;s necessary to font lock the whole buffer. This is done in <code>swiper-font-lock-ensure</code>. For some
modes, the buffer becomes discolored after calling <code>swiper-font-lock-ensure</code>. In theory, this should
not happen. As a work-around, I exclude these modes from ensuring font lock:</p>

<ul>
<li><code>package-menu-mode</code></li>
<li><code>gnus-summary-mode</code></li>
<li><code>gnus-article-mode</code></li>
<li><code>gnus-group-mode</code></li>
<li><code>emms-playlist-mode</code></li>
<li><code>erc-mode</code></li>
</ul>

<p>If you see a discoloration in one of your favorite major modes while using <code>swiper</code>, just let me
know and I&#39;ll add it to the list.</p>

<h3 id="fix-face-changes-in-the-minibuffer-propagating-to-the-main-buffer">Fix face changes in the minibuffer propagating to the main buffer</h3>

<p>This was a quite interesting <a href="https://github.com/abo-abo/swiper/issues/22">bug</a>. At that moment, I was using <code>add-face-text-property</code> to add faces to the copies of strings in the minibuffer. However, this function destructively modifies the properties, so the change to the properties of a string copy (obtained with <code>concat</code> or <code>copy-sequence</code>) was propagated to the properties of the original string. This was fixed by using <code>font-lock-append-text-property</code> instead of <code>add-face-text-property</code>.</p>

<h3 id="ivy-read-returns-immediately-for-0-1-candidates"><code>ivy-read</code> returns immediately for 0-1 candidates</h3>

<p>An obvious improvement.</p>

<h3 id="clean-up-overlays-better-for-c-g">Clean up overlays better for <kbd>C-g</kbd></h3>

<p>The hidden overlays revealed during the search will be re-hidden if you cancel the search with
<kbd>C-g</kbd>.</p>

<h3 id="ensure-that-candidates-don&#39;t-have-read-only-property">Ensure that candidates don&#39;t have read-only property</h3>

<p>This issue was causing a bug while using <code>swiper</code> in <code>erc-mode</code>, since it marks all of the buffer
content to <code>read-only</code>. So once a string with <code>read-only</code> property is inserted into the minibuffer,
you can&#39;t delete it unless you set <code>inhibit-read-only</code>.</p>

<h2 id="new-features">New Features</h2>

<h3 id="optional-initial-input">Optional initial input</h3>

<p>If you call <code>(swiper &quot;fix&quot;)</code>, you&#39;ll start searching with initial input <code>&quot;fix&quot;</code>.</p>

<h3 id="restore-the-initial-point-on-canceling">Restore the initial point on canceling</h3>

<p>If you cancel the search with e.g. <kbd>C-g</kbd> (or <kbd>DEL</kbd> when there&#39;s no input), the
initial point will be restored.</p>

<h3 id="inherit-standard-faces">Inherit standard faces</h3>

<p>To give a more standard default appearance, <code>swiper</code> faces inherit the default faces:</p>

<ul>
<li><code>isearch-lazy-highlight-face</code></li>
<li><code>isearch</code></li>
<li><code>match</code></li>
<li><code>isearch</code> again</li>
<li><code>highlight</code></li>
</ul>

<p>Most themes customize these faces, so by re-using them <code>swiper</code> blends in better.
If you want the cool (my opinion) original faces, have a look at <a href="https://github.com/abo-abo/eclipse-theme">eclipse-theme</a>.</p>

<h3 id="reveal-invisible-overlays">Reveal invisible overlays</h3>

<p>This is quite important for searches in <code>org-mode</code> buffers. I tried to make it as close as possible
to what <code>isearch</code> is doing.</p>

<h3 id="mark-is-saved-for-successful-searches">Mark is saved for successful searches</h3>

<p>This is the behavior of <code>isearch</code>. After you complete a search, you can go back to the search start with
<kbd>C-x C-SPC</kbd> (<code>pop-global-mark</code>).</p>

<h3 id="the-current-candidate-is-anchored-to-the-current-position">The current candidate is anchored to the current position</h3>

<p>This means that if many candidates are matching the current input, the one which is closest to the
current line (going forwards) is selected. This is important for not losing the context of what
you&#39;re searching.</p>

<h3 id="don&#39;t-recenter-unless-necessary">Don&#39;t recenter unless necessary</h3>

<p>This is similar to the behavior of <code>isearch</code>: a scroll is performed only if the candidate is out of
the window bounds. An alternate strategy of keeping the current candidate always centered in the
window is more distracting.</p>

<h3 id="decouple-helm-back-end">Decouple helm back end</h3>

<p><code>swiper</code> command uses only <code>ivy</code> now. If you want to use <code>helm</code>, have a look at
<a href="https://github.com/abo-abo/swiper-helm">swiper-helm</a>.</p>

<h3 id="add-history-handling">Add history handling</h3>

<p><kbd>M-n</kbd> will select the next history element, and <kbd>M-p</kbd> will select the previous
history element.</p>

<p>When there is no input, both <kbd>C-s</kbd> and <kbd>C-r</kbd> will select the last history element.
This is to make it similar to <code>isearch</code>.</p>

<p>When there is no input, and only once during the search, <kbd>M-n</kbd> will select symbol-at-point
as the current input.</p>

<h3 id="truncate-candidates-to-window-width-in-the-minibuffer">Truncate candidates to window width in the minibuffer</h3>

<p>If a candidate is longer than the window width, it will be appropriately truncated with <code>...</code>.
You can still match the invisible parts.</p>

<h3 id="warn-for-empty-buffer">Warn for empty buffer</h3>

<p>Obviously there&#39;s nothing to search for in an empty buffer.</p>

<h3 id="bring-the-last-history-candidate-to-front">Bring the last history candidate to front</h3>

<p>In case of a successful search, the current input will be removed from history, and then re-added to
the front.</p>

<h3 id="make-c-n-and-c-p-differ-from-c-s-and-c-r">Make <kbd>C-n</kbd> and <kbd>C-p</kbd> differ from <kbd>C-s</kbd> and <kbd>C-r</kbd></h3>

<p>The arrows will not recall the last history element in case the input is empty.
Otherwise, <kbd>C-n</kbd> matches to <kbd>C-s</kbd> and <kbd>C-p</kbd> matches to <kbd>C-r</kbd>.</p>

<h3 id="ivy-read-now-displays-the-number-of-candidates-in-the-prompt"><code>ivy-read</code> now displays the number of candidates in the prompt</h3>

<p>The prompt argument can hold a <code>format</code>-style expression, e.g. <code>&quot; [% 3d] pattern:&quot;</code>, and the integer
parameter will be updated with the current amount of matches.
You can also customize <code>ivy-count-format</code>, that defaults to <code>&quot;%-4d &quot;</code>.</p>

<h3 id="custom-amount-of-chars-to-start-highlighting">Custom amount of chars to start highlighting</h3>

<p>Customize <code>swiper-min-highlight</code> for this. It defaults to 2, which means that the current buffer
will be highlighted when the input has 2 chars or more. You can set it to <code>1</code> if you want, I found
it slightly distracting, since there will be a lot of highlights for just one char input.
Or you can set it to a larger value if you want the highlights to appear later.</p>

<h3 id="customize-wrapping-for-c-n-and-c-p">Customize wrapping for <kbd>C-n</kbd> and <kbd>C-p</kbd></h3>

<p>This feature being on by default in <code>helm-swoop</code> was very distracting for me, and one of the reasons
that I wrote <code>swiper</code>. So it&#39;s off by default, but you can set it if you want. Calling
<kbd>C-p</kbd> on line number 0 will cycle to the last candidate etc.</p>

<h3 id="update-copyright">Update Copyright</h3>

<p>Since <code>swiper</code> was added to <a href="https://elpa.gnu.org/packages/">GNU ELPA</a>, I had to assign the
Copyright to the FSF. This also means that you also need an FSF Copyright assignment for Emacs in
order to contribute more than total of 15 lines to the <code>swiper</code> code. It&#39;s really easy to get and is
already necessary to contribute to any package that is part of Emacs.</p>

<h3 id="add-swiper-query-replace">Add <code>swiper-query-replace</code></h3>

<p>You can start a query replace operation starting with the current candidate with <kbd>M-q</kbd>.  If
you want to query replace in whole buffer, just do <kbd>M-&lt; M-q</kbd>. And remember that
<kbd>!</kbd> will auto-replace all matches for the current query.</p>

<p>The default binding of <kbd>M-q</kbd> is <code>fill-paragraph</code>. This function is useless in the minibuffer,
so I chose that binding for query-replace, which is normally bound to sub-optimal <kbd>M-%</kbd>.
Although there are worse bindings than <kbd>M-%</kbd> (hold three keys at once), for instance, there&#39;s
<kbd>C-M-%</kbd> (hold <strong>four</strong> keys at once) that calls <code>query-replace-regexp</code>.</p>

<h2 id="outro">Outro</h2>

<p>Enjoy the new features, and a big thanks to all who contributed!</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page3">Older</a>
  
  
    
      <a class="pagination-item newer" href="/">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
