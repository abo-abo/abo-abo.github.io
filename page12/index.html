<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (or emacs &middot; irrelevant)
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://licensebuttons.net/l/by-sa/4.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/03/21/some-fun-with-hydra/">
        Some fun with Hydra
      </a>
    </h1>

    <span class="post-date">21 Mar 2015</span>

    <p>The code from this post has very little application. But it&#39;s kind of fun, so I&#39;ll post it.  Star
Trek: TNG is one of my favorite shows, so I&#39;ve added some TNG characters to one of the Hydra
features that I&#39;m testing.</p>

<h2 id="defhydradio-statement"><code>defhydradio</code> statement</h2>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;hydra</span><span class="p">)</span>
<span class="p">(</span><span class="nv">defhydradio</span> <span class="nv">hydra-tng</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">picard</span> <span class="s">&quot;_p_ Captain Jean Luc Picard:&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">riker</span> <span class="s">&quot;_r_ Commander William Riker:&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">data</span> <span class="s">&quot;_d_ Lieutenant Commander Data:&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">worf</span> <span class="s">&quot;_w_ Worf:&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">la-forge</span> <span class="s">&quot;_f_ Geordi La Forge:&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">troi</span> <span class="s">&quot;_t_ Deanna Troi:&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">dr-crusher</span> <span class="s">&quot;_c_ Doctor Beverly Crusher:&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">phaser</span> <span class="s">&quot;_h_ Set phasers to &quot;</span> <span class="nv">[stun</span> <span class="nv">kill]</span><span class="p">))</span>
</code></pre></div>
<p>The <code>defhydradio</code> macro is akin to a namespace construct that defines multiple variables that can
assume only certain values (either <code>t</code> or <code>nil</code> by default), and functions to cycle those values.</p>

<h2 id="defhydradio-implementation"><code>defhydradio</code> implementation</h2>

<p>Here&#39;s what you may see after a <code>macroexpand</code>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">progn</span>
  <span class="p">(</span><span class="k">defvar</span> <span class="nv">hydra-tng/picard</span> <span class="no">nil</span>
    <span class="s">&quot;_p_ Captain Jean Luc Picard:&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">put</span> <span class="p">(</span><span class="k">quote</span> <span class="nv">hydra-tng/picard</span><span class="p">)</span>
       <span class="p">(</span><span class="k">quote</span> <span class="nv">range</span><span class="p">)</span>
       <span class="nv">[nil</span> <span class="nv">t]</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">hydra-tng/picard</span> <span class="no">nil</span>
    <span class="p">(</span><span class="nv">hydra--cycle-radio</span> <span class="p">(</span><span class="k">quote</span> <span class="nv">hydra-tng/picard</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">defvar</span> <span class="nv">hydra-tng/riker</span> <span class="no">nil</span>
    <span class="s">&quot;_r_ Commander William Riker:&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">put</span> <span class="p">(</span><span class="k">quote</span> <span class="nv">hydra-tng/riker</span><span class="p">)</span>
       <span class="p">(</span><span class="k">quote</span> <span class="nv">range</span><span class="p">)</span>
       <span class="nv">[nil</span> <span class="nv">t]</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">hydra-tng/riker</span> <span class="no">nil</span> <span class="p">(</span><span class="nv">hydra--cycle-radio</span> <span class="p">(</span><span class="k">quote</span> <span class="nv">hydra-tng/riker</span><span class="p">)))</span>
  <span class="c1">;; ...</span>
  <span class="p">(</span><span class="k">defvar</span> <span class="nv">hydra-tng/names</span>
    <span class="o">&#39;</span><span class="p">(</span><span class="nv">hydra-tng/picard</span> <span class="nv">hydra-tng/riker</span>
      <span class="nv">hydra-tng/data</span> <span class="nv">hydra-tng/worf</span> <span class="nv">hydra-tng/la-forge</span>
      <span class="nv">hydra-tng/troi</span> <span class="nv">hydra-tng/dr-crusher</span> <span class="nv">hydra-tng/phaser</span><span class="p">)))</span>
</code></pre></div>
<p>As you can see, each list passed to <code>defhydradio</code>:</p>

<ul>
<li>gets a prefixed variable definition</li>
<li>gets a <code>range</code> property for the prefixed symbol</li>
<li>gets a prefixed function definition that cycles the variable value based on the <code>range</code> property</li>
<li>gets added to <code>hydra-tng/names</code></li>
</ul>

<h2 id="defhydra-statement"><code>defhydra</code> statement</h2>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defhydra</span> <span class="nv">hydra-tng</span> <span class="p">(</span><span class="nb">:foreign-keys</span> <span class="nv">run</span> <span class="nb">:hint</span> <span class="no">nil</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nv">hydra--table</span> <span class="nv">hydra-tng/names</span> <span class="mi">7</span> <span class="mi">2</span>
                        <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;  % -30s %% -3`%s&quot;</span>
                          <span class="s">&quot;%s %%`%s&quot;</span><span class="p">))</span>
          <span class="s">&quot;\n\n&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;p&quot;</span> <span class="p">(</span><span class="nv">hydra-tng/picard</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="nv">hydra-tng/riker</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;d&quot;</span> <span class="p">(</span><span class="nv">hydra-tng/data</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;w&quot;</span> <span class="p">(</span><span class="nv">hydra-tng/worf</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;f&quot;</span> <span class="p">(</span><span class="nv">hydra-tng/la-forge</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;t&quot;</span> <span class="p">(</span><span class="nv">hydra-tng/troi</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;c&quot;</span> <span class="p">(</span><span class="nv">hydra-tng/dr-crusher</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;h&quot;</span> <span class="p">(</span><span class="nv">hydra-tng/phaser</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;b&quot;</span> <span class="nv">beam-down</span> <span class="s">&quot;beam down&quot;</span> <span class="nb">:exit</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;o&quot;</span> <span class="p">(</span><span class="nv">hydra-reset-radios</span> <span class="nv">hydra-tng/names</span><span class="p">)</span> <span class="s">&quot;reset&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;q&quot;</span> <span class="no">nil</span> <span class="s">&quot;cancel&quot;</span><span class="p">))</span>
</code></pre></div>
<p>The interesting statement in place of the docstring will actually evaluate to this docstring:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="s">&quot;  _p_ Captain Jean Luc Picard:   % -3`hydra-tng/picard^^^^    _h_ Set phasers to  %`hydra-tng/phaser</span>
<span class="s">  _r_ Commander William Riker:   % -3`hydra-tng/riker^^^^^</span>
<span class="s">  _d_ Lieutenant Commander Data: % -3`hydra-tng/data^^^^^^</span>
<span class="s">  _w_ Worf:                      % -3`hydra-tng/worf^^^^^^</span>
<span class="s">  _f_ Geordi La Forge:           % -3`hydra-tng/la-forge^^</span>
<span class="s">  _t_ Deanna Troi:               % -3`hydra-tng/troi^^^^^^</span>
<span class="s">  _c_ Doctor Beverly Crusher:    % -3`hydra-tng/dr-crusher</span>

<span class="s">&quot;</span>
</code></pre></div>
<p>The first line overflows a bit, but it&#39;s clear what it is. There&#39;s some flexibility in using
<code>hydra--table</code>, since you can:</p>

<ul>
<li>redefine the row-column format (e.g. from 7x2 to 5x3)</li>
<li>add more variables to <code>hydra-tng/names</code></li>
</ul>

<p>Note also, that since <code>hydra-tng/names</code> holds all the names, and all the names know their default
values through <code>range</code>, it&#39;s possible to reset them all at once with <code>hydra-reset-radios</code>.</p>

<p>Finally, here&#39;s a simple implementation of <code>beam-down</code>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">beam-down</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">message</span>
   <span class="s">&quot;Beaming down: %s.&quot;</span>
   <span class="p">(</span><span class="nf">mapconcat</span>
    <span class="nf">#&#39;identity</span>
    <span class="p">(</span><span class="nf">delq</span> <span class="no">nil</span>
          <span class="p">(</span><span class="nf">mapcar</span>
           <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">symbol-value</span> <span class="nv">p</span><span class="p">)</span>
                    <span class="p">(</span><span class="nf">substring</span> <span class="p">(</span><span class="nf">symbol-name</span> <span class="nv">p</span><span class="p">)</span> <span class="mi">10</span><span class="p">)))</span>
           <span class="o">&#39;</span><span class="p">(</span><span class="nv">hydra-tng/picard</span>
             <span class="nv">hydra-tng/riker</span>
             <span class="nv">hydra-tng/data</span>
             <span class="nv">hydra-tng/worf</span>
             <span class="nv">hydra-tng/la-forge</span>
             <span class="nv">hydra-tng/troi</span>
             <span class="nv">hydra-tng/dr-crusher</span><span class="p">)))</span>
    <span class="s">&quot;, and &quot;</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c C-,&quot;</span><span class="p">)</span> <span class="ss">&#39;hydra-tng/body</span><span class="p">)</span>
</code></pre></div>
<h2 id="outro">Outro</h2>

<p>And that&#39;s it. There actually is an application of <code>defhydradio</code> in
<a href="https://github.com/abo-abo/hydra/blob/master/hydra-ox.el">hydra-ox.el</a>.  It&#39;s not fully finished,
but you can already try it as an alternative to <code>org-mode</code> export dispatch widget, most things are
working.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/03/20/managing-emacs-packages/">
        Emacs package management
      </a>
    </h1>

    <span class="post-date">20 Mar 2015</span>

    <p>Lately, I&#39;ve been spending some time to automate and publish my Emacs config.  Being able to quickly
reproduce your config has many advantages, the main one being that you no longer have to spend time
to make your config reproducible.</p>

<p>Happily, most of my config is already published in many packages, I only have to figure out a nice
layer to glue them together. Below, I&#39;ll show some automation for the packages managed by
<code>package.el</code>.</p>

<h2 id="step-1-get-the-main-directory">Step 1: get the main directory</h2>

<p>This is an important step that many other peoples&#39; configs miss, even the ones that are designed to
be distributed. You can&#39;t just assume that the config will be located in <code>~/.emacs.d</code> and rely on
Emacs defaults. Instead, it&#39;s nice to be able to clone the config into a random directory and launch
an Emacs from there, without messing with the currently installed Emacs.</p>

<p>It&#39;s also useful for having multiple repositories for different versions of Emacs. ELPA packages are
byte-compiled, and the byte code can be incompatible between versions (for instance, 24.3 and 24.4).
Having two independent checkouts with ELPA directory auto-generated really helps in that case.</p>

<p>So here is the code to get the main directory and define an ELPA directory with respect to that:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">defconst</span> <span class="nv">emacs-d</span>
  <span class="p">(</span><span class="nf">file-name-directory</span>
   <span class="p">(</span><span class="nv">file-chase-links</span> <span class="nv">load-file-name</span><span class="p">))</span>
  <span class="s">&quot;The giant turtle on which the world rests.&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">setq</span> <span class="nv">package-user-dir</span>
      <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&quot;elpa&quot;</span> <span class="nv">emacs-d</span><span class="p">))</span>
</code></pre></div>
<h2 id="step-2-decide-what-you-like">Step 2: decide what you like</h2>

<p>Next, I initialize the package and define some of the packages that I like, omitting the
dependencies that they bring. Note that the code of the whole post is stored in a separate file
<code>packages.el</code> that is not intended to be loaded on start up, so it&#39;s fine to call
<code>package-refresh-contents</code> here:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">package-initialize</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">package-archives</span>
      <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;melpa&quot;</span> <span class="o">.</span> <span class="s">&quot;http://melpa.milkbox.net/packages/&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;gnu&quot;</span> <span class="o">.</span> <span class="s">&quot;http://elpa.gnu.org/packages/&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="nv">package-refresh-contents</span><span class="p">)</span>

<span class="p">(</span><span class="k">defconst</span> <span class="nv">ora-packages</span>
  <span class="o">&#39;</span><span class="p">(</span><span class="nv">auto-compile</span> <span class="nv">auto-yasnippet</span> <span class="nv">ace-link</span> <span class="nv">ace-window</span>
    <span class="nv">company</span> <span class="nv">eclipse-theme</span> <span class="nv">flx-ido</span> <span class="nv">function-args</span>
    <span class="nv">headlong</span> <span class="nv">ido-occasional</span> <span class="nv">ido-vertical-mode</span> <span class="nv">lispy</span>
    <span class="nv">magit</span> <span class="nv">smex</span> <span class="nv">swiper</span> <span class="nb">use-package</span> <span class="nv">guide-key</span>
    <span class="nv">powerline</span> <span class="nv">projectile</span> <span class="nv">slime</span> <span class="nv">cider</span> <span class="nv">worf</span>
    <span class="nv">org-download</span> <span class="nv">make-it-so</span> <span class="nv">ukrainian-holidays</span>
    <span class="nv">netherlands-holidays</span> <span class="nv">j-mode</span><span class="p">)</span>
  <span class="s">&quot;List of packages that I like.&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="step-3-install-and-upgrade">Step 3: install and upgrade</h2>

<p>The install step is pretty straightforward: install a package unless it&#39;s already installed.
I tried to do something fancier for the upgrade, but in the end it was much more simple to
just call the interactive interface. The last two lines are basically equivalent to pressing
<kbd>Uxy</kbd> interactively:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="c1">;; install required</span>
<span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">package</span> <span class="nv">ora-packages</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">package-installed-p</span> <span class="nv">package</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">package-install</span> <span class="nv">package</span><span class="p">)))</span>

<span class="c1">;; upgrade installed</span>
<span class="p">(</span><span class="nb">save-window-excursion</span>
  <span class="p">(</span><span class="nv">package-list-packages</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">package-menu-mark-upgrades</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">package-menu-execute</span> <span class="no">t</span><span class="p">))</span>
</code></pre></div>
<h2 id="step-4-make-it-callable">Step 4: make it callable</h2>

<p>Finally, I just create a Makefile with the following contents:</p>
<div class="highlight"><pre><code class="language-Makefile" data-lang="Makefile"><span class="nv">emacs</span> <span class="o">?=</span> emacs
<span class="nf">upgrade</span><span class="o">:</span>
    <span class="k">$(</span>emacs<span class="k">)</span> -batch -l packages.el

<span class="nf">run</span><span class="o">:</span>
    <span class="k">$(</span>emacs<span class="k">)</span> -Q -l init.el

<span class="nf">up</span><span class="o">:</span> <span class="n">upgrade</span> <span class="n">run</span>
</code></pre></div>
<p>Thanks to the first line, I can issue stuff like this on the shell:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">emacs</span><span class="o">=</span>emacs24 make up
</code></pre></div>
<p>This will use the <code>emacs24</code> executable, instead of whatever <code>emacs</code> points to.  Since the <code>up</code>
target depends on <code>upgrade</code> and <code>run</code> targets, they will be executed in that order:</p>

<ul>
<li>the <code>upgrade</code> will install / upgrade all packages in a non-interactive Emacs</li>
<li>the <code>run</code> target will start an interactive Emacs with already updated packages</li>
</ul>

<p>I really like putting stuff in Makefiles, since they are very flexible, yet so easy to call.  In the
very same Makefile, I have a <code>profile</code> target from
<a href="http://oremacs.com/2015/02/24/emacs-speed-test/">the post on profiling Emacs start up</a>.  I also
wrote two packages related to Makefiles: <a href="https://github.com/abo-abo/helm-make">helm-make</a> and
<a href="https://github.com/abo-abo/make-it-so">make-it-so</a>. The latter one is actually very interesting and
deserves its own post, I should maybe just clean it up a bit.</p>

<h2 id="outro">Outro</h2>

<p>I&#39;ll just cite Gall&#39;s law here:</p>

<blockquote>
<p>A complex system that works is invariably found to have evolved from a simple system that
worked. A complex system designed from scratch never works and cannot be patched up to make it
work. You have to start over with a working simple system.</p>
</blockquote>

<p>I think it applies from both sides w.r.t. my Emacs config: it kind of works, but I really wish it
was reproducible from the start, before making it complex.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/03/19/swiper-on-youtubes/">
        A new Swiper demo on Youtube
      </a>
    </h1>

    <span class="post-date">19 Mar 2015</span>

    <h2 id="youtube-video">Youtube video</h2>

<p>Today, I&#39;ve fixed a few bugs in both <a href="https://github.com/abo-abo/swiper">swiper</a> and <code>ivy</code>.
Finally, the number of candidates display has also been added.  You can see the whole thing in the
<a href="https://www.youtube.com/watch?v=s3qwiAtKjuA">one minute video demo</a>.</p>

<p>Here are the bindings that I&#39;m using:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">global-set-key</span> <span class="s">&quot;\C-r&quot;</span> <span class="ss">&#39;swiper</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="s">&quot;\C-s&quot;</span> <span class="ss">&#39;swiper</span><span class="p">)</span>
</code></pre></div>
<h2 id="integration-tests">Integration tests</h2>

<p>I&#39;ve also added some <a href="https://github.com/abo-abo/swiper/blob/master/ivy-test.el">integration tests</a>,
if you&#39;re interested. I didn&#39;t know how to do exactly this type of testing before (when there&#39;s input from minibuffer).
Turns out, it&#39;s pretty easy to do using <code>execute-kbd-macro</code>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;ert</span><span class="p">)</span>

<span class="p">(</span><span class="k">defvar</span> <span class="nv">ivy-expr</span> <span class="no">nil</span>
  <span class="s">&quot;Holds a test expression to evaluate with `ivy-eval&#39;.&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">defvar</span> <span class="nv">ivy-result</span> <span class="no">nil</span>
  <span class="s">&quot;Holds the eval result of `ivy-expr&#39; by `ivy-eval&#39;.&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">ivy-eval</span> <span class="p">()</span>
  <span class="s">&quot;Evaluate `ivy-expr&#39;.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-result</span> <span class="p">(</span><span class="nf">eval</span> <span class="nv">ivy-expr</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c e&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-eval</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">ivy-with</span> <span class="p">(</span><span class="nv">expr</span> <span class="nv">keys</span><span class="p">)</span>
  <span class="s">&quot;Evaluate EXPR followed by KEYS.&quot;</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">ivy-expr</span> <span class="nv">expr</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">execute-kbd-macro</span>
     <span class="p">(</span><span class="nf">vconcat</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c e&quot;</span><span class="p">)</span>
              <span class="p">(</span><span class="nv">kbd</span> <span class="nv">keys</span><span class="p">)))</span>
    <span class="nv">ivy-result</span><span class="p">))</span>

<span class="p">(</span><span class="nb">ert-deftest</span> <span class="nv">ivy-read</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">should</span> <span class="p">(</span><span class="nf">equal</span>
           <span class="p">(</span><span class="nv">ivy-read</span> <span class="s">&quot;pattern: &quot;</span> <span class="no">nil</span><span class="p">)</span>
           <span class="no">nil</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">should</span> <span class="p">(</span><span class="nf">equal</span>
           <span class="p">(</span><span class="nv">ivy-read</span> <span class="s">&quot;pattern: &quot;</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;42&quot;</span><span class="p">))</span>
           <span class="s">&quot;42&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">should</span> <span class="p">(</span><span class="nf">equal</span>
           <span class="p">(</span><span class="nv">ivy-with</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">ivy-read</span> <span class="s">&quot;pattern: &quot;</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;blue&quot;</span> <span class="s">&quot;yellow&quot;</span><span class="p">))</span>
                     <span class="s">&quot;C-m&quot;</span><span class="p">)</span>
           <span class="s">&quot;blue&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">should</span> <span class="p">(</span><span class="nf">equal</span>
           <span class="p">(</span><span class="nv">ivy-with</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">ivy-read</span> <span class="s">&quot;pattern: &quot;</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;blue&quot;</span> <span class="s">&quot;yellow&quot;</span><span class="p">))</span>
                     <span class="s">&quot;y C-m&quot;</span><span class="p">)</span>
           <span class="s">&quot;yellow&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">should</span> <span class="p">(</span><span class="nf">equal</span>
           <span class="p">(</span><span class="nv">ivy-with</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">ivy-read</span> <span class="s">&quot;pattern: &quot;</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;blue&quot;</span> <span class="s">&quot;yellow&quot;</span><span class="p">))</span>
                     <span class="s">&quot;y DEL b C-m&quot;</span><span class="p">)</span>
           <span class="s">&quot;blue&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">should</span> <span class="p">(</span><span class="nf">equal</span>
           <span class="p">(</span><span class="nv">ivy-with</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">ivy-read</span> <span class="s">&quot;pattern: &quot;</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;blue&quot;</span> <span class="s">&quot;yellow&quot;</span><span class="p">))</span>
                     <span class="s">&quot;z C-m&quot;</span><span class="p">)</span>
           <span class="no">nil</span><span class="p">)))</span>
</code></pre></div>
<h2 id="outro">Outro</h2>

<p>Give the package a try, if you haven&#39;t yet. You can get it from <a href="http://melpa.org/#/swiper">MELPA</a>.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/03/18/ivy-git/">
        Find file in a Git repo with ivy
      </a>
    </h1>

    <span class="post-date">18 Mar 2015</span>

    <p>I&#39;m really enjoying using <a href="https://github.com/abo-abo/swiper">ivy</a> for matching stuff.</p>

<p>Here is today&#39;s <a href="https://github.com/abo-abo/swiper/blob/master/counsel.el">addition</a>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">couns-git</span> <span class="p">()</span>
  <span class="s">&quot;Find file in the current Git repository.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">default-directory</span> <span class="p">(</span><span class="nv">locate-dominating-file</span>
                             <span class="nv">default-directory</span> <span class="s">&quot;.git&quot;</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">cands</span> <span class="p">(</span><span class="nv">split-string</span>
                 <span class="p">(</span><span class="nv">shell-command-to-string</span>
                  <span class="s">&quot;git ls-files --full-name --&quot;</span><span class="p">)</span>
                 <span class="s">&quot;\n&quot;</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">file</span> <span class="p">(</span><span class="nv">ivy-read</span> <span class="s">&quot;Find file: &quot;</span> <span class="nv">cands</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">when</span> <span class="nv">file</span>
      <span class="p">(</span><span class="nv">find-file</span> <span class="nv">file</span><span class="p">))))</span>
</code></pre></div>
<p>This one will allow you to find a file in your Git repository.
I&#39;ve bound it like this:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c f&quot;</span><span class="p">)</span> <span class="ss">&#39;couns-git</span><span class="p">)</span>
</code></pre></div>
<p>Here&#39;s how it looks like for selecting a file in the Emacs repo:</p>

<p><img src="/download/couns-git.png" alt="couns-git.png"></p>

<p>The speed isn&#39;t an issue for 3500 candidates, although I should try to add the number of candidates
display pretty soon. It&#39;s just that there isn&#39;t a good spot in the minibuffer to show that.</p>

<p>I&#39;ve also updated <code>ivy-next-line</code> and <code>ivy-previous-line</code> to switch to the previous history element
in case <code>ivy-text</code> is empty. This is the exact behavior of <code>isearch</code>, so if you bind <code>swiper</code> to <kbd>C-s</kbd>
and <kbd>C-r</kbd> like I do, you&#39;ll find that <kbd>C-s C-s</kbd> and <kbd>C-r C-r</kbd> work as expected.
Thanks to <a href="https://github.com/johnmastro">@johnmastro</a> for the suggestion.</p>

<p>Here&#39;s the current state of the keymap:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">defvar</span> <span class="nv">ivy-minibuffer-map</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">map</span> <span class="p">(</span><span class="nf">make-sparse-keymap</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">define-key</span> <span class="nv">map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-m&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-done</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">define-key</span> <span class="nv">map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-n&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-next-line</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">define-key</span> <span class="nv">map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-p&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-previous-line</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">define-key</span> <span class="nv">map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-s&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-next-line</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">define-key</span> <span class="nv">map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-r&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-previous-line</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">define-key</span> <span class="nv">map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;SPC&quot;</span><span class="p">)</span> <span class="ss">&#39;self-insert-command</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">define-key</span> <span class="nv">map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;DEL&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-backward-delete-char</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">define-key</span> <span class="nv">map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;M-&lt;&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-beginning-of-buffer</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">define-key</span> <span class="nv">map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;M-&gt;&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-end-of-buffer</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">define-key</span> <span class="nv">map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;M-n&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-next-history-element</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">define-key</span> <span class="nv">map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;M-p&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-previous-history-element</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">define-key</span> <span class="nv">map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-g&quot;</span><span class="p">)</span> <span class="ss">&#39;minibuffer-keyboard-quit</span><span class="p">)</span>
    <span class="nv">map</span><span class="p">)</span>
  <span class="s">&quot;Keymap used in the minibuffer.&quot;</span><span class="p">)</span>
</code></pre></div>
<p>You can also try <code>counsel</code> for completing Elisp and <code>couns-clj</code> for completing Clojure.  As you can
see, the implementation is very simple: you just get a list of strings, and you&#39;re done.</p>

<p>If you want to implement some <code>ivy</code> completion for your favorite mode, I recommend to find the
corresponding <code>ac-source</code> and see where it gets its list of strings.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/03/17/more-info/">
        More Info
      </a>
    </h1>

    <span class="post-date">17 Mar 2015</span>

    <p>I really liked Marcin Borkowski&#39;s post on <a href="http://mbork.pl/2014-12-27_Info_dispatch">Info dispatch</a>,
where he describes how to open several <code>*info*</code> buffers for the most commonly used manuals.
However, as I tried to call one of these functions today, I forgot the key binding.</p>

<h2 id="hydra-to-the-rescue">Hydra to the rescue!</h2>

<p>Here&#39;s what I&#39;ve come up with:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">ora-open-info</span> <span class="p">(</span><span class="nv">topic</span> <span class="nv">bname</span><span class="p">)</span>
  <span class="s">&quot;Open info on TOPIC in BNAME.&quot;</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">get-buffer</span> <span class="nv">bname</span><span class="p">)</span>
      <span class="p">(</span><span class="k">progn</span>
        <span class="p">(</span><span class="nv">switch-to-buffer</span> <span class="nv">bname</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">string-match</span> <span class="nv">topic</span> <span class="nv">Info-current-file</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">Info-goto-node</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;(%s)&quot;</span> <span class="nv">topic</span><span class="p">))))</span>
    <span class="p">(</span><span class="nv">info</span> <span class="nv">topic</span> <span class="nv">bname</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defhydra</span> <span class="nv">hydra-info-to</span> <span class="p">(</span><span class="nb">:hint</span> <span class="no">nil</span> <span class="nb">:color</span> <span class="nv">teal</span><span class="p">)</span>
  <span class="s">&quot;</span>
<span class="s">_o_rg e_l_isp _e_macs _h_yperspec&quot;</span>
  <span class="p">(</span><span class="s">&quot;o&quot;</span> <span class="p">(</span><span class="nv">ora-open-info</span> <span class="s">&quot;org&quot;</span> <span class="s">&quot;*org info*&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;l&quot;</span> <span class="p">(</span><span class="nv">ora-open-info</span> <span class="s">&quot;elisp&quot;</span> <span class="s">&quot;*elisp info*&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;e&quot;</span> <span class="p">(</span><span class="nv">ora-open-info</span> <span class="s">&quot;emacs&quot;</span> <span class="s">&quot;*emacs info*&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;h&quot;</span> <span class="p">(</span><span class="nv">ora-open-info</span> <span class="s">&quot;gcl&quot;</span> <span class="s">&quot;*hyperspec*&quot;</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">define-key</span> <span class="nv">Info-mode-map</span> <span class="s">&quot;t&quot;</span> <span class="ss">&#39;hydra-info-to/body</span><span class="p">)</span>
</code></pre></div>
<h3 id="the-plan">The Plan</h3>

<p>I already have the <kbd>&lt;f1&gt; i</kbd> key binding hard wired to my fingers. So after I&#39;m in
<em>any</em> Info buffer, I plan to press <kbd>t</kbd> and get this dispatch:</p>

<p><img src="/download/hydra-info-dispatch.png" alt="hydra-info-dispatch.png"></p>

<h2 id="getting-the-hyperspec">Getting the Hyperspec</h2>

<p>I&#39;ve heard people lauding HTML while dumping on Info.
I&#39;d suggest them to compare the <a href="http://www.lispworks.com/documentation/HyperSpec/Front/index.htm">Common Lisp Hyperspec</a> web site
to this <a href="http://ftp.gnu.org/gnu/gcl/gcl.info.tgz">info file</a> extracted from there.
Their contents are identical, but it&#39;s easier and more pleasant to use Info.</p>

<p>After I downloaded the file, I extracted it to <code>./etc/info/gcl.info</code>, where <code>.</code> is my <code>emacs-d</code>.
Then I just added this directory to the Info path:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">Info-additional-directory-list</span>
      <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&quot;etc/info/&quot;</span> <span class="nv">emacs-d</span><span class="p">)))</span>
</code></pre></div>
<h2 id="outro">Outro</h2>

<p>Reading Info is pleasant and educational. In case you&#39;re new to Info, there&#39;s Info for Info. In Info
format! Just press <kbd>&lt;f1&gt; i h</kbd>.</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page13">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page11">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
