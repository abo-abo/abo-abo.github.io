<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="flattr:id" content="9yl9ry">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (or emacs &middot; irrelevant)
    
  </title>

  <link rel="canonical" href="https://oremacs.com/page12/" />

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>
          <a class="sidebar-nav-item" href="/about/">About</a>
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
          <a class="sidebar-nav-item" href="/donate/">Donate</a>
        <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://licensebuttons.net/l/by-sa/4.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/06/30/context-aware-hydra/">
        Context aware hydra
      </a>
    </h1>

    <span class="post-date">30 Jun 2015</span>

    <p>In this post, I&#39;ll demonstrate a snippet that came up this week in a
conversation over John Kitchin&#39;s
<a href="http://kitchingroup.cheme.cmu.edu/blog/2015/06/24/Conditional-hydra-menus/">post</a>.
While the following snippet isn&#39;t inherently useful, it might help a creative
user to understand Hydra a bit more and accomplish more advanced
things.</p>

<p>This hydra demonstrates that the hint and even the key bindings aren&#39;t
set in stone: you can modify them depending on the current state of
your Emacs, in this case the current line number.</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">defhydra</span> <span class="nv">hydra-vi</span> <span class="p">(</span><span class="nb">:hint</span> <span class="no">nil</span><span class="p">)</span>
  <span class="s">&quot;vi&quot;</span>
  <span class="p">(</span><span class="s">&quot;j&quot;</span> <span class="nv">next-line</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;k&quot;</span> <span class="nv">previous-line</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;n&quot;</span> <span class="nv">next-line</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;p&quot;</span> <span class="nv">previous-line</span><span class="p">))</span>

<span class="p">(</span><span class="k">setq</span> <span class="nv">hydra-vi/hint</span>
  <span class="o">&#39;</span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">evenp</span> <span class="p">(</span><span class="nv">line-number-at-pos</span><span class="p">))</span>
    <span class="p">(</span><span class="k">prog1</span> <span class="p">(</span><span class="nf">eval</span>
            <span class="p">(</span><span class="nv">hydra--format</span> <span class="no">nil</span> <span class="o">&#39;</span><span class="p">(</span><span class="no">nil</span> <span class="no">nil</span> <span class="nb">:hint</span> <span class="no">nil</span><span class="p">)</span>
                           <span class="s">&quot;\neven: _j_ _k_\n&quot;</span> <span class="nv">hydra-vi/heads</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">define-key</span> <span class="nv">hydra-vi/keymap</span> <span class="s">&quot;n&quot;</span> <span class="no">nil</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">define-key</span> <span class="nv">hydra-vi/keymap</span> <span class="s">&quot;p&quot;</span> <span class="no">nil</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">define-key</span> <span class="nv">hydra-vi/keymap</span> <span class="s">&quot;j&quot;</span> <span class="ss">&#39;hydra-vi/next-line</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">define-key</span> <span class="nv">hydra-vi/keymap</span> <span class="s">&quot;k&quot;</span> <span class="ss">&#39;hydra-vi/previous-line</span><span class="p">))</span>
    <span class="p">(</span><span class="k">prog1</span> <span class="p">(</span><span class="nf">eval</span>
            <span class="p">(</span><span class="nv">hydra--format</span> <span class="no">nil</span> <span class="o">&#39;</span><span class="p">(</span><span class="no">nil</span> <span class="no">nil</span> <span class="nb">:hint</span> <span class="no">nil</span><span class="p">)</span>
                           <span class="s">&quot;\nodd: _n_ _p_\n&quot;</span> <span class="nv">hydra-vi/heads</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">define-key</span> <span class="nv">hydra-vi/keymap</span> <span class="s">&quot;j&quot;</span> <span class="no">nil</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">define-key</span> <span class="nv">hydra-vi/keymap</span> <span class="s">&quot;k&quot;</span> <span class="no">nil</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">define-key</span> <span class="nv">hydra-vi/keymap</span> <span class="s">&quot;n&quot;</span> <span class="ss">&#39;hydra-vi/next-line</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">define-key</span> <span class="nv">hydra-vi/keymap</span> <span class="s">&quot;p&quot;</span> <span class="ss">&#39;hydra-vi/previous-line</span><span class="p">))))</span>
</code></pre></div>
<p>The first statement is one of the most elementary <code>defhydra</code>
calls. The only extra thing is that it sets the <code>:hint</code> to nil.</p>

<p>The <code>defhydra</code> statement generates a bunch of function and variable
definitions. You can examine them closely by evaluating:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nf">macroexpand</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">defhydra</span> <span class="nv">hydra-vi</span> <span class="p">(</span><span class="nb">:hint</span> <span class="no">nil</span><span class="p">)</span>
   <span class="s">&quot;vi&quot;</span>
   <span class="p">(</span><span class="s">&quot;j&quot;</span> <span class="nv">next-line</span><span class="p">)</span>
   <span class="p">(</span><span class="s">&quot;k&quot;</span> <span class="nv">previous-line</span><span class="p">)</span>
   <span class="p">(</span><span class="s">&quot;n&quot;</span> <span class="nv">next-line</span><span class="p">)</span>
   <span class="p">(</span><span class="s">&quot;p&quot;</span> <span class="nv">previous-line</span><span class="p">)))</span>
</code></pre></div>
<p>Just paste that code into <code>*scratch*</code>, and press <kbd>C-j</kbd>. If
you want pretty output (153 lines of code instead of 26), turn on
<a href="https://github.com/abo-abo/lispy">lispy-mode</a> and press <kbd>E</kbd>
instead of <kbd>C-j</kbd>.</p>

<p>Anyway, among these defined variables is <code>hydra-vi/hint</code> which is
evaluated each time to display the hint. So now we can just redefine
<code>hydra-vi/hint</code> to make it so that on even lines <kbd>n</kbd> calls
<code>next-line</code>, while on odd lines it&#39;s <kbd>j</kbd>, with the
appropriate changes in the doc. The change in bindings, modifying
<code>hydra-vi/keymap</code> - also one of the defined variables, needs to be a
side-effect, since <code>hydra-vi/hint</code> is expected to evaluate to a
string.</p>

<p>Just to give you some idea of how it could be used: you can have a
context-aware &quot;open&quot; command that, for instance, delegates to
<code>open-in-pdf-tools</code> or <code>open-in-firefox</code> or <code>open-in-emacs</code> when it
detects that the point is on a link. And of course all these commands
would have their own key binding that works only if the command makes
sense.</p>

<p>This approach is described on
<a href="https://github.com/abo-abo/hydra/wiki/Conditional-Hydra">the wiki</a>,
in case you read this post much later and want to see an up-to-date
code, or even update it yourself. In case something cool comes out of
this snippet, I can try to implement a more palatable API for
<code>defhydra</code>, most likely an option to supply a function name in the
<code>docstring</code> argument position.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/06/23/counsel-load-theme/">
        New video demo - counsel-load-theme
      </a>
    </h1>

    <span class="post-date">23 Jun 2015</span>

    <p>Without further ado, here&#39;s the <a href="https://youtu.be/V_whk214fec">video link</a>.</p>

<h2 id="the-code">The code</h2>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">counsel--load-theme-action</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
  <span class="s">&quot;Disable current themes and load theme X.&quot;</span>
  <span class="p">(</span><span class="k">condition-case</span> <span class="no">nil</span>
      <span class="p">(</span><span class="k">progn</span>
        <span class="p">(</span><span class="nf">mapc</span> <span class="nf">#&#39;</span><span class="nv">disable-theme</span> <span class="nv">custom-enabled-themes</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">load-theme</span> <span class="p">(</span><span class="nf">intern</span> <span class="nv">x</span><span class="p">))</span>
        <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">fboundp</span> <span class="ss">&#39;powerline-reset</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">powerline-reset</span><span class="p">)))</span>
    <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Problem loading theme %s&quot;</span> <span class="nv">x</span><span class="p">)))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">counsel-load-theme</span> <span class="p">()</span>
  <span class="s">&quot;Forward to </span><span class="ss">`load-theme&#39;</span><span class="s">.</span>
<span class="s">Usable with </span><span class="ss">`ivy-resume&#39;</span><span class="s">, </span><span class="ss">`ivy-next-line-and-call&#39;</span><span class="s"> and</span>
<span class="ss">`ivy-previous-line-and-call&#39;</span><span class="s">.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">ivy-read</span> <span class="s">&quot;Load custom theme: &quot;</span>
            <span class="p">(</span><span class="nf">mapcar</span> <span class="ss">&#39;symbol-name</span>
                    <span class="p">(</span><span class="nv">custom-available-themes</span><span class="p">))</span>
            <span class="nb">:action</span> <span class="nf">#&#39;</span><span class="nv">counsel--load-theme-action</span><span class="p">))</span>
</code></pre></div>
<p>It looks almost trivial, the main idea is to disable all current
themes and load the new one. Additionally, try to reset the
<code>powerline</code>, since it has to match the <code>mode-line</code> face, which most
themes customize.</p>

<h2 id="the-interface">The Interface</h2>

<p>The interface of <code>ivy-read</code> is the same as the built-in
<code>completing-read</code> in first two arguments. The difference is that it
also accepts a callback through the <code>:action</code> argument.  This callback
will make the completion engine aware of what needs to be done with
the completion result. The presence of the callback allows these completion engine features to work:</p>

<ul>
<li><code>ivy-resume</code> will resume the last completion. Very useful if you
change your mind on the candidate, or want to examine a related
candidate.<br></li>
<li><code>ivy-next-line-and-call</code> selects the next matching candidate and executes the callback for it.</li>
<li><code>ivy-previous-line-and-call</code> selects the previous matching candidate and executes the callback for it.</li>
</ul>

<p>I like to think of <code>ivy-resume</code> as a <kbd>DEL</kbd> or
<kbd>&lt;left&gt;</kbd> for completion. As you can erase or go back
one character with the same <kbd>DEL</kbd> binding, regardless of the
last character inputted (<kbd>a</kbd> or <kbd>B</kbd> etc), in the
same way you can call the completion again with the same
<kbd>&lt;f6&gt;</kbd> binding, regardless of the command that required
completion (<code>counsel-git-grep</code> or <code>counsel-load-theme</code> or
<code>counsel-load-library</code> etc). <code>ivy-resume</code> isn&#39;t bound by default,
since it needs to be a global binding. I just use this in my config:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">[</span><span class="nv">f6</span><span class="p">]</span> <span class="ss">&#39;ivy-resume</span><span class="p">)</span>
</code></pre></div>
<p>For the functions that execute the callback while changing the
candidate, the idea is:</p>

<ul>
<li><kbd>C-M-n</kbd> (<code>ivy-next-line-and-call</code>) corresponds to <kbd>C-n</kbd> (<code>ivy-next-line</code>),</li>
<li><kbd>C-M-p</kbd> (<code>ivy-previous-line-and-call</code>) corresponds to <kbd>C-n</kbd> (<code>ivy-previous-line</code>).</li>
</ul>

<p>I&#39;ve also showed off a generic <code>ivy</code> feature: <kbd>M-j</kbd> will yank
the word at point into the minibuffer.  Think of it as the mirror of
<kbd>C-w</kbd> in <code>isearch</code>. It could not be <kbd>C-w</kbd>, since I
like <kbd>C-w</kbd> being bound to <code>kill-region</code>.</p>

<h2 id="the-command-insert-mode-split">The command/insert mode split</h2>

<p><img src="/download/counsel-load-theme.png" alt="counsel-load-theme.png"></p>

<p>Finally, I show off the equivalent
<a href="https://github.com/abo-abo/hydra">hydra</a>-based modal selection
method.  So instead of pressing <kbd>C-M-n C-M-n C-M-n C-M-p
C-M-p</kbd>, you can press the equivalent <kbd>C-o c jjjkk</kbd>.
Luckily, you don&#39;t need to remember a lot of bindings for this <code>hydra</code>
mode: just press <kbd>C-o</kbd> and read the hints. I&#39;ll just list the
exit points, since that&#39;s usually the more important stuff:</p>

<ul>
<li>To exit the &quot;command-mode&quot; completely, press <kbd>o</kbd> or the standard <kbd>C-g</kbd>.</li>
<li>To exit the &quot;command-mode&quot; with the current candidate, press <kbd>f</kbd> or <kbd>d</kbd>.</li>
<li>To exit the &quot;command-mode&quot; and once again edit the minibuffer, press <kbd>i</kbd>.</li>
</ul>

<p>You might ask why <kbd>f</kbd> and <kbd>d</kbd> do the same. They
actually mirror <kbd>C-j</kbd> (<code>ivy-alt-done</code>) and <kbd>C-m</kbd>
(<code>ivy-done</code>). And if you ask what the difference between those two is,
the answer is that <code>ivy-alt-done</code> will not exit the completion when
selecting directories during file name completion. It may be possible
to extend this to other types of completion where it makes sense to
select something but not to exit the minibuffer.</p>

<h2 id="outro">Outro</h2>

<p>If you&#39;re using <code>ivy-mode</code>, make sure to try the new features: the
action-using commands should work for any command that starts with
<code>counsel-</code>. For other commands, like <code>package-install</code>, you can only
select one candidate with <kbd>C-m</kbd>.</p>

<p>Also do try <kbd>C-M-n</kbd> with <code>counsel-find-file</code>: you&#39;ll be able
to cycle through all files in a directory without exiting the
completion. Same goes for <code>ivy-switch-buffer</code>, which should probably
be renamed to <code>counsel-switch-buffer</code> for consistency.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/06/22/debug-clojure/">
        Debug Clojure with CIDER and lispy
      </a>
    </h1>

    <span class="post-date">22 Jun 2015</span>

    <p>To commemorate the release of <a href="http://batsov.com/articles/2015/06/16/cider-0-dot-9/">CIDER 0.9.0</a>, I&#39;ve just
added the ability to debug-step-in Clojure expressions to <a href="https://github.com/abo-abo/lispy">lispy</a>.</p>

<p>This ability was present for Elisp for a very long time, and it&#39;s
instrumental to
<a href="https://github.com/abo-abo?tab=repositories">my Elisp output</a>. So now
I&#39;ve added exactly the same thing to Clojure.</p>

<h2 id="how-it-works">How it works</h2>

<p>Suppose that you have this function (borrowed from <a href="http://www.manning.com/fogus2/">The Joy of Clojure</a>):</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span></span><span class="p">(</span><span class="kd">defn </span><span class="nv">l-&gt;rfix</span>
  <span class="p">([</span><span class="nv">a</span> <span class="nv">op</span> <span class="nv">b</span><span class="p">]</span>
   <span class="p">(</span><span class="nf">op</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))</span>
  <span class="p">([</span><span class="nv">a</span> <span class="nv">op1</span> <span class="nv">b</span> <span class="nv">op2</span> <span class="nv">c</span><span class="p">]</span>
   <span class="p">(</span><span class="nf">op2</span> <span class="nv">c</span> <span class="p">(</span><span class="nf">op1</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)))</span>
  <span class="p">([</span><span class="nv">a</span> <span class="nv">op1</span> <span class="nv">b</span> <span class="nv">op2</span> <span class="nv">c</span> <span class="nv">op3</span> <span class="nv">d</span><span class="p">]</span>
   <span class="p">(</span><span class="nf">op3</span> <span class="nv">d</span> <span class="p">(</span><span class="nf">op2</span> <span class="nv">c</span> <span class="p">(</span><span class="nf">op1</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)))))</span>
</code></pre></div>
<p>An important thing is that the function needs to be loaded (probably
with <code>cider-load-file</code>), in order for Clojure to know its location. If
you only evaluate the function with <kbd>C-x C-e</kbd>, it won&#39;t
work. Actually, the same applies to Elisp.</p>

<p>And then you have the corresponding function call (<code>|</code> is the point, as usual):</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span></span><span class="err">|</span><span class="p">(</span><span class="nf">l-&gt;rfix</span> <span class="mi">10</span> <span class="nb">* </span><span class="mi">2</span> <span class="nb">+ </span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<p>As you press <kbd>xj</kbd> (<code>lispy-debug-step-in</code>), the following code is evaluated on the Clojure side:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span></span><span class="p">(</span><span class="nf">do</span>
  <span class="p">(</span><span class="k">def </span><span class="nv">a</span> <span class="mi">10</span><span class="p">)</span>
  <span class="p">(</span><span class="k">def </span><span class="nv">op1</span> <span class="nv">*</span><span class="p">)</span>
  <span class="p">(</span><span class="k">def </span><span class="nv">b</span> <span class="mi">2</span><span class="p">)</span>
  <span class="p">(</span><span class="k">def </span><span class="nv">op2</span> <span class="nv">+</span><span class="p">)</span>
  <span class="p">(</span><span class="k">def </span><span class="nv">c</span> <span class="mi">3</span><span class="p">))</span>
</code></pre></div>
<p>At the same time, you are taken to the second branch of the body of
<code>l-&gt;rfix</code> - exactly the one that corresponds to 5 arguments.  And
that&#39;s it: you now have <code>a</code>, <code>op1</code> etc defined to their proper
values. You can now continue within the function body with many
possible follow-ups. I&#39;ll just list the eval-related ones:</p>

<ul>
<li>Use <kbd>e</kbd> to evaluate expression at point.</li>
<li>If you want to evaluate a symbol, mark it with <kbd>M-m</kbd>, end
evaluate with <kbd>e</kbd>. Actually, I prefer to mark stuff with
<kbd>m</kbd> and <kbd>hjkl</kbd> arrows, using <kbd>i</kbd> to mark
the first element of the region. It&#39;s also possible to mark with
<kbd>a</kbd>, and <kbd>2m</kbd>, <kbd>3m</kbd> etc.</li>
<li>If you want to bind a symbol in a <code>let</code> binding, mark both the
symbol and its value, and press <kbd>e</kbd>. If there are many
<code>let</code> bindings, you can navigate to the next one with either
<kbd>jj</kbd> or <kbd>2j</kbd>.</li>
<li>You can debug-step-in again if needed with <kbd>xj</kbd>.</li>
<li>You can flatten a function or a macro call with <kbd>xf</kbd>.</li>
<li>You can eval-and-insert with <kbd>E</kbd>.</li>
<li>You can eval-and-commented-insert with <kbd>2e</kbd>.</li>
</ul>

<p>Just to add, any of these will work properly and switch to an appropriate body branch:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span></span><span class="p">(</span><span class="nf">l-&gt;rfix</span> <span class="mi">1</span> <span class="nb">* </span><span class="mi">1</span> <span class="nb">+ </span><span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nf">l-&gt;rfix</span> <span class="mi">2</span> <span class="nb">+ </span><span class="mi">7</span><span class="p">)</span>
<span class="p">(</span><span class="nf">l-&gt;rfix</span> <span class="mi">1</span> <span class="nb">+ </span><span class="mi">2</span> <span class="nb">+ </span><span class="mi">3</span> <span class="nb">+ </span><span class="mi">4</span><span class="p">)</span>
<span class="p">(</span><span class="nf">l-&gt;rfix</span> <span class="p">(</span><span class="nb">str </span><span class="s">&quot;a&quot;</span> <span class="s">&quot;b&quot;</span> <span class="s">&quot;c&quot;</span><span class="p">)</span> <span class="nb">+ </span><span class="mi">7</span><span class="p">)</span>
</code></pre></div>
<h2 id="outro">Outro</h2>

<p>Enjoy the new code, but be mindful that it&#39;s really fresh, so it will
certainly have some quirks.  For instance, function arguments as a map
won&#39;t work since I haven&#39;t programmed for that yet.  Big thanks to
<a href="https://github.com/bbatsov">@bbatsov</a> and all CIDER contributors.</p>

<p>A really cool thing that I hope to get in the future, is to make
<kbd>Z</kbd> (<code>lispy-edebug-stop</code>) also work in Clojure.  What it does
currently for Elisp, is to use <code>edebug</code> to setup the function
arguments. It may be possible to use
<a href="https://github.com/Malabarba">@Malabarba</a>&#39;s new debugger
implementation for the same thing.</p>

<p>The advantages of using <code>lispy</code>-style debugger are the following:</p>

<ul>
<li>You can navigate your code the way you want, not just in a way that
the debugger allows you to.</li>
<li>You can multi-debug, and have sessions last for days.</li>
<li>You can edit the code as you debug. For this new code, I started
debugging when there was only a function name.  I added the body code
expression-by-expression, simultaneously debugging it.</li>
</ul>

<p>The disadvantage is a bit of namespace pollution, but I think it&#39;s
more or less acceptable.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/06/19/avy-0.3.0/">
        avy 0.3.0 is out
      </a>
    </h1>

    <span class="post-date">19 Jun 2015</span>

    <p>This is a feature-packed release consisting of 57 commits done over
the course of the last month by me and many
<a href="https://github.com/abo-abo/avy/graphs/contributors">contributors</a>.</p>

<p>I&#39;m trying something different this time with the
<a href="https://github.com/abo-abo/avy/releases/tag/0.3.0">release-notes</a>:
I&#39;ve started a
<a href="https://github.com/abo-abo/avy/blob/master/doc/Changelog.org">Changlelog.org</a>
in the repository, which is much more pleasant to read (and write) in <a href="https://raw.githubusercontent.com/abo-abo/avy/master/doc/Changelog.org"><code>org-mode</code> form</a> inside Emacs:</p>

<p><img src="/download/avy-changelog-org.png" alt="avy-changelog-org.png"></p>

<p>Then I used <a href="http://pandoc.org/">pandoc</a> to convert the Org file to Markdown. Too bad, the <code>pandoc</code> install-able through <code>apt-get</code> knows nothing of Org mode,
so I had to</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>cabal install pandoc
</code></pre></div>
<p>and let <code>cabal</code> do its thing for like 30 minutes. The exported
Markdown wasn&#39;t too bad, just had to reformat most things to one line,
since Github&#39;s <code>fill-column</code> is like 150 chars instead of the
usual 80.  If someone has more experience of exporting Org to
Markdown, please do share: maybe there&#39;s a better way to do this.</p>

<p>Anyway, read the release notes either at <a href="https://github.com/abo-abo/avy/releases/tag/0.3.0">github</a> or <a href="https://raw.githubusercontent.com/abo-abo/avy/master/doc/Changelog.org">inside Emacs</a> and enjoy the cool new stuff.  Big thanks to all contributors.</p>

<p>Also check out the <a href="https://github.com/abo-abo/avy/wiki/defcustom">wiki page on customization</a> and other pages.
I think it would be cool to have a separate page for e.g. <code>avy-goto-char</code> with the screenshots (or gifs) for all values of <code>avy-style</code>:</p>

<ul>
<li><code>pre</code></li>
<li><code>post</code></li>
<li><code>at</code></li>
<li><code>at-full</code></li>
<li><code>de-bruijn</code></li>
</ul>

<p>So if anyone is willing to contribute (and check out those overlay
styles in the process), please go ahead: you can either clone the wiki
with:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>git clone https://github.com/abo-abo/avy.wiki.git
</code></pre></div>
<p>and push, or just <a href="https://github.com/abo-abo/avy/wiki/_new">edit</a> it using Github&#39;s widgets.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/06/09/lispy-case-to-cond/">
        Transform a LISP case into a cond with lispy
      </a>
    </h1>

    <span class="post-date">09 Jun 2015</span>

    <p>Just a little extension to the old <kbd>xc</kbd> (<code>lispy-to-cond</code>)
command that I&#39;ve added today to <a href="https://github.com/abo-abo/lispy">lispy</a>:</p>

<p><img src="/download/lispy-case-to-cond.png" alt="lispy-case-to-cond.png"></p>

<p>Previously, <kbd>xc</kbd> could only transform a series of nested <code>if</code>
into a <code>cond</code>.  You can even chain <kbd>xcxi</kbd> to transform a
<code>case</code> statement into equivalent <code>if</code> statements.</p>

<p>Note also that unwanted whitespace is properly removed. What you see
in the picture is actually an
<a href="https://www.gnu.org/software/emacs/manual/html_node/ert/">ERT</a> test
that&#39;s being run each time I commit new stuff. It makes sure that
starting in the first buffer state and pressing <kbd>xc</kbd> really
results in the second buffer state. With this test, it&#39;s reasonable to
believe that <kbd>xc</kbd> will actually work the same way in an
interactive scenario. Right now, there are 599 of these type of tests
in lispy-test.el.  To view them like in the screenshot, you can press
<kbd>xv</kbd>.</p>

<p>Final note, I realize that it should be <code>eql</code> instead of <code>eq</code>, but I
like <code>eq</code> more: it&#39;s 33% more efficient.</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page13">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page11">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
