<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="flattr:id" content="9yl9ry">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (or emacs &middot; irrelevant)
    
  </title>

  <link rel="canonical" href="https://oremacs.com/page6/" />

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/donate/">Donate</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://licensebuttons.net/l/by-sa/4.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/01/06/ivy-flx/">
        Better fuzzy matching support in Ivy
      </a>
    </h1>

    <span class="post-date">06 Jan 2016</span>

    <p>Recently, I wrote some code to add better highlighting for
<a href="https://github.com/abo-abo/swiper">Ivy</a>&#39;s fuzzy matcher. Here&#39;s a
quick step-by-step to get an equivalent of
<a href="https://github.com/lewang/flx">flx-ido-mode</a> working with Ivy.</p>

<h2 id="step-1-install-the-packages">Step 1: install the packages</h2>

<p><kbd>M-x</kbd> <code>package-install</code> - <code>counsel</code> and <code>flx</code> (MELPA should be configured).</p>

<h2 id="step-2-configure-ivy-re-builders-alist">Step 2: configure <code>ivy-re-builders-alist</code></h2>

<p>Here&#39;s the default setting:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-re-builders-alist</span>
      <span class="o">&#39;</span><span class="p">((</span><span class="no">t</span> <span class="o">.</span> <span class="nv">ivy--regex-plus</span><span class="p">)))</span>
</code></pre></div>
<p>The default matcher will use a <code>.*</code> regex wild card in place of each
single space in the input.  If you want to use the fuzzy matcher,
which instead uses a <code>.*</code> regex wild card between each input letter,
write this in your config:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-re-builders-alist</span>
      <span class="o">&#39;</span><span class="p">((</span><span class="no">t</span> <span class="o">.</span> <span class="nv">ivy--regex-fuzzy</span><span class="p">)))</span>
</code></pre></div>
<p>You can also mix the two regex builders, for example:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-re-builders-alist</span>
      <span class="o">&#39;</span><span class="p">((</span><span class="nv">ivy-switch-buffer</span> <span class="o">.</span> <span class="nv">ivy--regex-plus</span><span class="p">)</span>
        <span class="p">(</span><span class="no">t</span> <span class="o">.</span> <span class="nv">ivy--regex-fuzzy</span><span class="p">)))</span>
</code></pre></div>
<p>The <code>t</code> key is used for all fall-through cases, otherwise the key is
the command or collection name.</p>

<p>The fuzzy matcher often results in substantially more matching
candidates than the regular one for similar input. That&#39;s why some
kind of sorting is important to bring the more relevant matching
candidates to the start of the list. Luckily, that&#39;s already been
figured out in <code>flx</code>, so to have it working just make sure that the
<code>flx</code> package is installed.</p>

<h2 id="step-3-optionally-configure-ivy-initial-inputs-alist">Step 3: optionally configure <code>ivy-initial-inputs-alist</code></h2>

<p>The <code>ivy-initial-inputs-alist</code> variable is pretty useful in
conjunction with the default matcher. It&#39;s usually used to insert <code>^</code>
into the input area for certain commands.</p>

<p>If you&#39;re going fuzzy all the way, you can do without the initial <code>^</code>,
and simply let <code>flx</code> (hopefully) sort the matches in a nice way:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-initial-inputs-alist</span> <span class="no">nil</span><span class="p">)</span>
</code></pre></div>
<h2 id="the-result">The result</h2>

<p>Here&#39;s how <kbd>M-x</kbd> <code>counsel-M-x</code> looks like now:</p>

<p><img src="/download/ivy-flx-highlight.png" alt="ivy-flx-highlight.png"></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/07/ivy-0.7.0/">
        Ivy-mode 0.7.0 is out
      </a>
    </h1>

    <span class="post-date">07 Dec 2015</span>

    <h2 id="intro">Intro</h2>

<p><a href="https://github.com/abo-abo/swiper">Ivy-mode</a> is a completion method
that&#39;s similar to <code>Ido</code>, but with emphasis on simplicity and
customizability.  Currently, there are two related packages on MELPA:
<code>swiper</code> and <code>counsel</code>:</p>

<ul>
<li><code>swiper</code> provides an <code>isearch</code> replacement, using <code>ivy-read</code> for
completion, as well as the basic <code>ivy-mode</code>.</li>
<li><code>counsel</code> provides some extra commands that use <code>ivy-read</code>, like <code>-M-x</code>, <code>-ag</code>,
<code>-load-theme</code> etc.</li>
</ul>

<h2 id="release-notes">Release Notes</h2>

<p>The release notes are available at the
<a href="https://github.com/abo-abo/swiper/releases/tag/0.7.0">homepage</a> as usual.
There are 220 commits since the last release, which was on Aug 5, roughly
4 months ago.  Slowly but surely, the
<a href="https://github.com/abo-abo/swiper/graphs/contributors">contributors list</a>
has grown to 20 people, besides me. A few people even got their Emacs
Copyright Assignment just to make large contributions. Statistically,
Org-mode is probably the prime package that leads to the most CA, but
I&#39;m glad that Ivy is there as well, contributing in a small way.</p>

<p>The release notes are made in
<a href="https://github.com/abo-abo/swiper/blob/master/doc/Changelog.org#070">Org-mode</a>,
each new version is a level 1 heading.  With time, hopefully, their
parts will make their way into the
<a href="https://github.com/abo-abo/swiper/blob/master/doc/ivy.org">manual</a>,
which is also in Org-mode.</p>

<p>In addition, I also export each new release notes to
<a href="https://github.com/abo-abo/swiper/releases/tag/0.7.0">Markdown</a> using
<a href="http://pandoc.org/">pandoc</a>, since that&#39;s what Github prefers.</p>

<h2 id="release-process">Release Process</h2>

<p>Since the release notes for <code>0.7.0</code> are huge, I don&#39;t embed them into
the post, they&#39;re listed separately.  You can go through them at your
own pace, or wait until I make some highlights for each piece either
or the blog or in the manual. The manual, by the way, is a work in
progress but is already distributed in MELPA. Use <kbd>C-h i</kbd>
followed by <kbd>g</kbd> <code>(ivy)</code> to read it. If you&#39;re new to reading
the info pages, there&#39;s info on info in info format: use <kbd>dg</kbd>
<code>(info)</code> to access it.</p>

<p>Today, I&#39;ll describe some cool stuff that I used to generate the
Markdown notes from <code>Changelog.org</code>.</p>

<h3 id="org-modes-org-narrow-to-subtree">Org-mode&#39;s <code>org-narrow-to-subtree</code></h3>

<p>Since <code>Changelog.org</code> already has a <code>0.6.0</code> branch that I didn&#39;t want
to see, I&#39;ve narrowed the buffer to only the <code>0.7.0</code> branch.  This is
possible to do thanks to Emacs&#39; narrowing feature and
<code>org-narrow-to-subtree</code>.  After this command, the buffer behaves as if
the <code>0.6.0</code> branch isn&#39;t there and the only content is <code>0.7.0</code> branch.
But if I perform any edits and save the file, everything that was
hidden is still there.</p>

<p>As a shortcut, I&#39;m using my <a href="https://github.com/abo-abo/worf">worf</a> to narrow faster.
Pressing <kbd>[</kbd> while <code>worf-mode</code> is active goes back to the current heading start.
While at heading start, pressing alphanumeric keys calls commands instead of self-inserting:</p>

<ul>
<li><kbd>N</kbd> calls <code>org-narrow-to-subtree</code>,</li>
<li><kbd>W</kbd> calls <code>widen</code>, which turns narrowing off.</li>
</ul>

<p>There are, of course, many more commands and bindings in <code>worf</code>. Check
it out if you like Org&#39;s Speed Keys feature, but feel like it could
use more structure.</p>

<h3 id="pandoc-mode"><code>pandoc-mode</code></h3>

<p><a href="https://github.com/joostkremers/pandoc-mode">pandoc-mode</a> is an Emacs
interface to <a href="http://pandoc.org/">pandoc</a> - a tool that allows to
export documents from one format to another.
The Elisp package is available in MELPA.
And I installed <a href="https://github.com/jgm/pandoc/releases/download/1.15.2/pandoc-1.15.2-1-amd64.deb">pandoc-1.15.2-1-amd64.deb</a> from
its <a href="https://github.com/jgm/pandoc/releases/tag/1.15.2">homepage</a> with:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>sudo dpkg -i pandoc-1.15.2-1-amd64.deb
</code></pre></div>
<p>After that, <kbd>M-x</kbd> <code>pandoc-mode</code> and I&#39;m on easy street: <kbd>C-c /</kbd> calls <code>pandoc-main-hydra/body</code>:</p>

<ul>
<li>Set the output format to Github-flavored Markdown with <kbd>OG</kbd>.</li>
<li>Set the input format to Org-mode with <kbd>bIo</kbd>.</li>
<li>Export with <kbd>C-c / r</kbd>.</li>
<li>View the resulting buffer with <kbd>C-c / V</kbd>.</li>
</ul>

<h3 id="add-table-of-contents-to-markdown">Add table of contents to Markdown</h3>

<p>I used <kbd>M-x</kbd> <code>markdown-toc/generate-toc</code> for this. The MELPA
package <a href="https://github.com/ardumont/markdown-toc">markdown-toc</a>
provides this function.  The resulting table of contents is a list
with a bunch of links, which turned out to be dead, because of the way
Github renders Markdown for releases.</p>

<h3 id="use-swiper-to-replace-each-markdown-link-with-its-title">Use <code>swiper</code> to replace each Markdown link with its title</h3>

<p>Since <code>swiper</code> works with regexps, here&#39;s what I input to match each link:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>\[\(.*?\)\](.*?)
</code></pre></div>
<p>This matches anything in brackets (non-greedy), followed by anything
in parens; the bracket&#39;s content is captured in a group.</p>

<p>Then I press <kbd>M-q</kbd> (<code>swiper-query-replace</code>) and enter <code>\1</code> as
replacement - the first captured group. After this, I confirm each
replacement with <kbd>y</kbd> or confirm them all at once with
<kbd>!</kbd>.</p>

<h3 id="use-rectangle-mark-mode-to-promote-toc-one-level">Use <code>rectangle-mark-mode</code> to promote TOC one level</h3>

<p>Since all entries in the TOC were children to a single <code>0.7.0</code> entry,
I wanted to remove that entry and promote its children one level.
This can be done with <code>rectangle-mark-mode</code>, bound by default to <kbd>C-x SPC</kbd>.</p>

<p>In my config, I use this instead:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-x SPC&quot;</span><span class="p">)</span> <span class="ss">&#39;hydra-rectangle/body</span><span class="p">)</span>
</code></pre></div>
<p>Where, <code>hydra-rectangle/body</code> is provided by <code>hydra-examples.el</code> and
is also described in
<a href="http://oremacs.com/2015/02/25/rectangle-hydra/">an earlier post</a>.  I
really liked the <code>hydra-rectangle/body</code> idea and use it all the time.
Here&#39;s a key sequence I used to delete a <code>4x95</code> rectangle in order to
promote the list items: <kbd>C-x SPC 4l95jdo</kbd>.</p>

<h3 id="use-basic-elisp-to-turn-each-bug-reference-into-an-org-mode-link">Use basic Elisp to turn each bug reference into an Org-mode link</h3>

<p>When copy-pasting from the commit log into <code>Changelog.org</code>, I quickly
tired of putting the each issue link as
e.g. <code>[[https://github.com/abo-abo/swiper/issues/244][#244]]</code>.  So I
wrote e.g. <code>#244</code> instead, and used this code in the end to make the
transformation:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">ora-quote-github-issues</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">base</span> <span class="s">&quot;https://github.com/abo-abo/swiper/issues/&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
    <span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="s">&quot;\\([^[]\\)#\\([0-9]+\\)&quot;</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">replace-match</span>
       <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;%s[[%s%s][#%s]]&quot;</span>
               <span class="p">(</span><span class="nv">match-string</span> <span class="mi">1</span><span class="p">)</span>
               <span class="nv">base</span>
               <span class="p">(</span><span class="nv">match-string</span> <span class="mi">2</span><span class="p">)</span>
               <span class="p">(</span><span class="nv">match-string</span> <span class="mi">2</span><span class="p">))))))</span>
</code></pre></div>
<p>If anyone reading the blog wants to start with some basic Elisp, the
above function is a nice intro to a lot of useful functions.  And I
expect that many people face this sort of automation scenario pretty
often. I&#39;m pretty sure that <kbd>M-%</kbd> <code>query-replace-regexp</code>
could work here as well, but it&#39;s easier for me to just write out the
code and save it for later.</p>

<h2 id="outro">Outro</h2>

<p>Thanks to everyone who contributed issues, code and
documentation. Enjoy the new release.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/11/30/hydra-lispy-move/">
        I move my s-expressions back and forth
      </a>
    </h1>

    <span class="post-date">30 Nov 2015</span>

    <p>Some people find <a href="https://github.com/abo-abo/lispy">lispy</a> too weird
and/or complex to try, quite possibly because of it&#39;s sort-of-modal
key binding structure. Which is a shame, since out of 7k lines of
lispy&#39;s code, only 500 lines do key bindings, the rest do all sorts of
useful stuff, like sexp navigation/modification, outlines and REPL
interaction.</p>

<p>In this post, I&#39;ll show a short example of using lispy&#39;s functions
outside of <code>lispy-mode</code>, and compare it with the default approach.</p>

<h2 id="moving-s-expressions-while-the-point-is-anywhere">Moving s-expressions while the point is anywhere</h2>

<p>Using this simple <a href="https://github.com/abo-abo/hydra">hydra</a>, and the
key sequence <kbd>C-c m sss www</kbd> I got the following GIF:</p>

<p><img src="/download/hydra-lispy-move-1.gif" alt="hydra-lispy-move-1.gif"></p>

<h2 id="doing-the-same-lispy-way">Doing the same lispy-way</h2>

<p>To do it the lispy-way, I move the point before the list that I wish
to operate on (with
<kbd>[</kbd> key), and press <kbd>sss www</kbd> to get the following GIF:</p>

<p><img src="/download/hydra-lispy-move-2.gif" alt="hydra-lispy-move-2.gif"></p>

<p>The difference here is that no hydra is necessary in the second case,
the key bindings come only from <code>lispy-mode</code>.  But the first case will
also work if <code>lispy-mode</code> is off.</p>

<h2 id="which-way-is-better">Which way is better?</h2>

<p>I think the second way is better, since it&#39;s faster and more clear,
but you can decide for yourself. By the way, you can also move
symbols, comments and sub-words (if that makes sense) with
<kbd>w</kbd> and <kbd>s</kbd>, provided you mark them with a region
first.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/11/04/ivy-occur/">
        New feature in Ivy - ivy-occur
      </a>
    </h1>

    <span class="post-date">04 Nov 2015</span>

    <p>I&#39;ve had an idea with this feature for quite some time, and only
recently got to finally implement it.  So here it goes: with
<code>ivy-occur</code>, bound to <kbd>C-c C-o</kbd> while in the minibuffer, you
can store almost <a href="https://github.com/abo-abo/swiper">Ivy</a> any
completion session in progress, and you can have as many of them as
you like.</p>

<h2 id="example-1">Example 1</h2>

<p>This is where the command name originates from: <code>swiper</code> + <code>ivy-occur</code>
= <code>occur</code>. You can store all of swiper&#39;s matching lines into a
separate buffer. This doesn&#39;t give too much advantage over the
good-old <code>occur</code>, the only thing is that you can use ivy-style regexps
with wild spaces, and have an interactive preview beforehand. Having
said that, it actually sounds pretty good!</p>

<h2 id="example-2">Example 2</h2>

<p>I press <kbd>C-S-o</kbd>, bound to <code>counsel-rhythmbox</code>, and enter
<code>u2</code>.  After pressing <kbd>C-c C-o</kbd>, bound to <code>ivy-occur</code>, the
completion session is closed (effectively <kbd>C-g</kbd>), and a new
buffer <code>*ivy-occur counsel-rhythmbox &quot;u2&quot;*</code> is generated with all
songs that match <code>u2</code>.</p>

<p>As a reminder, <code>counsel-rhythmbox</code> has two actions: <code>play</code> (the
default) and <code>enqueue</code>. In this new buffer, pressing <kbd>RET</kbd> or
<code>mouse-1</code> will call the <code>play</code> action (since it was active at the
moment <code>ivy-occur</code> was called) for the current candidate. So I&#39;ve
effectively added a playlist functionality to <code>counsel-rhythmbox</code>
through a generic command.</p>

<p>Note that it&#39;s very easy to identify a completion session by the
command name and input.  So I can distinguish e.g. <code>*ivy-occur
counsel-rhythmbox &quot;u2&quot;*</code> and <code>*ivy-occur counsel-rhythmbox &quot;скря&quot;*</code>,
and quickly select them with <code>ivy-switch-buffer</code>: just input <code>rhy</code>,
usually only these two and similar buffers will match.</p>

<h2 id="example-3">Example 3</h2>

<p>Suppose I want to go through the documentation of all variables that
end in <code>-function</code>.  Easy:</p>

<ol>
<li><kbd>&lt;f1&gt; v</kbd> (<code>counsel-describe-variable</code>) with input
<code>function$</code>.</li>
<li><kbd>C-c C-o</kbd> (<code>ivy-occur</code>).</li>
</ol>

<p>I get a new buffer named <code>*ivy-occur cousnel-describe-variable
&quot;function$*&quot;</code> with 346 candidates. I can go through them at my own
pace, possibly doing other completion stuff in between without
disturbing my process. It&#39;s also convenient to navigate these buffers
with <code>swiper</code>.</p>

<h2 id="example-4">Example 4</h2>

<p>Let&#39;s tweak the previous one. After inputting <code>function$</code> I can press
<kbd>C-M-a</kbd> (<code>ivy-read-action</code>) followed by <kbd>d</kbd> to
select the <code>definition</code> action. Then again <kbd>C-c C-o</kbd>
(<code>ivy-occur</code>).  Pressing <kbd>RET</kbd> in the resulting buffer will
take me to that variable&#39;s definition, instead of describing it as
before. A similar thing could be done for <code>counsel-rhythmbox</code> to get
the <code>enqueue</code> action in <code>*ivy-occur*</code> buffer, instead of <code>play</code>.</p>

<h2 id="example-5">Example 5</h2>

<p>This is an improvement to my workflow for quickly looking at a new
package&#39;s features.  This can be done with <kbd>oge</kbd>
(<code>lispy-goto-elisp-commands</code>) from
<a href="https://github.com/abo-abo/lispy">lispy</a>, which scans the source for
<code>(interactive)</code> tags and allows to jump to their definition.</p>

<p>It&#39;s a pretty cool optimization, compared to looking at all tags. For
example, <a href="https://github.com/bbatsov/projectile">projectile</a> currently
has 375 top-level tags (functions and variables).  But with
<code>lispy-goto-elisp-commands</code> I only get 48 tags. And now I can have
them in a convenient permanent list too.</p>

<p><img src="/download/ivy-occur-1.png" alt="ivy-occur-1.png"></p>

<p>Alternatively, if <code>projectile</code> is already loaded, I can use
<code>counsel-M-x</code> with input <code>projectile-</code>, followed by <kbd>C-M-a d</kbd>
to select the <code>definition</code> action, followed by <kbd>C-c C-o</kbd>.</p>

<p>As a reminder of how it works, <code>counsel-M-x</code> is defined with a single
action that calls the selected command. But then, I&#39;ve also added this
statement at top-level of counsel.el:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">ivy-set-actions</span>
 <span class="ss">&#39;counsel-M-x</span>
 <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;d&quot;</span> <span class="nv">counsel--find-symbol</span> <span class="s">&quot;definition&quot;</span><span class="p">)))</span>
</code></pre></div>
<p>This means that you can add as many actions as you like to <code>ivy-read</code>
commands. And of course customize the binding and the hint, which are
in this case <kbd>d</kbd> and <code>definition</code> respectively.</p>

<h2 id="limitations">Limitations</h2>

<p>Unfortunately, since the <code>*ivy-occur*</code> buffer needs to know the action
to execute, it only works for commands that explicitly pass <code>:action</code>
to <code>ivy-read</code>. For instance, it won&#39;t work for <code>package-install</code> with
<code>ivy-mode</code> on: the buffer will be properly generated, but pressing
<kbd>RET</kbd> won&#39;t install a package.</p>

<p>Fortunately, it&#39;s not hard to write a version that works:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">counsel-package-install</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">ivy-read</span> <span class="s">&quot;Install package: &quot;</span>
            <span class="p">(</span><span class="nf">delq</span> <span class="no">nil</span>
                  <span class="p">(</span><span class="nf">mapcar</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nf">elt</span><span class="p">)</span>
                            <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">package-installed-p</span> <span class="p">(</span><span class="nf">car</span> <span class="nf">elt</span><span class="p">))</span>
                              <span class="p">(</span><span class="nf">symbol-name</span> <span class="p">(</span><span class="nf">car</span> <span class="nf">elt</span><span class="p">))))</span>
                          <span class="nv">package-archive-contents</span><span class="p">))</span>
            <span class="nb">:action</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
                      <span class="p">(</span><span class="nv">package-install</span> <span class="p">(</span><span class="nf">intern</span> <span class="nv">x</span><span class="p">)))</span>
            <span class="nb">:caller</span> <span class="ss">&#39;counsel-package-install</span><span class="p">))</span>
</code></pre></div>
<p>Here&#39;s a buffer with a list of packages matching &quot;ga&quot;; pressing
<kbd>RET</kbd> will install the selected package:</p>

<p><img src="/download/ivy-occur-2.png" alt="ivy-occur-2.png"></p>

<h2 id="small-note-on-key-bindings">Small note on key bindings</h2>

<p>In the initial post, I wanted to bind <code>ivy-occur</code> to <kbd>C-c o</kbd>
instead of <kbd>C-c C-o</kbd>. But I was reminded that <kbd>C-c LETTER</kbd> are
<a href="http://www.gnu.org/software/emacs/manual/html_node/elisp/Key-Binding-Conventions.html">reserved</a>.
I still think it&#39;s a better binding. If you agree, you can add it to your config:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">ivy-minibuffer-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c o&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-occur</span><span class="p">)</span>
</code></pre></div>
<p>Additionally, <code>ivy-occur</code> is also available on <kbd>C-o u</kbd>,
through the <kbd>C-o</kbd> hydra.</p>

<h2 id="outro">Outro</h2>

<p>I think <code>ivy-occur</code> is a very powerful command that shouldn&#39;t be
overlooked.  Just as <code>ivy-resume</code> implements a sort of <kbd>DEL</kbd>
or <kbd>C-u</kbd> key for completion, <code>ivy-occur</code> implements a
convenient way to switch and store the completion context, a sort of
<kbd>C-x o</kbd> or <kbd>C-x b</kbd> for completion.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/10/23/dired-compress/">
        New in Emacs 25 - convenient compression/decompression in Dired
      </a>
    </h1>

    <span class="post-date">23 Oct 2015</span>

    <p>Today I&#39;ll describe my past and current workflows for compressing
files and directories in Dired.  In my opinion, Dired is one of the
best features of Emacs - a great abstraction of <code>cd</code>+<code>ls</code> that lets
you get things done much faster. The default binding for <code>dired</code> is
<kbd>C-x d</kbd> (I bind it to <kbd>C-;-d</kbd> though, see my
<a href="http://oremacs.com/2015/02/14/semi-xmodmap/">xmodmap post</a>).</p>

<h2 id="my-previous-workflow">My previous workflow</h2>

<p>To compress several files in Dired, first I compile a list of files to
work on by marking them with <kbd>m</kbd> (<code>dired-mark</code>), navigating
to ones that you want with <kbd>n</kbd> (<code>dired-next-line</code>) and
<kbd>p</kbd> (<code>dired-previous-line</code>).</p>

<p>Once a list is ready, I press <kbd>&amp;</kbd> (<code>dired-do-async-shell-command</code>), which allows me to run an arbitrary shell command.
I enter:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>tar -czf ~/tmp/path/foo.tar.gz *
</code></pre></div>
<p>into the minibuffer, press <kbd>RET</kbd> and I&#39;m done. It&#39;s a
standard shell command with 2 advantages:</p>

<ol>
<li>I get <kbd>TAB</kbd> completion for the directory of the created archive.</li>
<li><code>*</code> means the selected file list, so I don&#39;t enter them by hand.</li>
</ol>

<h2 id="my-current-workflow">My current workflow</h2>

<p>Since I often forget the command for <code>tar</code>, and I really don&#39;t want to
remember the commands for <code>zip</code> etc, I&#39;ve implemented a more convenient approach:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">dired-mode-map</span> <span class="s">&quot;c&quot;</span> <span class="ss">&#39;dired-do-compress-to</span><span class="p">)</span>
</code></pre></div>
<p>This new command <code>dired-do-compress-to</code>, bound to <kbd>c</kbd>, will
prompt me for a file name of the output archive. So now it&#39;s easier to
type in that file name, if you use <code>ido-mode</code> / <code>ivy-mode</code> /
<code>helm-mode</code>. What&#39;s more, the command will be automatically determined
from the archive extension and executed. Here&#39;s the corresponding
customization variable:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">defvar</span> <span class="nv">dired-compress-files-alist</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;\\.tar\\.gz\\&#39;&quot;</span> <span class="o">.</span> <span class="s">&quot;tar -c %i | gzip -c9 &gt; %o&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;\\.zip\\&#39;&quot;</span> <span class="o">.</span> <span class="s">&quot;zip %o -r --filesync %i&quot;</span><span class="p">))</span>
  <span class="s">&quot;Control the compression shell command for </span><span class="ss">`dired-do-compress-to&#39;</span><span class="s">.</span>

<span class="s">Each element is (REGEXP . CMD), where REGEXP is the name of the</span>
<span class="s">archive to which you want to compress, and CMD the the</span>
<span class="s">corresponding command.</span>

<span class="s">Within CMD, %i denotes the input file(s), and %o denotes the</span>
<span class="s">output file. %i path(s) are relative, while %o is absolute.&quot;</span><span class="p">)</span>
</code></pre></div>
<p>This thing is pretty self-explanatory. It currently only supports
<code>*.tar.gz</code> and <code>*.zip</code>, use <kbd>M-x</kbd> <code>report-emacs-bug</code> if you
want to add more options.</p>

<h2 id="other-improvements-in-compression-decompression">Other improvements in compression/decompression</h2>

<p>I improved the good-old <kbd>Z</kbd> (<code>dired-do-compress</code>) as
well. Now it can compress directories to <code>*.tar.gz</code>, as well as
decompress <code>*.tar.gz</code> and <code>*.zip</code> to directories.  It&#39;s all automatic,
you only have to press <kbd>Z</kbd>, either on an archive to
decompress, or on a directory to compress.</p>

<h2 id="easy-way-to-have-a-bleeding-edge-emacs">Easy way to have a bleeding edge Emacs</h2>

<p>If you want to get these improvements right now and are on a Debian
type system (I use Ubuntu), you can use:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>sudo apt-add-repository ppa:ubuntu-elisp/ppa
sudo apt-get update
sudo apt-get install emacs-snapshot
</code></pre></div>
<p>Then just use <code>emacs-snapshot</code> executable. It updates every few days.</p>

<p>Myself, I track the Emacs master from
<a href="http://savannah.gnu.org/projects/emacs">git</a>. But <code>emacs-snapshot</code> is
very useful for CI tests, and can also be used by people who don&#39;t
want to build the executable from git.</p>

<h2 id="how-to-get-your-improvements-into-emacs">How to get your improvements into Emacs</h2>

<p>If you&#39;d like to contribute code to the Emacs core yourself, it takes
two steps:</p>

<ol>
<li><p>Sign the Copyright Assignment
(<a href="http://orgmode.org/w/org-mode.git?p=org-mode.git;a=blob_plain;f=request-assign-future.txt;hb=HEAD">CA</a>).
This gives the Copyright for your changes to Emacs to the Free
Software Foundation. This is useful so that the FSF can defend your
rights in court, in case the GPL regarding your contribution is broken
by someone.</p></li>
<li><p><kbd>M-x</kbd> <code>report-emacs-bug</code> and attach a patch.</p></li>
</ol>

<p>It seems that some people could have a moral objection to the CA. I
see no reason for it whatsoever.  Since Elisp libraries make calls to
GPL code and are GPL themselves, you have to publish Elisp code under
GPL, there&#39;s no choice there.  GPL means basically that, while you&#39;re
still acknowledged as the author, everyone else has about as much
right to your code as you do. No one can hide or restrict access to
it, but neither can you. The CA is a further step, which makes the FSF
own the Copyright to your <em>changes</em> to Emacs. You submit these changes
yourself, and the Copyright over these changes isn&#39;t really that
useful: they&#39;re only changes - they do nothing on their own, outside
of Emacs. Besides, with the FSF owning the Copyright, the range of
things that you can do to your code stays exactly the same as if you
owned the Copyright, as long as you publish under GPL.</p>

<p>To illustrate, the FSF CA is very polite and benign, compared to the
CA that I have to give to Elsevier when I publish an article.  That CA
means that a multi-billion dollar corporation owns the right to my
paper until the end of time, and can charge people to view it
(including myself and my peers) as much as they see fit (currently,
$30). Of course, I don&#39;t receive a dime of that money, but hey - I get
published, and at least I can share my article <em>for free</em> for the
first 50 days of the publish date. And if that one doesn&#39;t seem
draconian enough for you, just think of the NDAs in commercial
companies: out there, you can&#39;t even publish or mention anything
related to your work. So please, if you&#39;re hating on the FSF, do
reconsider, they&#39;re the good guys in my book.</p>

<p>Eventually, after a few submitted patches, you&#39;ll be granted commit
access. This is a great way to implement small improvements faster.
However, the larger issues that aren&#39;t simple improvements still need
to be discussed with other developers, either on debbugs or on
emacs-devel. For example, initially I went with the <code>tar -czf</code>
command. But it turns out that it can&#39;t be used on Solaris 10 or AIX
7.1. Whatever those things are, people still use Emacs on them, and
it&#39;s important that the core features are usable on all supported
systems.</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page7">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page5">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
