<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="flattr:id" content="9yl9ry">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (or emacs &middot; irrelevant)
    
  </title>

  <link rel="canonical" href="https://oremacs.com/page6/" />

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>
          <a class="sidebar-nav-item" href="/about/">About</a>
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
          <a class="sidebar-nav-item" href="/donate/">Donate</a>
        <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://licensebuttons.net/l/by-sa/4.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/04/26/ivy-0.8.0/">
        Ivy 0.8.0 is out
      </a>
    </h1>

    <span class="post-date">26 Apr 2016</span>

    <h2 id="intro">Intro</h2>

<p><a href="https://github.com/abo-abo/swiper">Ivy</a> is a completion method that&#39;s
similar to <code>Ido</code>, but with emphasis on simplicity and customizability.</p>

<h2 id="new-package-names">New package names</h2>

<h3 id="changes-on-melpa">Changes on MELPA</h3>

<p>Due to multiple requests, in an attempt to simplify things a new
package <code>ivy</code> has been released on MELPA. The old package <code>swiper</code>,
which used to provide most of the <code>ivy</code> features, now only provides
<code>swiper.el</code> and depends on <code>ivy</code>. The third package <code>counsel</code>, which
provides most of the goodies using <code>ivy</code> hasn&#39;t been changed and is
still on MELPA. All three packages have the version <code>0.8.0</code> currently.</p>

<p>To reiterate the dependencies:</p>

<ul>
<li><code>ivy</code> depends on Emacs version larger than 24.1, preferably at least 24.3 (the most common one bundled currently with Linux distributions).</li>
<li><code>swiper</code> depends on <code>ivy</code> and provides basically 3 commands: <code>swiper</code>, <code>swiper-multi</code> and <code>swiper-all</code>.</li>
<li><code>counsel</code> depends on <code>swiper</code> and provides around 50 commands for all kinds of stuff. My favorites are <code>counsel-M-x</code>, <code>counsel-git-grep</code>, <code>counsel-rhythmbox</code> and <code>counsel-grep-or-swiper</code>.</li>
</ul>

<h3 id="changes-on-gnu-elpa">Changes on GNU ELPA</h3>

<p>On <a href="http://elpa.gnu.org/packages/">GNU ELPA</a>, a single package
<code>ivy-0.8.0</code> has replaced the previous stable version <code>swiper-0.7.0</code>.
This package provides all the files combined of the three separate
MELPA packages.</p>

<h2 id="release-summary">Release summary</h2>

<p>The release consists of 282 commits over 5 months by 15 authors. The
detailed Changelog is available
<a href="http://oremacs.com/swiper/Changelog.html#0.8.0">here</a>, thanks to the
ever useful Org mode export. The raw Org file is in
<a href="https://github.com/abo-abo/swiper/blob/master/doc/Changelog.org#080">doc/Changelog.org</a>
in the main repository.</p>

<p>The detailed documentation is available as an <code>(ivy)</code> Info node and
also in HTML form <a href="http://oremacs.com/swiper/">here</a>. If anyone wants
to document something that&#39;s missing there, I&#39;d appreciate the help:
simply edit
<a href="https://github.com/abo-abo/swiper/blob/master/doc/ivy.org">doc/ivy.org</a>
and send me a PR.</p>

<h2 id="release-highlights">Release highlights</h2>

<p>Below, I&#39;ll highlight some of the new features.</p>

<h3 id="allow-to-compose-collections">Allow to compose collections</h3>

<p>For example, to stack the top 10 elements of <code>recentf</code> on top of <code>counsel-locate</code>, use this code:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">small-test</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">cl-subseq</span> <span class="nv">recentf-list</span> <span class="mi">0</span> <span class="mi">10</span><span class="p">))</span>

<span class="p">(</span><span class="nv">ivy-set-sources</span>
 <span class="ss">&#39;counsel-locate</span>
 <span class="o">&#39;</span><span class="p">((</span><span class="nv">small-test</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">original-source</span><span class="p">)))</span>
</code></pre></div>
<p>Here, <code>(original-source)</code> represents the async candidates of
counsel-locate. All extra sources are static - each function is called
once to generate a list of strings, which will be filtered later.</p>

<p>See <a href="https://github.com/abo-abo/swiper/issues/373">#373</a> for more info.</p>

<h3 id="improved-documentation">Improved documentation</h3>

<p>If you&#39;re not yet familiar with Ivy, you can get a quick reference
card by pressing <kbd>C-h m</kbd> during any completion session.  It
will pop up an Org-mode buffer that describes most of the minibuffer
key bindings.</p>

<p>Additionally, <kbd>C-o</kbd> (<code>hydra-ivy/body</code>), which serves a quick
reference as well, received a small restructuring and a new
binding. Press <kbd>D</kbd> to go to the definition of this
hydra. This is useful to see what each key does, you might even want
to customize some of it.</p>

<h3 id="completion-in-region">Completion in region</h3>

<p>From now on, <code>ivy-mode</code> will also set
<code>completion-in-region-function</code>. This means that functions like:</p>

<ul>
<li><kbd>C-M-i</kbd> <code>complete-symbol</code> in many major modes, </li>
<li><kbd>TAB</kbd> while in the <kbd>M-:</kbd> (<code>eval-expression</code>) minibuffer,</li>
<li><kbd>TAB</kbd> in a <code>shell</code> buffer,</li>
</ul>

<p>will use <code>ivy</code> for completion.</p>

<h3 id="many-improvements-to-ivy-occur-mode">Many improvements to <code>ivy-occur-mode</code></h3>

<p>You can &quot;permanently&quot; save any completion session by pressing <kbd>C-c
C-o</kbd> (<code>ivy-occur</code>).  This will generate a new buffer in
<code>ivy-occur-mode</code> with all your current candidates inserted there.
Clicking or pressing <kbd>f</kbd> on any of the candidates in that
buffer will result in the appropriate action being called with that
candidate.</p>

<p><img src="/download/ivy-occur-mode.png" alt="ivy-occur-mode.png"></p>

<p>The <code>*ivy-occur ...*</code> buffers can actually be customized per
collection type. Specifically for <code>swiper</code>, <code>counsel-git-grep</code>,
<code>counsel-grep</code> and <code>counsel-ag</code>, the customizations are already in
place that allow you to:</p>

<ul>
<li>Edit the buffer with <code>wgrep</code> by pressing <kbd>C-x C-q</kbd>
(<code>ivy-wgrep-change-to-wgrep-mode</code>).</li>
<li>Refresh the buffer due to the original files being changed by pressing <kbd>g</kbd> (<code>ivy-occur-revert-buffer</code>).</li>
</ul>

<p>The second feature is often useful to me when I want to somehow change
a symbol throughout the project. First I make a list of all
occurrences via e.g. <code>swiper</code> and <code>ivy-occur</code>. After I went through
some of the occurrences, I can press <kbd>g</kbd> to refresh the
search for the same symbol and see how many I still have left.</p>

<p>Yet another cool feature is to press <kbd>c</kbd>
(<code>ivy-occur-toggle-calling</code>) to toggle calling the action after each
line movement and cycle through candidates by holding either
<kbd>j</kbd> (<code>ivy-occur-next-line</code>) or <kbd>k</kbd>
(<code>ivy-occur-previous-line</code>).</p>

<h3 id="ivy-set-action-can-work-on-all-commands"><code>ivy-set-action</code> can work on all commands</h3>

<p>Here&#39;s the code I&#39;m using currently in my config:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">ivy-insert-action</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">with-ivy-window</span>
    <span class="p">(</span><span class="nf">insert</span> <span class="nv">x</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">ivy-set-actions</span>
 <span class="no">t</span>
 <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;I&quot;</span> <span class="nv">ivy-insert-action</span> <span class="s">&quot;insert&quot;</span><span class="p">)))</span>
</code></pre></div>
<p>This allows me to press <kbd>M-o I</kbd> to insert the current
candidate into the buffer. For instance, if I want to quote an Emacs
command, I can <kbd>M-x</kbd> (<code>counsel-M-x</code>), select the command I
want and press <kbd>M-o I</kbd> to insert it instead of calling it.</p>

<h3 id="virtual-views-in-ivy-switch-buffer">Virtual views in <code>ivy-switch-buffer</code></h3>

<p>Here, &quot;virtual&quot; buffer means something that&#39;s close to a buffer but
not an actual buffer. If you were using the setting
<code>ivy-use-virtual-buffers</code>, you&#39;d have your bookmarks and <code>recentf</code>
items available to you as virtual buffers.</p>

<p>The new feature allows to select a whole window configuration with
many buffers inside nested horizontal and vertical splits from
<code>ivy-switch-buffer</code>.</p>

<p>To use it, set <code>ivy-views</code>, since it&#39;s nil by default. For instance,
here&#39;s what I have in my config:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-views</span>
      <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;dutch + notes {}&quot;</span>
         <span class="p">(</span><span class="nv">vert</span>
          <span class="p">(</span><span class="nv">file</span> <span class="s">&quot;dutch.org&quot;</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">buffer</span> <span class="s">&quot;notes&quot;</span><span class="p">)))</span>
        <span class="p">(</span><span class="s">&quot;ivy {}&quot;</span>
         <span class="p">(</span><span class="nv">horz</span>
          <span class="p">(</span><span class="nv">file</span> <span class="s">&quot;ivy.el&quot;</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">buffer</span> <span class="s">&quot;*scratch*&quot;</span><span class="p">)))))</span>
</code></pre></div>
<p>For a more elaborate and detailed use, see
<a href="http://informatica.boccaperta.com/m-x-emacs-piu-rapidi-con-ivy-views/">this post</a>
by Manuel Uberti.</p>

<h3 id="magic-slash-in-file-name-completion">Magic slash in file name completion</h3>

<p>From now on, if you want to enter a directory, simply select a
candidate which is a directory and press <kbd>/</kbd>. You can still
use the old binding <kbd>C-j</kbd> (<code>ivy-alt-done</code>), but <kbd>/</kbd>
is shorter and easier to get used to if you&#39;re switching from Ido.</p>

<p>Note that this does not prevent the use of old functionality like:</p>

<ul>
<li><kbd>//</kbd> to enter the root directory,</li>
<li><code>/ssh:</code> <kbd>RET</kbd> to connect via TRAMP.</li>
</ul>

<h3 id="a-better-way-to-search-with-counsel-grep-or-swiper">A better way to search with <code>counsel-grep-or-swiper</code></h3>

<p>If you&#39;ve ever been annoyed with the long start-up time of <code>swiper</code> in
huge buffers, switch to this setting:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">global-set-key</span> <span class="s">&quot;\C-s&quot;</span> <span class="ss">&#39;counsel-grep-or-swiper</span><span class="p">)</span>
</code></pre></div>
<p>This command will use <code>swiper</code> for small buffers, and <code>counsel-grep</code> for large buffers.</p>

<p>Something very similar to this command was highlighted in
<a href="http://karl-voit.at/2016/04/09/chosing-emacs-search-method/">this post</a>
by Karl Voit.</p>

<p>Just to give you an idea of how fast <code>counsel-grep</code> is:</p>

<ul>
<li>It has 0s start-up time, since it&#39;s async.</li>
<li>For a two million line file weighing 50MB produced by copying
<code>org.el</code> a few times, it takes 0.2s to find the 17,664 occurrences
of the word <code>hook</code>. It still takes 7.5s to search for <code>org</code> in that
file, simply because there are 500,000 candidates and it takes time
for Emacs to simply receive that input.</li>
</ul>

<h3 id="a-list-of-all-new-commands">A list of all new commands</h3>

<p>The new commands since <code>0.7.0</code> are: <code>counsel-tmm</code>, <code>counsel-imenu</code>,
<code>counsel-decbinds</code>, <code>counsel-list-processes</code>,
<code>ivy-switch-buffer-other-window</code>, <code>counsel-git-stash</code>,
<code>counsel-git-log</code>, <code>counsel-pt</code>, <code>counsel-linux-app</code>,
<code>counsel-ace-link</code>, <code>counsel-esh-history</code>, <code>counsel-shell-history</code>,
<code>counsel-grep-or-swiper</code>.</p>

<p>If any of those sound interesting, go ahead and try them out.</p>

<h2 id="outro">Outro</h2>

<p>Thanks to all the contributors. Happy hacking!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/04/04/hydra-doc-syntax/">
        Extended syntax for hydra docstrings
      </a>
    </h1>

    <span class="post-date">04 Apr 2016</span>

    <p>I&#39;ve been getting more and more organized in tracking my tasks and
time with Org-mode. Still using the usual suspects, of course: GTD and
Pomodoro, I&#39;m just getting more diligent with them than in the
previous years.</p>

<p>So today I wanted to prettify the good old
<code>org-agenda-view-mode-dispatch</code>, which is bound to <kbd>v</kbd> in
<code>org-agenda-mode</code>. Currently, it&#39;s just a boring static <code>message</code> and
<code>read-char</code> combination. Why not do it with a
<a href="https://github.com/abo-abo/hydra">hydra</a> instead?</p>

<p>Here&#39;s the current full code, that uses the newly extended doc syntax:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">org-agenda-mode-map</span>
    <span class="s">&quot;v&quot;</span> <span class="ss">&#39;hydra-org-agenda-view/body</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">org-agenda-cts</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">args</span> <span class="p">(</span><span class="nf">get-text-property</span>
               <span class="p">(</span><span class="nf">min</span> <span class="p">(</span><span class="nf">1-</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span> <span class="p">(</span><span class="nf">point</span><span class="p">))</span>
               <span class="ss">&#39;org-last-args</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">nth</span> <span class="mi">2</span> <span class="nv">args</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">defhydra</span> <span class="nv">hydra-org-agenda-view</span> <span class="p">(</span><span class="nb">:hint</span> <span class="nv">none</span><span class="p">)</span>
  <span class="s">&quot;</span>
<span class="s">_d_: ?d? day        _g_: time grid=?g? _a_: arch-trees</span>
<span class="s">_w_: ?w? week       _[_: inactive      _A_: arch-files</span>
<span class="s">_t_: ?t? fortnight  _f_: follow=?f?    _r_: report=?r?</span>
<span class="s">_m_: ?m? month      _e_: entry =?e?    _D_: diary=?D?</span>
<span class="s">_y_: ?y? year       _q_: quit          _L__l__c_: ?l?&quot;</span>
  <span class="p">(</span><span class="s">&quot;SPC&quot;</span> <span class="nv">org-agenda-reset-view</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;d&quot;</span> <span class="nv">org-agenda-day-view</span>
       <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="ss">&#39;day</span> <span class="p">(</span><span class="nv">org-agenda-cts</span><span class="p">))</span>
           <span class="s">&quot;[x]&quot;</span> <span class="s">&quot;[ ]&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;w&quot;</span> <span class="nv">org-agenda-week-view</span>
       <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="ss">&#39;week</span> <span class="p">(</span><span class="nv">org-agenda-cts</span><span class="p">))</span>
           <span class="s">&quot;[x]&quot;</span> <span class="s">&quot;[ ]&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;t&quot;</span> <span class="nv">org-agenda-fortnight-view</span>
       <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="ss">&#39;fortnight</span> <span class="p">(</span><span class="nv">org-agenda-cts</span><span class="p">))</span>
           <span class="s">&quot;[x]&quot;</span> <span class="s">&quot;[ ]&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;m&quot;</span> <span class="nv">org-agenda-month-view</span>
       <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="ss">&#39;month</span> <span class="p">(</span><span class="nv">org-agenda-cts</span><span class="p">))</span> <span class="s">&quot;[x]&quot;</span> <span class="s">&quot;[ ]&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;y&quot;</span> <span class="nv">org-agenda-year-view</span>
       <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="ss">&#39;year</span> <span class="p">(</span><span class="nv">org-agenda-cts</span><span class="p">))</span> <span class="s">&quot;[x]&quot;</span> <span class="s">&quot;[ ]&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;l&quot;</span> <span class="nv">org-agenda-log-mode</span>
       <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;% -3S&quot;</span> <span class="nv">org-agenda-show-log</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;L&quot;</span> <span class="p">(</span><span class="nv">org-agenda-log-mode</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
  <span class="p">(</span><span class="s">&quot;c&quot;</span> <span class="p">(</span><span class="nv">org-agenda-log-mode</span> <span class="ss">&#39;clockcheck</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;f&quot;</span> <span class="nv">org-agenda-follow-mode</span>
       <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;% -3S&quot;</span> <span class="nv">org-agenda-follow-mode</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;a&quot;</span> <span class="nv">org-agenda-archives-mode</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;A&quot;</span> <span class="p">(</span><span class="nv">org-agenda-archives-mode</span> <span class="ss">&#39;files</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;r&quot;</span> <span class="nv">org-agenda-clockreport-mode</span>
       <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;% -3S&quot;</span> <span class="nv">org-agenda-clockreport-mode</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;e&quot;</span> <span class="nv">org-agenda-entry-text-mode</span>
       <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;% -3S&quot;</span> <span class="nv">org-agenda-entry-text-mode</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;g&quot;</span> <span class="nv">org-agenda-toggle-time-grid</span>
       <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;% -3S&quot;</span> <span class="nv">org-agenda-use-time-grid</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;D&quot;</span> <span class="nv">org-agenda-toggle-diary</span>
       <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;% -3S&quot;</span> <span class="nv">org-agenda-include-diary</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;!&quot;</span> <span class="nv">org-agenda-toggle-deadlines</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;[&quot;</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">org-agenda-include-inactive-timestamps</span> <span class="no">t</span><span class="p">))</span>
     <span class="p">(</span><span class="nv">org-agenda-check-type</span> <span class="no">t</span> <span class="ss">&#39;timeline</span> <span class="ss">&#39;agenda</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">org-agenda-redo</span><span class="p">)))</span>
  <span class="p">(</span><span class="s">&quot;q&quot;</span> <span class="p">(</span><span class="nf">message</span> <span class="s">&quot;Abort&quot;</span><span class="p">)</span> <span class="nb">:exit</span> <span class="no">t</span><span class="p">))</span>
</code></pre></div>
<p>And here&#39;s how it looks like in action, I simply pressed <kbd>v</kbd> while in the agenda:</p>

<p><img src="/download/hydra-sexp-docstring.png" alt="hydra-sexp-docstring.png"></p>

<p>Since many functions that <code>org-agenda-view-mode-dispatch</code> calls are
toggles, it makes sense for <code>hydra-org-agenda-view</code> to display the
status of these toggles.</p>

<p>And it&#39;s actually convenient to toggle a whole lot of things at once,
and the default red hydra keys really come in handy here.</p>

<h2 id="quick-explanation-of-the-syntax">Quick explanation of the syntax</h2>

<p>Each head of a hydra looks like:</p>

<blockquote>
<p>(key cmd &amp;optional doc &amp;rest plist)</p>
</blockquote>

<p>The fairly new bit that I&#39;m using here is the ability to use a sexp
instead of a plain string in the <code>doc</code> part.  This sexp will be
evaluated each time the doc is re-displayed. This means that it can
represent a changing variable, for instance the state of a minor mode
or a variable.</p>

<p>And here&#39;s the best part: the doc of each head can be quoted in the
hydra&#39;s docstring by using the corresponding key, e.g. <code>?g?</code>.  This
allows to have very complex docstrings while keeping them easily
aligned in a tabular format.</p>

<p>Here is only the hydra&#39;s docstring, copied from the above code:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>_d_: ?d? day        _g_: time grid=?g? _a_: arch-trees
_w_: ?w? week       _[_: inactive      _A_: arch-files
_t_: ?t? fortnight  _f_: follow=?f?    _r_: report=?r?
_m_: ?m? month      _e_: entry =?e?    _D_: diary=?D?
_y_: ?y? year       _q_: quit          _L__l__c_: ?l?
</code></pre></div>
<p>Doesn&#39;t that look simple?</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/03/16/counsel-linux-app/">
        Emacs completion for launching Linux desktop apps.
      </a>
    </h1>

    <span class="post-date">16 Mar 2016</span>

    <p>I&#39;d like to highlight the new command <code>counsel-linux-app</code> that I
recently added to the <a href="https://github.com/abo-abo/swiper">counsel</a>
package:</p>

<p><img src="/download/counsel-linux-app-1.png" alt="counsel-linux-app-1.png"></p>

<p>This command looks through your <code>/usr/share/applications/*.desktop</code>
and offers to launch them, just like the launcher that you normally
get when you press the super key. My current system is Ubuntu, and the
launcher here is really horrible, so I&#39;m glad to have a much faster
and reliable replacement.</p>

<p>Here&#39;s another screenshot, I open the keyboard settings quite often:</p>

<p><img src="/download/counsel-linux-app-2.png" alt="counsel-linux-app-2.png"></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/02/24/dired-rsync/">
        Using rsync in dired
      </a>
    </h1>

    <span class="post-date">24 Feb 2016</span>

    <p>Here&#39;s a code snippet I&#39;ve found long ago on the internet (the source
seems to be no longer accessible), that has proven valuable time and
time again:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ora-dired-rsync</span> <span class="p">(</span><span class="nv">dest</span><span class="p">)</span>
  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="nf">list</span>
    <span class="p">(</span><span class="nf">expand-file-name</span>
     <span class="p">(</span><span class="nv">read-file-name</span>
      <span class="s">&quot;Rsync to:&quot;</span>
      <span class="p">(</span><span class="nv">dired-dwim-target-directory</span><span class="p">)))))</span>
  <span class="c1">;; store all selected files into &quot;files&quot; list</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">files</span> <span class="p">(</span><span class="nv">dired-get-marked-files</span>
                <span class="no">nil</span> <span class="nv">current-prefix-arg</span><span class="p">))</span>
        <span class="c1">;; the rsync command</span>
        <span class="p">(</span><span class="nv">tmtxt/rsync-command</span>
         <span class="s">&quot;rsync -arvz --progress &quot;</span><span class="p">))</span>
    <span class="c1">;; add all selected file names as arguments</span>
    <span class="c1">;; to the rsync command</span>
    <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">file</span> <span class="nv">files</span><span class="p">)</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">tmtxt/rsync-command</span>
            <span class="p">(</span><span class="nf">concat</span> <span class="nv">tmtxt/rsync-command</span>
                    <span class="p">(</span><span class="nv">shell-quote-argument</span> <span class="nv">file</span><span class="p">)</span>
                    <span class="s">&quot; &quot;</span><span class="p">)))</span>
    <span class="c1">;; append the destination</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">tmtxt/rsync-command</span>
          <span class="p">(</span><span class="nf">concat</span> <span class="nv">tmtxt/rsync-command</span>
                  <span class="p">(</span><span class="nv">shell-quote-argument</span> <span class="nv">dest</span><span class="p">)))</span>
    <span class="c1">;; run the async shell command</span>
    <span class="p">(</span><span class="nv">async-shell-command</span> <span class="nv">tmtxt/rsync-command</span> <span class="s">&quot;*rsync*&quot;</span><span class="p">)</span>
    <span class="c1">;; finally, switch to that window</span>
    <span class="p">(</span><span class="nv">other-window</span> <span class="mi">1</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">define-key</span> <span class="nv">dired-mode-map</span> <span class="s">&quot;Y&quot;</span> <span class="ss">&#39;ora-dired-rsync</span><span class="p">)</span>
</code></pre></div>
<p>Lets you copy huge files and directories without Emacs freezing up and
with convenient progress bar updates. That is all.</p>

<p>Thanks to <code>tmtxt</code>, the mysterious hacker-person from whom the snippet
likely originated .  Good luck with getting your blog back up.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/02/15/counsel-ffap/">
        Visiting URLs and issues with counsel-find-file
      </a>
    </h1>

    <span class="post-date">15 Feb 2016</span>

    <p>Many experienced Emacs users are aware of <code>ffap</code> command:</p>

<blockquote>
<p>Find FILENAME, guessing a default from text around point.
If <code>ffap-url-regexp</code> is not nil, the FILENAME may also be an URL.</p>
</blockquote>

<p>It&#39;s a great way to open an link, if you plan things in advance. But
for me it was usually <kbd>C-x C-f</kbd> (annoyed grunt) <kbd>C-g M-x
ffap RET</kbd>.</p>

<p>Now, thanks to <a href="https://github.com/abo-abo/swiper">counsel-find-file</a>,
it&#39;s <kbd>C-x C-f</kbd> (anticipated annoyance, followed by a sigh of
relief) <kbd>M-n</kbd>.</p>

<p>With Ivy completion, <kbd>M-n</kbd> calls <code>ivy-next-history-element</code>,
which tries to</p>

<p><a href="http://endlessparentheses.com/predicting-the-future-with-the-m-n-key.html">predict the history element</a>
in case you&#39;ve reached history&#39;s edge. The prediction usually simply
inserts thing-at-point into the minibuffer. My favorite applications
of this are:</p>

<ul>
<li><kbd>C-s M-n</kbd> - <code>swiper</code> thing-at-point, to get the occurrences
of the current symbol in the current file.</li>
<li><kbd>C-c j M-n</kbd> - <code>counsel-git-grep</code> thing-at-point, to get the
mentions within the current project.</li>
<li><kbd>C-c g M-n</kbd> - <code>counsel-git</code> thing-at-point to open a file
to which the current symbol links.</li>
</ul>

<p>One thing I&#39;ve recently added is the <code>\_&lt;...\_&gt;</code> wrapper for when
<code>major-mode</code> derives from <code>prog-mode</code>. Since the <code>\_&lt;</code> regex matches
the symbol start, and <code>\_&gt;</code> matches the symbol end, there&#39;s no chance
of getting partial matches. You can call <code>undo</code> or press
<kbd>M-n</kbd> again in case the symbol bounds aren&#39;t useful.</p>

<p>Finally, <kbd>C-x C-f M-n</kbd> can be used to open URLs. Recently,
I&#39;ve added functionality to <code>counsel-find-file</code> that allows me to also
visit Github issues by simply pointing at the plain issue number,
e.g. <code>#123</code> in either a version-controlled file or in a Magit buffer.
The command will query:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>$ git remote get-url origin
</code></pre></div>
<p>and fill in all the details. So I no longer bother with
<code>bug-reference-url-format</code> and <code>bug-reference-mode</code> - now it&#39;s all
automatic.</p>

<p>It&#39;s also possible to make it work for places other than Github, for
instance this code (already included in
<a href="http://melpa.org/#/counsel">counsel</a>) makes it work for the Emacs Git
repository:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">counsel-emacs-url-p</span> <span class="p">()</span>
  <span class="s">&quot;Return a Debbugs issue URL at point.&quot;</span>
  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">looking-at</span> <span class="s">&quot;#[0-9]+&quot;</span><span class="p">)</span>
             <span class="p">(</span><span class="k">or</span>
              <span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nv">vc-backend</span> <span class="p">(</span><span class="nf">buffer-file-name</span><span class="p">))</span> <span class="ss">&#39;Git</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">memq</span> <span class="nv">major-mode</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">magit-commit-mode</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">url</span> <span class="p">(</span><span class="nv">match-string-no-properties</span> <span class="mi">0</span><span class="p">))</span>
          <span class="p">(</span><span class="nv">origin</span> <span class="p">(</span><span class="nv">shell-command-to-string</span>
                   <span class="s">&quot;git remote get-url origin&quot;</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">string-match</span> <span class="s">&quot;git.sv.gnu.org:/srv/git/emacs.git&quot;</span>
                          <span class="nv">origin</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;http://debbugs.gnu.org/cgi/bugreport.cgi?bug=%s&quot;</span>
                <span class="p">(</span><span class="nf">substring</span> <span class="nv">url</span> <span class="mi">1</span><span class="p">))))))</span>

<span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;ivy-ffap-url-functions</span> <span class="ss">&#39;counsel-emacs-url-p</span><span class="p">)</span>
</code></pre></div>
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page7">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page5">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
