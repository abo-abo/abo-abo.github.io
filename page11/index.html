<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (or emacs &middot; irrelevant)
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://licensebuttons.net/l/by-sa/4.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/04/14/hydra-org-mode/">
        Org-mode Hydras incoming!
      </a>
    </h1>

    <span class="post-date">14 Apr 2015</span>

    <h2 id="a-hydra-for-org-mode-time-clock-capture">A hydra for org-mode time/clock/capture</h2>

<p>This is a categorized version of the hydra that <a href="https://github.com/WorldsEndless">@WorldsEndless</a> contributed
today to the <a href="https://github.com/abo-abo/hydra/wiki/Hydras-by-Topic">wiki</a>.</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defhydra</span> <span class="nv">hydra-global-org</span> <span class="p">(</span><span class="nb">:color</span> <span class="nv">blue</span>
                            <span class="nb">:hint</span> <span class="no">nil</span><span class="p">)</span>
  <span class="s">&quot;</span>
<span class="s">Timer^^        ^Clock^         ^Capture^</span>
<span class="s">--------------------------------------------------</span>
<span class="s">s_t_art        _w_ clock in    _c_apture</span>
<span class="s"> _s_top        _o_ clock out   _l_ast capture</span>
<span class="s">_r_eset        _j_ clock goto</span>
<span class="s">_p_rint</span>
<span class="s">&quot;</span>
  <span class="p">(</span><span class="s">&quot;t&quot;</span> <span class="nv">org-timer-start</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;s&quot;</span> <span class="nv">org-timer-stop</span><span class="p">)</span>
  <span class="c1">;; Need to be at timer</span>
  <span class="p">(</span><span class="s">&quot;r&quot;</span> <span class="nv">org-timer-set-timer</span><span class="p">)</span>
  <span class="c1">;; Print timer value to buffer</span>
  <span class="p">(</span><span class="s">&quot;p&quot;</span> <span class="nv">org-timer</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;w&quot;</span> <span class="p">(</span><span class="nv">org-clock-in</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
  <span class="p">(</span><span class="s">&quot;o&quot;</span> <span class="nv">org-clock-out</span><span class="p">)</span>
  <span class="c1">;; Visit the clocked task from any buffer</span>
  <span class="p">(</span><span class="s">&quot;j&quot;</span> <span class="nv">org-clock-goto</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;c&quot;</span> <span class="nv">org-capture</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;l&quot;</span> <span class="nv">org-capture-goto-last-stored</span><span class="p">))</span>
</code></pre></div>
<p>I&#39;ve bound it like this:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">global-set-key</span> <span class="nv">[f11]</span> <span class="ss">&#39;hydra-global-org/body</span><span class="p">)</span>
</code></pre></div>
<p>Previously, I had <kbd>f11</kbd> bound to <code>org-clock-goto</code>, thanks to
the <a href="http://doc.norang.ca/org-mode.html">Org Mode - Organize Your Life In Plain Text!</a>
post.  I kind of recommend that post, as it has a tonne of useful
stuff. At the same time, it resulted in me copying too much stuff that I didn&#39;t understand into my config,
ultimately discouraging me from using <code>org-mode</code>. YMMV.</p>

<p>Screenshot:</p>

<p><img src="/download/hydra-org-global.png" alt="hydra-org-global.png"></p>

<h2 id="a-hydra-for-refile-archive">A hydra for refile/archive</h2>

<p>Inspired by the previous one, I wanted to write a hydra of my own.  As
it happened, I was just about to clean up my git notes. So I wanted a
nice refile hydra to speed up the process.</p>

<p>Here&#39;s the hydra&#39;s code, which is now part of
<a href="https://github.com/abo-abo/worf">worf</a>.  Worf is a package for
quickly navigating around an <code>org-mode</code> buffer, you can get it from
MELPA.</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defhydra</span> <span class="nv">hydra-refile</span> <span class="p">(</span><span class="nb">:hint</span> <span class="no">nil</span>
                        <span class="nb">:color</span> <span class="nv">teal</span><span class="p">)</span>
  <span class="s">&quot;</span>
<span class="s">Refile:^^   _k_eep: %`org-refile-keep</span>
<span class="s">----------------------------------</span>
<span class="s">_l_ast      _a_rchive</span>
<span class="s">_o_ther</span>
<span class="s">_t_his</span>

<span class="s">&quot;</span>
  <span class="p">(</span><span class="s">&quot;t&quot;</span> <span class="nv">worf-refile-this</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;o&quot;</span> <span class="nv">worf-refile-other</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;l&quot;</span> <span class="nv">worf-refile-last</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;k&quot;</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">org-refile-keep</span> <span class="p">(</span><span class="nv">not</span> <span class="nv">org-refile-keep</span><span class="p">))</span>
       <span class="nb">:exit</span> <span class="no">nil</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;a&quot;</span> <span class="p">(</span><span class="nv">org-archive-subtree</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;q&quot;</span> <span class="no">nil</span> <span class="s">&quot;quit&quot;</span><span class="p">))</span>
</code></pre></div>
<p>Some explanations:</p>

<ul>
<li><code>worf-refile-this</code> will give you a choice of this file&#39;s headings for refiling.</li>
<li><code>worf-refile-other</code> will give you a choice of your <code>org-refile-targets</code> except the current file.</li>
<li><code>worf-refile-last</code> will refile to the last refile location without prompting.</li>
<li><kbd>k</kbd> will toggle <code>org-refile-keep</code>, which decides if refiling moves or copies the text.</li>
</ul>

<p>And here&#39;s how it looks like:</p>

<p><img src="/download/hydra-refile.png" alt="hydra-refile.png"></p>

<h2 id="outro">Outro</h2>

<p>Thanks for the contribution, enjoy the new stuff.
Also, if you ever want to dig around someone&#39;s git notes, you can read <a href="/public/git-notes/git.html">mine</a>,
courtesy of <code>org-mode</code> export.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/04/13/hydra-0.13.0/">
        Hydra 0.13.0 is out
      </a>
    </h1>

    <span class="post-date">13 Apr 2015</span>

    <p>A lot of the changes for this release aren&#39;t very user-visible, although they
are important in improving the usability.  The main change is the move from the
standard <code>set-transient-map</code> to my own <code>hydra-set-transient-map</code>.</p>

<p>This change has allowed to remove the part where the amaranth and pink hydras
intercept a binding which doesn&#39;t belong to them and then try to forward it back
to Emacs. It was done in this way, which might be interesting for people who
write Elisp:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">hydra-keymap</span> <span class="no">t</span> <span class="ss">&#39;hydra-intercept</span><span class="p">)</span>
</code></pre></div>
<p>Binding <code>t</code> means that when the keymap is active, any binding which doesn&#39;t
belong to the keymap will be interpreted as <code>t</code>.  Then, I would use <code>lookup-key</code>
and <code>this-command-keys</code> and try to call the result.  That method was quite
fragile:</p>

<ul>
<li>It didn&#39;t work for prefix keys while a pink hydra was active.</li>
<li>It didn&#39;t work for some keys in the terminal because of <code>input-decode-map</code>.</li>
</ul>

<p>The new method solves the mentioned issues by not using <code>t</code> and instead running
this function in the <code>pre-command-hook</code>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">hydra--clearfun</span> <span class="p">()</span>
  <span class="s">&quot;Disable the current Hydra unless `this-command&#39; is a head.&quot;</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">memq</span> <span class="nv">this-command</span> <span class="o">&#39;</span><span class="p">(</span><span class="nf">handle-switch-frame</span>
                           <span class="nv">keyboard-quit</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">hydra-disable</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">this-command</span>
                <span class="p">(</span><span class="nf">lookup-key</span> <span class="nv">hydra-curr-map</span>
                            <span class="p">(</span><span class="nf">this-single-command-keys</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">cl-case</span> <span class="nv">hydra-curr-foreign-keys</span>
                <span class="p">(</span><span class="ne">warn</span>
                 <span class="p">(</span><span class="k">setq</span> <span class="nv">this-command</span> <span class="ss">&#39;hydra-amaranth-warn</span><span class="p">))</span>
                <span class="p">(</span><span class="nv">run</span>
                 <span class="no">t</span><span class="p">)</span>
                <span class="p">(</span><span class="no">t</span> <span class="no">nil</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">hydra-disable</span><span class="p">)))))</span>
</code></pre></div>
<p>This approach is actually very similar to what the built-in <code>set-transient-map</code>
does from Emacs 24.4 onward.  Of course, changing the a large cog in the Hydra
mechanism can lead to some new bugs, or even old bugs to re-surface. So I really
appreciate the help from <a href="https://github.com/jhonnyseven">@jhonnyseven</a> in testing the new code.</p>

<p>As always, if you find something very broken, you can roll back to <a href="http://elpa.gnu.org/packages/hydra.html">the GNU ELPA version</a>
and raise an <a href="https://github.com/abo-abo/hydra/issues">issue</a>.</p>

<h2 id="fixes">Fixes</h2>

<h3 id="single-command-red-blue-issue">single command red/blue issue</h3>

<p>Fix the uniqueness issue, when a single command is assigned to both a
red and a blue head.</p>

<p>Here&#39;s an example:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defhydra</span> <span class="nv">hydra-zoom</span> <span class="p">(</span><span class="nv">global-map</span> <span class="s">&quot;&lt;f2&gt;&quot;</span><span class="p">)</span>
  <span class="s">&quot;zoom&quot;</span>
  <span class="p">(</span><span class="s">&quot;g&quot;</span> <span class="nv">text-scale-increase</span> <span class="s">&quot;in&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;l&quot;</span> <span class="nv">text-scale-decrease</span> <span class="s">&quot;out&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="nv">text-scale-set</span> <span class="mi">0</span><span class="p">)</span> <span class="s">&quot;reset&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;0&quot;</span> <span class="p">(</span><span class="nv">text-scale-set</span> <span class="mi">0</span><span class="p">)</span> <span class="nb">:bind</span> <span class="no">nil</span> <span class="nb">:exit</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;1&quot;</span> <span class="p">(</span><span class="nv">text-scale-set</span> <span class="mi">0</span><span class="p">)</span> <span class="no">nil</span> <span class="nb">:bind</span> <span class="no">nil</span> <span class="nb">:exit</span> <span class="no">t</span><span class="p">))</span>
</code></pre></div>
<p>Here, three heads are assigned <code>(text-scale-set 0)</code>, however their behavior is different:</p>

<ul>
<li><kbd>r</kbd> doesn&#39;t exit and has a string hint.</li>
<li><kbd>0</kbd> exits and has an empty hint (so only the key is in the docstring).</li>
<li><kbd>1</kbd> exits and has a nil hint (will not be displayed in the docstring).</li>
</ul>

<p>The latter two call <code>hydra-zoom/lambda-0-and-exit</code>, while <kbd>r</kbd>
calls <code>hydra-zoom/lambda-r</code>.</p>

<h3 id="don-39-t-default-hydra-repeast-prefix-arg-to-1">Don&#39;t default <code>hydra-repeast--prefix-arg</code> to 1</h3>

<p>See <a href="https://github.com/abo-abo/hydra/issues/61">#61</a> for more info.</p>

<h3 id="allow-hydra-repeat-to-take-a-numeric-arg">Allow <code>hydra-repeat</code> to take a numeric arg</h3>

<p>For <code>hydra-vi</code>, it&#39;s now possible to do this <kbd>4j.2..</kbd>.
The line will be forwarded:</p>

<ul>
<li>4 times by <kbd>4j</kbd></li>
<li>4 times by <kbd>.</kbd></li>
<li>2 times by <kbd>2.</kbd></li>
<li>2 times by <kbd>.</kbd></li>
</ul>

<p>See <a href="https://github.com/abo-abo/hydra/issues/92">#92</a> for more info.</p>

<h3 id="key-chord-will-be-disabled-for-the-duration-of-a-hydra">Key chord will be disabled for the duration of a hydra</h3>

<p>This means that hydras have become much more easy to use with key chords.  For
instance, if <kbd>dj</kbd> key chord calls a hydra or is part of the hydra, you
won&#39;t call the <kbd>jj</kbd> key chord by accident with <kbd>djj</kbd>.</p>

<p>See <a href="https://github.com/abo-abo/hydra/issues/97">#97</a> for more info.</p>

<h2 id="new-features">New Features</h2>

<h3 id="variable-as-a-string-docstring-spec">Variable as a string docstring spec</h3>

<p>You can now use this form in your hydras:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">defvar</span> <span class="nv">foo</span> <span class="s">&quot;a b c&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">defhydra</span> <span class="nv">bar</span> <span class="p">()</span>
  <span class="s">&quot;</span>
<span class="s">  bar %s`foo</span>
<span class="s">&quot;</span>
  <span class="p">(</span><span class="s">&quot;a&quot;</span> <span class="ss">&#39;t</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;q&quot;</span> <span class="no">nil</span><span class="p">))</span>
</code></pre></div>
<p>Previously, it would only work for <code>%s(foo)</code> forms.</p>

<h3 id="bind-property-can-also-be-a-keymap"><code>:bind</code> property can also be a keymap</h3>

<p>If you remember, you can set <code>:bind</code> in the body to define in which way the
heads should be bound <em>outside</em> the Hydra. You also assign/override <code>:bind</code> for
each head.  This is especially useful to set <code>:bind</code> to nil for a few heads that
you don&#39;t want to bind outside.</p>

<p>Previously, <code>:bind</code> could be either a lambda or nil. Now a keymap is also accepted.</p>

<h3 id="integration-tests">Integration tests</h3>

<p>In addition to the abundant macro-expansion tests, integration tests are now
also running, both for <code>emacs24</code> and for <code>emacs-snapshot</code>. This means that hydra
should be a lot more stable now.</p>

<p>Here&#39;s an example test:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defhydra</span> <span class="nv">hydra-simple-1</span> <span class="p">(</span><span class="nv">global-map</span> <span class="s">&quot;C-c&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;a&quot;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&quot;j&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;b&quot;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&quot;k&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;q&quot;</span> <span class="no">nil</span><span class="p">))</span>

<span class="p">(</span><span class="nb">ert-deftest</span> <span class="nv">hydra-integration-1</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">should</span> <span class="p">(</span><span class="nv">string=</span> <span class="p">(</span><span class="nv">hydra-with</span> <span class="s">&quot;|&quot;</span>
                               <span class="p">(</span><span class="nf">execute-kbd-macro</span>
                                <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c aabbaaqaabbaa&quot;</span><span class="p">)))</span>
                   <span class="s">&quot;jjkkjjaabbaa|&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">should</span> <span class="p">(</span><span class="nv">string=</span> <span class="p">(</span><span class="nv">hydra-with</span> <span class="s">&quot;|&quot;</span>
                               <span class="p">(</span><span class="k">condition-case</span> <span class="no">nil</span>
                                   <span class="p">(</span><span class="nf">execute-kbd-macro</span>
                                    <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c aabb C-g&quot;</span><span class="p">))</span>
                                 <span class="p">(</span><span class="nv">quit</span> <span class="no">nil</span><span class="p">))</span>
                               <span class="p">(</span><span class="nf">execute-kbd-macro</span> <span class="s">&quot;aaqaabbaa&quot;</span><span class="p">))</span>
                   <span class="s">&quot;jjkkaaqaabbaa|&quot;</span><span class="p">)))</span>
</code></pre></div>
<p>In the tests above, <code>hydra-simple</code> is a defined and bound hydra. <code>&quot;|&quot;</code>
represents the buffer text (empty), where <code>|</code> is the point position.
And <code>(kbd &quot;C-c aabbaaqaabbaa&quot;)</code> represents the key sequence that you can normally press by hand.
Finally, <code>&quot;jjkkjjaabbaa|&quot;</code> is what the buffer and the point position should look like afterwards.
If you find a hydra bug, it would be really cool to submit a new integration test to make sure that
this bug doesn&#39;t happen in the future.</p>

<h3 id="basic-error-handling">Basic error handling</h3>

<p>I really like the <a href="https://github.com/jwiegley/use-package">use-package</a> feature where it catches load-time errors and issues a message instead of bringing up the debugger. This is really useful, since it&#39;s hard to fix the bug with a mostly broken Emacs, in the case when the error happened early in the load process. So the same behavior now happens with <code>defhydra</code>. In case of an error, <code>defhydra</code> will be equivalent to a no-op, and the error message will be written to the <code>*Messages*</code> buffer.</p>

<h3 id="use-a-variable-instead-of-a-function-for-the-hint">Use a variable instead of a function for the hint</h3>

<p>This leads up to the yet unresolved <a href="https://github.com/abo-abo/hydra/issues/86">#86</a>, which asks
for heads to be activated conditionally.</p>

<p>For now, you can modify the docstring on your own if you wish.
Here&#39;s some code from the expansion of <code>hydra-zoom</code> to explain what I mean:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nf">set</span>
 <span class="p">(</span><span class="k">defvar</span> <span class="nv">hydra-zoom/hint</span> <span class="no">nil</span>
   <span class="s">&quot;Dynamic hint for hydra-zoom.&quot;</span><span class="p">)</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nf">format</span>
   <span class="o">#(</span><span class="s">&quot;zoom: [g]: in, [l]: out.&quot;</span>
     <span class="mi">7</span> <span class="mi">8</span> <span class="p">(</span><span class="nv">face</span> <span class="nv">hydra-face-red</span><span class="p">)</span>
     <span class="mi">16</span> <span class="mi">17</span> <span class="p">(</span><span class="nv">face</span> <span class="nv">hydra-face-red</span><span class="p">))))</span>
<span class="c1">;; in head body:</span>
<span class="p">(</span><span class="nb">when</span> <span class="nv">hydra-is-helpful</span>
  <span class="p">(</span><span class="k">if</span> <span class="nv">hydra-lv</span>
      <span class="p">(</span><span class="nv">lv-message</span>
       <span class="p">(</span><span class="nf">eval</span> <span class="nv">hydra-zoom/hint</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">message</span>
     <span class="p">(</span><span class="nf">eval</span> <span class="nv">hydra-zoom/hint</span><span class="p">))))</span>
</code></pre></div>
<p>Eventually, I&#39;ll add some automatic stuff to fix #86. But for now, you can
experiment with modifying e.g. <code>hydra-zoom/hint</code> inside heads, if you want.</p>

<h3 id="multiple-inheritance-for-hydra-heads">Multiple inheritance for Hydra heads</h3>

<p>Each hydra, e.g. <code>hydra-foo</code> will now declare its own heads as a variable
<code>hydra-foo/heads</code>. It&#39;s possible to inherit them like this:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defhydra</span> <span class="nv">hydra-zoom</span> <span class="p">(</span><span class="nv">global-map</span> <span class="s">&quot;&lt;f2&gt;&quot;</span><span class="p">)</span>
  <span class="s">&quot;zoom&quot;</span>
  <span class="p">(</span><span class="s">&quot;g&quot;</span> <span class="nv">text-scale-increase</span> <span class="s">&quot;in&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;s&quot;</span> <span class="nv">text-scale-decrease</span> <span class="s">&quot;out&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defhydra</span> <span class="nv">hydra-arrows</span> <span class="p">()</span>
  <span class="p">(</span><span class="s">&quot;h&quot;</span> <span class="nf">backward-char</span> <span class="s">&quot;left&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;j&quot;</span> <span class="nv">next-line</span> <span class="s">&quot;down&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;k&quot;</span> <span class="nv">previous-line</span> <span class="s">&quot;up&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;l&quot;</span> <span class="nf">forward-char</span> <span class="s">&quot;right&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defhydra</span> <span class="nv">hydra-zoom-child</span> <span class="p">(</span><span class="nb">:inherit</span> <span class="p">(</span><span class="nv">hydra-zoom/heads</span>
                                      <span class="nv">hydra-arrows/heads</span><span class="p">)</span>
                            <span class="nb">:color</span> <span class="nv">amaranth</span><span class="p">)</span>
  <span class="s">&quot;zoom&quot;</span>
  <span class="p">(</span><span class="s">&quot;q&quot;</span> <span class="no">nil</span><span class="p">))</span>
</code></pre></div>
<p>Here, <code>hydra-zoom-child</code> inherits the heads of <code>hydra-zoom</code> and <code>hydra-arrows</code>.
It adds one more head <kbd>q</kbd> to quit. Also, it changes the color to
amaranth, which means that it&#39;s only possible to exit it with <kbd>q</kbd> or
<kbd>C-g</kbd>. This hydra&#39;s parents remain at their original (red) color.</p>

<p>See <a href="https://github.com/abo-abo/hydra/issues/57">#57</a> for more info.</p>

<h2 id="outro">Outro</h2>

<p>A big thanks to all who contributed towards this release and to <a href="https://github.com/abo-abo/hydra/wiki">the wiki</a>.
If you have an idea that would be cool in Hydra, do raise <a href="https://github.com/abo-abo/hydra/issues">an issue</a>.
And if you written some cool code that uses the already available Hydra features, please share it on the wiki.
It&#39;s also a good way to protect your code against regressions (although the best one would be an integration test).</p>

<p>Finally, check out the new version of
<a href="https://github.com/joostkremers/pandoc-mode">pandoc-mode</a> which is
one of the coolest and most elaborate uses of Hydra yet.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/04/09/counsel-completion/">
        Complete stuff with Counsel
      </a>
    </h1>

    <span class="post-date">09 Apr 2015</span>

    <h2 id="intro">Intro</h2>

<p>If you like my package <a href="https://github.com/abo-abo/swiper">swiper</a>,
I&#39;m sure you&#39;ll also like <a href="http://melpa.org/#/counsel">counsel</a>. It
lives in the same repository, but you can install it separately from
MELPA.</p>

<p>Counsel uses <code>ivy</code> - the same method as <code>swiper</code> to:</p>

<ul>
<li>Complete Elisp at point with <code>counsel-el</code>.</li>
<li>Complete Clojure at point with <code>counsel-clj</code>.</li>
<li>Open a git-managed file with <code>counsel-git</code>.</li>
<li>Describe an Elisp variable with <code>counsel-describe-variable</code>.</li>
<li>Describe an Elisp function with <code>counsel-describe-function</code>.</li>
<li>Look up an Elisp symbol in the info with <code>counsel-info-lookup-symbol</code>.</li>
<li>Insert a Unicode character at point with <code>counsel-unicode-char</code>.</li>
</ul>

<p>Below, I&#39;ll describe the functions that I added just today.</p>

<h3 id="counsel-describe-function"><code>counsel-describe-function</code></h3>

<p>This is just a replacement for <code>describe-function</code>:</p>

<p><img src="/download/counsel-describe-function.png" alt="counsel-describe-function.png"></p>

<p>As you can see, regular expressions work here as well.  The
space-splitting behavior is the same as in <code>swiper</code>, so don&#39;t expect
to be able to match a single space: spaces are wild.</p>

<h3 id="counsel-describe-variable"><code>counsel-describe-variable</code></h3>

<p>This is just a replacement for <code>describe-variable</code>:</p>

<p><img src="/download/counsel-describe-variable.png" alt="counsel-describe-variable.png"></p>

<p>Well, actually I&#39;ve used <code>ido-mode</code> with <code>flx</code> matching for these two
functions before. In my experience, <code>ivy</code> handles much better:</p>

<ul>
<li>you are in charge of which regex you&#39;re searching for</li>
<li>you see the candidate count</li>
<li>no crazy wrap-around candidate cycling</li>
</ul>

<p>And it works faster, too.</p>

<p>Here are my bindings:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;&lt;f1&gt; f&quot;</span><span class="p">)</span> <span class="ss">&#39;counsel-describe-function</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;&lt;f1&gt; v&quot;</span><span class="p">)</span> <span class="ss">&#39;counsel-describe-variable</span><span class="p">)</span>
</code></pre></div>
<h3 id="counsel-info-lookup-symbol"><code>counsel-info-lookup-symbol</code></h3>

<p><img src="/download/counsel-info-lookup-symbol.png" alt="counsel-info-lookup-symbol.png"></p>

<p>I don&#39;t use this one too often, but it&#39;s nice to have the option:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;&lt;f2&gt; i&quot;</span><span class="p">)</span> <span class="ss">&#39;counsel-info-lookup-symbol</span><span class="p">)</span>
</code></pre></div>
<h3 id="counsel-unicode-char"><code>counsel-unicode-char</code></h3>

<p><img src="/download/counsel-unicode-char.png" alt="counsel-unicode-char.png"></p>

<p>At around 40000 candidates, <code>ivy</code> starts to feel clunky (around 0.1s
display delay). Unfortunately, I don&#39;t really see a way around this,
except using tricks like <code>while-no-input</code>, which didn&#39;t work right
when I tried it earlier. It would be really cool to do the completion
in another thread, but alas.</p>

<h2 id="outro">Outro</h2>

<p>Give the new functions a try. I think <code>ivy</code> can become a viable <code>ido</code>
replacement, at least it has done so for me: the only <code>ido</code> functions
that I&#39;m still using are <code>ido-switch-buffer</code> and <code>ido-find-file</code>.</p>

<p>Also, if you&#39;re using <code>projectile</code>, you can use <code>ivy</code> completion for it:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">projectile-completion-system</span> <span class="ss">&#39;ivy</span><span class="p">)</span>
</code></pre></div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/04/06/lispy-multiline/">
        Rule-based multi-line in lispy
      </a>
    </h1>

    <span class="post-date">06 Apr 2015</span>

    <h2 id="where-do-one-line-expressions-come-from">Where do one-line expressions come from?</h2>

<p>When programming LISP, especially with <a href="https://github.com/abo-abo/lispy">lispy</a>, it&#39;s easy to
generate random one-line expressions. This is, of course, because the results of <code>read</code> or <code>eval</code>
don&#39;t contain any whitespace information: all original newlines are lost.</p>

<p>Just to review the multitude of ways to insert generated code into a buffer using <code>lispy</code> I&#39;ll list
the shortcuts and the test-based explanations (at around 2000 lines of tests and 54% test coverage,
<code>lispy</code> is pretty well tested).</p>

<h3 id="eval-and-insert">eval-and-insert</h3>

<p><kbd>E</kbd> calls <code>lispy-eval-and-insert</code>.</p>

<p><img src="/download/lispy-test-eval-and-insert.png" alt="lispy-test-eval-and-insert.png"></p>

<p>The image above is generated using the interactive test visualizer <code>lispy-view-test</code>, bound to
<kbd>xv</kbd>. If you want to explore how a certain command is intended to behave, just find the
corresponding test (with the same name as the command) and call <kbd>xv</kbd>.</p>

<h3 id="eval-and-replace">eval-and-replace</h3>

<p><kbd>xr</kbd> calls <code>lispy-eval-and-replace</code>.  This function evaluates the current expression and
replaces it with the result.</p>

<p><img src="/download/lispy-test-eval-and-replace.png" alt="lispy-test-eval-and-replace.png"></p>

<p>The sequence of actions in the test:</p>

<ul>
<li><kbd>e</kbd> calls <code>lispy-eval</code> to set <code>foo</code> to <code>42</code>.</li>
<li><kbd>j</kbd> calls <code>lispy-down</code> to move to the next sexp.</li>
<li><kbd>xr</kbd> calls <code>lispy-eval-and-replace</code>.</li>
</ul>

<p>Ideally, there should have been <code>&quot;xr&quot;</code> instead of <code>(lispy-eval-and-replace)</code> in the test, but
there&#39;s a small wrinkle in the <code>lispy-with</code> macro that needs to be fixed before that can happen.</p>

<h3 id="flatten">flatten</h3>

<p><kbd>xf</kbd> calls <code>lispy-flatten</code>. This function expands in-place the current function or macro
call.</p>

<p><img src="/download/lispy-test-flatten.png" alt="lispy-test-flatten.png"></p>

<p>In this test, the misleadingly named function <code>square</code> is evaluated and flattened, to see if the
<code>&amp;optional</code> and <code>&amp;rest</code> argument passing rules indeed work.</p>

<p>The flatten operation works really well for Elisp and quite well for Clojure.  The CL implementation
would need to heavily rely on SLIME features (currently absent), since the CL spec doesn&#39;t define an
equivalent of Elisp&#39;s <code>symbol-function</code>. The same applies to Scheme, I guess.</p>

<h3 id="oneline">oneline</h3>

<p><kbd>O</kbd> calls <code>lispy-oneline</code>. It&#39;s not eval-based, it just deletes the newlines.
If there are any comments present, they are pushed out.</p>

<p><img src="/download/lispy-test-oneline.png" alt="lispy-test-oneline.png"></p>

<h2 id="lispy-alt-multiline-demo-1"><code>lispy-alt-multiline</code> Demo 1</h2>

<p>In the following image, I just press <kbd>T</kbd> once, starting from an unchanged buffer:</p>

<p><img src="/download/lispy-alt-multiline-1.gif" alt="lispy-alt-multiline-1.gif"></p>

<h2 id="lispy-alt-multiline-demo-2"><code>lispy-alt-multiline</code> Demo 2</h2>

<h3 id="flatten-push">Flatten <code>push</code></h3>

<p>Start from this code (the cursor is in the CSS, if you don&#39;t see it):</p>

<div class="highlight"><pre><code class="language-elisp"
data-lang="elisp"><span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">res</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">dotimes</span> <span class="p">(</span><span class="nv">i</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p"><cursor>(</cursor></span><span class="nb">push</span> <span class="nv">i</span> <span class="nv">res</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">nreverse</span> <span class="nv">res</span><span class="p">))</span>
</code></pre></div>

<p>After <kbd>xf</kbd> it becomes:</p>

<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">res</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">dotimes</span> <span class="p">(</span><span class="nv">i</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p"><cursor>(</cursor></span><span class="k">setq</span> <span class="nv">res</span>
          <span class="p">(</span><span class="nf">cons</span> <span class="nv">i</span> <span class="nv">res</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">nreverse</span> <span class="nv">res</span><span class="p">))</span>
</code></pre></div>

<p>Since <code>push</code> is a macro, <code>macroexpand</code> is used. And since <code>macroexpand</code> doesn&#39;t give newline
information, <code>pp-to-string</code> is used, and it gives a reasonable result.</p>

<h3 id="flatten-dotimes">Flatten <code>dotimes</code></h3>

<p>Start with the same code, but with cursor on <code>dotimes</code> this time:</p>

<div class="highlight"><pre><code class="language-elisp"
data-lang="elisp"><span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">res</span><span class="p">)</span>
  <span class="p"><cursor>(</cursor></span><span class="nb">dotimes</span> <span class="p">(</span><span class="nv">i</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">push</span> <span class="nv">i</span> <span class="nv">res</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">nreverse</span> <span class="nv">res</span><span class="p">))</span>
</code></pre></div>

<p>After <kbd>xf</kbd> it becomes:</p>

<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">res</span><span class="p">)</span>
  <span class="p"><cursor>(</cursor></span><span class="nv">cl--block-wrapper</span>
   <span class="p">(</span><span class="k">catch</span> <span class="ss">&#39;--cl-block-nil--</span>
     <span class="p">(</span><span class="k">let</span>
         <span class="p">((</span><span class="nv">--dotimes-limit--</span> <span class="mi">10</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">i</span> <span class="mi">0</span><span class="p">))</span>
       <span class="p">(</span><span class="k">while</span>
           <span class="p">(</span><span class="nf">&lt;</span> <span class="nv">i</span> <span class="nv">--dotimes-limit--</span><span class="p">)</span>
         <span class="p">(</span><span class="k">setq</span> <span class="nv">res</span>
               <span class="p">(</span><span class="nf">cons</span> <span class="nv">i</span> <span class="nv">res</span><span class="p">))</span>
         <span class="p">(</span><span class="k">setq</span> <span class="nv">i</span>
               <span class="p">(</span><span class="nf">1+</span> <span class="nv">i</span><span class="p">))))))</span>
  <span class="p">(</span><span class="nf">nreverse</span> <span class="nv">res</span><span class="p">))</span>
</code></pre></div>

<p>This time <code>pp-to-string</code> isn&#39;t as good: <code>let</code> and <code>while</code> statements are messed up.
Follow this up with <kbd>T</kbd> which calls <code>lispy-alt-multiline</code>:</p>

<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">res</span><span class="p">)</span>
  <span class="p"><cursor>(</cursor></span><span class="nv">cl--block-wrapper</span>
   <span class="p">(</span><span class="k">catch</span> <span class="ss">&#39;--cl-block-nil--</span>
     <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">--dotimes-limit--</span> <span class="mi">10</span><span class="p">)</span>
           <span class="p">(</span><span class="nv">i</span> <span class="mi">0</span><span class="p">))</span>
       <span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="nf">&lt;</span> <span class="nv">i</span>
                 <span class="nv">--dotimes-limit--</span><span class="p">)</span>
         <span class="p">(</span><span class="k">setq</span> <span class="nv">res</span>
               <span class="p">(</span><span class="nf">cons</span> <span class="nv">i</span>
                     <span class="nv">res</span><span class="p">))</span>
         <span class="p">(</span><span class="k">setq</span> <span class="nv">i</span>
               <span class="p">(</span><span class="nf">1+</span>
                <span class="nv">i</span><span class="p">))))))</span>
  <span class="p">(</span><span class="nf">nreverse</span> <span class="nv">res</span><span class="p">))</span>
</code></pre></div>

<p>Well, at least some parts look better. It could be make perfect by adding a sort of threshold when
printing each sub-expression. It&#39;s less than, say <code>15</code> chars, which <code>(setq i (1+ i))</code> is, no
newlines should be added. I&#39;ll add this a bit later.</p>

<h2 id="more-on-lispy-alt-multiline">More on <code>lispy-alt-multiline</code></h2>

<p><code>lispy-alt-multiline</code> can be used on a LISP expression to re-format it across multiple lines.  It
doesn&#39;t matter in which shape the expression currently is, since all current newlines will be removed
before the algorithm starts.</p>

<p>This has to be done with some rules, since a one-line expression can transform to multiple viable
multi-line forms. So far, these rules are implemented by customizing these variables:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">defvar</span> <span class="nv">lispy--multiline-take-3</span>
  <span class="o">&#39;</span><span class="p">(</span><span class="k">defvar</span> <span class="nb">defun</span> <span class="nb">defmacro</span> <span class="nb">defcustom</span> <span class="nb">defgroup</span><span class="p">)</span>
  <span class="s">&quot;List of constructs for which the first 3 elements are on the first line.&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">defvar</span> <span class="nv">lispy--multiline-take-2</span> <span class="o">&#39;</span><span class="p">(</span><span class="nb">defface</span> <span class="nb">define-minor-mode</span>
  <span class="k">condition-case</span> <span class="k">while</span> <span class="nb">incf</span> <span class="nf">car</span> <span class="nf">cdr</span> <span class="nf">&gt;</span> <span class="nf">&gt;=</span> <span class="nf">&lt;</span> <span class="nf">&lt;=</span> <span class="nf">eq</span> <span class="nf">equal</span> <span class="nb">incf</span> <span class="nb">decf</span>
  <span class="nb">cl-incf</span> <span class="nb">cl-decf</span> <span class="k">catch</span> <span class="nb">require</span> <span class="nb">provide</span> <span class="k">setq</span> <span class="nf">cons</span> <span class="nb">when</span> <span class="k">if</span> <span class="nb">unless</span> <span class="k">interactive</span><span class="p">)</span>
  <span class="s">&quot;List of constructs for which the first 2 elements are on the first line.&quot;</span><span class="p">)</span>
</code></pre></div>
<p>The name suggests that there should be <code>lispy-multiline</code>, and there is, bound to <kbd>M</kbd>.  The
difference between <kbd>M</kbd> and <kbd>T</kbd> is that <kbd>M</kbd> is older and ad-hoc, while
<kbd>T</kbd> is newer and rule-based. This means that the latter can misbehave, since it&#39;s not yet
fully tested. However, it has the following built-in check to make sure that it doesn&#39;t mess up your
code:</p>

<blockquote>
<p>The <code>read</code> of the expression before transformation should be <code>equal</code> to the <code>read</code> of the
transformed expression.</p>
</blockquote>

<p>If the above check fails, no change will be performed on the source code. So your code should be
pretty safe. One more cool thing that I want to add to other operations is that it checks if the
buffer will be changed after the transformation. If there will be no change, it will just issue a
<code>&quot;No change&quot;</code> message, and no change will be performed. This is really cool if you obsess about the
buffer changed marker in the mode line like I do.</p>

<h2 id="outro">Outro</h2>

<p>The functions bound to <kbd>O</kbd>, <kbd>M</kbd>, and <kbd>T</kbd> apply to the current expression.
To be really sure which one, turn on <code>show-paren-mode</code>.  You can also call these functions not from
special, although it&#39;s not very convenient. The typical strategy in that case would be to bind all
of them on a prefix map, e.g. <kbd>C-c</kbd>.
How is it different from <a href="https://github.com/abo-abo/lispy#how-to-get-into-list-editing-mode-special">special</a> then?</p>

<blockquote>
<p>Instead of typing <kbd>[T</kbd> you would type <kbd>C-c T</kbd>.</p>
</blockquote>

<p>But the advantage of the special approach is that <kbd>[</kbd>
actually does something (moves point to the start of the current list),
instead of just being a useless part of a key combination like <kbd>C-c</kbd>.
And if you&#39;re in special already, there&#39;s no need for <kbd>[</kbd>.</p>

<p>I hope that you enjoy the new update. If it&#39;s needed, variables like <code>lispy--multiline-take-3</code> can
be made buffer-local so that <kbd>T</kbd> works appropriately for Clojure, CL and Scheme, instead of
just Elisp. If you&#39;d like to add support for your favorite dialect in this way, I&#39;d be happy to
explain some details if needed and to merge the PR. Happy hacking!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/04/02/lispy-paredit-emulation/">
        Paredit emulation in lispy
      </a>
    </h1>

    <span class="post-date">02 Apr 2015</span>

    <h2 id="intro">Intro</h2>

<p>I just finished this feature today.  Almost all Paredit functionality is available in terms of
<a href="https://github.com/abo-abo/lispy">lispy</a>&#39;s own functions.  The only functions that I didn&#39;t
implement were the ones that I didn&#39;t find any use for: <code>paredit-backslash</code> (ugh, prompts),
<code>paredit-comment-dwim</code> (covered by regular <kbd>;</kbd>), <code>paredit-forward-down</code> and
<code>paredit-backward-down</code> (both just move out of special, and throw a lot).</p>

<h2 id="setting-the-keymap-theme">Setting the keymap theme</h2>

<p>So if you ever thought that <code>lispy</code> could be a good idea, but the non-special key bindings are weird,
and you&#39;re too used to Paredit, you can now try this setting:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">lispy-set-key-theme</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">special</span> <span class="nv">paredit</span> <span class="nv">c-digits</span><span class="p">))</span>
</code></pre></div>
<p>Here&#39;s the setting that I&#39;m using, since I love <code>lispy</code>&#39;s default bindings:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">lispy-set-key-theme</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">oleh</span> <span class="nv">special</span> <span class="nv">lispy</span> <span class="nv">c-digits</span><span class="p">))</span>
</code></pre></div>
<p>The default setting actually is this one, <code>lispy-mode-map-oleh</code> is an additional map for use with
my <a href="http://oremacs.com/2015/02/14/semi-xmodmap/">Xmodmap setup</a>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">lispy-set-key-theme</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">special</span> <span class="nv">lispy</span> <span class="nv">c-digits</span><span class="p">))</span>
</code></pre></div>
<p>Each item in the list passed to <code>lispy-set-key-theme</code> designates a keymap to turn on.
So in a non-LISP buffer you could turn on just the special map:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">lispy-set-key-theme</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">special</span><span class="p">))</span>
</code></pre></div>
<p>This would mean that zero regular bindings get overridden, but when the point is before or after a
paren, you get the <code>lispy</code> bindings. Actually, I&#39;ve just enabled <code>lispy-mode</code> for <code>markdown-mode</code>,
and it&#39;s working great. Unfortunately, I haven&#39;t yet figured out how to make a minor mode&#39;s keymap
buffer-local. Maybe someone reading has an idea.</p>

<h2 id="the-screencast">The screencast</h2>

<p>I went through all of Paredit tests and made ERT tests out of them, to make sure that the features
are actually working. I&#39;ve recorded a short (&lt;3 minutes)
<a href="https://www.youtube.com/watch?v=RDcc3RBQ9Gw">screencast</a> of implementing one of the tests.  Have a
look, maybe you&#39;ll something interesting in my setup. There are two short pauses in the video,
that&#39;s just me thinking how to write down a function. My ERT and Magit workflows are also shown.</p>

<h2 id="outro">Outro</h2>

<p>The new key-theme feature is meant to make <code>lispy</code> super-not-annoying. I think it&#39;s useful, since
using <code>lispy</code> in Paredit mode was annoying for me, so the opposite has to be true for people that
are used to Paredit. So if you notice a bug, please <a href="https://github.com/abo-abo/lispy/issues">report it</a>, bug
reports are very important for my non-annoyance agenda.</p>

<p>Finally, if you&#39;re super-devoted to Paredit and don&#39;t want to drop it, now you can easily have both
<code>lispy-mode</code> and <code>paredit-mode</code> on. Just use this setting:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">lispy-set-key-theme</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">special</span><span class="p">))</span>
</code></pre></div>
<p>Or this one if you additionally want <kbd>C-1</kbd> to show the inline doc, and <kbd>C-2</kbd> to show
the inline args:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">lispy-set-key-theme</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">special</span> <span class="nv">c-digits</span><span class="p">))</span>
</code></pre></div>
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page12">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page10">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
