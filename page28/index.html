<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="flattr:id" content="9yl9ry">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (or emacs &middot; irrelevant)
    
  </title>

  <link rel="canonical" href="https://oremacs.com/page28/" />

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/donate/">Donate</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://licensebuttons.net/l/by-sa/4.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/28/notes-on-elisp-indentation/">
        A few notes on Elisp indentation
      </a>
    </h1>

    <span class="post-date">28 Jan 2015</span>

    <p>I sure do like to keep my Elisp code nice and indented.
But sometimes the indentation engine just won&#39;t listen.</p>

<h2 id="lisp-indent-function">lisp-indent-function</h2>

<p>By default, the indentation is handled as if:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">setq</span> <span class="nv">lisp-indent-function</span> <span class="ss">&#39;lisp-indent-function</span><span class="p">)</span>
</code></pre></div>
<p>At least in one case, it looks horrible:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">cl-labels</span> <span class="p">((</span><span class="nv">square</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
                    <span class="p">(</span><span class="nf">*</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">mapcar</span> <span class="nf">#&#39;</span><span class="nv">square</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">)))</span>
<span class="c1">;; =&gt; (0 1 4 9 16 25)</span>
</code></pre></div>
<p>That&#39;s why I have:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">setq</span> <span class="nv">lisp-indent-function</span> <span class="ss">&#39;common-lisp-indent-function</span><span class="p">)</span>
</code></pre></div>
<p>which leads to this indentation:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">cl-labels</span> <span class="p">((</span><span class="nv">square</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">*</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">mapcar</span> <span class="nf">#&#39;</span><span class="nv">square</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">)))</span>
<span class="c1">;; =&gt; (0 1 4 9 16 25)</span>
</code></pre></div>
<p>Ah, much better. The indentation does change a bit in other places as
a result of this. To my experience, it can be fixed on a case-by-case
basis by declaring the indent level for the offending function or
macro.</p>

<h2 id="declaring-indent-level">Declaring indent level</h2>

<p>Here&#39;s how it looks like</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defmacro</span> <span class="nv">lispy-save-excursion</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">body</span><span class="p">)</span>
  <span class="s">&quot;More intuitive (</span><span class="ss">`save-excursion&#39;</span><span class="s"> BODY).&quot;</span>
  <span class="p">(</span><span class="nb">declare</span> <span class="p">(</span><span class="nv">indent</span> <span class="mi">0</span><span class="p">))</span>
  <span class="o">`</span><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">out</span> <span class="p">(</span><span class="k">save-excursion</span>
                <span class="o">,@</span><span class="nv">body</span><span class="p">)))</span>
     <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">bolp</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">back-to-indentation</span><span class="p">))</span>
     <span class="nv">out</span><span class="p">))</span>
</code></pre></div>
<p>By default, functions behave as if their <code>indent</code> was declared to <code>nil</code>.
Zero here means that we expect zero arguments on the same line, so that this indentation follows:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">lispy-save-excursion</span>
  <span class="p">(</span><span class="nv">lispy--out-forward</span> <span class="nv">arg</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">backward-list</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">indent-sexp</span><span class="p">))</span>
</code></pre></div>
<p>The indentation above is just like the one that the original <code>save-excursion</code> has.
Note that if I hadn&#39;t declared the indent, it would look like this:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">lispy-save-excursion</span>
 <span class="p">(</span><span class="nv">lispy--out-forward</span> <span class="nv">arg</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">backward-list</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">indent-sexp</span><span class="p">))</span>
</code></pre></div>
<p>The impact is much larger for statements that require an <code>indent</code> of 1:</p>

<p>Compare the proper thing:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">lispy-dotimes</span> <span class="nv">arg</span>
  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">=</span> <span class="p">(</span><span class="nf">point</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span>
    <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Reached end of buffer&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">forward-list</span><span class="p">))</span>
</code></pre></div>
<p>to this horror:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">lispy-dotimes</span> <span class="nv">arg</span>
               <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">=</span> <span class="p">(</span><span class="nf">point</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span>
                 <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Reached end of buffer&quot;</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">forward-list</span><span class="p">))</span>
</code></pre></div>
<h2 id="outro">Outro</h2>

<p>I&#39;ve shown two things you can try if you find your Elisp indentation
annoying. If you know of more, let me know.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/27/my-refactoring-workflow/">
        My "refactoring" workflow
      </a>
    </h1>

    <span class="post-date">27 Jan 2015</span>

    <p>Well, &quot;refactoring&quot; is for the Java people, I simply rename things.
Just today, I had to do a big rename operation related to the
<a href="https://github.com/abo-abo/lispy/releases">release of lispy 0.22.0</a>.
Below, I&#39;ll share some functions and packages that I used for that.</p>

<h2 id="my-github-setup">My Github setup</h2>

<p>Here&#39;s it (<code>tree -da -L 1</code>) is:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>.
├── .cask
├── gh-pages
├── .git
└── images
</code></pre></div>
<p>I&#39;ve cloned my <code>gh-pages</code> branch into its own git repository <em>inside</em>
the original <code>lispy</code> repository. This way, I can rename functions in
the code and the documentation simultaneously.</p>

<h2 id="declaring-functions-obsolete-in-elisp">Declaring functions obsolete in Elisp</h2>

<p>It can be done like this:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">define-obsolete-function-alias</span> <span class="ss">&#39;lispy-out-forward</span>
    <span class="ss">&#39;lispy-right</span> <span class="s">&quot;0.21.0&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">define-obsolete-function-alias</span> <span class="ss">&#39;lispy-out-backward</span>
    <span class="ss">&#39;lispy-left</span> <span class="s">&quot;0.21.0&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">define-obsolete-function-alias</span> <span class="ss">&#39;lispy-out-forward-nostring</span>
    <span class="ss">&#39;lispy-right-nostring</span> <span class="s">&quot;0.21.0&quot;</span><span class="p">)</span>
</code></pre></div>
<p>After version <code>&quot;0.21.0&quot;</code> hits, any time you call <code>lispy-left</code> by its
now obsolete alias <code>lispy-out-backward</code>, you&#39;ll get a message:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>`lispy-out-forward&#39; is an obsolete command (as of 0.21.0); use `lispy-right&#39; instead.
</code></pre></div>
<p>So now, since I&#39;m releasing version <code>&quot;0.22.0&quot;</code>, I can remove even the
alias declarations. I gave people one week of warnings to adjust (just
rename to the new name) any of their code that&#39;s calling the currently
obsolete functions.</p>

<h2 id="renaming-obsolete-functions-in-the-documentation">Renaming obsolete functions in the documentation</h2>

<p>Taking advantage of the repository setup, I can:</p>

<h3 id="step-1-call-rgrep">Step 1: call <code>rgrep</code></h3>

<p><code>rgrep</code> is a fine function, I wonder why it&#39;s not bound by default; I
bind it to <kbd>C-&lt;</kbd>, taking advantage of my weird key
mappings (I&#39;m actually pressing the <kbd>C-;-l</kbd> physical keys).</p>

<p>It requires 3 inputs:</p>

<ol>
<li><strong>Symbol to search for</strong>: I call it with the point positioned on
the symbol that I want to rename in the code, in the middle of the
<code>define-obsolete-function-alias</code> tag, so <code>rgrep</code> picks up the
symbol name as the default and I just type <kbd>RET</kbd> to select
it.</li>
<li><strong>File pattern</strong>: <code>*.el</code>, the current file extension is the
default. I type <code>*</code> <kbd>RET</kbd>, since I want to match the <code>org</code> and <code>html</code>
files as well.</li>
<li><strong>Base directory</strong>: this directory will be will be recursively
searched for files that match the file pattern; the default
<code>~/git/lispy/</code> is fine here, <kbd>RET</kbd>.</li>
</ol>

<h3 id="step-2-call-wgrep">Step 2: call <code>wgrep</code></h3>

<p><a href="https://github.com/mhayashi1120/Emacs-wgrep">wgrep</a> is a fine
package, I wonder why it&#39;s not more popular. Since it&#39;s so similar to
<code>wdired</code> (one of the best things since sliced bread, btw), I like to bind
the starter to  <kbd>C-x C-q</kbd> and the finisher to <kbd>C-c C-c</kbd>
as well:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">eval-after-load</span> <span class="ss">&#39;grep</span>
  <span class="o">&#39;</span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">grep-mode-map</span>
    <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-x C-q&quot;</span><span class="p">)</span> <span class="ss">&#39;wgrep-change-to-wgrep-mode</span><span class="p">))</span>

<span class="p">(</span><span class="nv">eval-after-load</span> <span class="ss">&#39;wgrep</span>
  <span class="o">&#39;</span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">grep-mode-map</span>
    <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c C-c&quot;</span><span class="p">)</span> <span class="ss">&#39;wgrep-finish-edit</span><span class="p">))</span>
</code></pre></div>
<h3 id="step-3-call-iedit">Step 3: call <code>iedit</code></h3>

<p><a href="https://github.com/victorhge/iedit">iedit</a> is an amazing package, it&#39;s crazy-good.
Here&#39;s how I bind it, since once <code>iedit-mode</code> is on, you can move to the next occurrence with <kbd>C-i</kbd>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-M-i&quot;</span><span class="p">)</span> <span class="ss">&#39;iedit-mode</span><span class="p">)</span>
</code></pre></div>
<p>In order to change <em>really</em> every occurrence in the buffer, I need to
mark the thing that I want to change, before <kbd>C-M-i</kbd>.
Otherwise, <code>iedit</code> will automatically add symbol bounds (a nice
feature, actually), so that e.g. <code>=lispy-out-forward=</code> will not match
<code>lispy-out-forward</code>.</p>

<p>Finally, I interactively, char-by-char, rename e.g. <code>lispy-out-forward</code> to <code>lispy-right</code>.
The experience is similar to the popular <a href="https://github.com/magnars/multiple-cursors.el">multiple-cursors</a>,
which I also like to use, just for different purposes.</p>

<h3 id="step-4-exiting">Step 4: exiting</h3>

<p>When I&#39;m done:</p>

<ul>
<li>I exit <code>iedit-mode</code> with <kbd>C-M-i</kbd>.</li>
<li>I exit <code>wgrep</code> with <kbd>C-c C-c</kbd></li>
<li>I save all affected files if I want, since they aren&#39;t saved yet and
it&#39;s still possible to revert everything.</li>
</ul>

<h2 id="outro">Outro</h2>

<blockquote>
<p>Woah, that&#39;s a lot of steps!</p>
</blockquote>

<p>True, but do note that all three tools can be used on their own for
various other tasks.  See for instance my other
<a href="http://youtu.be/DFTXnC1scno?t=3m49s">&quot;refactoring&quot; demo</a>, that uses
<code>iedit-mode</code> to unbind a <code>let</code>-bound variable in Elisp (should also
work for Common Lisp, since the syntax is the same).</p>

<p>There&#39;s beauty and utility in having such composable tools. A lot of
the time, it&#39;s better than to just have one &quot;Rename&quot; button. For
instance, when only one buffer is involved, the <code>rgrep</code>-<code>wgrep</code> step
can be skipped and I can rename stuff with <code>iedit-mode</code> only.</p>

<p>Or, when the playground for renaming is less than a buffer, I can:</p>

<ol>
<li><kbd>C-x nd</kbd> - <code>narrow-to-defun</code> or <kbd>C-x nn</kbd> -
<code>narrow-to-region</code> (both are equivalent to <kbd>N</kbd> in <code>lispy</code>)</li>
<li><code>iedit-mode</code></li>
<li><kbd>C-x nw</kbd> - <code>widen</code> (<kbd>W</kbd> in <code>lispy</code>)</li>
</ol>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/26/occur-dwim/">
        occur-dwim (Do What I Mean)
      </a>
    </h1>

    <span class="post-date">26 Jan 2015</span>

    <p>I&#39;d like to share a little snippet that I like to use instead of a
plain <kbd>M-s o</kbd> (<code>occur</code>).</p>

<h2 id="smarter-than-the-average-occur">smarter-than-the-average-occur</h2>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">occur-dwim</span> <span class="p">()</span>
  <span class="s">&quot;Call </span><span class="ss">`occur&#39;</span><span class="s"> with a sane default.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">push</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">region-active-p</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">buffer-substring-no-properties</span>
             <span class="p">(</span><span class="nf">region-beginning</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">region-end</span><span class="p">))</span>
          <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">sym</span> <span class="p">(</span><span class="nv">thing-at-point</span> <span class="ss">&#39;symbol</span><span class="p">)))</span>
            <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">sym</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">regexp-quote</span> <span class="nv">sym</span><span class="p">))))</span>
        <span class="nv">regexp-history</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">call-interactively</span> <span class="ss">&#39;occur</span><span class="p">))</span>
</code></pre></div>
<p>It will offer as the default candidate:</p>

<ul>
<li>the current region, if it&#39;s active</li>
<li>the current symbol, otherwise</li>
</ul>

<p>It&#39;s pretty good, since I actually want the default candidate in 95%
of the cases.  Some other functions, such as <code>rgrep</code> are smart like
this out-of-the-box.</p>

<h2 id="a-hydra-that-goes-nicely-with-occur">A Hydra that goes nicely with <code>occur</code></h2>

<p>Since <code>occur</code>, like some other functions (<code>grep</code>, <code>rgrep</code>, <code>compile</code>),
works with <code>next-error</code>, it&#39;s possible to use this
<a href="https://github.com/abo-abo/hydra">Hydra</a> to navigate the <code>occur</code>
matches:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">hydra-create</span> <span class="s">&quot;M-g&quot;</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;h&quot;</span> <span class="nv">first-error</span> <span class="s">&quot;first&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;j&quot;</span> <span class="nv">next-error</span> <span class="s">&quot;next&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;k&quot;</span> <span class="nv">previous-error</span> <span class="s">&quot;prev&quot;</span><span class="p">)))</span>
</code></pre></div>
<p>Hydra was introduced in an
<a href="/2015/01/20/introducing-hydra/">earlier post</a>,
and is available in GNU ELPA.</p>

<h2 id="what-goes-around-comes-around">What goes around comes around</h2>

<p>I usually do a quick internet search to see where I got the code that
I&#39;m posting here, reason being that it&#39;s nice to list the source, as
well as there could be more advanced stuff out there on the same
topic.</p>

<p>I saw a few results for <code>&quot;occur-dwim&quot;</code> so I thought that I just
copy-pasted it from somewhere. Slight disappointment turned into a
small sense of pride, when I found that the source of the copy-pastes
was my old Stack Overflow answer:)</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/25/exploring-emacs-packages/">
        Exploring Emacs packages
      </a>
    </h1>

    <span class="post-date">25 Jan 2015</span>

    <p>Currently, <a href="http://melpa.org/">MELPA</a> hosts over <code>2250</code> packages. That&#39;s
quite a large number, although it&#39;s still feasible to try most of the
popular ones. In comparison,</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>apt-cache pkgnames <span class="p">|</span> wc
</code></pre></div>
<p>gives me the number <code>50250</code>. I don&#39;t recall calling <code>apt-cache
pkgnames</code> ever before, while I call <code>package-list-packages</code> all the
time. I suppose that this will have to change when the number of
packages grows further.</p>

<p>I usually explore packages just as they show up as new in <code>package-list-packages</code>.
I&#39;ll share the two tools that I use for exploring them.</p>

<h2 id="smex">Smex</h2>

<p><a href="https://github.com/nonsequitur/smex">Smex</a> is an <kbd>M-x</kbd> enhancement for Emacs.
In addition to executing commands faster, it gives you an option to jump to the current command&#39;s definition
with <kbd>M-.</kbd>.</p>

<p>Here&#39;s how I bind <code>smex</code>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;smex</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="s">&quot;\C-t&quot;</span> <span class="ss">&#39;smex</span><span class="p">)</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">smex-prepare-ido-bindings</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">ido-completion-map</span>
      <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-,&quot;</span><span class="p">)</span> <span class="ss">&#39;smex-describe-function</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">ido-completion-map</span>
      <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-w&quot;</span><span class="p">)</span> <span class="ss">&#39;smex-where-is</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">ido-completion-map</span>
      <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-.&quot;</span><span class="p">)</span> <span class="ss">&#39;smex-find-function</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">ido-completion-map</span>
      <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-a&quot;</span><span class="p">)</span> <span class="ss">&#39;move-beginning-of-line</span><span class="p">)</span>
  <span class="c1">;; (define-key ido-completion-map &quot;\C-i&quot; &#39;smex-helm)</span>
  <span class="c1">;; (define-key ido-completion-map &quot; &quot; &#39;smex-helm)</span>
  <span class="p">)</span>
</code></pre></div>
<p>I don&#39;t feel bad at all for unbinding <code>transpose-chars</code>,
<kbd>C-t</kbd> is such a prime binding, that only the best commands
can deserve it. And since I touch-type, it&#39;s easier for me to hit
<kbd>M-DEL</kbd> and retype the word when I notice a mistake, than to
carefully navigate to the mistake location and call <code>transpose-chars</code>
with surgical precision. On the other hand, the number of Emacs
packages is only going to grow, so it becomes less and less feasible
to bind everything. Instead, seldom used stuff can be called though
<code>smex</code>. For instance, I don&#39;t bind
<a href="https://github.com/ardumont/markdown-toc">markdown-toc</a> or
<a href="https://github.com/hagleitn/speed-type">speed-type</a> and call them via
<kbd>C-t</kbd> instead.</p>

<p>Back to the point, <kbd>C-t</kbd> ... <kbd>C-.</kbd>
(<code>smex-find-function</code>) allows me to quickly jump to the source of the
package that I want to explore.</p>

<h2 id="semantic-tags">Semantic tags</h2>

<p>Once I&#39;m in the source code, I can quickly get an overview with
<kbd>g</kbd> (<code>lispy-goto</code>) from
<a href="https://github.com/abo-abo/lispy">lispy</a>. It uses CEDET&#39;s semantic
module to get a list of tags in current directory with
<a href="https://github.com/emacs-helm/helm">helm</a> for completion.  In my
opinion, it&#39;s much prettier than <code>helm</code>&#39;s own <code>helm-semantic</code>. It also
explores more tags for Emacs Lisp, for instance it will capture
<code>use-package</code> and <code>global-set-key</code> tags.</p>

<p>A new cute feature that I added recently is a different background for
user-visible functions, i.e.  the ones that are callable by
<kbd>M-x</kbd> or <code>smex</code>.  Here&#39;s how it looks like, for the
<code>speed-type</code> package (interactive functions have a purple background):</p>

<p><img src="/download/lispy-goto.png" alt="lispy-goto"></p>

<p>If the image text looks too small, you can right click / view image in
your browser. Here, I can see at a glance, that there are three
commands that I can call.  I can also see a few variables, two of them
don&#39;t include <code>--</code>, so they&#39;re probably customizable.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/24/after-select-window/">
        Do things after selecting window
      </a>
    </h1>

    <span class="post-date">24 Jan 2015</span>

    <p>I saw this question today at Stack Overflow -
<a href="http://stackoverflow.com/q/28124095/1350992">Emacs: How to enable toolbar mode and menubar mode only under a certain mode?</a>.
Myself, I never use the menubar or the toolbar. But maybe it&#39;s just
because it&#39;s useless in the modes to which I&#39;m used to. What if there
was an option to have the menu bar <em>on</em> just for a few select
modes?  For instance, if I decided that I want to learn Haskell
tomorrow, I wouldn&#39;t mind to have the menu bar on for a while,
especially if there was some useful stuff there in the menu.</p>

<h2 id="the-code">The Code</h2>

<p>I&#39;m not aware of a convenient hook for this job; I tried
<code>after-change-major-mode-hook</code>, and it doesn&#39;t work when switching
windows. The universal <code>post-command-hook</code> would be totally lame for this task.</p>

<p>Then it occurred to me, that <code>select-window</code> <em>has</em> to be called
eventually in most circumstances.  Even
<a href="https://github.com/abo-abo/ace-window">ace-window</a> calls
<code>select-window</code>.</p>

<p>This is what I came up with so far:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">defvar</span> <span class="nv">menubar-last</span>
  <span class="p">(</span><span class="nv">make-ring</span> <span class="mi">20</span><span class="p">))</span>
<span class="p">(</span><span class="nv">ring-insert</span> <span class="nv">menubar-last</span> <span class="s">&quot;dummy&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defadvice</span> <span class="nf">select-window</span> <span class="p">(</span><span class="nv">after</span> <span class="nv">select-window-menubar</span> <span class="nv">activate</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">equal</span> <span class="p">(</span><span class="nf">buffer-name</span><span class="p">)</span> <span class="p">(</span><span class="nv">ring-ref</span> <span class="nv">menubar-last</span> <span class="mi">0</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">ring-insert</span> <span class="nv">menubar-last</span> <span class="p">(</span><span class="nf">buffer-name</span><span class="p">))</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">yes-or-no</span>
           <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">memq</span> <span class="nv">major-mode</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">r-mode</span> <span class="nv">lisp-interaction-mode</span><span class="p">))</span>
               <span class="mi">1</span> <span class="mi">-1</span><span class="p">)))</span>
      <span class="p">(</span><span class="nv">menu-bar-mode</span> <span class="nv">yes-or-no</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">tool-bar-mode</span> <span class="nv">yes-or-no</span><span class="p">))))</span>
</code></pre></div>
<h2 id="the-ring-trickery">The Ring trickery</h2>

<p>It&#39;s necessary at least for <code>magit</code>. Doing, for instance,
<kbd>ll</kbd> operation switches windows many times.
So I added a check that the current buffer isn&#39;t selected twice.</p>

<p>In Emacs, a ring is like a stack with a limited length: you push onto
the head, and if the stack becomes too large, the stuff gets removed
from the tail. Perfect for debugging this code, since I don&#39;t care
what happened 20 window switches ago, I&#39;m only interested in the most
recent state. One small annoyance is that the following code will
throw, if the ring is empty:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">ring-ref</span> <span class="nv">menubar-last</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div>
<p>I would prefer if it just returned <code>nil</code> instead. Hence the trick of
initializing <code>menubar-last</code> with a dummy item.  Note that this
annoyance propagates to other areas: <code>(current-kill 0)</code> will throw if
you haven&#39;t yet copied text since Emacs started.</p>

<h2 id="outro">Outro</h2>

<p>I&#39;m not sure if this code is more annoying than useful, but, at least,
I learned something new while writing it, and I hope you did too.  If
you know of a better way to accomplish the original task, please do
share.</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page29">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page27">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
