<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }
body .hll { background-color: #ffffcc }
body  { background: #ffffff; }
body .c { color: #3f7f5f } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #2a3483; font-weight: bold } /* Keyword */
body .o { color: #666666 } /* Operator */
body .cm { color: #3f7f5f } /* Comment.Multiline */
body .cp { color: #3f7f5f } /* Comment.Preproc */
body .c1 { color: #3f7f5f } /* Comment.Single */
body .cs { color: #3f7f5f } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #FF0000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #00A000 } /* Generic.Inserted */
body .go { color: #888888 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #2a3483; font-weight: bold } /* Keyword.Constant */
body .kd { color: #2a3483; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #2a3483; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #7F0055 } /* Keyword.Pseudo */
body .kr { color: #2a3483; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #2A00FF } /* Literal.String */
body .na { color: #7D9029 } /* Name.Attribute */
body .nb { color: #7F0055; font-weight: bold } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #999999; font-weight: bold } /* Name.Entity */
body .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
body .nf { color: #8c328d } /* Name.Function */
body .nl { color: #A0A000 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #000000 } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #ffffff } /* Text.Whitespace */
body .mb { color: #666666 } /* Literal.Number.Bin */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sb { color: #2A00FF } /* Literal.String.Backtick */
body .sc { color: #2A00FF } /* Literal.String.Char */
body .sd { color: #2A00FF; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #2A00FF } /* Literal.String.Double */
body .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #2A00FF } /* Literal.String.Heredoc */
body .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #BB6688 } /* Literal.String.Regex */
body .s1 { color: #2A00FF } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #7F0055; font-weight: bold } /* Name.Builtin.Pseudo */
body .vc { color: #000000 } /* Name.Variable.Class */
body .vg { color: #000000 } /* Name.Variable.Global */
body .vi { color: #000000 } /* Name.Variable.Instance */
body .il { color: #666666 } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><pre><span class="c1">;;; ediff.el --- a comprehensive visual interface to diff &amp; patch</span>

<span class="c1">;; Copyright (C) 1994-2014 Free Software Foundation, Inc.</span>

<span class="c1">;; Author: Michael Kifer &lt;kifer@cs.stonybrook.edu&gt;</span>
<span class="c1">;; Created: February 2, 1994</span>
<span class="c1">;; Keywords: comparing, merging, patching, vc, tools, unix</span>
<span class="c1">;; Version: 2.81.4</span>

<span class="c1">;; Yoni Rabkin &lt;yoni@rabkins.net&gt; contacted the maintainer of this</span>
<span class="c1">;; file on 20/3/2008, and the maintainer agreed that when a bug is</span>
<span class="c1">;; filed in the Emacs bug reporting system against this file, a copy</span>
<span class="c1">;; of the bug report be sent to the maintainer&#39;s email address.</span>

<span class="p">(</span><span class="k">defconst</span> <span class="nv">ediff-version</span> <span class="s">&quot;2.81.5&quot;</span> <span class="s">&quot;The current version of Ediff&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">defconst</span> <span class="nv">ediff-date</span> <span class="s">&quot;July 4, 2013&quot;</span> <span class="s">&quot;Date of last update&quot;</span><span class="p">)</span>


<span class="c1">;; This file is part of GNU Emacs.</span>

<span class="c1">;; GNU Emacs is free software: you can redistribute it and/or modify</span>
<span class="c1">;; it under the terms of the GNU General Public License as published by</span>
<span class="c1">;; the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1">;; (at your option) any later version.</span>

<span class="c1">;; GNU Emacs is distributed in the hope that it will be useful,</span>
<span class="c1">;; but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1">;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1">;; GNU General Public License for more details.</span>

<span class="c1">;; You should have received a copy of the GNU General Public License</span>
<span class="c1">;; along with GNU Emacs.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="c1">;;; Commentary:</span>

<span class="c1">;; Never read that diff output again!</span>
<span class="c1">;; Apply patch interactively!</span>
<span class="c1">;; Merge with ease!</span>

<span class="c1">;; This package provides a convenient way of simultaneous browsing through</span>
<span class="c1">;; the differences between a pair (or a triple) of files or buffers.  The</span>
<span class="c1">;; files being compared, file-A, file-B, and file-C (if applicable) are</span>
<span class="c1">;; shown in separate windows (side by side, one above the another, or in</span>
<span class="c1">;; separate frames), and the differences are highlighted as you step</span>
<span class="c1">;; through them.  You can also copy difference regions from one buffer to</span>
<span class="c1">;; another (and recover old differences if you change your mind).</span>

<span class="c1">;; Ediff also supports merging operations on files and buffers, including</span>
<span class="c1">;; merging using ancestor versions.  Both comparison and merging operations can</span>
<span class="c1">;; be performed on directories, i.e., by pairwise comparison of files in those</span>
<span class="c1">;; directories.</span>

<span class="c1">;; In addition, Ediff can apply a patch to a file and then let you step</span>
<span class="c1">;; though both files, the patched and the original one, simultaneously,</span>
<span class="c1">;; difference-by-difference.  You can even apply a patch right out of a</span>
<span class="c1">;; mail buffer, i.e., patches received by mail don&#39;t even have to be saved.</span>
<span class="c1">;; Since Ediff lets you copy differences between buffers, you can, in</span>
<span class="c1">;; effect, apply patches selectively (i.e., you can copy a difference</span>
<span class="c1">;; region from file_orig to file, thereby undoing any particular patch that</span>
<span class="c1">;; you don&#39;t like).</span>

<span class="c1">;; Ediff is aware of version control, which lets the user compare</span>
<span class="c1">;; files with their older versions.  Ediff can also work with remote and</span>
<span class="c1">;; compressed files.  Details are given below.</span>

<span class="c1">;; Finally, Ediff supports directory-level comparison, merging and patching.</span>
<span class="c1">;; See the Ediff manual for details.</span>

<span class="c1">;; This package builds upon the ideas borrowed from emerge.el and several</span>
<span class="c1">;; Ediff&#39;s functions are adaptations from emerge.el.  Much of the functionality</span>
<span class="c1">;; Ediff provides is also influenced by emerge.el.</span>

<span class="c1">;; The present version of Ediff supersedes Emerge.  It provides a superior user</span>
<span class="c1">;; interface and has numerous major features not found in Emerge.  In</span>
<span class="c1">;; particular, it can do patching, and 2-way and 3-way file comparison,</span>
<span class="c1">;; merging, and directory operations.</span>



<span class="c1">;;; Bugs:</span>

<span class="c1">;;  1. The undo command doesn&#39;t restore deleted regions well.  That is, if</span>
<span class="c1">;;  you delete all characters in a difference region and then invoke</span>
<span class="c1">;;  `undo&#39;, the reinstated text will most likely be inserted outside of</span>
<span class="c1">;;  what Ediff thinks is the current difference region. (This problem</span>
<span class="c1">;;  doesn&#39;t seem to exist with XEmacs.)</span>
<span class="c1">;;</span>
<span class="c1">;;  If at any point you feel that difference regions are no longer correct,</span>
<span class="c1">;;  you can hit &#39;!&#39; to recompute the differences.</span>

<span class="c1">;;  2. On a monochrome display, the repertoire of faces with which to</span>
<span class="c1">;;  highlight fine differences is limited.  By default, Ediff is using</span>
<span class="c1">;;  underlining.  However, if the region is already underlined by some other</span>
<span class="c1">;;  overlays, there is no simple way to temporarily remove that residual</span>
<span class="c1">;;  underlining.  This problem occurs when a buffer is highlighted with</span>
<span class="c1">;;  hilit19.el or font-lock.el packages.  If this residual highlighting gets</span>
<span class="c1">;;  in the way, you can do the following.  Both font-lock.el and hilit19.el</span>
<span class="c1">;;  provide commands for unhighlighting buffers.  You can either place these</span>
<span class="c1">;;  commands in `ediff-prepare-buffer-hook&#39; (which will unhighlight every</span>
<span class="c1">;;  buffer used by Ediff) or you can execute them interactively, at any time</span>
<span class="c1">;;  and on any buffer.</span>


<span class="c1">;;; Acknowledgments:</span>

<span class="c1">;; Ediff was inspired by Dale R. Worley&#39;s &lt;drw@math.mit.edu&gt; emerge.el.</span>
<span class="c1">;; Ediff would not have been possible without the help and encouragement of</span>
<span class="c1">;; its many users.  See Ediff on-line Info for the full list of those who</span>
<span class="c1">;; helped.  Improved defaults in Ediff file-name reading commands.</span>

<span class="c1">;;; Code:</span>

<span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;ediff</span><span class="p">)</span>

<span class="c1">;; Compiler pacifier</span>
<span class="p">(</span><span class="nb">eval-and-compile</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">fboundp</span> <span class="ss">&#39;declare-function</span><span class="p">)</span> <span class="p">(</span><span class="nb">defmacro</span> <span class="nb">declare-function</span> <span class="p">(</span><span class="kp">&amp;rest</span>  <span class="nv">_r</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;ediff-util</span><span class="p">)</span>
<span class="c1">;; end pacifier</span>

<span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;ediff-init</span><span class="p">)</span>
<span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;ediff-mult</span><span class="p">)</span>  <span class="c1">; required because of the registry stuff</span>

<span class="p">(</span><span class="nb">defgroup</span> <span class="nv">ediff</span> <span class="no">nil</span>
  <span class="s">&quot;Comprehensive visual interface to `diff&#39; and `patch&#39;.&quot;</span>
  <span class="nb">:tag</span> <span class="s">&quot;Ediff&quot;</span>
  <span class="nb">:group</span> <span class="ss">&#39;tools</span><span class="p">)</span>


<span class="p">(</span><span class="nb">defcustom</span> <span class="nv">ediff-use-last-dir</span> <span class="no">nil</span>
  <span class="s">&quot;If t, Ediff will use previous directory as default when reading file name.&quot;</span>
  <span class="nb">:type</span> <span class="ss">&#39;boolean</span>
  <span class="nb">:group</span> <span class="ss">&#39;ediff</span><span class="p">)</span>

<span class="c1">;; Last directory used by an Ediff command for file-A.</span>
<span class="p">(</span><span class="k">defvar</span> <span class="nv">ediff-last-dir-A</span> <span class="no">nil</span><span class="p">)</span>
<span class="c1">;; Last directory used by an Ediff command for file-B.</span>
<span class="p">(</span><span class="k">defvar</span> <span class="nv">ediff-last-dir-B</span> <span class="no">nil</span><span class="p">)</span>
<span class="c1">;; Last directory used by an Ediff command for file-C.</span>
<span class="p">(</span><span class="k">defvar</span> <span class="nv">ediff-last-dir-C</span> <span class="no">nil</span><span class="p">)</span>
<span class="c1">;; Last directory used by an Ediff command for the ancestor file.</span>
<span class="p">(</span><span class="k">defvar</span> <span class="nv">ediff-last-dir-ancestor</span> <span class="no">nil</span><span class="p">)</span>
<span class="c1">;; Last directory used by an Ediff command as the output directory for merge.</span>
<span class="p">(</span><span class="k">defvar</span> <span class="nv">ediff-last-merge-autostore-dir</span> <span class="no">nil</span><span class="p">)</span>


<span class="c1">;; Used as a startup hook to set `_orig&#39; patch file read-only.</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-set-read-only-in-buf-A</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">ediff-with-current-buffer</span> <span class="nv">ediff-buffer-A</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">buffer-read-only</span> <span class="no">t</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">declare-function</span> <span class="nv">dired-get-filename</span> <span class="s">&quot;dired&quot;</span>
                  <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">localp</span> <span class="nv">no-error-if-not-filep</span><span class="p">))</span>
<span class="p">(</span><span class="nb">declare-function</span> <span class="nv">dired-get-marked-files</span> <span class="s">&quot;dired&quot;</span>
                  <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">localp</span> <span class="nv">arg</span> <span class="nv">filter</span> <span class="nv">distinguish-one-marked</span><span class="p">))</span>

<span class="c1">;; Return a plausible default for ediff&#39;s first file:</span>
<span class="c1">;; In dired, return the file number FILENO (or 0) in the list</span>
<span class="c1">;; (all-selected-files, filename under the cursor), where directories are</span>
<span class="c1">;; ignored. Otherwise, return DEFAULT file name, if non-nil. Else,</span>
<span class="c1">;; if the buffer is visiting a file, return that file name.</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-get-default-file-name</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">default</span> <span class="nv">fileno</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nf">eq</span> <span class="nv">major-mode</span> <span class="ss">&#39;dired-mode</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">current</span> <span class="p">(</span><span class="nv">dired-get-filename</span> <span class="no">nil</span> <span class="ss">&#39;no-error</span><span class="p">))</span>
	       <span class="p">(</span><span class="nv">marked</span> <span class="p">(</span><span class="k">condition-case</span> <span class="no">nil</span>
			   <span class="p">(</span><span class="nv">dired-get-marked-files</span> <span class="ss">&#39;no-dir</span><span class="p">)</span>
			 <span class="p">(</span><span class="ne">error</span> <span class="no">nil</span><span class="p">)))</span>
	       <span class="nv">aux-list</span> <span class="nv">choices</span> <span class="nv">result</span><span class="p">)</span>
	   <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nf">integerp</span> <span class="nv">fileno</span><span class="p">)</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">fileno</span> <span class="mi">0</span><span class="p">))</span>
	   <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">default</span><span class="p">)</span>
	       <span class="p">(</span><span class="k">setq</span> <span class="nv">aux-list</span> <span class="p">(</span><span class="nf">cons</span> <span class="nv">default</span> <span class="nv">aux-list</span><span class="p">)))</span>
	   <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">current</span><span class="p">)</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">current</span><span class="p">)))</span>
	       <span class="p">(</span><span class="k">setq</span> <span class="nv">aux-list</span> <span class="p">(</span><span class="nf">cons</span> <span class="nv">current</span> <span class="nv">aux-list</span><span class="p">)))</span>
	   <span class="p">(</span><span class="k">setq</span> <span class="nv">choices</span> <span class="p">(</span><span class="nf">nconc</span>  <span class="nv">marked</span> <span class="nv">aux-list</span><span class="p">))</span>
	   <span class="p">(</span><span class="k">setq</span> <span class="nv">result</span> <span class="p">(</span><span class="nf">elt</span> <span class="nv">choices</span> <span class="nv">fileno</span><span class="p">))</span>
	   <span class="p">(</span><span class="k">or</span> <span class="nv">result</span>
	       <span class="nv">default</span><span class="p">)))</span>
	<span class="p">((</span><span class="nf">stringp</span> <span class="nv">default</span><span class="p">)</span> <span class="nv">default</span><span class="p">)</span>
	<span class="p">((</span><span class="nf">buffer-file-name</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">))</span>
	 <span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="p">(</span><span class="nf">buffer-file-name</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">))))</span>
	<span class="p">))</span>

<span class="c1">;;; Compare files/buffers</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-files</span> <span class="p">(</span><span class="nv">file-A</span> <span class="nv">file-B</span> <span class="kp">&amp;optional</span> <span class="nv">startup-hooks</span><span class="p">)</span>
  <span class="s">&quot;Run Ediff on a pair of files, FILE-A and FILE-B.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">dir-A</span> <span class="p">(</span><span class="k">if</span> <span class="nv">ediff-use-last-dir</span>
		    <span class="nv">ediff-last-dir-A</span>
		  <span class="nv">default-directory</span><span class="p">))</span>
	 <span class="nv">dir-B</span> <span class="nv">f</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">f</span> <span class="p">(</span><span class="nv">ediff-read-file-name</span>
		    <span class="s">&quot;File A to compare&quot;</span>
		    <span class="nv">dir-A</span>
		    <span class="p">(</span><span class="nv">ediff-get-default-file-name</span><span class="p">)</span>
		    <span class="ss">&#39;no-dirs</span><span class="p">))</span>
	   <span class="p">(</span><span class="nv">ediff-read-file-name</span> <span class="s">&quot;File B to compare&quot;</span>
				 <span class="p">(</span><span class="k">setq</span> <span class="nv">dir-B</span>
				       <span class="p">(</span><span class="k">if</span> <span class="nv">ediff-use-last-dir</span>
					   <span class="nv">ediff-last-dir-B</span>
					 <span class="p">(</span><span class="nf">file-name-directory</span> <span class="nv">f</span><span class="p">)))</span>
				 <span class="p">(</span><span class="k">progn</span>
				   <span class="p">(</span><span class="nv">ediff-add-to-history</span>
				    <span class="ss">&#39;file-name-history</span>
				    <span class="p">(</span><span class="nv">ediff-abbreviate-file-name</span>
				     <span class="p">(</span><span class="nf">expand-file-name</span>
				      <span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">f</span><span class="p">)</span>
				      <span class="nv">dir-B</span><span class="p">)))</span>
				   <span class="p">(</span><span class="nv">ediff-get-default-file-name</span> <span class="nv">f</span> <span class="mi">1</span><span class="p">)))</span>
	   <span class="p">)))</span>
  <span class="p">(</span><span class="nv">ediff-files-internal</span> <span class="nv">file-A</span>
			<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">file-B</span><span class="p">)</span>
			    <span class="p">(</span><span class="nf">expand-file-name</span>
			     <span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">file-A</span><span class="p">)</span> <span class="nv">file-B</span><span class="p">)</span>
			  <span class="nv">file-B</span><span class="p">)</span>
			<span class="no">nil</span> <span class="c1">; file-C</span>
			<span class="nv">startup-hooks</span>
			<span class="ss">&#39;ediff-files</span><span class="p">))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-files3</span> <span class="p">(</span><span class="nv">file-A</span> <span class="nv">file-B</span> <span class="nv">file-C</span> <span class="kp">&amp;optional</span> <span class="nv">startup-hooks</span><span class="p">)</span>
  <span class="s">&quot;Run Ediff on three files, FILE-A, FILE-B, and FILE-C.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">dir-A</span> <span class="p">(</span><span class="k">if</span> <span class="nv">ediff-use-last-dir</span>
		    <span class="nv">ediff-last-dir-A</span>
		  <span class="nv">default-directory</span><span class="p">))</span>
	 <span class="nv">dir-B</span> <span class="nv">dir-C</span> <span class="nv">f</span> <span class="nv">ff</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">f</span> <span class="p">(</span><span class="nv">ediff-read-file-name</span>
		    <span class="s">&quot;File A to compare&quot;</span>
		    <span class="nv">dir-A</span>
		    <span class="p">(</span><span class="nv">ediff-get-default-file-name</span><span class="p">)</span>
		    <span class="ss">&#39;no-dirs</span><span class="p">))</span>
	   <span class="p">(</span><span class="k">setq</span> <span class="nv">ff</span> <span class="p">(</span><span class="nv">ediff-read-file-name</span> <span class="s">&quot;File B to compare&quot;</span>
					  <span class="p">(</span><span class="k">setq</span> <span class="nv">dir-B</span>
						<span class="p">(</span><span class="k">if</span> <span class="nv">ediff-use-last-dir</span>
						    <span class="nv">ediff-last-dir-B</span>
						  <span class="p">(</span><span class="nf">file-name-directory</span> <span class="nv">f</span><span class="p">)))</span>
					  <span class="p">(</span><span class="k">progn</span>
					    <span class="p">(</span><span class="nv">ediff-add-to-history</span>
					     <span class="ss">&#39;file-name-history</span>
					     <span class="p">(</span><span class="nv">ediff-abbreviate-file-name</span>
					      <span class="p">(</span><span class="nf">expand-file-name</span>
					       <span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">f</span><span class="p">)</span>
					       <span class="nv">dir-B</span><span class="p">)))</span>
					    <span class="p">(</span><span class="nv">ediff-get-default-file-name</span> <span class="nv">f</span> <span class="mi">1</span><span class="p">))))</span>
	   <span class="p">(</span><span class="nv">ediff-read-file-name</span> <span class="s">&quot;File C to compare&quot;</span>
				 <span class="p">(</span><span class="k">setq</span> <span class="nv">dir-C</span> <span class="p">(</span><span class="k">if</span> <span class="nv">ediff-use-last-dir</span>
						 <span class="nv">ediff-last-dir-C</span>
					       <span class="p">(</span><span class="nf">file-name-directory</span> <span class="nv">ff</span><span class="p">)))</span>
				 <span class="p">(</span><span class="k">progn</span>
				   <span class="p">(</span><span class="nv">ediff-add-to-history</span>
				    <span class="ss">&#39;file-name-history</span>
				    <span class="p">(</span><span class="nv">ediff-abbreviate-file-name</span>
				     <span class="p">(</span><span class="nf">expand-file-name</span>
				      <span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">ff</span><span class="p">)</span>
				      <span class="nv">dir-C</span><span class="p">)))</span>
				   <span class="p">(</span><span class="nv">ediff-get-default-file-name</span> <span class="nv">ff</span> <span class="mi">2</span><span class="p">)))</span>
	   <span class="p">)))</span>
  <span class="p">(</span><span class="nv">ediff-files-internal</span> <span class="nv">file-A</span>
			<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">file-B</span><span class="p">)</span>
			    <span class="p">(</span><span class="nf">expand-file-name</span>
			     <span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">file-A</span><span class="p">)</span> <span class="nv">file-B</span><span class="p">)</span>
			  <span class="nv">file-B</span><span class="p">)</span>
			<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">file-C</span><span class="p">)</span>
			    <span class="p">(</span><span class="nf">expand-file-name</span>
			     <span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">file-A</span><span class="p">)</span> <span class="nv">file-C</span><span class="p">)</span>
			  <span class="nv">file-C</span><span class="p">)</span>
			<span class="nv">startup-hooks</span>
			<span class="ss">&#39;ediff-files3</span><span class="p">))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defalias</span> <span class="ss">&#39;ediff3</span> <span class="ss">&#39;ediff-files3</span><span class="p">)</span>


<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-find-file</span> <span class="p">(</span><span class="nv">file-var</span> <span class="nf">buffer-name</span> <span class="kp">&amp;optional</span> <span class="nv">last-dir</span> <span class="nv">hooks-var</span><span class="p">)</span>
  <span class="s">&quot;Visit FILE and arrange its buffer to Ediff&#39;s liking.</span>
<span class="s">FILE-VAR is actually a variable symbol whose value must contain a true</span>
<span class="s">file name.</span>
<span class="s">BUFFER-NAME is a variable symbol, which will get the buffer object into</span>
<span class="s">which FILE is read.</span>
<span class="s">LAST-DIR is the directory variable symbol where FILE&#39;s</span>
<span class="s">directory name should be returned.  HOOKS-VAR is a variable symbol that will</span>
<span class="s">be assigned the hook to be executed after `ediff-startup&#39; is finished.</span>
<span class="s">`ediff-find-file&#39; arranges that the temp files it might create will be</span>
<span class="s">deleted.&quot;</span>
  <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">file</span> <span class="p">(</span><span class="nf">symbol-value</span> <span class="nv">file-var</span><span class="p">))</span>
	 <span class="p">(</span><span class="nv">file-magic</span> <span class="p">(</span><span class="nv">ediff-filename-magic-p</span> <span class="nv">file</span><span class="p">))</span>
	 <span class="p">(</span><span class="nv">temp-file-name-prefix</span> <span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">file</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nv">not</span> <span class="p">(</span><span class="nf">file-readable-p</span> <span class="nv">file</span><span class="p">))</span>
	   <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;File `%s&#39; does not exist or is not readable&quot;</span> <span class="nv">file</span><span class="p">))</span>
	  <span class="p">((</span><span class="nf">file-directory-p</span> <span class="nv">file</span><span class="p">)</span>
	   <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;File `%s&#39; is a directory&quot;</span> <span class="nv">file</span><span class="p">)))</span>

    <span class="c1">;; some of the commands, below, require full file name</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="nv">file</span><span class="p">))</span>

    <span class="c1">;; Record the directory of the file</span>
    <span class="p">(</span><span class="k">if</span> <span class="nv">last-dir</span>
	<span class="p">(</span><span class="nf">set</span> <span class="nv">last-dir</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="p">(</span><span class="nf">file-name-directory</span> <span class="nv">file</span><span class="p">))))</span>

    <span class="c1">;; Setup the buffer</span>
    <span class="p">(</span><span class="nf">set</span> <span class="nf">buffer-name</span> <span class="p">(</span><span class="nv">find-file-noselect</span> <span class="nv">file</span><span class="p">))</span>

    <span class="p">(</span><span class="nv">ediff-with-current-buffer</span> <span class="p">(</span><span class="nf">symbol-value</span> <span class="nf">buffer-name</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">widen</span><span class="p">)</span> <span class="c1">; Make sure the entire file is seen</span>
      <span class="p">(</span><span class="k">cond</span> <span class="p">(</span><span class="nv">file-magic</span>  <span class="c1">;   file has a handler, such as jka-compr-handler or</span>
	     		 <span class="c1">;;; ange-ftp-hook-function--arrange for temp file</span>
	     <span class="p">(</span><span class="nv">ediff-verify-file-buffer</span> <span class="ss">&#39;magic</span><span class="p">)</span>
	     <span class="p">(</span><span class="k">setq</span> <span class="nv">file</span>
		   <span class="p">(</span><span class="nv">ediff-make-temp-file</span>
		    <span class="p">(</span><span class="nf">current-buffer</span><span class="p">)</span> <span class="nv">temp-file-name-prefix</span><span class="p">))</span>
	     <span class="p">(</span><span class="nf">set</span> <span class="nv">hooks-var</span> <span class="p">(</span><span class="nf">cons</span> <span class="o">`</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nf">delete-file</span> <span class="o">,</span><span class="nv">file</span><span class="p">))</span>
				  <span class="p">(</span><span class="nf">symbol-value</span> <span class="nv">hooks-var</span><span class="p">))))</span>
	    <span class="c1">;; file processed via auto-mode-alist, a la uncompress.el</span>
	    <span class="p">((</span><span class="nv">not</span> <span class="p">(</span><span class="nf">equal</span> <span class="p">(</span><span class="nv">file-truename</span> <span class="nv">file</span><span class="p">)</span>
			 <span class="p">(</span><span class="nv">file-truename</span> <span class="p">(</span><span class="nf">buffer-file-name</span><span class="p">))))</span>
	     <span class="p">(</span><span class="k">setq</span> <span class="nv">file</span>
		   <span class="p">(</span><span class="nv">ediff-make-temp-file</span>
		    <span class="p">(</span><span class="nf">current-buffer</span><span class="p">)</span> <span class="nv">temp-file-name-prefix</span><span class="p">))</span>
	     <span class="p">(</span><span class="nf">set</span> <span class="nv">hooks-var</span> <span class="p">(</span><span class="nf">cons</span> <span class="o">`</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nf">delete-file</span> <span class="o">,</span><span class="nv">file</span><span class="p">))</span>
				  <span class="p">(</span><span class="nf">symbol-value</span> <span class="nv">hooks-var</span><span class="p">))))</span>
	    <span class="p">(</span><span class="no">t</span> <span class="c1">;; plain file---just check that the file matches the buffer</span>
	     <span class="p">(</span><span class="nv">ediff-verify-file-buffer</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">set</span> <span class="nv">file-var</span> <span class="nv">file</span><span class="p">)))</span>

<span class="c1">;; MERGE-BUFFER-FILE is the file to be associated with the merge buffer</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-files-internal</span> <span class="p">(</span><span class="nv">file-A</span> <span class="nv">file-B</span> <span class="nv">file-C</span> <span class="nv">startup-hooks</span> <span class="nv">job-name</span>
				    <span class="kp">&amp;optional</span> <span class="nv">merge-buffer-file</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">buf-A</span> <span class="nv">buf-B</span> <span class="nv">buf-C</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">string=</span> <span class="nv">file-A</span> <span class="nv">file-B</span><span class="p">)</span>
	<span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Files A and B are the same&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">file-C</span><span class="p">)</span>
	<span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nv">string=</span> <span class="nv">file-A</span> <span class="nv">file-C</span><span class="p">)</span> <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Files A and C are the same&quot;</span><span class="p">))</span>
	    <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nv">string=</span> <span class="nv">file-B</span> <span class="nv">file-C</span><span class="p">)</span> <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Files B and C are the same&quot;</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">message</span> <span class="s">&quot;Reading file %s ... &quot;</span> <span class="nv">file-A</span><span class="p">)</span>
    <span class="c1">;;(sit-for 0)</span>
    <span class="p">(</span><span class="nv">ediff-find-file</span> <span class="ss">&#39;file-A</span> <span class="ss">&#39;buf-A</span> <span class="ss">&#39;ediff-last-dir-A</span> <span class="ss">&#39;startup-hooks</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">message</span> <span class="s">&quot;Reading file %s ... &quot;</span> <span class="nv">file-B</span><span class="p">)</span>
    <span class="c1">;;(sit-for 0)</span>
    <span class="p">(</span><span class="nv">ediff-find-file</span> <span class="ss">&#39;file-B</span> <span class="ss">&#39;buf-B</span> <span class="ss">&#39;ediff-last-dir-B</span> <span class="ss">&#39;startup-hooks</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">file-C</span><span class="p">)</span>
	<span class="p">(</span><span class="k">progn</span>
	  <span class="p">(</span><span class="nf">message</span> <span class="s">&quot;Reading file %s ... &quot;</span> <span class="nv">file-C</span><span class="p">)</span>
	  <span class="c1">;;(sit-for 0)</span>
	  <span class="p">(</span><span class="nv">ediff-find-file</span>
	   <span class="ss">&#39;file-C</span> <span class="ss">&#39;buf-C</span>
	   <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">job-name</span> <span class="ss">&#39;ediff-merge-files-with-ancestor</span><span class="p">)</span>
	       <span class="ss">&#39;ediff-last-dir-ancestor</span> <span class="ss">&#39;ediff-last-dir-C</span><span class="p">)</span>
	   <span class="ss">&#39;startup-hooks</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">ediff-setup</span> <span class="nv">buf-A</span> <span class="nv">file-A</span>
		 <span class="nv">buf-B</span> <span class="nv">file-B</span>
		 <span class="nv">buf-C</span> <span class="nv">file-C</span>
		 <span class="nv">startup-hooks</span>
		 <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nf">cons</span> <span class="ss">&#39;ediff-job-name</span> <span class="nv">job-name</span><span class="p">))</span>
		 <span class="nv">merge-buffer-file</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">declare-function</span> <span class="nv">diff-latest-backup-file</span> <span class="s">&quot;diff&quot;</span> <span class="p">(</span><span class="nv">fn</span><span class="p">))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defalias</span> <span class="ss">&#39;ediff</span> <span class="ss">&#39;ediff-files</span><span class="p">)</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-current-file</span> <span class="p">()</span>
  <span class="s">&quot;Start ediff between current buffer and its file on disk.</span>
<span class="s">This command can be used instead of `revert-buffer&#39;.  If there is</span>
<span class="s">nothing to revert then this command fails.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="c1">;; This duplicates code from menu-bar.el.</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">revert-buffer-function</span> <span class="ss">&#39;revert-buffer--default</span><span class="p">))</span>
              <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">revert-buffer-insert-file-contents-function</span>
		       <span class="ss">&#39;revert-buffer-insert-file-contents--default-function</span><span class="p">))</span>
              <span class="p">(</span><span class="k">and</span> <span class="nv">buffer-file-number</span>
                   <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nf">buffer-modified-p</span><span class="p">)</span>
                       <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">verify-visited-file-modtime</span>
                             <span class="p">(</span><span class="nf">current-buffer</span><span class="p">))))))</span>
    <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Nothing to revert&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">auto-save-p</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">recent-auto-save-p</span><span class="p">)</span>
                           <span class="nv">buffer-auto-save-file-name</span>
                           <span class="p">(</span><span class="nf">file-readable-p</span> <span class="nv">buffer-auto-save-file-name</span><span class="p">)</span>
                           <span class="p">(</span><span class="nv">y-or-n-p</span>
                            <span class="s">&quot;Buffer has been auto-saved recently.  Compare with auto-save file? &quot;</span><span class="p">)))</span>
         <span class="p">(</span><span class="nv">file-name</span> <span class="p">(</span><span class="k">if</span> <span class="nv">auto-save-p</span>
                        <span class="nv">buffer-auto-save-file-name</span>
                      <span class="nf">buffer-file-name</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">revert-buf-name</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&quot;FILE=&quot;</span> <span class="nv">file-name</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">revert-buf</span> <span class="p">(</span><span class="nf">get-buffer</span> <span class="nv">revert-buf-name</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">current-major</span> <span class="nv">major-mode</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">unless</span> <span class="nv">file-name</span>
      <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Buffer does not seem to be associated with any file&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">when</span> <span class="nv">revert-buf</span>
      <span class="p">(</span><span class="nf">kill-buffer</span> <span class="nv">revert-buf</span><span class="p">)</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">revert-buf</span> <span class="no">nil</span><span class="p">))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">revert-buf</span> <span class="p">(</span><span class="nf">get-buffer-create</span> <span class="nv">revert-buf-name</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">with-current-buffer</span> <span class="nv">revert-buf</span>
      <span class="p">(</span><span class="nf">insert-file-contents</span> <span class="nv">file-name</span><span class="p">)</span>
      <span class="c1">;; Assume same modes:</span>
      <span class="p">(</span><span class="nf">funcall</span> <span class="nv">current-major</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">ediff-buffers</span> <span class="nv">revert-buf</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">))))</span>


<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-backup</span> <span class="p">(</span><span class="nv">file</span><span class="p">)</span>
  <span class="s">&quot;Run Ediff on FILE and its backup file.</span>
<span class="s">Uses the latest backup, if there are several numerical backups.</span>
<span class="s">If this file is a backup, `ediff&#39; it with its original.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span> <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nv">read-file-name</span> <span class="s">&quot;Ediff (file with backup): &quot;</span><span class="p">)))</span>
  <span class="c1">;; The code is taken from `diff-backup&#39;.</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;diff</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">bak</span> <span class="nv">ori</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">backup-file-name-p</span> <span class="nv">file</span><span class="p">)</span>
	<span class="p">(</span><span class="k">setq</span> <span class="nv">bak</span> <span class="nv">file</span>
	      <span class="nv">ori</span> <span class="p">(</span><span class="nv">file-name-sans-versions</span> <span class="nv">file</span><span class="p">))</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">bak</span> <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nv">diff-latest-backup-file</span> <span class="nv">file</span><span class="p">)</span>
		    <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;No backup found for %s&quot;</span> <span class="nv">file</span><span class="p">))</span>
	    <span class="nv">ori</span> <span class="nv">file</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">ediff-files</span> <span class="nv">bak</span> <span class="nv">ori</span><span class="p">)))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-buffers</span> <span class="p">(</span><span class="nv">buffer-A</span> <span class="nv">buffer-B</span> <span class="kp">&amp;optional</span> <span class="nv">startup-hooks</span> <span class="nv">job-name</span><span class="p">)</span>
  <span class="s">&quot;Run Ediff on a pair of buffers, BUFFER-A and BUFFER-B.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">bf</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">bf</span> <span class="p">(</span><span class="nf">read-buffer</span> <span class="s">&quot;Buffer A to compare: &quot;</span>
				 <span class="p">(</span><span class="nv">ediff-other-buffer</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="no">t</span><span class="p">))</span>
	   <span class="p">(</span><span class="nf">read-buffer</span> <span class="s">&quot;Buffer B to compare: &quot;</span>
			<span class="p">(</span><span class="k">progn</span>
			  <span class="c1">;; realign buffers so that two visible bufs will be</span>
			  <span class="c1">;; at the top</span>
			  <span class="p">(</span><span class="nb">save-window-excursion</span> <span class="p">(</span><span class="nv">other-window</span> <span class="mi">1</span><span class="p">))</span>
			  <span class="p">(</span><span class="nv">ediff-other-buffer</span> <span class="nv">bf</span><span class="p">))</span>
			<span class="no">t</span><span class="p">))))</span>
  <span class="p">(</span><span class="k">or</span> <span class="nv">job-name</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">job-name</span> <span class="ss">&#39;ediff-buffers</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">ediff-buffers-internal</span> <span class="nv">buffer-A</span> <span class="nv">buffer-B</span> <span class="no">nil</span> <span class="nv">startup-hooks</span> <span class="nv">job-name</span><span class="p">))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defalias</span> <span class="ss">&#39;ebuffers</span> <span class="ss">&#39;ediff-buffers</span><span class="p">)</span>


<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-buffers3</span> <span class="p">(</span><span class="nv">buffer-A</span> <span class="nv">buffer-B</span> <span class="nv">buffer-C</span>
				 <span class="kp">&amp;optional</span> <span class="nv">startup-hooks</span> <span class="nv">job-name</span><span class="p">)</span>
  <span class="s">&quot;Run Ediff on three buffers, BUFFER-A, BUFFER-B, and BUFFER-C.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">bf</span> <span class="nv">bff</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">bf</span> <span class="p">(</span><span class="nf">read-buffer</span> <span class="s">&quot;Buffer A to compare: &quot;</span>
				 <span class="p">(</span><span class="nv">ediff-other-buffer</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="no">t</span><span class="p">))</span>
	   <span class="p">(</span><span class="k">setq</span> <span class="nv">bff</span> <span class="p">(</span><span class="nf">read-buffer</span> <span class="s">&quot;Buffer B to compare: &quot;</span>
				  <span class="p">(</span><span class="k">progn</span>
				    <span class="c1">;; realign buffers so that two visible</span>
				    <span class="c1">;; bufs will be at the top</span>
				    <span class="p">(</span><span class="nb">save-window-excursion</span> <span class="p">(</span><span class="nv">other-window</span> <span class="mi">1</span><span class="p">))</span>
				    <span class="p">(</span><span class="nv">ediff-other-buffer</span> <span class="nv">bf</span><span class="p">))</span>
				  <span class="no">t</span><span class="p">))</span>
	   <span class="p">(</span><span class="nf">read-buffer</span> <span class="s">&quot;Buffer C to compare: &quot;</span>
				  <span class="p">(</span><span class="k">progn</span>
				    <span class="c1">;; realign buffers so that three visible</span>
				    <span class="c1">;; bufs will be at the top</span>
				    <span class="p">(</span><span class="nb">save-window-excursion</span> <span class="p">(</span><span class="nv">other-window</span> <span class="mi">1</span><span class="p">))</span>
				    <span class="p">(</span><span class="nv">ediff-other-buffer</span> <span class="p">(</span><span class="nf">list</span> <span class="nv">bf</span> <span class="nv">bff</span><span class="p">)))</span>
				  <span class="no">t</span><span class="p">)</span>
	   <span class="p">)))</span>
  <span class="p">(</span><span class="k">or</span> <span class="nv">job-name</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">job-name</span> <span class="ss">&#39;ediff-buffers3</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">ediff-buffers-internal</span> <span class="nv">buffer-A</span> <span class="nv">buffer-B</span> <span class="nv">buffer-C</span> <span class="nv">startup-hooks</span> <span class="nv">job-name</span><span class="p">))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defalias</span> <span class="ss">&#39;ebuffers3</span> <span class="ss">&#39;ediff-buffers3</span><span class="p">)</span>



<span class="c1">;; MERGE-BUFFER-FILE is the file to be associated with the merge buffer</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-buffers-internal</span> <span class="p">(</span><span class="nv">buf-A</span> <span class="nv">buf-B</span> <span class="nv">buf-C</span> <span class="nv">startup-hooks</span> <span class="nv">job-name</span>
				     <span class="kp">&amp;optional</span> <span class="nv">merge-buffer-file</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">buf-A-file-name</span> <span class="p">(</span><span class="nf">buffer-file-name</span> <span class="p">(</span><span class="nf">get-buffer</span> <span class="nv">buf-A</span><span class="p">)))</span>
	 <span class="p">(</span><span class="nv">buf-B-file-name</span> <span class="p">(</span><span class="nf">buffer-file-name</span> <span class="p">(</span><span class="nf">get-buffer</span> <span class="nv">buf-B</span><span class="p">)))</span>
	 <span class="p">(</span><span class="nv">buf-C-is-alive</span> <span class="p">(</span><span class="nv">ediff-buffer-live-p</span> <span class="nv">buf-C</span><span class="p">))</span>
	 <span class="p">(</span><span class="nv">buf-C-file-name</span> <span class="p">(</span><span class="k">if</span> <span class="nv">buf-C-is-alive</span>
			      <span class="p">(</span><span class="nf">buffer-file-name</span> <span class="p">(</span><span class="nf">get-buffer</span> <span class="nv">buf-B</span><span class="p">))))</span>
	 <span class="nv">file-A</span> <span class="nv">file-B</span> <span class="nv">file-C</span><span class="p">)</span>
    <span class="p">(</span><span class="k">unwind-protect</span>
	<span class="p">(</span><span class="k">progn</span>
	  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">ediff-buffer-live-p</span> <span class="nv">buf-A</span><span class="p">))</span>
	      <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Buffer %S doesn&#39;t exist&quot;</span> <span class="nv">buf-A</span><span class="p">))</span>
	  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">ediff-buffer-live-p</span> <span class="nv">buf-B</span><span class="p">))</span>
	      <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Buffer %S doesn&#39;t exist&quot;</span> <span class="nv">buf-B</span><span class="p">))</span>
	  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">ediff-job-name</span> <span class="nv">job-name</span><span class="p">))</span>
	    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">and</span> <span class="nv">ediff-3way-comparison-job</span>
		     <span class="p">(</span><span class="nv">not</span> <span class="nv">buf-C-is-alive</span><span class="p">))</span>
		<span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Buffer %S doesn&#39;t exist&quot;</span> <span class="nv">buf-C</span><span class="p">)))</span>
	  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">buf-A-file-name</span><span class="p">)</span>
	      <span class="p">(</span><span class="k">setq</span> <span class="nv">buf-A-file-name</span> <span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">buf-A-file-name</span><span class="p">)))</span>
	  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">buf-B-file-name</span><span class="p">)</span>
	      <span class="p">(</span><span class="k">setq</span> <span class="nv">buf-B-file-name</span> <span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">buf-B-file-name</span><span class="p">)))</span>
	  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">buf-C-file-name</span><span class="p">)</span>
	      <span class="p">(</span><span class="k">setq</span> <span class="nv">buf-C-file-name</span> <span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">buf-C-file-name</span><span class="p">)))</span>

	  <span class="p">(</span><span class="k">setq</span> <span class="nv">file-A</span> <span class="p">(</span><span class="nv">ediff-make-temp-file</span> <span class="nv">buf-A</span> <span class="nv">buf-A-file-name</span><span class="p">)</span>
		<span class="nv">file-B</span> <span class="p">(</span><span class="nv">ediff-make-temp-file</span> <span class="nv">buf-B</span> <span class="nv">buf-B-file-name</span><span class="p">))</span>
	  <span class="p">(</span><span class="k">if</span> <span class="nv">buf-C-is-alive</span>
	      <span class="p">(</span><span class="k">setq</span> <span class="nv">file-C</span> <span class="p">(</span><span class="nv">ediff-make-temp-file</span> <span class="nv">buf-C</span> <span class="nv">buf-C-file-name</span><span class="p">)))</span>

	  <span class="p">(</span><span class="nv">ediff-setup</span> <span class="p">(</span><span class="nf">get-buffer</span> <span class="nv">buf-A</span><span class="p">)</span> <span class="nv">file-A</span>
		       <span class="p">(</span><span class="nf">get-buffer</span> <span class="nv">buf-B</span><span class="p">)</span> <span class="nv">file-B</span>
		       <span class="p">(</span><span class="k">if</span> <span class="nv">buf-C-is-alive</span> <span class="p">(</span><span class="nf">get-buffer</span> <span class="nv">buf-C</span><span class="p">))</span>
		       <span class="nv">file-C</span>
		       <span class="p">(</span><span class="nf">cons</span> <span class="o">`</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
				<span class="p">(</span><span class="nf">delete-file</span> <span class="o">,</span><span class="nv">file-A</span><span class="p">)</span>
				<span class="p">(</span><span class="nf">delete-file</span> <span class="o">,</span><span class="nv">file-B</span><span class="p">)</span>
				<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="o">,</span><span class="nv">file-C</span><span class="p">)</span> <span class="p">(</span><span class="nf">delete-file</span> <span class="o">,</span><span class="nv">file-C</span><span class="p">)))</span>
			     <span class="nv">startup-hooks</span><span class="p">)</span>
		       <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nf">cons</span> <span class="ss">&#39;ediff-job-name</span> <span class="nv">job-name</span><span class="p">))</span>
		       <span class="nv">merge-buffer-file</span><span class="p">))</span>
      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">file-A</span><span class="p">)</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">file-A</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">delete-file</span> <span class="nv">file-A</span><span class="p">))</span>
      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">file-B</span><span class="p">)</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">file-B</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">delete-file</span> <span class="nv">file-B</span><span class="p">))</span>
      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">file-C</span><span class="p">)</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">file-C</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">delete-file</span> <span class="nv">file-C</span><span class="p">)))))</span>


<span class="c1">;;; Directory and file group operations</span>

<span class="c1">;; Get appropriate default name for directory:</span>
<span class="c1">;; If ediff-use-last-dir, use ediff-last-dir-A.</span>
<span class="c1">;; In dired mode, use the directory that is under the point (if any);</span>
<span class="c1">;; otherwise, use default-directory</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-get-default-directory-name</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">cond</span> <span class="p">(</span><span class="nv">ediff-use-last-dir</span> <span class="nv">ediff-last-dir-A</span><span class="p">)</span>
	<span class="p">((</span><span class="nf">eq</span> <span class="nv">major-mode</span> <span class="ss">&#39;dired-mode</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">f</span> <span class="p">(</span><span class="nv">dired-get-filename</span> <span class="no">nil</span> <span class="ss">&#39;noerror</span><span class="p">)))</span>
	   <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">f</span><span class="p">)</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">f</span><span class="p">))</span>
	       <span class="nv">f</span>
	     <span class="nv">default-directory</span><span class="p">)))</span>
	<span class="p">(</span><span class="no">t</span> <span class="nv">default-directory</span><span class="p">)))</span>


<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-directories</span> <span class="p">(</span><span class="nv">dir1</span> <span class="nv">dir2</span> <span class="nv">regexp</span><span class="p">)</span>
  <span class="s">&quot;Run Ediff on a pair of directories, DIR1 and DIR2, comparing files that have</span>
<span class="s">the same name in both.  The third argument, REGEXP, is nil or a regular</span>
<span class="s">expression; only file names that match the regexp are considered.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">dir-A</span> <span class="p">(</span><span class="nv">ediff-get-default-directory-name</span><span class="p">))</span>
	 <span class="p">(</span><span class="nv">default-regexp</span> <span class="p">(</span><span class="nf">eval</span> <span class="nv">ediff-default-filtering-regexp</span><span class="p">))</span>
	 <span class="nv">f</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">f</span> <span class="p">(</span><span class="nv">read-directory-name</span>
		    <span class="s">&quot;Directory A to compare: &quot;</span> <span class="nv">dir-A</span> <span class="no">nil</span> <span class="ss">&#39;must-match</span><span class="p">))</span>
	   <span class="p">(</span><span class="nv">read-directory-name</span> <span class="s">&quot;Directory B to compare: &quot;</span>
			   <span class="p">(</span><span class="k">if</span> <span class="nv">ediff-use-last-dir</span>
			       <span class="nv">ediff-last-dir-B</span>
			     <span class="p">(</span><span class="nv">ediff-strip-last-dir</span> <span class="nv">f</span><span class="p">))</span>
			   <span class="no">nil</span> <span class="ss">&#39;must-match</span><span class="p">)</span>
	   <span class="p">(</span><span class="nf">read-string</span>
	    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">default-regexp</span><span class="p">)</span>
		<span class="p">(</span><span class="nf">format</span> <span class="s">&quot;Filter through regular expression (default %s): &quot;</span>
			 <span class="nv">default-regexp</span><span class="p">)</span>
	      <span class="s">&quot;Filter through regular expression: &quot;</span><span class="p">)</span>
	    <span class="no">nil</span>
	    <span class="ss">&#39;ediff-filtering-regexp-history</span>
	    <span class="p">(</span><span class="nf">eval</span> <span class="nv">ediff-default-filtering-regexp</span><span class="p">))</span>
	   <span class="p">)))</span>
  <span class="p">(</span><span class="nv">ediff-directories-internal</span>
   <span class="nv">dir1</span> <span class="nv">dir2</span> <span class="no">nil</span> <span class="nv">regexp</span> <span class="ss">&#39;ediff-files</span> <span class="ss">&#39;ediff-directories</span>
   <span class="p">))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defalias</span> <span class="ss">&#39;edirs</span> <span class="ss">&#39;ediff-directories</span><span class="p">)</span>


<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-directory-revisions</span> <span class="p">(</span><span class="nv">dir1</span> <span class="nv">regexp</span><span class="p">)</span>
  <span class="s">&quot;Run Ediff on a directory, DIR1, comparing its files with their revisions.</span>
<span class="s">The second argument, REGEXP, is a regular expression that filters the file</span>
<span class="s">names.  Only the files that are under revision control are taken into account.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">dir-A</span> <span class="p">(</span><span class="nv">ediff-get-default-directory-name</span><span class="p">))</span>
	 <span class="p">(</span><span class="nv">default-regexp</span> <span class="p">(</span><span class="nf">eval</span> <span class="nv">ediff-default-filtering-regexp</span><span class="p">))</span>
	 <span class="p">)</span>
     <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nv">read-directory-name</span>
	    <span class="s">&quot;Directory to compare with revision:&quot;</span> <span class="nv">dir-A</span> <span class="no">nil</span> <span class="ss">&#39;must-match</span><span class="p">)</span>
	   <span class="p">(</span><span class="nf">read-string</span>
	    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">default-regexp</span><span class="p">)</span>
		<span class="p">(</span><span class="nf">format</span> <span class="s">&quot;Filter through regular expression (default %s): &quot;</span>
			 <span class="nv">default-regexp</span><span class="p">)</span>
	      <span class="s">&quot;Filter through regular expression: &quot;</span><span class="p">)</span>
	    <span class="no">nil</span>
	    <span class="ss">&#39;ediff-filtering-regexp-history</span>
	    <span class="p">(</span><span class="nf">eval</span> <span class="nv">ediff-default-filtering-regexp</span><span class="p">))</span>
	   <span class="p">)))</span>
  <span class="p">(</span><span class="nv">ediff-directory-revisions-internal</span>
   <span class="nv">dir1</span> <span class="nv">regexp</span> <span class="ss">&#39;ediff-revision</span> <span class="ss">&#39;ediff-directory-revisions</span>
   <span class="p">))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defalias</span> <span class="ss">&#39;edir-revisions</span> <span class="ss">&#39;ediff-directory-revisions</span><span class="p">)</span>


<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-directories3</span> <span class="p">(</span><span class="nv">dir1</span> <span class="nv">dir2</span> <span class="nv">dir3</span> <span class="nv">regexp</span><span class="p">)</span>
  <span class="s">&quot;Run Ediff on three directories, DIR1, DIR2, and DIR3, comparing files that</span>
<span class="s">have the same name in all three.  The last argument, REGEXP, is nil or a</span>
<span class="s">regular expression; only file names that match the regexp are considered.&quot;</span>

  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">dir-A</span> <span class="p">(</span><span class="nv">ediff-get-default-directory-name</span><span class="p">))</span>
	 <span class="p">(</span><span class="nv">default-regexp</span> <span class="p">(</span><span class="nf">eval</span> <span class="nv">ediff-default-filtering-regexp</span><span class="p">))</span>
	 <span class="nv">f</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">f</span> <span class="p">(</span><span class="nv">read-directory-name</span> <span class="s">&quot;Directory A to compare:&quot;</span> <span class="nv">dir-A</span> <span class="no">nil</span><span class="p">))</span>
	   <span class="p">(</span><span class="k">setq</span> <span class="nv">f</span> <span class="p">(</span><span class="nv">read-directory-name</span> <span class="s">&quot;Directory B to compare:&quot;</span>
				   <span class="p">(</span><span class="k">if</span> <span class="nv">ediff-use-last-dir</span>
				       <span class="nv">ediff-last-dir-B</span>
				     <span class="p">(</span><span class="nv">ediff-strip-last-dir</span> <span class="nv">f</span><span class="p">))</span>
				   <span class="no">nil</span> <span class="ss">&#39;must-match</span><span class="p">))</span>
	   <span class="p">(</span><span class="nv">read-directory-name</span> <span class="s">&quot;Directory C to compare:&quot;</span>
			   <span class="p">(</span><span class="k">if</span> <span class="nv">ediff-use-last-dir</span>
			       <span class="nv">ediff-last-dir-C</span>
			     <span class="p">(</span><span class="nv">ediff-strip-last-dir</span> <span class="nv">f</span><span class="p">))</span>
			   <span class="no">nil</span> <span class="ss">&#39;must-match</span><span class="p">)</span>
	   <span class="p">(</span><span class="nf">read-string</span>
	    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">default-regexp</span><span class="p">)</span>
		<span class="p">(</span><span class="nf">format</span> <span class="s">&quot;Filter through regular expression (default %s): &quot;</span>
			 <span class="nv">default-regexp</span><span class="p">)</span>
	      <span class="s">&quot;Filter through regular expression: &quot;</span><span class="p">)</span>
	    <span class="no">nil</span>
	    <span class="ss">&#39;ediff-filtering-regexp-history</span>
	    <span class="p">(</span><span class="nf">eval</span> <span class="nv">ediff-default-filtering-regexp</span><span class="p">))</span>
	   <span class="p">)))</span>
  <span class="p">(</span><span class="nv">ediff-directories-internal</span>
   <span class="nv">dir1</span> <span class="nv">dir2</span> <span class="nv">dir3</span> <span class="nv">regexp</span> <span class="ss">&#39;ediff-files3</span> <span class="ss">&#39;ediff-directories3</span>
   <span class="p">))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defalias</span> <span class="ss">&#39;edirs3</span> <span class="ss">&#39;ediff-directories3</span><span class="p">)</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-merge-directories</span> <span class="p">(</span><span class="nv">dir1</span> <span class="nv">dir2</span> <span class="nv">regexp</span> <span class="kp">&amp;optional</span> <span class="nv">merge-autostore-dir</span><span class="p">)</span>
  <span class="s">&quot;Run Ediff on a pair of directories, DIR1 and DIR2, merging files that have</span>
<span class="s">the same name in both.  The third argument, REGEXP, is nil or a regular</span>
<span class="s">expression; only file names that match the regexp are considered.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">dir-A</span> <span class="p">(</span><span class="nv">ediff-get-default-directory-name</span><span class="p">))</span>
	 <span class="p">(</span><span class="nv">default-regexp</span> <span class="p">(</span><span class="nf">eval</span> <span class="nv">ediff-default-filtering-regexp</span><span class="p">))</span>
	 <span class="nv">f</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">f</span> <span class="p">(</span><span class="nv">read-directory-name</span> <span class="s">&quot;Directory A to merge:&quot;</span>
					<span class="nv">dir-A</span> <span class="no">nil</span> <span class="ss">&#39;must-match</span><span class="p">))</span>
	   <span class="p">(</span><span class="nv">read-directory-name</span> <span class="s">&quot;Directory B to merge:&quot;</span>
			   <span class="p">(</span><span class="k">if</span> <span class="nv">ediff-use-last-dir</span>
			       <span class="nv">ediff-last-dir-B</span>
			     <span class="p">(</span><span class="nv">ediff-strip-last-dir</span> <span class="nv">f</span><span class="p">))</span>
			   <span class="no">nil</span> <span class="ss">&#39;must-match</span><span class="p">)</span>
	   <span class="p">(</span><span class="nf">read-string</span>
	    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">default-regexp</span><span class="p">)</span>
		<span class="p">(</span><span class="nf">format</span> <span class="s">&quot;Filter through regular expression (default %s): &quot;</span>
			 <span class="nv">default-regexp</span><span class="p">)</span>
	      <span class="s">&quot;Filter through regular expression: &quot;</span><span class="p">)</span>
	    <span class="no">nil</span>
	    <span class="ss">&#39;ediff-filtering-regexp-history</span>
	    <span class="p">(</span><span class="nf">eval</span> <span class="nv">ediff-default-filtering-regexp</span><span class="p">))</span>
	   <span class="p">)))</span>
  <span class="p">(</span><span class="nv">ediff-directories-internal</span>
   <span class="nv">dir1</span> <span class="nv">dir2</span> <span class="no">nil</span> <span class="nv">regexp</span> <span class="ss">&#39;ediff-merge-files</span> <span class="ss">&#39;ediff-merge-directories</span>
   <span class="no">nil</span> <span class="nv">merge-autostore-dir</span>
   <span class="p">))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defalias</span> <span class="ss">&#39;edirs-merge</span> <span class="ss">&#39;ediff-merge-directories</span><span class="p">)</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-merge-directories-with-ancestor</span> <span class="p">(</span><span class="nv">dir1</span> <span class="nv">dir2</span> <span class="nv">ancestor-dir</span> <span class="nv">regexp</span>
						   <span class="kp">&amp;optional</span>
						   <span class="nv">merge-autostore-dir</span><span class="p">)</span>
  <span class="s">&quot;Merge files in directories DIR1 and DIR2 using files in ANCESTOR-DIR as ancestors.</span>
<span class="s">Ediff merges files that have identical names in DIR1, DIR2.  If a pair of files</span>
<span class="s">in DIR1 and DIR2 doesn&#39;t have an ancestor in ANCESTOR-DIR, Ediff will merge</span>
<span class="s">without ancestor.  The fourth argument, REGEXP, is nil or a regular expression;</span>
<span class="s">only file names that match the regexp are considered.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">dir-A</span> <span class="p">(</span><span class="nv">ediff-get-default-directory-name</span><span class="p">))</span>
	 <span class="p">(</span><span class="nv">default-regexp</span> <span class="p">(</span><span class="nf">eval</span> <span class="nv">ediff-default-filtering-regexp</span><span class="p">))</span>
	 <span class="nv">f</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">f</span> <span class="p">(</span><span class="nv">read-directory-name</span> <span class="s">&quot;Directory A to merge:&quot;</span> <span class="nv">dir-A</span> <span class="no">nil</span><span class="p">))</span>
	   <span class="p">(</span><span class="k">setq</span> <span class="nv">f</span> <span class="p">(</span><span class="nv">read-directory-name</span> <span class="s">&quot;Directory B to merge:&quot;</span>
				 <span class="p">(</span><span class="k">if</span> <span class="nv">ediff-use-last-dir</span>
				     <span class="nv">ediff-last-dir-B</span>
				   <span class="p">(</span><span class="nv">ediff-strip-last-dir</span> <span class="nv">f</span><span class="p">))</span>
				 <span class="no">nil</span> <span class="ss">&#39;must-match</span><span class="p">))</span>
	   <span class="p">(</span><span class="nv">read-directory-name</span> <span class="s">&quot;Ancestor directory:&quot;</span>
				 <span class="p">(</span><span class="k">if</span> <span class="nv">ediff-use-last-dir</span>
				     <span class="nv">ediff-last-dir-C</span>
				   <span class="p">(</span><span class="nv">ediff-strip-last-dir</span> <span class="nv">f</span><span class="p">))</span>
				 <span class="no">nil</span> <span class="ss">&#39;must-match</span><span class="p">)</span>
	   <span class="p">(</span><span class="nf">read-string</span>
	    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">default-regexp</span><span class="p">)</span>
		<span class="p">(</span><span class="nf">format</span> <span class="s">&quot;Filter through regular expression (default %s): &quot;</span>
			 <span class="nv">default-regexp</span><span class="p">)</span>
	      <span class="s">&quot;Filter through regular expression: &quot;</span><span class="p">)</span>
	    <span class="no">nil</span>
	    <span class="ss">&#39;ediff-filtering-regexp-history</span>
	    <span class="p">(</span><span class="nf">eval</span> <span class="nv">ediff-default-filtering-regexp</span><span class="p">))</span>
	   <span class="p">)))</span>
  <span class="p">(</span><span class="nv">ediff-directories-internal</span>
   <span class="nv">dir1</span> <span class="nv">dir2</span> <span class="nv">ancestor-dir</span> <span class="nv">regexp</span>
   <span class="ss">&#39;ediff-merge-files-with-ancestor</span> <span class="ss">&#39;ediff-merge-directories-with-ancestor</span>
   <span class="no">nil</span> <span class="nv">merge-autostore-dir</span>
   <span class="p">))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-merge-directory-revisions</span> <span class="p">(</span><span class="nv">dir1</span> <span class="nv">regexp</span>
					     <span class="kp">&amp;optional</span> <span class="nv">merge-autostore-dir</span><span class="p">)</span>
  <span class="s">&quot;Run Ediff on a directory, DIR1, merging its files with their revisions.</span>
<span class="s">The second argument, REGEXP, is a regular expression that filters the file</span>
<span class="s">names.  Only the files that are under revision control are taken into account.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">dir-A</span> <span class="p">(</span><span class="nv">ediff-get-default-directory-name</span><span class="p">))</span>
	 <span class="p">(</span><span class="nv">default-regexp</span> <span class="p">(</span><span class="nf">eval</span> <span class="nv">ediff-default-filtering-regexp</span><span class="p">))</span>
	 <span class="p">)</span>
     <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nv">read-directory-name</span>
	    <span class="s">&quot;Directory to merge with revisions:&quot;</span> <span class="nv">dir-A</span> <span class="no">nil</span> <span class="ss">&#39;must-match</span><span class="p">)</span>
	   <span class="p">(</span><span class="nf">read-string</span>
	    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">default-regexp</span><span class="p">)</span>
		<span class="p">(</span><span class="nf">format</span> <span class="s">&quot;Filter through regular expression (default %s): &quot;</span>
			 <span class="nv">default-regexp</span><span class="p">)</span>
	      <span class="s">&quot;Filter through regular expression: &quot;</span><span class="p">)</span>
	    <span class="no">nil</span>
	    <span class="ss">&#39;ediff-filtering-regexp-history</span>
	    <span class="p">(</span><span class="nf">eval</span> <span class="nv">ediff-default-filtering-regexp</span><span class="p">))</span>
	   <span class="p">)))</span>
  <span class="p">(</span><span class="nv">ediff-directory-revisions-internal</span>
   <span class="nv">dir1</span> <span class="nv">regexp</span> <span class="ss">&#39;ediff-merge-revisions</span> <span class="ss">&#39;ediff-merge-directory-revisions</span>
   <span class="no">nil</span> <span class="nv">merge-autostore-dir</span>
   <span class="p">))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defalias</span> <span class="ss">&#39;edir-merge-revisions</span> <span class="ss">&#39;ediff-merge-directory-revisions</span><span class="p">)</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-merge-directory-revisions-with-ancestor</span> <span class="p">(</span><span class="nv">dir1</span> <span class="nv">regexp</span>
							   <span class="kp">&amp;optional</span>
							   <span class="nv">merge-autostore-dir</span><span class="p">)</span>
  <span class="s">&quot;Run Ediff on a directory, DIR1, merging its files with their revisions and ancestors.</span>
<span class="s">The second argument, REGEXP, is a regular expression that filters the file</span>
<span class="s">names.  Only the files that are under revision control are taken into account.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">dir-A</span> <span class="p">(</span><span class="nv">ediff-get-default-directory-name</span><span class="p">))</span>
	 <span class="p">(</span><span class="nv">default-regexp</span> <span class="p">(</span><span class="nf">eval</span> <span class="nv">ediff-default-filtering-regexp</span><span class="p">))</span>
	 <span class="p">)</span>
     <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nv">read-directory-name</span>
	    <span class="s">&quot;Directory to merge with revisions and ancestors:&quot;</span>
	    <span class="nv">dir-A</span> <span class="no">nil</span> <span class="ss">&#39;must-match</span><span class="p">)</span>
	   <span class="p">(</span><span class="nf">read-string</span>
	    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">default-regexp</span><span class="p">)</span>
		<span class="p">(</span><span class="nf">format</span> <span class="s">&quot;Filter through regular expression (default %s): &quot;</span>
			 <span class="nv">default-regexp</span><span class="p">)</span>
	      <span class="s">&quot;Filter through regular expression: &quot;</span><span class="p">)</span>
	    <span class="no">nil</span>
	    <span class="ss">&#39;ediff-filtering-regexp-history</span>
	    <span class="p">(</span><span class="nf">eval</span> <span class="nv">ediff-default-filtering-regexp</span><span class="p">))</span>
	   <span class="p">)))</span>
  <span class="p">(</span><span class="nv">ediff-directory-revisions-internal</span>
   <span class="nv">dir1</span> <span class="nv">regexp</span> <span class="ss">&#39;ediff-merge-revisions-with-ancestor</span>
   <span class="ss">&#39;ediff-merge-directory-revisions-with-ancestor</span>
   <span class="no">nil</span> <span class="nv">merge-autostore-dir</span>
   <span class="p">))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defalias</span>
  <span class="ss">&#39;edir-merge-revisions-with-ancestor</span>
  <span class="ss">&#39;ediff-merge-directory-revisions-with-ancestor</span><span class="p">)</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defalias</span> <span class="ss">&#39;edirs-merge-with-ancestor</span> <span class="ss">&#39;ediff-merge-directories-with-ancestor</span><span class="p">)</span>

<span class="c1">;; Run ediff-action (ediff-files, ediff-merge, ediff-merge-with-ancestors)</span>
<span class="c1">;; on a pair of directories (three directories, in case of ancestor).</span>
<span class="c1">;; The third argument, REGEXP, is nil or a regular expression;</span>
<span class="c1">;; only file names that match the regexp are considered.</span>
<span class="c1">;; JOBNAME is the symbol indicating the meta-job to be performed.</span>
<span class="c1">;; MERGE-AUTOSTORE-DIR is the directory in which to store merged files.</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-directories-internal</span> <span class="p">(</span><span class="nv">dir1</span> <span class="nv">dir2</span> <span class="nv">dir3</span> <span class="nv">regexp</span> <span class="nv">action</span> <span class="nv">jobname</span>
					<span class="kp">&amp;optional</span> <span class="nv">startup-hooks</span>
					<span class="nv">merge-autostore-dir</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">dir3</span><span class="p">)</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">dir3</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">dir3</span><span class="p">)</span> <span class="nv">dir3</span> <span class="p">(</span><span class="nf">file-name-directory</span> <span class="nv">dir3</span><span class="p">))))</span>

  <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nv">string=</span> <span class="nv">dir1</span> <span class="nv">dir2</span><span class="p">)</span>
	 <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Directories A and B are the same: %s&quot;</span> <span class="nv">dir1</span><span class="p">))</span>
	<span class="p">((</span><span class="k">and</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">jobname</span> <span class="ss">&#39;ediff-directories3</span><span class="p">)</span>
	      <span class="p">(</span><span class="nv">string=</span> <span class="nv">dir1</span> <span class="nv">dir3</span><span class="p">))</span>
	 <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Directories A and C are the same: %s&quot;</span> <span class="nv">dir1</span><span class="p">))</span>
	<span class="p">((</span><span class="k">and</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">jobname</span> <span class="ss">&#39;ediff-directories3</span><span class="p">)</span>
	      <span class="p">(</span><span class="nv">string=</span> <span class="nv">dir2</span> <span class="nv">dir3</span><span class="p">))</span>
	 <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Directories B and C are the same: %s&quot;</span> <span class="nv">dir1</span><span class="p">)))</span>

  <span class="p">(</span><span class="k">if</span> <span class="nv">merge-autostore-dir</span>
      <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">merge-autostore-dir</span><span class="p">)</span>
	  <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;%s: Directory for storing merged files must be a string&quot;</span>
		 <span class="nv">jobname</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="c1">;; dir-diff-struct is of the form (common-list diff-list)</span>
	<span class="c1">;; It is a structure where ediff-intersect-directories returns</span>
	<span class="c1">;; commonalities and differences among directories</span>
	<span class="nv">dir-diff-struct</span>
	<span class="nv">meta-buf</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">and</span> <span class="nv">ediff-autostore-merges</span>
	     <span class="p">(</span><span class="nv">ediff-merge-metajob</span> <span class="nv">jobname</span><span class="p">)</span>
	     <span class="p">(</span><span class="nv">not</span> <span class="nv">merge-autostore-dir</span><span class="p">))</span>
	<span class="p">(</span><span class="k">setq</span> <span class="nv">merge-autostore-dir</span>
	      <span class="p">(</span><span class="nv">read-directory-name</span> <span class="s">&quot;Save merged files in directory: &quot;</span>
			      <span class="p">(</span><span class="k">if</span> <span class="nv">ediff-use-last-dir</span>
					<span class="nv">ediff-last-merge-autostore-dir</span>
				      <span class="p">(</span><span class="nv">ediff-strip-last-dir</span> <span class="nv">dir1</span><span class="p">))</span>
			      <span class="no">nil</span>
			      <span class="ss">&#39;must-match</span><span class="p">)))</span>
    <span class="c1">;; verify we are not merging into an orig directory</span>
    <span class="p">(</span><span class="k">if</span> <span class="nv">merge-autostore-dir</span>
	<span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="k">and</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">dir1</span><span class="p">)</span> <span class="p">(</span><span class="nv">string=</span> <span class="nv">merge-autostore-dir</span> <span class="nv">dir1</span><span class="p">))</span>
	       <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nv">y-or-n-p</span>
		    <span class="s">&quot;Directory for saving merged files = Directory A.  Sure? &quot;</span><span class="p">)</span>
		   <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Directory merge aborted&quot;</span><span class="p">)))</span>
	      <span class="p">((</span><span class="k">and</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">dir2</span><span class="p">)</span> <span class="p">(</span><span class="nv">string=</span> <span class="nv">merge-autostore-dir</span> <span class="nv">dir2</span><span class="p">))</span>
	       <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nv">y-or-n-p</span>
		    <span class="s">&quot;Directory for saving merged files = Directory B.  Sure? &quot;</span><span class="p">)</span>
		   <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Directory merge aborted&quot;</span><span class="p">)))</span>
	      <span class="p">((</span><span class="k">and</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">dir3</span><span class="p">)</span> <span class="p">(</span><span class="nv">string=</span> <span class="nv">merge-autostore-dir</span> <span class="nv">dir3</span><span class="p">))</span>
	       <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nv">y-or-n-p</span>
		    <span class="s">&quot;Directory for saving merged files = Ancestor Directory.  Sure? &quot;</span><span class="p">)</span>
		   <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Directory merge aborted&quot;</span><span class="p">)))))</span>

    <span class="p">(</span><span class="k">setq</span> <span class="nv">dir-diff-struct</span> <span class="p">(</span><span class="nv">ediff-intersect-directories</span>
			   <span class="nv">jobname</span>
			   <span class="nv">regexp</span> <span class="nv">dir1</span> <span class="nv">dir2</span> <span class="nv">dir3</span> <span class="nv">merge-autostore-dir</span><span class="p">))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">startup-hooks</span>
	  <span class="c1">;; this sets various vars in the meta buffer inside</span>
	  <span class="c1">;; ediff-prepare-meta-buffer</span>
	  <span class="p">(</span><span class="nf">cons</span> <span class="o">`</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
		   <span class="c1">;; tell what to do if the user clicks on a session record</span>
		   <span class="p">(</span><span class="k">setq</span> <span class="nv">ediff-session-action-function</span> <span class="p">(</span><span class="k">quote</span> <span class="o">,</span><span class="nv">action</span><span class="p">))</span>
		   <span class="c1">;; set ediff-dir-difference-list</span>
		   <span class="p">(</span><span class="k">setq</span> <span class="nv">ediff-dir-difference-list</span>
			 <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="k">quote</span> <span class="o">,</span><span class="nv">dir-diff-struct</span><span class="p">))))</span>
		<span class="nv">startup-hooks</span><span class="p">))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">meta-buf</span> <span class="p">(</span><span class="nv">ediff-prepare-meta-buffer</span>
		    <span class="ss">&#39;ediff-filegroup-action</span>
		    <span class="p">(</span><span class="nf">car</span> <span class="nv">dir-diff-struct</span><span class="p">)</span>
		    <span class="s">&quot;*Ediff Session Group Panel&quot;</span>
		    <span class="ss">&#39;ediff-redraw-directory-group-buffer</span>
		    <span class="nv">jobname</span>
		    <span class="nv">startup-hooks</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">ediff-show-meta-buffer</span> <span class="nv">meta-buf</span><span class="p">)</span>
    <span class="p">))</span>

<span class="c1">;; MERGE-AUTOSTORE-DIR can be given to tell ediff where to store the merged</span>
<span class="c1">;; files</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-directory-revisions-internal</span> <span class="p">(</span><span class="nv">dir1</span> <span class="nv">regexp</span> <span class="nv">action</span> <span class="nv">jobname</span>
						<span class="kp">&amp;optional</span> <span class="nv">startup-hooks</span>
						<span class="nv">merge-autostore-dir</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">dir1</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">dir1</span><span class="p">)</span> <span class="nv">dir1</span> <span class="p">(</span><span class="nf">file-name-directory</span> <span class="nv">dir1</span><span class="p">)))</span>

  <span class="p">(</span><span class="k">if</span> <span class="nv">merge-autostore-dir</span>
      <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">merge-autostore-dir</span><span class="p">)</span>
	  <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;%S: Directory for storing merged files must be a string&quot;</span>
		 <span class="nv">jobname</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">file-list</span> <span class="nv">meta-buf</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">and</span> <span class="nv">ediff-autostore-merges</span>
	     <span class="p">(</span><span class="nv">ediff-merge-metajob</span> <span class="nv">jobname</span><span class="p">)</span>
	     <span class="p">(</span><span class="nv">not</span> <span class="nv">merge-autostore-dir</span><span class="p">))</span>
	<span class="p">(</span><span class="k">setq</span> <span class="nv">merge-autostore-dir</span>
	      <span class="p">(</span><span class="nv">read-directory-name</span> <span class="s">&quot;Save merged files in directory: &quot;</span>
			      <span class="p">(</span><span class="k">if</span> <span class="nv">ediff-use-last-dir</span>
				  <span class="nv">ediff-last-merge-autostore-dir</span>
				<span class="p">(</span><span class="nv">ediff-strip-last-dir</span> <span class="nv">dir1</span><span class="p">))</span>
			      <span class="no">nil</span>
			      <span class="ss">&#39;must-match</span><span class="p">)))</span>
    <span class="c1">;; verify merge-autostore-dir != dir1</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">and</span> <span class="nv">merge-autostore-dir</span>
	     <span class="p">(</span><span class="nf">stringp</span> <span class="nv">dir1</span><span class="p">)</span>
	     <span class="p">(</span><span class="nv">string=</span> <span class="nv">merge-autostore-dir</span> <span class="nv">dir1</span><span class="p">))</span>
	<span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nv">y-or-n-p</span>
	     <span class="s">&quot;Directory for saving merged file = directory A.  Sure? &quot;</span><span class="p">)</span>
	    <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Merge of directory revisions aborted&quot;</span><span class="p">)))</span>

    <span class="p">(</span><span class="k">setq</span> <span class="nv">file-list</span>
	  <span class="p">(</span><span class="nv">ediff-get-directory-files-under-revision</span>
	   <span class="nv">jobname</span> <span class="nv">regexp</span> <span class="nv">dir1</span> <span class="nv">merge-autostore-dir</span><span class="p">))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">startup-hooks</span>
	  <span class="c1">;; this sets various vars in the meta buffer inside</span>
	  <span class="c1">;; ediff-prepare-meta-buffer</span>
	  <span class="p">(</span><span class="nf">cons</span> <span class="o">`</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
		   <span class="c1">;; tell what to do if the user clicks on a session record</span>
		   <span class="p">(</span><span class="k">setq</span> <span class="nv">ediff-session-action-function</span> <span class="p">(</span><span class="k">quote</span> <span class="o">,</span><span class="nv">action</span><span class="p">)))</span>
		<span class="nv">startup-hooks</span><span class="p">))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">meta-buf</span> <span class="p">(</span><span class="nv">ediff-prepare-meta-buffer</span>
		    <span class="ss">&#39;ediff-filegroup-action</span>
		    <span class="nv">file-list</span>
		    <span class="s">&quot;*Ediff Session Group Panel&quot;</span>
		    <span class="ss">&#39;ediff-redraw-directory-group-buffer</span>
		    <span class="nv">jobname</span>
		    <span class="nv">startup-hooks</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">ediff-show-meta-buffer</span> <span class="nv">meta-buf</span><span class="p">)</span>
    <span class="p">))</span>


<span class="c1">;;; Compare regions and windows</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-windows-wordwise</span> <span class="p">(</span><span class="nv">dumb-mode</span> <span class="kp">&amp;optional</span> <span class="nv">wind-A</span> <span class="nv">wind-B</span> <span class="nv">startup-hooks</span><span class="p">)</span>
  <span class="s">&quot;Compare WIND-A and WIND-B, which are selected by clicking, wordwise.</span>
<span class="s">With prefix argument, DUMB-MODE, or on a non-windowing display, works as</span>
<span class="s">follows:</span>
<span class="s">If WIND-A is nil, use selected window.</span>
<span class="s">If WIND-B is nil, use window next to WIND-A.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span> <span class="s">&quot;P&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">ediff-windows</span> <span class="nv">dumb-mode</span> <span class="nv">wind-A</span> <span class="nv">wind-B</span>
		 <span class="nv">startup-hooks</span> <span class="ss">&#39;ediff-windows-wordwise</span> <span class="ss">&#39;word-mode</span><span class="p">))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-windows-linewise</span> <span class="p">(</span><span class="nv">dumb-mode</span> <span class="kp">&amp;optional</span> <span class="nv">wind-A</span> <span class="nv">wind-B</span> <span class="nv">startup-hooks</span><span class="p">)</span>
  <span class="s">&quot;Compare WIND-A and WIND-B, which are selected by clicking, linewise.</span>
<span class="s">With prefix argument, DUMB-MODE, or on a non-windowing display, works as</span>
<span class="s">follows:</span>
<span class="s">If WIND-A is nil, use selected window.</span>
<span class="s">If WIND-B is nil, use window next to WIND-A.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span> <span class="s">&quot;P&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">ediff-windows</span> <span class="nv">dumb-mode</span> <span class="nv">wind-A</span> <span class="nv">wind-B</span>
		 <span class="nv">startup-hooks</span> <span class="ss">&#39;ediff-windows-linewise</span> <span class="no">nil</span><span class="p">))</span>

<span class="c1">;; Compare WIND-A and WIND-B, which are selected by clicking.</span>
<span class="c1">;; With prefix argument, DUMB-MODE, or on a non-windowing display,</span>
<span class="c1">;; works as follows:</span>
<span class="c1">;; If WIND-A is nil, use selected window.</span>
<span class="c1">;; If WIND-B is nil, use window next to WIND-A.</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-windows</span> <span class="p">(</span><span class="nv">dumb-mode</span> <span class="nv">wind-A</span> <span class="nv">wind-B</span> <span class="nv">startup-hooks</span> <span class="nv">job-name</span> <span class="nv">word-mode</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">or</span> <span class="nv">dumb-mode</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">ediff-window-display-p</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">wind-A</span> <span class="p">(</span><span class="nv">ediff-get-next-window</span> <span class="nv">wind-A</span> <span class="no">nil</span><span class="p">)</span>
	    <span class="nv">wind-B</span> <span class="p">(</span><span class="nv">ediff-get-next-window</span> <span class="nv">wind-B</span> <span class="nv">wind-A</span><span class="p">))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">wind-A</span> <span class="p">(</span><span class="nv">ediff-get-window-by-clicking</span> <span class="nv">wind-A</span> <span class="no">nil</span> <span class="mi">1</span><span class="p">)</span>
	  <span class="nv">wind-B</span> <span class="p">(</span><span class="nv">ediff-get-window-by-clicking</span> <span class="nv">wind-B</span> <span class="nv">wind-A</span> <span class="mi">2</span><span class="p">)))</span>

  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">buffer-A</span> <span class="p">(</span><span class="nf">window-buffer</span> <span class="nv">wind-A</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">buffer-B</span> <span class="p">(</span><span class="nf">window-buffer</span> <span class="nv">wind-B</span><span class="p">))</span>
	<span class="nv">beg-A</span> <span class="nv">end-A</span> <span class="nv">beg-B</span> <span class="nv">end-B</span><span class="p">)</span>

    <span class="p">(</span><span class="k">save-excursion</span>
      <span class="p">(</span><span class="nb">save-window-excursion</span>
	<span class="p">(</span><span class="nv">sit-for</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">; sync before using window-start/end -- a precaution</span>
	<span class="p">(</span><span class="nf">select-window</span> <span class="nv">wind-A</span><span class="p">)</span>
	<span class="p">(</span><span class="k">setq</span> <span class="nv">beg-A</span> <span class="p">(</span><span class="nf">window-start</span><span class="p">)</span>
	      <span class="nv">end-A</span> <span class="p">(</span><span class="nf">window-end</span><span class="p">))</span>
	<span class="p">(</span><span class="nf">select-window</span> <span class="nv">wind-B</span><span class="p">)</span>
	<span class="p">(</span><span class="k">setq</span> <span class="nv">beg-B</span> <span class="p">(</span><span class="nf">window-start</span><span class="p">)</span>
	      <span class="nv">end-B</span> <span class="p">(</span><span class="nf">window-end</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">buffer-A</span>
	  <span class="p">(</span><span class="nv">ediff-clone-buffer-for-window-comparison</span>
	   <span class="nv">buffer-A</span> <span class="nv">wind-A</span> <span class="s">&quot;-Window.A-&quot;</span><span class="p">)</span>
	  <span class="nv">buffer-B</span>
	  <span class="p">(</span><span class="nv">ediff-clone-buffer-for-window-comparison</span>
	   <span class="nv">buffer-B</span> <span class="nv">wind-B</span> <span class="s">&quot;-Window.B-&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">ediff-regions-internal</span>
     <span class="nv">buffer-A</span> <span class="nv">beg-A</span> <span class="nv">end-A</span> <span class="nv">buffer-B</span> <span class="nv">beg-B</span> <span class="nv">end-B</span>
     <span class="nv">startup-hooks</span> <span class="nv">job-name</span> <span class="nv">word-mode</span> <span class="no">nil</span><span class="p">)))</span>


<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-regions-wordwise</span> <span class="p">(</span><span class="nv">buffer-A</span> <span class="nv">buffer-B</span> <span class="kp">&amp;optional</span> <span class="nv">startup-hooks</span><span class="p">)</span>
  <span class="s">&quot;Run Ediff on a pair of regions in specified buffers.</span>
<span class="s">Regions \(i.e., point and mark\) can be set in advance or marked interactively.</span>
<span class="s">This function is effective only for relatively small regions, up to 200</span>
<span class="s">lines.  For large regions, use `ediff-regions-linewise&#39;.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">bf</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">bf</span> <span class="p">(</span><span class="nf">read-buffer</span> <span class="s">&quot;Region&#39;s A buffer: &quot;</span>
				 <span class="p">(</span><span class="nv">ediff-other-buffer</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="no">t</span><span class="p">))</span>
	   <span class="p">(</span><span class="nf">read-buffer</span> <span class="s">&quot;Region&#39;s B buffer: &quot;</span>
			<span class="p">(</span><span class="k">progn</span>
			  <span class="c1">;; realign buffers so that two visible bufs will be</span>
			  <span class="c1">;; at the top</span>
			  <span class="p">(</span><span class="nb">save-window-excursion</span> <span class="p">(</span><span class="nv">other-window</span> <span class="mi">1</span><span class="p">))</span>
			  <span class="p">(</span><span class="nv">ediff-other-buffer</span> <span class="nv">bf</span><span class="p">))</span>
			<span class="no">t</span><span class="p">))))</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">ediff-buffer-live-p</span> <span class="nv">buffer-A</span><span class="p">))</span>
      <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Buffer %S doesn&#39;t exist&quot;</span> <span class="nv">buffer-A</span><span class="p">))</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">ediff-buffer-live-p</span> <span class="nv">buffer-B</span><span class="p">))</span>
      <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Buffer %S doesn&#39;t exist&quot;</span> <span class="nv">buffer-B</span><span class="p">))</span>


  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">buffer-A</span>
         <span class="p">(</span><span class="nv">ediff-clone-buffer-for-region-comparison</span> <span class="nv">buffer-A</span> <span class="s">&quot;-Region.A-&quot;</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">buffer-B</span>
         <span class="p">(</span><span class="nv">ediff-clone-buffer-for-region-comparison</span> <span class="nv">buffer-B</span> <span class="s">&quot;-Region.B-&quot;</span><span class="p">))</span>
        <span class="nv">reg-A-beg</span> <span class="nv">reg-A-end</span> <span class="nv">reg-B-beg</span> <span class="nv">reg-B-end</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">with-current-buffer</span> <span class="nv">buffer-A</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">reg-A-beg</span> <span class="p">(</span><span class="nf">region-beginning</span><span class="p">)</span>
	    <span class="nv">reg-A-end</span> <span class="p">(</span><span class="nf">region-end</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">set-buffer</span> <span class="nv">buffer-B</span><span class="p">)</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">reg-B-beg</span> <span class="p">(</span><span class="nf">region-beginning</span><span class="p">)</span>
	    <span class="nv">reg-B-end</span> <span class="p">(</span><span class="nf">region-end</span><span class="p">)))</span>

    <span class="p">(</span><span class="nv">ediff-regions-internal</span>
     <span class="p">(</span><span class="nf">get-buffer</span> <span class="nv">buffer-A</span><span class="p">)</span> <span class="nv">reg-A-beg</span> <span class="nv">reg-A-end</span>
     <span class="p">(</span><span class="nf">get-buffer</span> <span class="nv">buffer-B</span><span class="p">)</span> <span class="nv">reg-B-beg</span> <span class="nv">reg-B-end</span>
     <span class="nv">startup-hooks</span> <span class="ss">&#39;ediff-regions-wordwise</span> <span class="ss">&#39;word-mode</span> <span class="no">nil</span><span class="p">)))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-regions-linewise</span> <span class="p">(</span><span class="nv">buffer-A</span> <span class="nv">buffer-B</span> <span class="kp">&amp;optional</span> <span class="nv">startup-hooks</span><span class="p">)</span>
  <span class="s">&quot;Run Ediff on a pair of regions in specified buffers.</span>
<span class="s">Regions \(i.e., point and mark\) can be set in advance or marked interactively.</span>
<span class="s">Each region is enlarged to contain full lines.</span>
<span class="s">This function is effective for large regions, over 100-200</span>
<span class="s">lines.  For small regions, use `ediff-regions-wordwise&#39;.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">bf</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">bf</span> <span class="p">(</span><span class="nf">read-buffer</span> <span class="s">&quot;Region A&#39;s buffer: &quot;</span>
				 <span class="p">(</span><span class="nv">ediff-other-buffer</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="no">t</span><span class="p">))</span>
	   <span class="p">(</span><span class="nf">read-buffer</span> <span class="s">&quot;Region B&#39;s buffer: &quot;</span>
			<span class="p">(</span><span class="k">progn</span>
			  <span class="c1">;; realign buffers so that two visible bufs will be</span>
			  <span class="c1">;; at the top</span>
			  <span class="p">(</span><span class="nb">save-window-excursion</span> <span class="p">(</span><span class="nv">other-window</span> <span class="mi">1</span><span class="p">))</span>
			  <span class="p">(</span><span class="nv">ediff-other-buffer</span> <span class="nv">bf</span><span class="p">))</span>
			<span class="no">t</span><span class="p">))))</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">ediff-buffer-live-p</span> <span class="nv">buffer-A</span><span class="p">))</span>
      <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Buffer %S doesn&#39;t exist&quot;</span> <span class="nv">buffer-A</span><span class="p">))</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">ediff-buffer-live-p</span> <span class="nv">buffer-B</span><span class="p">))</span>
      <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Buffer %S doesn&#39;t exist&quot;</span> <span class="nv">buffer-B</span><span class="p">))</span>

  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">buffer-A</span>
         <span class="p">(</span><span class="nv">ediff-clone-buffer-for-region-comparison</span> <span class="nv">buffer-A</span> <span class="s">&quot;-Region.A-&quot;</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">buffer-B</span>
         <span class="p">(</span><span class="nv">ediff-clone-buffer-for-region-comparison</span> <span class="nv">buffer-B</span> <span class="s">&quot;-Region.B-&quot;</span><span class="p">))</span>
        <span class="nv">reg-A-beg</span> <span class="nv">reg-A-end</span> <span class="nv">reg-B-beg</span> <span class="nv">reg-B-end</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">with-current-buffer</span> <span class="nv">buffer-A</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">reg-A-beg</span> <span class="p">(</span><span class="nf">region-beginning</span><span class="p">)</span>
	    <span class="nv">reg-A-end</span> <span class="p">(</span><span class="nf">region-end</span><span class="p">))</span>
      <span class="c1">;; enlarge the region to hold full lines</span>
      <span class="p">(</span><span class="nf">goto-char</span> <span class="nv">reg-A-beg</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">beginning-of-line</span><span class="p">)</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">reg-A-beg</span> <span class="p">(</span><span class="nf">point</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">goto-char</span> <span class="nv">reg-A-end</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">end-of-line</span><span class="p">)</span>
      <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nf">eobp</span><span class="p">)</span> <span class="p">(</span><span class="nf">forward-char</span><span class="p">))</span> <span class="c1">; include the newline char</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">reg-A-end</span> <span class="p">(</span><span class="nf">point</span><span class="p">))</span>

      <span class="p">(</span><span class="nf">set-buffer</span> <span class="nv">buffer-B</span><span class="p">)</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">reg-B-beg</span> <span class="p">(</span><span class="nf">region-beginning</span><span class="p">)</span>
	    <span class="nv">reg-B-end</span> <span class="p">(</span><span class="nf">region-end</span><span class="p">))</span>
      <span class="c1">;; enlarge the region to hold full lines</span>
      <span class="p">(</span><span class="nf">goto-char</span> <span class="nv">reg-B-beg</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">beginning-of-line</span><span class="p">)</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">reg-B-beg</span> <span class="p">(</span><span class="nf">point</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">goto-char</span> <span class="nv">reg-B-end</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">end-of-line</span><span class="p">)</span>
      <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nf">eobp</span><span class="p">)</span> <span class="p">(</span><span class="nf">forward-char</span><span class="p">))</span> <span class="c1">; include the newline char</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">reg-B-end</span> <span class="p">(</span><span class="nf">point</span><span class="p">))</span>
      <span class="p">)</span> <span class="c1">; save excursion</span>

    <span class="p">(</span><span class="nv">ediff-regions-internal</span>
     <span class="p">(</span><span class="nf">get-buffer</span> <span class="nv">buffer-A</span><span class="p">)</span> <span class="nv">reg-A-beg</span> <span class="nv">reg-A-end</span>
     <span class="p">(</span><span class="nf">get-buffer</span> <span class="nv">buffer-B</span><span class="p">)</span> <span class="nv">reg-B-beg</span> <span class="nv">reg-B-end</span>
     <span class="nv">startup-hooks</span> <span class="ss">&#39;ediff-regions-linewise</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">)))</span> <span class="c1">; no word mode</span>

<span class="c1">;; compare region beg-A to end-A of buffer-A</span>
<span class="c1">;; to regions beg-B -- end-B in buffer-B.</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-regions-internal</span> <span class="p">(</span><span class="nv">buffer-A</span> <span class="nv">beg-A</span> <span class="nv">end-A</span> <span class="nv">buffer-B</span> <span class="nv">beg-B</span> <span class="nv">end-B</span>
					<span class="nv">startup-hooks</span> <span class="nv">job-name</span> <span class="nv">word-mode</span>
					<span class="nv">setup-parameters</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">tmp-buffer</span> <span class="p">(</span><span class="nf">get-buffer-create</span> <span class="nv">ediff-tmp-buffer</span><span class="p">))</span>
	<span class="nv">overl-A</span> <span class="nv">overl-B</span>
	<span class="nv">file-A</span> <span class="nv">file-B</span><span class="p">)</span>
    <span class="p">(</span><span class="k">unwind-protect</span>
	<span class="p">(</span><span class="k">progn</span>
	  <span class="c1">;; in case beg/end-A/B aren&#39;t markers--make them into markers</span>
	  <span class="p">(</span><span class="nv">ediff-with-current-buffer</span> <span class="nv">buffer-A</span>
	    <span class="p">(</span><span class="k">setq</span> <span class="nv">beg-A</span> <span class="p">(</span><span class="nv">move-marker</span> <span class="p">(</span><span class="nf">make-marker</span><span class="p">)</span> <span class="nv">beg-A</span><span class="p">)</span>
		  <span class="nv">end-A</span> <span class="p">(</span><span class="nv">move-marker</span> <span class="p">(</span><span class="nf">make-marker</span><span class="p">)</span> <span class="nv">end-A</span><span class="p">)))</span>
	  <span class="p">(</span><span class="nv">ediff-with-current-buffer</span> <span class="nv">buffer-B</span>
	    <span class="p">(</span><span class="k">setq</span> <span class="nv">beg-B</span> <span class="p">(</span><span class="nv">move-marker</span> <span class="p">(</span><span class="nf">make-marker</span><span class="p">)</span> <span class="nv">beg-B</span><span class="p">)</span>
		  <span class="nv">end-B</span> <span class="p">(</span><span class="nv">move-marker</span> <span class="p">(</span><span class="nf">make-marker</span><span class="p">)</span> <span class="nv">end-B</span><span class="p">)))</span>

	  <span class="c1">;; make file-A</span>
	  <span class="p">(</span><span class="k">if</span> <span class="nv">word-mode</span>
	      <span class="p">(</span><span class="nv">ediff-wordify</span> <span class="nv">beg-A</span> <span class="nv">end-A</span> <span class="nv">buffer-A</span> <span class="nv">tmp-buffer</span><span class="p">)</span>
	    <span class="p">(</span><span class="nv">ediff-copy-to-buffer</span> <span class="nv">beg-A</span> <span class="nv">end-A</span> <span class="nv">buffer-A</span> <span class="nv">tmp-buffer</span><span class="p">))</span>
	  <span class="p">(</span><span class="k">setq</span> <span class="nv">file-A</span> <span class="p">(</span><span class="nv">ediff-make-temp-file</span> <span class="nv">tmp-buffer</span> <span class="s">&quot;regA&quot;</span><span class="p">))</span>

	  <span class="c1">;; make file-B</span>
	  <span class="p">(</span><span class="k">if</span> <span class="nv">word-mode</span>
	      <span class="p">(</span><span class="nv">ediff-wordify</span> <span class="nv">beg-B</span> <span class="nv">end-B</span> <span class="nv">buffer-B</span> <span class="nv">tmp-buffer</span><span class="p">)</span>
	    <span class="p">(</span><span class="nv">ediff-copy-to-buffer</span> <span class="nv">beg-B</span> <span class="nv">end-B</span> <span class="nv">buffer-B</span> <span class="nv">tmp-buffer</span><span class="p">))</span>
	  <span class="p">(</span><span class="k">setq</span> <span class="nv">file-B</span> <span class="p">(</span><span class="nv">ediff-make-temp-file</span> <span class="nv">tmp-buffer</span> <span class="s">&quot;regB&quot;</span><span class="p">))</span>

	  <span class="p">(</span><span class="k">setq</span> <span class="nv">overl-A</span> <span class="p">(</span><span class="nv">ediff-make-bullet-proof-overlay</span> <span class="nv">beg-A</span> <span class="nv">end-A</span> <span class="nv">buffer-A</span><span class="p">))</span>
	  <span class="p">(</span><span class="k">setq</span> <span class="nv">overl-B</span> <span class="p">(</span><span class="nv">ediff-make-bullet-proof-overlay</span> <span class="nv">beg-B</span> <span class="nv">end-B</span> <span class="nv">buffer-B</span><span class="p">))</span>
	  <span class="p">(</span><span class="nv">ediff-setup</span> <span class="nv">buffer-A</span> <span class="nv">file-A</span>
		       <span class="nv">buffer-B</span> <span class="nv">file-B</span>
		       <span class="no">nil</span> <span class="nv">nil</span>	    <span class="c1">; buffer &amp; file C</span>
		       <span class="p">(</span><span class="nf">cons</span> <span class="o">`</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
				<span class="p">(</span><span class="nf">delete-file</span> <span class="o">,</span><span class="nv">file-A</span><span class="p">)</span>
				<span class="p">(</span><span class="nf">delete-file</span> <span class="o">,</span><span class="nv">file-B</span><span class="p">))</span>
			     <span class="nv">startup-hooks</span><span class="p">)</span>
		       <span class="p">(</span><span class="nf">append</span>
			<span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nf">cons</span> <span class="ss">&#39;ediff-word-mode</span>  <span class="nv">word-mode</span><span class="p">)</span>
			      <span class="p">(</span><span class="nf">cons</span> <span class="ss">&#39;ediff-narrow-bounds</span> <span class="p">(</span><span class="nf">list</span> <span class="nv">overl-A</span> <span class="nv">overl-B</span><span class="p">))</span>
			      <span class="p">(</span><span class="nf">cons</span> <span class="ss">&#39;ediff-job-name</span> <span class="nv">job-name</span><span class="p">))</span>
			<span class="nv">setup-parameters</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">file-A</span><span class="p">)</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">file-A</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">delete-file</span> <span class="nv">file-A</span><span class="p">))</span>
      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">file-B</span><span class="p">)</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">file-B</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">delete-file</span> <span class="nv">file-B</span><span class="p">)))</span>
    <span class="p">))</span>


<span class="c1">;;; Merge files and buffers</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defalias</span> <span class="ss">&#39;ediff-merge</span> <span class="ss">&#39;ediff-merge-files</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defsubst</span> <span class="nv">ediff-merge-on-startup</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">ediff-do-merge</span> <span class="mi">0</span><span class="p">)</span>
  <span class="c1">;; Can&#39;t remember why this is here, but it may cause the automatically merged</span>
  <span class="c1">;; buffer to be lost. So, keep the buffer modified.</span>
  <span class="c1">;;(ediff-with-current-buffer ediff-buffer-C</span>
  <span class="c1">;;  (set-buffer-modified-p nil))</span>
  <span class="p">)</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-merge-files</span> <span class="p">(</span><span class="nv">file-A</span> <span class="nv">file-B</span>
				 <span class="c1">;; MERGE-BUFFER-FILE is the file to be</span>
				 <span class="c1">;; associated with the merge buffer</span>
				 <span class="kp">&amp;optional</span> <span class="nv">startup-hooks</span> <span class="nv">merge-buffer-file</span><span class="p">)</span>
  <span class="s">&quot;Merge two files without ancestor.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">dir-A</span> <span class="p">(</span><span class="k">if</span> <span class="nv">ediff-use-last-dir</span>
		    <span class="nv">ediff-last-dir-A</span>
		  <span class="nv">default-directory</span><span class="p">))</span>
	 <span class="nv">dir-B</span> <span class="nv">f</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">f</span> <span class="p">(</span><span class="nv">ediff-read-file-name</span>
		    <span class="s">&quot;File A to merge&quot;</span>
		    <span class="nv">dir-A</span>
		    <span class="p">(</span><span class="nv">ediff-get-default-file-name</span><span class="p">)</span>
		    <span class="ss">&#39;no-dirs</span><span class="p">))</span>
	   <span class="p">(</span><span class="nv">ediff-read-file-name</span> <span class="s">&quot;File B to merge&quot;</span>
				 <span class="p">(</span><span class="k">setq</span> <span class="nv">dir-B</span>
				       <span class="p">(</span><span class="k">if</span> <span class="nv">ediff-use-last-dir</span>
					   <span class="nv">ediff-last-dir-B</span>
					 <span class="p">(</span><span class="nf">file-name-directory</span> <span class="nv">f</span><span class="p">)))</span>
				 <span class="p">(</span><span class="k">progn</span>
				   <span class="p">(</span><span class="nv">ediff-add-to-history</span>
				    <span class="ss">&#39;file-name-history</span>
				    <span class="p">(</span><span class="nv">ediff-abbreviate-file-name</span>
				     <span class="p">(</span><span class="nf">expand-file-name</span>
				      <span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">f</span><span class="p">)</span>
				      <span class="nv">dir-B</span><span class="p">)))</span>
				   <span class="p">(</span><span class="nv">ediff-get-default-file-name</span> <span class="nv">f</span> <span class="mi">1</span><span class="p">)))</span>
	   <span class="p">)))</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">startup-hooks</span> <span class="p">(</span><span class="nf">cons</span> <span class="ss">&#39;ediff-merge-on-startup</span> <span class="nv">startup-hooks</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">ediff-files-internal</span> <span class="nv">file-A</span>
			<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">file-B</span><span class="p">)</span>
			    <span class="p">(</span><span class="nf">expand-file-name</span>
			     <span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">file-A</span><span class="p">)</span> <span class="nv">file-B</span><span class="p">)</span>
			  <span class="nv">file-B</span><span class="p">)</span>
			  <span class="no">nil</span> <span class="c1">; file-C</span>
			  <span class="nv">startup-hooks</span>
			  <span class="ss">&#39;ediff-merge-files</span>
			  <span class="nv">merge-buffer-file</span><span class="p">))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-merge-files-with-ancestor</span> <span class="p">(</span><span class="nv">file-A</span> <span class="nv">file-B</span> <span class="nv">file-ancestor</span>
					       <span class="kp">&amp;optional</span>
					       <span class="nv">startup-hooks</span>
					       <span class="c1">;; MERGE-BUFFER-FILE is the file</span>
					       <span class="c1">;; to be associated with the</span>
					       <span class="c1">;; merge buffer</span>
					       <span class="nv">merge-buffer-file</span><span class="p">)</span>
  <span class="s">&quot;Merge two files with ancestor.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">dir-A</span> <span class="p">(</span><span class="k">if</span> <span class="nv">ediff-use-last-dir</span>
		    <span class="nv">ediff-last-dir-A</span>
		  <span class="nv">default-directory</span><span class="p">))</span>
	 <span class="nv">dir-B</span> <span class="nv">dir-ancestor</span> <span class="nv">f</span> <span class="nv">ff</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">f</span> <span class="p">(</span><span class="nv">ediff-read-file-name</span>
		    <span class="s">&quot;File A to merge&quot;</span>
		    <span class="nv">dir-A</span>
		    <span class="p">(</span><span class="nv">ediff-get-default-file-name</span><span class="p">)</span>
		    <span class="ss">&#39;no-dirs</span><span class="p">))</span>
	   <span class="p">(</span><span class="k">setq</span> <span class="nv">ff</span> <span class="p">(</span><span class="nv">ediff-read-file-name</span> <span class="s">&quot;File B to merge&quot;</span>
					  <span class="p">(</span><span class="k">setq</span> <span class="nv">dir-B</span>
						<span class="p">(</span><span class="k">if</span> <span class="nv">ediff-use-last-dir</span>
						    <span class="nv">ediff-last-dir-B</span>
						  <span class="p">(</span><span class="nf">file-name-directory</span> <span class="nv">f</span><span class="p">)))</span>
					  <span class="p">(</span><span class="k">progn</span>
					    <span class="p">(</span><span class="nv">ediff-add-to-history</span>
					     <span class="ss">&#39;file-name-history</span>
					     <span class="p">(</span><span class="nv">ediff-abbreviate-file-name</span>
					      <span class="p">(</span><span class="nf">expand-file-name</span>
					       <span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">f</span><span class="p">)</span>
					       <span class="nv">dir-B</span><span class="p">)))</span>
					    <span class="p">(</span><span class="nv">ediff-get-default-file-name</span> <span class="nv">f</span> <span class="mi">1</span><span class="p">))))</span>
	   <span class="p">(</span><span class="nv">ediff-read-file-name</span> <span class="s">&quot;Ancestor file&quot;</span>
				 <span class="p">(</span><span class="k">setq</span> <span class="nv">dir-ancestor</span>
				       <span class="p">(</span><span class="k">if</span> <span class="nv">ediff-use-last-dir</span>
					   <span class="nv">ediff-last-dir-ancestor</span>
					 <span class="p">(</span><span class="nf">file-name-directory</span> <span class="nv">ff</span><span class="p">)))</span>
				 <span class="p">(</span><span class="k">progn</span>
				   <span class="p">(</span><span class="nv">ediff-add-to-history</span>
				    <span class="ss">&#39;file-name-history</span>
				    <span class="p">(</span><span class="nv">ediff-abbreviate-file-name</span>
				     <span class="p">(</span><span class="nf">expand-file-name</span>
				      <span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">ff</span><span class="p">)</span>
				      <span class="nv">dir-ancestor</span><span class="p">)))</span>
				   <span class="p">(</span><span class="nv">ediff-get-default-file-name</span> <span class="nv">ff</span> <span class="mi">2</span><span class="p">)))</span>
	   <span class="p">)))</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">startup-hooks</span> <span class="p">(</span><span class="nf">cons</span> <span class="ss">&#39;ediff-merge-on-startup</span> <span class="nv">startup-hooks</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">ediff-files-internal</span> <span class="nv">file-A</span>
			<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">file-B</span><span class="p">)</span>
			    <span class="p">(</span><span class="nf">expand-file-name</span>
			     <span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">file-A</span><span class="p">)</span> <span class="nv">file-B</span><span class="p">)</span>
			  <span class="nv">file-B</span><span class="p">)</span>
			  <span class="nv">file-ancestor</span>
			  <span class="nv">startup-hooks</span>
			  <span class="ss">&#39;ediff-merge-files-with-ancestor</span>
			  <span class="nv">merge-buffer-file</span><span class="p">))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defalias</span> <span class="ss">&#39;ediff-merge-with-ancestor</span> <span class="ss">&#39;ediff-merge-files-with-ancestor</span><span class="p">)</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-merge-buffers</span> <span class="p">(</span><span class="nv">buffer-A</span> <span class="nv">buffer-B</span>
				     <span class="kp">&amp;optional</span>
				     <span class="c1">;; MERGE-BUFFER-FILE is the file to be</span>
				     <span class="c1">;; associated with the merge buffer</span>
				     <span class="nv">startup-hooks</span> <span class="nv">job-name</span> <span class="nv">merge-buffer-file</span><span class="p">)</span>
  <span class="s">&quot;Merge buffers without ancestor.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">bf</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">bf</span> <span class="p">(</span><span class="nf">read-buffer</span> <span class="s">&quot;Buffer A to merge: &quot;</span>
				 <span class="p">(</span><span class="nv">ediff-other-buffer</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="no">t</span><span class="p">))</span>
	   <span class="p">(</span><span class="nf">read-buffer</span> <span class="s">&quot;Buffer B to merge: &quot;</span>
			<span class="p">(</span><span class="k">progn</span>
			  <span class="c1">;; realign buffers so that two visible bufs will be</span>
			  <span class="c1">;; at the top</span>
			  <span class="p">(</span><span class="nb">save-window-excursion</span> <span class="p">(</span><span class="nv">other-window</span> <span class="mi">1</span><span class="p">))</span>
			  <span class="p">(</span><span class="nv">ediff-other-buffer</span> <span class="nv">bf</span><span class="p">))</span>
			<span class="no">t</span><span class="p">))))</span>

  <span class="p">(</span><span class="k">setq</span> <span class="nv">startup-hooks</span> <span class="p">(</span><span class="nf">cons</span> <span class="ss">&#39;ediff-merge-on-startup</span> <span class="nv">startup-hooks</span><span class="p">))</span>
  <span class="p">(</span><span class="k">or</span> <span class="nv">job-name</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">job-name</span> <span class="ss">&#39;ediff-merge-buffers</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">ediff-buffers-internal</span>
   <span class="nv">buffer-A</span> <span class="nv">buffer-B</span> <span class="no">nil</span> <span class="nv">startup-hooks</span> <span class="nv">job-name</span> <span class="nv">merge-buffer-file</span><span class="p">))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-merge-buffers-with-ancestor</span> <span class="p">(</span><span class="nv">buffer-A</span> <span class="nv">buffer-B</span> <span class="nv">buffer-ancestor</span>
						   <span class="kp">&amp;optional</span>
						   <span class="nv">startup-hooks</span>
						   <span class="nv">job-name</span>
						   <span class="c1">;; MERGE-BUFFER-FILE is the</span>
						   <span class="c1">;; file to be associated</span>
						   <span class="c1">;; with the merge buffer</span>
						   <span class="nv">merge-buffer-file</span><span class="p">)</span>
  <span class="s">&quot;Merge buffers with ancestor.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">bf</span> <span class="nv">bff</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">bf</span> <span class="p">(</span><span class="nf">read-buffer</span> <span class="s">&quot;Buffer A to merge: &quot;</span>
				 <span class="p">(</span><span class="nv">ediff-other-buffer</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="no">t</span><span class="p">))</span>
	   <span class="p">(</span><span class="k">setq</span> <span class="nv">bff</span> <span class="p">(</span><span class="nf">read-buffer</span> <span class="s">&quot;Buffer B to merge: &quot;</span>
				  <span class="p">(</span><span class="k">progn</span>
				    <span class="c1">;; realign buffers so that two visible</span>
				    <span class="c1">;; bufs will be at the top</span>
				    <span class="p">(</span><span class="nb">save-window-excursion</span> <span class="p">(</span><span class="nv">other-window</span> <span class="mi">1</span><span class="p">))</span>
				    <span class="p">(</span><span class="nv">ediff-other-buffer</span> <span class="nv">bf</span><span class="p">))</span>
				  <span class="no">t</span><span class="p">))</span>
	   <span class="p">(</span><span class="nf">read-buffer</span> <span class="s">&quot;Ancestor buffer: &quot;</span>
				  <span class="p">(</span><span class="k">progn</span>
				    <span class="c1">;; realign buffers so that three visible</span>
				    <span class="c1">;; bufs will be at the top</span>
				    <span class="p">(</span><span class="nb">save-window-excursion</span> <span class="p">(</span><span class="nv">other-window</span> <span class="mi">1</span><span class="p">))</span>
				    <span class="p">(</span><span class="nv">ediff-other-buffer</span> <span class="p">(</span><span class="nf">list</span> <span class="nv">bf</span> <span class="nv">bff</span><span class="p">)))</span>
				  <span class="no">t</span><span class="p">)</span>
	   <span class="p">)))</span>

  <span class="p">(</span><span class="k">setq</span> <span class="nv">startup-hooks</span> <span class="p">(</span><span class="nf">cons</span> <span class="ss">&#39;ediff-merge-on-startup</span> <span class="nv">startup-hooks</span><span class="p">))</span>
  <span class="p">(</span><span class="k">or</span> <span class="nv">job-name</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">job-name</span> <span class="ss">&#39;ediff-merge-buffers-with-ancestor</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">ediff-buffers-internal</span>
   <span class="nv">buffer-A</span> <span class="nv">buffer-B</span> <span class="nv">buffer-ancestor</span> <span class="nv">startup-hooks</span> <span class="nv">job-name</span> <span class="nv">merge-buffer-file</span><span class="p">))</span>


<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-merge-revisions</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">file</span> <span class="nv">startup-hooks</span> <span class="nv">merge-buffer-file</span><span class="p">)</span>
  <span class="c1">;; MERGE-BUFFER-FILE is the file to be associated with the merge buffer</span>
  <span class="s">&quot;Run Ediff by merging two revisions of a file.</span>
<span class="s">The file is the optional FILE argument or the file visited by the current</span>
<span class="s">buffer.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">file</span><span class="p">)</span> <span class="p">(</span><span class="nv">find-file</span> <span class="nv">file</span><span class="p">))</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">rev1</span> <span class="nv">rev2</span><span class="p">)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">rev1</span>
	  <span class="p">(</span><span class="nf">read-string</span>
	   <span class="p">(</span><span class="nf">format</span>
	    <span class="s">&quot;Version 1 to merge (default %s&#39;s working version): &quot;</span>
	    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">file</span><span class="p">)</span>
		<span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">file</span><span class="p">)</span> <span class="s">&quot;current buffer&quot;</span><span class="p">)))</span>
	  <span class="nv">rev2</span>
	  <span class="p">(</span><span class="nf">read-string</span>
	   <span class="p">(</span><span class="nf">format</span>
	    <span class="s">&quot;Version 2 to merge (default %s): &quot;</span>
	    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">file</span><span class="p">)</span>
		<span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">file</span><span class="p">)</span> <span class="s">&quot;current buffer&quot;</span><span class="p">))))</span>
    <span class="p">(</span><span class="nv">ediff-load-version-control</span><span class="p">)</span>
    <span class="c1">;; ancestor-revision=nil</span>
    <span class="p">(</span><span class="nf">funcall</span>
     <span class="p">(</span><span class="nf">intern</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;ediff-%S-merge-internal&quot;</span> <span class="nv">ediff-version-control-package</span><span class="p">))</span>
     <span class="nv">rev1</span> <span class="nv">rev2</span> <span class="no">nil</span> <span class="nv">startup-hooks</span> <span class="nv">merge-buffer-file</span><span class="p">)))</span>


<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-merge-revisions-with-ancestor</span> <span class="p">(</span><span class="kp">&amp;optional</span>
					    <span class="nv">file</span> <span class="nv">startup-hooks</span>
					    <span class="c1">;; MERGE-BUFFER-FILE is the file to</span>
					    <span class="c1">;; be associated with the merge</span>
					    <span class="c1">;; buffer</span>
					    <span class="nv">merge-buffer-file</span><span class="p">)</span>
  <span class="s">&quot;Run Ediff by merging two revisions of a file with a common ancestor.</span>
<span class="s">The file is the optional FILE argument or the file visited by the current</span>
<span class="s">buffer.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">file</span><span class="p">)</span> <span class="p">(</span><span class="nv">find-file</span> <span class="nv">file</span><span class="p">))</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">rev1</span> <span class="nv">rev2</span> <span class="nv">ancestor-rev</span><span class="p">)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">rev1</span>
	  <span class="p">(</span><span class="nf">read-string</span>
	   <span class="p">(</span><span class="nf">format</span>
	    <span class="s">&quot;Version 1 to merge (default %s&#39;s working version): &quot;</span>
	    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">file</span><span class="p">)</span>
		<span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">file</span><span class="p">)</span> <span class="s">&quot;current buffer&quot;</span><span class="p">)))</span>
	  <span class="nv">rev2</span>
	  <span class="p">(</span><span class="nf">read-string</span>
	   <span class="p">(</span><span class="nf">format</span>
	    <span class="s">&quot;Version 2 to merge (default %s): &quot;</span>
	    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">file</span><span class="p">)</span>
		<span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">file</span><span class="p">)</span> <span class="s">&quot;current buffer&quot;</span><span class="p">)))</span>
	  <span class="nv">ancestor-rev</span>
	  <span class="p">(</span><span class="nf">read-string</span>
	   <span class="p">(</span><span class="nf">format</span>
	    <span class="s">&quot;Ancestor version (default %s&#39;s base revision): &quot;</span>
	    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">file</span><span class="p">)</span>
		<span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">file</span><span class="p">)</span> <span class="s">&quot;current buffer&quot;</span><span class="p">))))</span>
    <span class="p">(</span><span class="nv">ediff-load-version-control</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">funcall</span>
     <span class="p">(</span><span class="nf">intern</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;ediff-%S-merge-internal&quot;</span> <span class="nv">ediff-version-control-package</span><span class="p">))</span>
     <span class="nv">rev1</span> <span class="nv">rev2</span> <span class="nv">ancestor-rev</span> <span class="nv">startup-hooks</span> <span class="nv">merge-buffer-file</span><span class="p">)))</span>

<span class="c1">;;; Apply patch</span>
<span class="p">(</span><span class="k">defvar</span> <span class="nv">ediff-last-dir-patch</span><span class="p">)</span>
<span class="p">(</span><span class="k">defvar</span> <span class="nv">ediff-patch-default-directory</span><span class="p">)</span>
<span class="p">(</span><span class="nb">declare-function</span> <span class="nv">ediff-get-patch-buffer</span> <span class="s">&quot;ediff-ptch&quot;</span>
                  <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">arg</span> <span class="nv">patch-buf</span><span class="p">))</span>
<span class="p">(</span><span class="nb">declare-function</span> <span class="nv">ediff-dispatch-file-patching-job</span> <span class="s">&quot;ediff-ptch&quot;</span>
                  <span class="p">(</span><span class="nv">patch-buf</span> <span class="nv">filename</span> <span class="kp">&amp;optional</span> <span class="nv">startup-hooks</span><span class="p">))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-patch-file</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">arg</span> <span class="nv">patch-buf</span><span class="p">)</span>
  <span class="s">&quot;Query for a file name, and then run Ediff by patching that file.</span>
<span class="s">If optional PATCH-BUF is given, use the patch in that buffer</span>
<span class="s">and don&#39;t ask the user.</span>
<span class="s">If prefix argument, then: if even argument, assume that the patch is in a</span>
<span class="s">buffer. If odd -- assume it is in a file.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span> <span class="s">&quot;P&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">source-dir</span> <span class="nv">source-file</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;ediff-ptch</span><span class="p">)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">patch-buf</span>
	  <span class="p">(</span><span class="nv">ediff-get-patch-buffer</span>
	   <span class="p">(</span><span class="k">if</span> <span class="nv">arg</span> <span class="p">(</span><span class="nf">prefix-numeric-value</span> <span class="nv">arg</span><span class="p">))</span> <span class="nv">patch-buf</span><span class="p">))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">source-dir</span> <span class="p">(</span><span class="k">cond</span> <span class="p">(</span><span class="nv">ediff-use-last-dir</span> <span class="nv">ediff-last-dir-patch</span><span class="p">)</span>
			   <span class="p">((</span><span class="k">and</span> <span class="p">(</span><span class="nv">not</span> <span class="nv">ediff-patch-default-directory</span><span class="p">)</span>
				 <span class="p">(</span><span class="nf">buffer-file-name</span> <span class="nv">patch-buf</span><span class="p">))</span>
			    <span class="p">(</span><span class="nf">file-name-directory</span>
			     <span class="p">(</span><span class="nf">expand-file-name</span>
			      <span class="p">(</span><span class="nf">buffer-file-name</span> <span class="nv">patch-buf</span><span class="p">))))</span>
			   <span class="p">(</span><span class="no">t</span> <span class="nv">default-directory</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">source-file</span>
	  <span class="p">(</span><span class="nv">read-file-name</span>
	   <span class="s">&quot;File to patch (directory, if multifile patch): &quot;</span>
	   <span class="c1">;; use an explicit initial file</span>
	   <span class="nv">source-dir</span> <span class="no">nil</span> <span class="no">nil</span> <span class="p">(</span><span class="nv">ediff-get-default-file-name</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">ediff-dispatch-file-patching-job</span> <span class="nv">patch-buf</span> <span class="nv">source-file</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">declare-function</span> <span class="nv">ediff-patch-buffer-internal</span> <span class="s">&quot;ediff-ptch&quot;</span>
                  <span class="p">(</span><span class="nv">patch-buf</span> <span class="nv">buf-to-patch-name</span> <span class="kp">&amp;optional</span> <span class="nv">startup-hooks</span><span class="p">))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-patch-buffer</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">arg</span> <span class="nv">patch-buf</span><span class="p">)</span>
  <span class="s">&quot;Run Ediff by patching the buffer specified at prompt.</span>
<span class="s">Without the optional prefix ARG, asks if the patch is in some buffer and</span>
<span class="s">prompts for the buffer or a file, depending on the answer.</span>
<span class="s">With ARG=1, assumes the patch is in a file and prompts for the file.</span>
<span class="s">With ARG=2, assumes the patch is in a buffer and prompts for the buffer.</span>
<span class="s">PATCH-BUF is an optional argument, which specifies the buffer that contains the</span>
<span class="s">patch. If not given, the user is prompted according to the prefix argument.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span> <span class="s">&quot;P&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;ediff-ptch</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">patch-buf</span>
	<span class="p">(</span><span class="nv">ediff-get-patch-buffer</span>
	 <span class="p">(</span><span class="k">if</span> <span class="nv">arg</span> <span class="p">(</span><span class="nf">prefix-numeric-value</span> <span class="nv">arg</span><span class="p">))</span> <span class="nv">patch-buf</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">ediff-patch-buffer-internal</span>
   <span class="nv">patch-buf</span>
   <span class="p">(</span><span class="nf">read-buffer</span>
    <span class="s">&quot;Which buffer to patch? &quot;</span>
    <span class="p">(</span><span class="nv">ediff-other-buffer</span> <span class="nv">patch-buf</span><span class="p">))))</span>


<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defalias</span> <span class="ss">&#39;epatch</span> <span class="ss">&#39;ediff-patch-file</span><span class="p">)</span>
<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defalias</span> <span class="ss">&#39;epatch-buffer</span> <span class="ss">&#39;ediff-patch-buffer</span><span class="p">)</span>




<span class="c1">;;; Versions Control functions</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-revision</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">file</span> <span class="nv">startup-hooks</span><span class="p">)</span>
  <span class="s">&quot;Run Ediff by comparing versions of a file.</span>
<span class="s">The file is an optional FILE argument or the file entered at the prompt.</span>
<span class="s">Default: the file visited by the current buffer.</span>
<span class="s">Uses `vc.el&#39; or `rcs.el&#39; depending on `ediff-version-control-package&#39;.&quot;</span>
  <span class="c1">;; if buffer is non-nil, use that buffer instead of the current buffer</span>
  <span class="p">(</span><span class="k">interactive</span> <span class="s">&quot;P&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">file</span><span class="p">))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">file</span>
	  <span class="p">(</span><span class="nv">ediff-read-file-name</span> <span class="s">&quot;Compare revisions for file&quot;</span>
				<span class="p">(</span><span class="k">if</span> <span class="nv">ediff-use-last-dir</span>
				    <span class="nv">ediff-last-dir-A</span>
				  <span class="nv">default-directory</span><span class="p">)</span>
				<span class="p">(</span><span class="nv">ediff-get-default-file-name</span><span class="p">)</span>
				<span class="ss">&#39;no-dirs</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">find-file</span> <span class="nv">file</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">buffer-modified-p</span><span class="p">)</span>
	   <span class="p">(</span><span class="nv">y-or-n-p</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;Buffer %s is modified. Save buffer? &quot;</span>
                             <span class="p">(</span><span class="nf">buffer-name</span><span class="p">))))</span>
      <span class="p">(</span><span class="nv">save-buffer</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">rev1</span> <span class="nv">rev2</span><span class="p">)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">rev1</span>
	  <span class="p">(</span><span class="nf">read-string</span>
	   <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;Revision 1 to compare (default %s&#39;s latest revision): &quot;</span>
		   <span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">file</span><span class="p">)))</span>
	  <span class="nv">rev2</span>
	  <span class="p">(</span><span class="nf">read-string</span>
	   <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;Revision 2 to compare (default %s&#39;s current state): &quot;</span>
		   <span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">file</span><span class="p">))))</span>
    <span class="p">(</span><span class="nv">ediff-load-version-control</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">funcall</span>
     <span class="p">(</span><span class="nf">intern</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;ediff-%S-internal&quot;</span> <span class="nv">ediff-version-control-package</span><span class="p">))</span>
     <span class="nv">rev1</span> <span class="nv">rev2</span> <span class="nv">startup-hooks</span><span class="p">)</span>
    <span class="p">))</span>


<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defalias</span> <span class="ss">&#39;erevision</span> <span class="ss">&#39;ediff-revision</span><span class="p">)</span>


<span class="c1">;; Test if version control package is loaded and load if not</span>
<span class="c1">;; Is SILENT is non-nil, don&#39;t report error if package is not found.</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-load-version-control</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">silent</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;ediff-vers</span><span class="p">)</span>
  <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nb">featurep</span> <span class="nv">ediff-version-control-package</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">locate-library</span> <span class="p">(</span><span class="nf">symbol-name</span> <span class="nv">ediff-version-control-package</span><span class="p">))</span>
	  <span class="p">(</span><span class="k">progn</span>
	    <span class="p">(</span><span class="nf">message</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="c1">; kill the message from `locate-library&#39;</span>
	    <span class="p">(</span><span class="nb">require</span> <span class="nv">ediff-version-control-package</span><span class="p">))</span>
	<span class="p">(</span><span class="k">or</span> <span class="nv">silent</span>
	    <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Version control package %S.el not found.  Use vc.el instead&quot;</span>
		   <span class="nv">ediff-version-control-package</span><span class="p">)))))</span>


<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-version</span> <span class="p">()</span>
  <span class="s">&quot;Return string describing the version of Ediff.</span>
<span class="s">When called interactively, displays the version.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">featurep</span> <span class="ss">&#39;xemacs</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">interactive-p</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">called-interactively-p</span> <span class="ss">&#39;interactive</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">message</span> <span class="s">&quot;%s&quot;</span> <span class="p">(</span><span class="nv">ediff-version</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;Ediff %s of %s&quot;</span> <span class="nv">ediff-version</span> <span class="nv">ediff-date</span><span class="p">)))</span>

<span class="c1">;; info is run first, and will autoload info.el.</span>
<span class="p">(</span><span class="nb">declare-function</span> <span class="nv">Info-goto-node</span> <span class="s">&quot;info&quot;</span> <span class="p">(</span><span class="nv">nodename</span> <span class="kp">&amp;optional</span> <span class="nv">fork</span> <span class="nv">strict-case</span><span class="p">))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-documentation</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">node</span><span class="p">)</span>
  <span class="s">&quot;Display Ediff&#39;s manual.</span>
<span class="s">With optional NODE, goes to that node.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">ctl-window</span> <span class="nv">ediff-control-window</span><span class="p">)</span>
	<span class="p">(</span><span class="nv">ctl-buf</span> <span class="nv">ediff-control-buffer</span><span class="p">))</span>

    <span class="p">(</span><span class="nv">ediff-skip-unsuitable-frames</span><span class="p">)</span>
    <span class="p">(</span><span class="k">condition-case</span> <span class="no">nil</span>
	<span class="p">(</span><span class="k">progn</span>
	  <span class="p">(</span><span class="nv">pop-to-buffer</span> <span class="p">(</span><span class="nf">get-buffer-create</span> <span class="s">&quot;*info*&quot;</span><span class="p">))</span>
	  <span class="p">(</span><span class="nv">info</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">featurep</span> <span class="ss">&#39;xemacs</span><span class="p">)</span> <span class="s">&quot;ediff.info&quot;</span> <span class="s">&quot;ediff&quot;</span><span class="p">))</span>
	  <span class="p">(</span><span class="k">if</span> <span class="nv">node</span>
	      <span class="p">(</span><span class="nv">Info-goto-node</span> <span class="nv">node</span><span class="p">)</span>
	    <span class="p">(</span><span class="nf">message</span> <span class="s">&quot;Type `i&#39; to search for a specific topic&quot;</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">raise-frame</span><span class="p">))</span>
      <span class="p">(</span><span class="ne">error</span> <span class="p">(</span><span class="nv">beep</span> <span class="mi">1</span><span class="p">)</span>
	     <span class="p">(</span><span class="nb">with-output-to-temp-buffer</span> <span class="nv">ediff-msg-buffer</span>
	       <span class="p">(</span><span class="nv">ediff-with-current-buffer</span> <span class="nv">standard-output</span>
		 <span class="p">(</span><span class="nv">fundamental-mode</span><span class="p">))</span>
	       <span class="p">(</span><span class="nf">princ</span> <span class="nv">ediff-BAD-INFO</span><span class="p">))</span>
	     <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">window-live-p</span> <span class="nv">ctl-window</span><span class="p">)</span>
		 <span class="p">(</span><span class="k">progn</span>
		   <span class="p">(</span><span class="nf">select-window</span> <span class="nv">ctl-window</span><span class="p">)</span>
		   <span class="p">(</span><span class="nf">set-window-buffer</span> <span class="nv">ctl-window</span> <span class="nv">ctl-buf</span><span class="p">)))))))</span>


<span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">mess</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;^Errors in diff output. Diff output is in &quot;</span>
                <span class="s">&quot;^Hmm... I don&#39;t see an Ediff command around here...$&quot;</span>
                <span class="s">&quot;^Undocumented command! Type `G&#39; in Ediff Control Panel to drop a note to the Ediff maintainer$&quot;</span>
                <span class="s">&quot;: This command runs in Ediff Control Buffer only!$&quot;</span>
                <span class="s">&quot;: Invalid op in ediff-check-version$&quot;</span>
                <span class="s">&quot;^ediff-shrink-window-C can be used only for merging jobs$&quot;</span>
                <span class="s">&quot;^Lost difference info on these directories$&quot;</span>
                <span class="s">&quot;^This command is inapplicable in the present context$&quot;</span>
                <span class="s">&quot;^This session group has no parent$&quot;</span>
                <span class="s">&quot;^Can&#39;t hide active session, $&quot;</span>
                <span class="s">&quot;^Ediff: something wrong--no multiple diffs buffer$&quot;</span>
                <span class="s">&quot;^Can&#39;t make context diff for Session $&quot;</span>
                <span class="s">&quot;^The patch buffer wasn&#39;t found$&quot;</span>
                <span class="s">&quot;^Aborted$&quot;</span>
                <span class="s">&quot;^This Ediff session is not part of a session group$&quot;</span>
                <span class="s">&quot;^No active Ediff sessions or corrupted session registry$&quot;</span>
                <span class="s">&quot;^No session info in this line$&quot;</span>
                <span class="s">&quot;^`.*&#39; is not an ordinary file$&quot;</span>
                <span class="s">&quot;^Patch appears to have failed$&quot;</span>
                <span class="s">&quot;^Recomputation of differences cancelled$&quot;</span>
                <span class="s">&quot;^No fine differences in this mode$&quot;</span>
                <span class="s">&quot;^Lost connection to ancestor buffer...sorry$&quot;</span>
                <span class="s">&quot;^Not merging with ancestor$&quot;</span>
                <span class="s">&quot;^Don&#39;t know how to toggle read-only in buffer &quot;</span>
                <span class="s">&quot;Emacs is not running as a window application$&quot;</span>
                <span class="s">&quot;^This command makes sense only when merging with an ancestor$&quot;</span>
                <span class="s">&quot;^At end of the difference list$&quot;</span>
                <span class="s">&quot;^At beginning of the difference list$&quot;</span>
                <span class="s">&quot;^Nothing saved for diff .* in buffer &quot;</span>
                <span class="s">&quot;^Buffer is out of sync for file &quot;</span>
                <span class="s">&quot;^Buffer out of sync for file &quot;</span>
                <span class="s">&quot;^Output from `diff&#39; not found$&quot;</span>
                <span class="s">&quot;^You forgot to specify a region in buffer &quot;</span>
                <span class="s">&quot;^All right. Make up your mind and come back...$&quot;</span>
                <span class="s">&quot;^Current buffer is not visiting any file$&quot;</span>
                <span class="s">&quot;^Failed to retrieve revision: $&quot;</span>
                <span class="s">&quot;^Can&#39;t determine display width.$&quot;</span>
                <span class="s">&quot;^File `.*&#39; does not exist or is not readable$&quot;</span>
                <span class="s">&quot;^File `.*&#39; is a directory$&quot;</span>
                <span class="s">&quot;^Buffer .* doesn&#39;t exist$&quot;</span>
                <span class="s">&quot;^Directories . and . are the same: &quot;</span>
                <span class="s">&quot;^Directory merge aborted$&quot;</span>
                <span class="s">&quot;^Merge of directory revisions aborted$&quot;</span>
                <span class="s">&quot;^Buffer .* doesn&#39;t exist$&quot;</span>
                <span class="s">&quot;^There is no file to merge$&quot;</span>
                <span class="s">&quot;^Version control package .*.el not found. Use vc.el instead$&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;debug-ignored-errors</span> <span class="nv">mess</span><span class="p">))</span>



<span class="c1">;;; Command line interface</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-files-command</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">file-a</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">0</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">file-b</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="nv">command-line-args-left</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">command-line-args-left</span> <span class="p">(</span><span class="nf">nthcdr</span> <span class="mi">2</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">ediff</span> <span class="nv">file-a</span> <span class="nv">file-b</span><span class="p">)))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff3-files-command</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">file-a</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">0</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">file-b</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">file-c</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">2</span> <span class="nv">command-line-args-left</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">command-line-args-left</span> <span class="p">(</span><span class="nf">nthcdr</span> <span class="mi">3</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">ediff3</span> <span class="nv">file-a</span> <span class="nv">file-b</span> <span class="nv">file-c</span><span class="p">)))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-merge-command</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">file-a</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">0</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">file-b</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="nv">command-line-args-left</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">command-line-args-left</span> <span class="p">(</span><span class="nf">nthcdr</span> <span class="mi">2</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">ediff-merge-files</span> <span class="nv">file-a</span> <span class="nv">file-b</span><span class="p">)))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-merge-with-ancestor-command</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">file-a</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">0</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">file-b</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">ancestor</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">2</span> <span class="nv">command-line-args-left</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">command-line-args-left</span> <span class="p">(</span><span class="nf">nthcdr</span> <span class="mi">3</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">ediff-merge-files-with-ancestor</span> <span class="nv">file-a</span> <span class="nv">file-b</span> <span class="nv">ancestor</span><span class="p">)))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-directories-command</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">file-a</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">0</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">file-b</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">regexp</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">2</span> <span class="nv">command-line-args-left</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">command-line-args-left</span> <span class="p">(</span><span class="nf">nthcdr</span> <span class="mi">3</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">ediff-directories</span> <span class="nv">file-a</span> <span class="nv">file-b</span> <span class="nv">regexp</span><span class="p">)))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-directories3-command</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">file-a</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">0</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">file-b</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">file-c</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">2</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">regexp</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">3</span> <span class="nv">command-line-args-left</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">command-line-args-left</span> <span class="p">(</span><span class="nf">nthcdr</span> <span class="mi">4</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">ediff-directories3</span> <span class="nv">file-a</span> <span class="nv">file-b</span> <span class="nv">file-c</span> <span class="nv">regexp</span><span class="p">)))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-merge-directories-command</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">file-a</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">0</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">file-b</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">regexp</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">2</span> <span class="nv">command-line-args-left</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">command-line-args-left</span> <span class="p">(</span><span class="nf">nthcdr</span> <span class="mi">3</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">ediff-merge-directories</span> <span class="nv">file-a</span> <span class="nv">file-b</span> <span class="nv">regexp</span><span class="p">)))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ediff-merge-directories-with-ancestor-command</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">file-a</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">0</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">file-b</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">ancestor</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">2</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">regexp</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">3</span> <span class="nv">command-line-args-left</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">command-line-args-left</span> <span class="p">(</span><span class="nf">nthcdr</span> <span class="mi">4</span> <span class="nv">command-line-args-left</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">ediff-merge-directories-with-ancestor</span> <span class="nv">file-a</span> <span class="nv">file-b</span> <span class="nv">ancestor</span> <span class="nv">regexp</span><span class="p">)))</span>



<span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;ediff-util</span><span class="p">)</span>

<span class="p">(</span><span class="nf">run-hooks</span> <span class="ss">&#39;ediff-load-hook</span><span class="p">)</span>


<span class="c1">;; Local Variables:</span>
<span class="c1">;; eval: (put &#39;ediff-defvar-local &#39;lisp-indent-hook &#39;defun)</span>
<span class="c1">;; eval: (put &#39;ediff-with-current-buffer &#39;lisp-indent-hook 1)</span>
<span class="c1">;; eval: (put &#39;ediff-with-current-buffer &#39;edebug-form-spec &#39;(form body))</span>
<span class="c1">;; End:</span>

<span class="c1">;;; ediff.el ends here</span>
</pre></div>
</body>
</html>
