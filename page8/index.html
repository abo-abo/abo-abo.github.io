<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="flattr:id" content="9yl9ry">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (or emacs &middot; irrelevant)
    
  </title>

  <link rel="canonical" href="https://oremacs.com/page8/" />

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>
          <a class="sidebar-nav-item" href="/about/">About</a>
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
          <a class="sidebar-nav-item" href="/donate/">Donate</a>
        <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://licensebuttons.net/l/by-sa/4.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/11/30/hydra-lispy-move/">
        I move my s-expressions back and forth
      </a>
    </h1>

    <span class="post-date">30 Nov 2015</span>

    <p>Some people find <a href="https://github.com/abo-abo/lispy">lispy</a> too weird
and/or complex to try, quite possibly because of it&#39;s sort-of-modal
key binding structure. Which is a shame, since out of 7k lines of
lispy&#39;s code, only 500 lines do key bindings, the rest do all sorts of
useful stuff, like sexp navigation/modification, outlines and REPL
interaction.</p>

<p>In this post, I&#39;ll show a short example of using lispy&#39;s functions
outside of <code>lispy-mode</code>, and compare it with the default approach.</p>

<h2 id="moving-s-expressions-while-the-point-is-anywhere">Moving s-expressions while the point is anywhere</h2>

<p>Using this simple <a href="https://github.com/abo-abo/hydra">hydra</a>, and the
key sequence <kbd>C-c m sss www</kbd> I got the following GIF:</p>

<p><img src="/download/hydra-lispy-move-1.gif" alt="hydra-lispy-move-1.gif"></p>

<h2 id="doing-the-same-lispy-way">Doing the same lispy-way</h2>

<p>To do it the lispy-way, I move the point before the list that I wish
to operate on (with
<kbd>[</kbd> key), and press <kbd>sss www</kbd> to get the following GIF:</p>

<p><img src="/download/hydra-lispy-move-2.gif" alt="hydra-lispy-move-2.gif"></p>

<p>The difference here is that no hydra is necessary in the second case,
the key bindings come only from <code>lispy-mode</code>.  But the first case will
also work if <code>lispy-mode</code> is off.</p>

<h2 id="which-way-is-better">Which way is better?</h2>

<p>I think the second way is better, since it&#39;s faster and more clear,
but you can decide for yourself. By the way, you can also move
symbols, comments and sub-words (if that makes sense) with
<kbd>w</kbd> and <kbd>s</kbd>, provided you mark them with a region
first.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/11/04/ivy-occur/">
        New feature in Ivy - ivy-occur
      </a>
    </h1>

    <span class="post-date">04 Nov 2015</span>

    <p>I&#39;ve had an idea with this feature for quite some time, and only
recently got to finally implement it.  So here it goes: with
<code>ivy-occur</code>, bound to <kbd>C-c C-o</kbd> while in the minibuffer, you
can store almost <a href="https://github.com/abo-abo/swiper">Ivy</a> any
completion session in progress, and you can have as many of them as
you like.</p>

<h2 id="example-1">Example 1</h2>

<p>This is where the command name originates from: <code>swiper</code> + <code>ivy-occur</code>
= <code>occur</code>. You can store all of swiper&#39;s matching lines into a
separate buffer. This doesn&#39;t give too much advantage over the
good-old <code>occur</code>, the only thing is that you can use ivy-style regexps
with wild spaces, and have an interactive preview beforehand. Having
said that, it actually sounds pretty good!</p>

<h2 id="example-2">Example 2</h2>

<p>I press <kbd>C-S-o</kbd>, bound to <code>counsel-rhythmbox</code>, and enter
<code>u2</code>.  After pressing <kbd>C-c C-o</kbd>, bound to <code>ivy-occur</code>, the
completion session is closed (effectively <kbd>C-g</kbd>), and a new
buffer <code>*ivy-occur counsel-rhythmbox &quot;u2&quot;*</code> is generated with all
songs that match <code>u2</code>.</p>

<p>As a reminder, <code>counsel-rhythmbox</code> has two actions: <code>play</code> (the
default) and <code>enqueue</code>. In this new buffer, pressing <kbd>RET</kbd> or
<code>mouse-1</code> will call the <code>play</code> action (since it was active at the
moment <code>ivy-occur</code> was called) for the current candidate. So I&#39;ve
effectively added a playlist functionality to <code>counsel-rhythmbox</code>
through a generic command.</p>

<p>Note that it&#39;s very easy to identify a completion session by the
command name and input.  So I can distinguish e.g. <code>*ivy-occur
counsel-rhythmbox &quot;u2&quot;*</code> and <code>*ivy-occur counsel-rhythmbox &quot;скря&quot;*</code>,
and quickly select them with <code>ivy-switch-buffer</code>: just input <code>rhy</code>,
usually only these two and similar buffers will match.</p>

<h2 id="example-3">Example 3</h2>

<p>Suppose I want to go through the documentation of all variables that
end in <code>-function</code>.  Easy:</p>

<ol>
<li><kbd>&lt;f1&gt; v</kbd> (<code>counsel-describe-variable</code>) with input
<code>function$</code>.</li>
<li><kbd>C-c C-o</kbd> (<code>ivy-occur</code>).</li>
</ol>

<p>I get a new buffer named <code>*ivy-occur cousnel-describe-variable
&quot;function$*&quot;</code> with 346 candidates. I can go through them at my own
pace, possibly doing other completion stuff in between without
disturbing my process. It&#39;s also convenient to navigate these buffers
with <code>swiper</code>.</p>

<h2 id="example-4">Example 4</h2>

<p>Let&#39;s tweak the previous one. After inputting <code>function$</code> I can press
<kbd>C-M-a</kbd> (<code>ivy-read-action</code>) followed by <kbd>d</kbd> to
select the <code>definition</code> action. Then again <kbd>C-c C-o</kbd>
(<code>ivy-occur</code>).  Pressing <kbd>RET</kbd> in the resulting buffer will
take me to that variable&#39;s definition, instead of describing it as
before. A similar thing could be done for <code>counsel-rhythmbox</code> to get
the <code>enqueue</code> action in <code>*ivy-occur*</code> buffer, instead of <code>play</code>.</p>

<h2 id="example-5">Example 5</h2>

<p>This is an improvement to my workflow for quickly looking at a new
package&#39;s features.  This can be done with <kbd>oge</kbd>
(<code>lispy-goto-elisp-commands</code>) from
<a href="https://github.com/abo-abo/lispy">lispy</a>, which scans the source for
<code>(interactive)</code> tags and allows to jump to their definition.</p>

<p>It&#39;s a pretty cool optimization, compared to looking at all tags. For
example, <a href="https://github.com/bbatsov/projectile">projectile</a> currently
has 375 top-level tags (functions and variables).  But with
<code>lispy-goto-elisp-commands</code> I only get 48 tags. And now I can have
them in a convenient permanent list too.</p>

<p><img src="/download/ivy-occur-1.png" alt="ivy-occur-1.png"></p>

<p>Alternatively, if <code>projectile</code> is already loaded, I can use
<code>counsel-M-x</code> with input <code>projectile-</code>, followed by <kbd>C-M-a d</kbd>
to select the <code>definition</code> action, followed by <kbd>C-c C-o</kbd>.</p>

<p>As a reminder of how it works, <code>counsel-M-x</code> is defined with a single
action that calls the selected command. But then, I&#39;ve also added this
statement at top-level of counsel.el:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">ivy-set-actions</span>
 <span class="ss">&#39;counsel-M-x</span>
 <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;d&quot;</span> <span class="nv">counsel--find-symbol</span> <span class="s">&quot;definition&quot;</span><span class="p">)))</span>
</code></pre></div>
<p>This means that you can add as many actions as you like to <code>ivy-read</code>
commands. And of course customize the binding and the hint, which are
in this case <kbd>d</kbd> and <code>definition</code> respectively.</p>

<h2 id="limitations">Limitations</h2>

<p>Unfortunately, since the <code>*ivy-occur*</code> buffer needs to know the action
to execute, it only works for commands that explicitly pass <code>:action</code>
to <code>ivy-read</code>. For instance, it won&#39;t work for <code>package-install</code> with
<code>ivy-mode</code> on: the buffer will be properly generated, but pressing
<kbd>RET</kbd> won&#39;t install a package.</p>

<p>Fortunately, it&#39;s not hard to write a version that works:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">counsel-package-install</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">ivy-read</span> <span class="s">&quot;Install package: &quot;</span>
            <span class="p">(</span><span class="nf">delq</span> <span class="no">nil</span>
                  <span class="p">(</span><span class="nf">mapcar</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nf">elt</span><span class="p">)</span>
                            <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">package-installed-p</span> <span class="p">(</span><span class="nf">car</span> <span class="nf">elt</span><span class="p">))</span>
                              <span class="p">(</span><span class="nf">symbol-name</span> <span class="p">(</span><span class="nf">car</span> <span class="nf">elt</span><span class="p">))))</span>
                          <span class="nv">package-archive-contents</span><span class="p">))</span>
            <span class="nb">:action</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
                      <span class="p">(</span><span class="nv">package-install</span> <span class="p">(</span><span class="nf">intern</span> <span class="nv">x</span><span class="p">)))</span>
            <span class="nb">:caller</span> <span class="ss">&#39;counsel-package-install</span><span class="p">))</span>
</code></pre></div>
<p>Here&#39;s a buffer with a list of packages matching &quot;ga&quot;; pressing
<kbd>RET</kbd> will install the selected package:</p>

<p><img src="/download/ivy-occur-2.png" alt="ivy-occur-2.png"></p>

<h2 id="small-note-on-key-bindings">Small note on key bindings</h2>

<p>In the initial post, I wanted to bind <code>ivy-occur</code> to <kbd>C-c o</kbd>
instead of <kbd>C-c C-o</kbd>. But I was reminded that <kbd>C-c LETTER</kbd> are
<a href="http://www.gnu.org/software/emacs/manual/html_node/elisp/Key-Binding-Conventions.html">reserved</a>.
I still think it&#39;s a better binding. If you agree, you can add it to your config:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">ivy-minibuffer-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c o&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-occur</span><span class="p">)</span>
</code></pre></div>
<p>Additionally, <code>ivy-occur</code> is also available on <kbd>C-o u</kbd>,
through the <kbd>C-o</kbd> hydra.</p>

<h2 id="outro">Outro</h2>

<p>I think <code>ivy-occur</code> is a very powerful command that shouldn&#39;t be
overlooked.  Just as <code>ivy-resume</code> implements a sort of <kbd>DEL</kbd>
or <kbd>C-u</kbd> key for completion, <code>ivy-occur</code> implements a
convenient way to switch and store the completion context, a sort of
<kbd>C-x o</kbd> or <kbd>C-x b</kbd> for completion.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/10/23/dired-compress/">
        New in Emacs 25 - convenient compression/decompression in Dired
      </a>
    </h1>

    <span class="post-date">23 Oct 2015</span>

    <p>Today I&#39;ll describe my past and current workflows for compressing
files and directories in Dired.  In my opinion, Dired is one of the
best features of Emacs - a great abstraction of <code>cd</code>+<code>ls</code> that lets
you get things done much faster. The default binding for <code>dired</code> is
<kbd>C-x d</kbd> (I bind it to <kbd>C-;-d</kbd> though, see my
<a href="http://oremacs.com/2015/02/14/semi-xmodmap/">xmodmap post</a>).</p>

<h2 id="my-previous-workflow">My previous workflow</h2>

<p>To compress several files in Dired, first I compile a list of files to
work on by marking them with <kbd>m</kbd> (<code>dired-mark</code>), navigating
to ones that you want with <kbd>n</kbd> (<code>dired-next-line</code>) and
<kbd>p</kbd> (<code>dired-previous-line</code>).</p>

<p>Once a list is ready, I press <kbd>&amp;</kbd> (<code>dired-do-async-shell-command</code>), which allows me to run an arbitrary shell command.
I enter:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>tar -czf ~/tmp/path/foo.tar.gz *
</code></pre></div>
<p>into the minibuffer, press <kbd>RET</kbd> and I&#39;m done. It&#39;s a
standard shell command with 2 advantages:</p>

<ol>
<li>I get <kbd>TAB</kbd> completion for the directory of the created archive.</li>
<li><code>*</code> means the selected file list, so I don&#39;t enter them by hand.</li>
</ol>

<h2 id="my-current-workflow">My current workflow</h2>

<p>Since I often forget the command for <code>tar</code>, and I really don&#39;t want to
remember the commands for <code>zip</code> etc, I&#39;ve implemented a more convenient approach:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">dired-mode-map</span> <span class="s">&quot;c&quot;</span> <span class="ss">&#39;dired-do-compress-to</span><span class="p">)</span>
</code></pre></div>
<p>This new command <code>dired-do-compress-to</code>, bound to <kbd>c</kbd>, will
prompt me for a file name of the output archive. So now it&#39;s easier to
type in that file name, if you use <code>ido-mode</code> / <code>ivy-mode</code> /
<code>helm-mode</code>. What&#39;s more, the command will be automatically determined
from the archive extension and executed. Here&#39;s the corresponding
customization variable:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">defvar</span> <span class="nv">dired-compress-files-alist</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;\\.tar\\.gz\\&#39;&quot;</span> <span class="o">.</span> <span class="s">&quot;tar -c %i | gzip -c9 &gt; %o&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;\\.zip\\&#39;&quot;</span> <span class="o">.</span> <span class="s">&quot;zip %o -r --filesync %i&quot;</span><span class="p">))</span>
  <span class="s">&quot;Control the compression shell command for </span><span class="ss">`dired-do-compress-to&#39;</span><span class="s">.</span>

<span class="s">Each element is (REGEXP . CMD), where REGEXP is the name of the</span>
<span class="s">archive to which you want to compress, and CMD the the</span>
<span class="s">corresponding command.</span>

<span class="s">Within CMD, %i denotes the input file(s), and %o denotes the</span>
<span class="s">output file. %i path(s) are relative, while %o is absolute.&quot;</span><span class="p">)</span>
</code></pre></div>
<p>This thing is pretty self-explanatory. It currently only supports
<code>*.tar.gz</code> and <code>*.zip</code>, use <kbd>M-x</kbd> <code>report-emacs-bug</code> if you
want to add more options.</p>

<h2 id="other-improvements-in-compression-decompression">Other improvements in compression/decompression</h2>

<p>I improved the good-old <kbd>Z</kbd> (<code>dired-do-compress</code>) as
well. Now it can compress directories to <code>*.tar.gz</code>, as well as
decompress <code>*.tar.gz</code> and <code>*.zip</code> to directories.  It&#39;s all automatic,
you only have to press <kbd>Z</kbd>, either on an archive to
decompress, or on a directory to compress.</p>

<h2 id="easy-way-to-have-a-bleeding-edge-emacs">Easy way to have a bleeding edge Emacs</h2>

<p>If you want to get these improvements right now and are on a Debian
type system (I use Ubuntu), you can use:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>sudo apt-add-repository ppa:ubuntu-elisp/ppa
sudo apt-get update
sudo apt-get install emacs-snapshot
</code></pre></div>
<p>Then just use <code>emacs-snapshot</code> executable. It updates every few days.</p>

<p>Myself, I track the Emacs master from
<a href="http://savannah.gnu.org/projects/emacs">git</a>. But <code>emacs-snapshot</code> is
very useful for CI tests, and can also be used by people who don&#39;t
want to build the executable from git.</p>

<h2 id="how-to-get-your-improvements-into-emacs">How to get your improvements into Emacs</h2>

<p>If you&#39;d like to contribute code to the Emacs core yourself, it takes
two steps:</p>

<ol>
<li><p>Sign the Copyright Assignment
(<a href="http://orgmode.org/w/org-mode.git?p=org-mode.git;a=blob_plain;f=request-assign-future.txt;hb=HEAD">CA</a>).
This gives the Copyright for your changes to Emacs to the Free
Software Foundation. This is useful so that the FSF can defend your
rights in court, in case the GPL regarding your contribution is broken
by someone.</p></li>
<li><p><kbd>M-x</kbd> <code>report-emacs-bug</code> and attach a patch.</p></li>
</ol>

<p>It seems that some people could have a moral objection to the CA. I
see no reason for it whatsoever.  Since Elisp libraries make calls to
GPL code and are GPL themselves, you have to publish Elisp code under
GPL, there&#39;s no choice there.  GPL means basically that, while you&#39;re
still acknowledged as the author, everyone else has about as much
right to your code as you do. No one can hide or restrict access to
it, but neither can you. The CA is a further step, which makes the FSF
own the Copyright to your <em>changes</em> to Emacs. You submit these changes
yourself, and the Copyright over these changes isn&#39;t really that
useful: they&#39;re only changes - they do nothing on their own, outside
of Emacs. Besides, with the FSF owning the Copyright, the range of
things that you can do to your code stays exactly the same as if you
owned the Copyright, as long as you publish under GPL.</p>

<p>To illustrate, the FSF CA is very polite and benign, compared to the
CA that I have to give to Elsevier when I publish an article.  That CA
means that a multi-billion dollar corporation owns the right to my
paper until the end of time, and can charge people to view it
(including myself and my peers) as much as they see fit (currently,
$30). Of course, I don&#39;t receive a dime of that money, but hey - I get
published, and at least I can share my article <em>for free</em> for the
first 50 days of the publish date. And if that one doesn&#39;t seem
draconian enough for you, just think of the NDAs in commercial
companies: out there, you can&#39;t even publish or mention anything
related to your work. So please, if you&#39;re hating on the FSF, do
reconsider, they&#39;re the good guys in my book.</p>

<p>Eventually, after a few submitted patches, you&#39;ll be granted commit
access. This is a great way to implement small improvements faster.
However, the larger issues that aren&#39;t simple improvements still need
to be discussed with other developers, either on debbugs or on
emacs-devel. For example, initially I went with the <code>tar -czf</code>
command. But it turns out that it can&#39;t be used on Solaris 10 or AIX
7.1. Whatever those things are, people still use Emacs on them, and
it&#39;s important that the core features are usable on all supported
systems.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/10/14/swiper-mc/">
        A simple multiple-cursors extension to swiper
      </a>
    </h1>

    <span class="post-date">14 Oct 2015</span>

    <p>When using Emacs, it happens sometimes that I accumulate too many
buffers. The usual next action is to close the buffers for the project
that I&#39;m not currently working on. Previously, I marked those buffers
in <code>*Buffer List*</code> by hand with <kbd>d</kbd> and
<kbd>C-n</kbd>. Today, I&#39;ll show a faster way.</p>

<p>It&#39;s very easy to select these buffers in <code>*Buffer List*</code> with
<a href="https://github.com/abo-abo/swiper">swiper</a>: just type a part the
shared directory name. Another example is to select all <code>dired</code>
buffers: a &quot;dired by&quot; input will usually match all of them, since they
all have <code>Dired by name</code> in their line.</p>

<p>Afterwards, I want to open
<a href="https://github.com/magnars/multiple-cursors.el">multiple-cursors</a> for
each matched line. I&#39;ve bound this action to <kbd>C-7</kbd>. Here&#39;s
the very simple code:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">swiper-mc</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;multiple-cursors</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;multiple-cursors isn&#39;t installed&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">cands</span> <span class="p">(</span><span class="nf">nreverse</span> <span class="nv">ivy--old-cands</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">string=</span> <span class="nv">ivy-text</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">ivy-set-action</span>
       <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">_</span><span class="p">)</span>
         <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">cand</span><span class="p">)</span>
           <span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">cand</span> <span class="p">(</span><span class="nb">pop</span> <span class="nv">cands</span><span class="p">))</span>
             <span class="p">(</span><span class="nv">swiper--action</span> <span class="nv">cand</span><span class="p">)</span>
             <span class="p">(</span><span class="nb">when</span> <span class="nv">cands</span>
               <span class="p">(</span><span class="nv">mc/create-fake-cursor-at-point</span><span class="p">))))</span>
         <span class="p">(</span><span class="nv">mc/maybe-multiple-cursors-mode</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-exit</span> <span class="ss">&#39;done</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">exit-minibuffer</span><span class="p">))))</span>
</code></pre></div>
<p>After <kbd>C-7</kbd>, here&#39;s the sequence to delete the selected buffers:</p>

<ul>
<li><kbd>d</kbd> (<code>Buffer-menu-delete</code>) to mark each item for deletion.</li>
<li><kbd>C-g</kbd> (<code>keyboard-quit</code>) to exit <code>multiple-cursors</code>.</li>
<li><kbd>x</kbd> (<code>Buffer-menu-execute</code>) to execute the deletions.</li>
</ul>

<p>And that&#39;s it: all selected buffers are now deleted.  To summarize,
<kbd>C-s</kbd> <code>dired by</code> <kbd>C-7 d C-g x</kbd> will close all
<code>dired</code> buffers from your <code>*Buffer List*</code>.</p>

<p>Other interesting applications are also possible, like mass renames in
<code>wdired</code>, or un-commenting everything in a function.  For example,
suppose that you have this code:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">progn</span>
  <span class="c1">;; (check-1)</span>
  <span class="p">(</span><span class="nv">foo</span><span class="p">)</span>
  <span class="c1">;; (check-2)</span>
  <span class="p">(</span><span class="nv">bar</span><span class="p">)</span>
  <span class="c1">;; (check-3)</span>
  <span class="p">(</span><span class="nv">baz</span><span class="p">))</span>
</code></pre></div>
<p>If it&#39;s a part of a larger buffer, you can narrow with <kbd>C-x nd</kbd> (<code>narrow-to-defun</code>)
or <kbd>C-x nn</kbd> (<code>narrow-to-region</code>).  Then <kbd>C-s ;; C-7 DEL DEL C-d C-g</kbd> to
remove all comments.</p>

<p>I have to say that the functionality intersects a bit with
<code>mc/mark-all-like-this</code>. Except you know the result ahead of time
(number and position of matches), and you can use a regex instead of a
literal string.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/10/02/swiper-visual-line/">
        Swiper and visual-line-mode
      </a>
    </h1>

    <span class="post-date">02 Oct 2015</span>

    <p>In case you encounter files with very long lines, the built-in
<kbd>M-x</kbd> <code>visual-line-mode</code> might come in handy.  Although 1MB
long one-line files are a disaster for Emacs, there&#39;s no problem
handling smaller files with long lines that result from bad markdown
renderers (notably Github).  They way <code>visual-line-mode</code> works, is it
inserts virtual newlines in appropriate positions, so that no line is
truncated.  The advantage is that these newlines aren&#39;t written to the
file when the buffer is saved (otherwise, a simple <kbd>M-q</kbd>
(<code>fill-paragraph</code>) would work too).</p>

<p>Today I&#39;ve added <code>visual-line-mode</code> support to
<a href="https://github.com/abo-abo/swiper">swiper</a>, so handling these files
should be even easier now. The change was surprisingly simple: just
two checks for <code>visual-line-mode</code> variable and these basic
replacements:</p>

<ul>
<li><code>forward-line</code> -&gt; <code>line-move</code>,</li>
<li><code>line-beginning-position</code> -&gt; <code>beginning-of-visual-line</code>,</li>
<li><code>line-end-position</code> -&gt; <code>end-of-visual-line</code>.</li>
</ul>

<p>By the way, <code>visual-line-mode</code> is one of the small number of commands
that I call by name instead of by key chord. But thanks to
<code>counsel-M-x</code> and <code>smex</code> calling this command by name is as short as
<kbd>C-t v RET</kbd>.  To explain a bit more, here&#39;s my setup:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="c1">;; make sure to install smex</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-t&quot;</span><span class="p">)</span> <span class="ss">&#39;counsel-M-x</span><span class="p">)</span>
</code></pre></div>
<p>The default command bound to <kbd>C-t</kbd> is <code>transpose-chars</code> - a
highly situational and ultimately counter-productive command
(<kbd>M-DEL</kbd> and re-typing the word is faster than surgically
navigating to the transpose point and calling <code>transpose-chars</code>, plus
it trains the hands to type the word correctly next time).  Anyway,
<kbd>C-t</kbd> is a prime binding for launching interactive commands.
And since <code>smex</code> is installed it remembers that my most used command
that starts with &quot;v&quot; is <code>visual-line-mode</code> - so it&#39;s the first one
that gets selected after <kbd>C-t v</kbd>. This means that I can just
press <kbd>RET</kbd> and be done with it.</p>

<p><img src="/download/swiper-visual-line-mode.png" alt="swiper-visual-line-mode.png"></p>

<p>Finally, related to <code>visual-line-mode</code>, here&#39;s a command I use to
negate <kbd>M-q</kbd> (<code>fill-paragraph</code>) (<a href="http://www.emacswiki.org/emacs/UnfillParagraph">source</a>):</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-M-q&quot;</span><span class="p">)</span> <span class="ss">&#39;ora-unfill-paragraph</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">ora-unfill-paragraph</span> <span class="p">()</span>
  <span class="s">&quot;Transform a paragraph into a single line.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">fill-column</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">fill-paragraph</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)))</span>
</code></pre></div>
<p>Thanks to <a href="https://github.com/joostkremers">@joostkremers</a> for the
suggestion in <a href="https://github.com/abo-abo/swiper/issues/227">#227</a>.</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page9">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page7">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
