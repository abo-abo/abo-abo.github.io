<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (or emacs &middot; irrelevant)
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://licensebuttons.net/l/by-sa/4.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/05/13/ace-window-0.9.0/">
        ace-window 0.9.0 is out
      </a>
    </h1>

    <span class="post-date">13 May 2015</span>

    <p><img src="https://cloud.githubusercontent.com/assets/390964/7583437/86180fa6-f895-11e4-80ef-c24a7bdf9bf6.png" alt="ace-window-keys.png"></p>

<p>I kind of forgot to tag the <code>0.8.0</code> release on Github, so it&#39;s been a
whole 3 months since the last release. In this post, I&#39;ll only
describe the newest exciting feature in more detail, see
<a href="http://oremacs.com/archive/">the archive</a> for
<a href="http://oremacs.com/2015/02/27/ace-window-leading-char/">older</a>
<a href="http://oremacs.com/2015/03/02/ace-window-without-ace/">posts</a>
<a href="http://oremacs.com/2015/03/03/ace-window-full-path/">on</a>
<a href="http://oremacs.com/2015/03/06/ace-window-toggle/">ace</a>
<a href="http://oremacs.com/2015/03/12/ace-window-display-mode/">window</a>.</p>

<h2 id="new-features">New Features</h2>

<h3 id="display-the-window-decision-chars-in-the-mode-line">Display the window decision chars in the mode line</h3>

<p>Enable <code>ace-window-display-mode</code> for this. This gives you the
advantage of always being aware which window corresponds to which
char.</p>

<h3 id="new-defcustom:-aw-ignore-current">New defcustom: <code>aw-ignore-current</code></h3>

<p>This is off by default. When t, <code>ace-window</code> will ignore
<code>selected-window</code>.</p>

<h3 id="allow-to-switch-the-window-action-midway">Allow to switch the window action midway</h3>

<p>Ace-window has many commands available, like:</p>

<ul>
<li><code>ace-select-window</code></li>
<li><code>ace-delete-window</code></li>
<li><code>ace-swap-window</code></li>
<li>...</li>
</ul>

<p>But did you wish sometimes when you called <code>ace-select-window</code> that
you should have called <code>ace-delete-window</code>? In the old way, you would
cancel <code>ace-select-window</code> with <kbd>C-g</kbd> and call
<code>ace-delete-window</code>.</p>

<p>With the new way, you can, just press <kbd>x</kbd> followed by the
decision char.  All keys are customizable through <code>aw-dispatch-alist</code>.</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">defvar</span> <span class="nv">aw-dispatch-alist</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="nv">?x</span> <span class="nv">aw-delete-window</span> <span class="s">&quot; Ace - Delete Window&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">?m</span> <span class="nv">aw-swap-window</span> <span class="s">&quot; Ace - Swap Window&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">?n</span> <span class="nv">aw-flip-window</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">?v</span> <span class="nv">aw-split-window-vert</span> <span class="s">&quot; Ace - Split Vert Window&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">?b</span> <span class="nv">aw-split-window-horz</span> <span class="s">&quot; Ace - Split Horz Window&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">?i</span> <span class="nv">delete-other-windows</span> <span class="s">&quot; Ace - Maximize Window&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">?o</span> <span class="nv">delete-other-windows</span><span class="p">))</span>
  <span class="s">&quot;List of actions for `aw-dispatch-default&#39;.&quot;</span><span class="p">)</span>
</code></pre></div>
<p>The strings beside each command are important: they are used to update
the mode line when you press a char. They also mean that a window
should be selected using <code>aw-keys</code> for the corresponding command. If
there&#39;s no string, the command is just called straight away, with no
arguments.  To reiterate, for each entry without a string, its command
will be called immediately, and for others the window will be selected
first.</p>

<p>Also, take note of <code>aw-flip-window</code>. Suppose the you have a lot (say
7) windows, but you only want to cycle between the most recent
two. You can do so with <kbd>n</kbd>, with no need to press the
decision char.</p>

<p>I call this feature &quot;the dispatch&quot;. The dispatch normally happens when:</p>

<ol>
<li>you&#39;re prompted for <code>aw-keys</code></li>
<li>you press a char that isn&#39;t in <code>aw-keys</code></li>
<li>there&#39;s an entry in <code>aw-dispatch-alist</code> for this char</li>
</ol>

<p>If you want to skip step 1 always (since, by default, you&#39;re not
prompted for <code>aw-keys</code> when you have 2 or less windows), use:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">aw-dispatch-always</span> <span class="no">t</span><span class="p">)</span>
</code></pre></div>
<p>Be careful though, setting this means that you&#39;ll always have to
select a window with <code>aw-keys</code>, even if there are only two. This is a
large toll on the muscle memory. On the other hand, even with one
window, assuming you&#39;ve bound <code>ace-window</code> to <kbd>M-p</kbd>, you get:</p>

<ul>
<li><code>split-window-vertically</code> on <kbd>M-p v</kbd></li>
<li><code>split-window-horizontally</code> on <kbd>M-p b</kbd></li>
<li><code>delete-other-windows</code> on <kbd>M-p o</kbd></li>
</ul>

<p>What&#39;s also nice is that these commands scale with the amount of
windows: if you have only one window, you get no prompt for <kbd>M-p
v</kbd>, so it acts just like <kbd>C-x 2</kbd>. But if you have more
windows, you don&#39;t have to select the window that you want to split
beforehand: you can select it after you decided to issue a split
operation.</p>

<p>See <a href="https://github.com/abo-abo/ace-window/wiki">the wiki</a> for a nice
customization setup by <a href="https://github.com/joedicastro">@joedicastro</a>.</p>

<h2 id="outro">Outro</h2>

<p>Give the new feature a try. The jump in utility between the new and
old <code>ace-window</code>, I feel, is of the same magnitude as the jump between
<code>other-window</code> and <code>ace-window</code>. However, it doesn&#39;t come for free and
the muscle memory needs to be readjusted slightly.</p>

<p>Big thanks to all who contributed, especially to <a href="https://github.com/joedicastro">@joedicastro</a>.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/05/08/avy-0.1.0/">
        New on MELPA - avy
      </a>
    </h1>

    <span class="post-date">08 May 2015</span>

    <p>This package contains the library on which <a href="https://github.com/abo-abo/ace-window">ace-window</a> and
<a href="https://github.com/abo-abo/ace-link">ace-link</a> now depend, as well as a multitude of navigation
commands.</p>

<p><img src="https://raw.githubusercontent.com/wiki/abo-abo/avy-jump/images/avy-avatar-1.png" alt="logo.png"></p>

<h2 id="intro">Intro</h2>

<p>Yes, they used to depend on <a href="https://github.com/winterTTr/ace-jump-mode">ace-jump-mode</a>, hence the
<code>ace</code> in their names, but as I added features to my packages over time, it became harder to compose
features because of <code>ace-jump-mode</code> inflexibility.</p>

<p>Don&#39;t get me wrong, <code>ace-jump-mode</code> is a fine standalone package, and if you&#39;re using it only for
jumping to chars, there are few reasons for you to make the switch. However, if you&#39;re interested in
the new and juicy features, such as: </p>

<ul>
<li>jumping to word starts</li>
<li>jumping to sub-word starts</li>
<li>jumping to line beginnings or endings</li>
<li>copying and moving lines</li>
</ul>

<p>with most of the features coming in <code>-0</code>, <code>-1</code>, or <code>-2</code> flavor, or if you&#39;re interested in building
an <code>ace-jump-mode</code>-based package, then you should consider <a href="https://github.com/abo-abo/avy">avy</a>.</p>

<h2 id="the-leading-chars-flavor">The leading chars flavor</h2>

<p>All of the commands provided are about jumping to visible characters, and possibly doing some stuff.
Since usually there are a lot of these visible characters, it&#39;s advantageous to first narrow them
somewhat. So each command can be divided into two phases: the narrowing phase and the decision phase.</p>

<p>There are 3 variations of the narrowing phase:</p>

<ul>
<li><p>The <code>-0</code> flavor, e.g. <code>avy-goto-word-0</code> or <code>avy-goto-line</code> doesn&#39;t narrow at all. The advantage
that there&#39;s minimum context switching (no narrowing phase, only decision phase). The disadvantage
is that the number of candidates in the decision phase can be quite large.</p></li>
<li><p>The <code>-1</code> flavor, e.g. <code>avy-goto-word-1</code> or <code>avy-goto-char</code> narrows by the first character of the
thing.  The disadvantage is the context switch: first you call the command, then you switch context
to scan and input the leading char, then you switch context to scan and input the decision chars.
The advantage is less candidates in the decision phase.</p></li>
<li><p>The <code>-2</code> flavor is my favorite <code>avy-goto-char-2</code>: it reads <strong>two</strong> consecutive chars, instead of
just one.  This doesn&#39;t impact the narrowing phase too much, since inputting two consecutive chars
isn&#39;t much more than just one.  But it greatly decreases the number of candidates in the decision
phase. The small amount of candidates allows me to use this setting for the decision:</p></li>
</ul>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">avy-keys</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">?a</span> <span class="nv">?s</span> <span class="nv">?d</span> <span class="nv">?f</span> <span class="nv">?g</span> <span class="nv">?h</span> <span class="nv">?j</span> <span class="nv">?k</span> <span class="nv">?l</span><span class="p">))</span>
</code></pre></div>
<p>That&#39;s only 9 decision chars, all of them on the home row.</p>

<h2 id="the-decision-char-overlay-flavors">The decision char overlay flavors</h2>

<p>Once again, there are three, here are their corresponding <code>defcustom</code>s:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defcustom</span> <span class="nv">avy-goto-char-style</span> <span class="ss">&#39;pre</span>
  <span class="s">&quot;Method of displaying the overlays for `avy-goto-char&#39; and `avy-goto-char-2&#39;.&quot;</span>
  <span class="nb">:type</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">choice</span>
          <span class="p">(</span><span class="nv">const</span> <span class="nb">:tag</span> <span class="s">&quot;Pre&quot;</span> <span class="nv">pre</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">const</span> <span class="nb">:tag</span> <span class="s">&quot;At&quot;</span> <span class="nv">at</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">const</span> <span class="nb">:tag</span> <span class="s">&quot;Post&quot;</span> <span class="nv">post</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defcustom</span> <span class="nv">avy-goto-word-style</span> <span class="ss">&#39;pre</span>
  <span class="s">&quot;Method of displaying the overlays for `avy-goto-word-0&#39; and `avy-goto-word-0&#39;.&quot;</span>
  <span class="nb">:type</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">choice</span>
          <span class="p">(</span><span class="nv">const</span> <span class="nb">:tag</span> <span class="s">&quot;Pre&quot;</span> <span class="nv">pre</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">const</span> <span class="nb">:tag</span> <span class="s">&quot;At&quot;</span> <span class="nv">at</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">const</span> <span class="nb">:tag</span> <span class="s">&quot;Post&quot;</span> <span class="nv">post</span><span class="p">)))</span>
</code></pre></div>
<p>If you&#39;re used to <code>ace-jump-mode</code>, the corresponding style is <code>at</code>, which displays the overlay at
the target position, one character at a time.  I don&#39;t like this style most of the time, I prefer
<code>pre</code> which is more similar to <code>vim-easymotion</code>: it will display the full char path at once, before
the target position. This results in less feedback and more efficiency, in my opinion.</p>

<h2 id="outro">Outro</h2>

<p>Give the new package a try, it&#39;s already been pretty active the last few days, with bugs being fixed
and new features appearing, thanks to all who contributed.</p>

<p>If you want to see some screenshots, there are plenty at the
<a href="https://github.com/abo-abo/avy">repository page</a>, and also in an earlier
<a href="http://oremacs.com/2015/03/03/ace-window-full-path/">post</a>.</p>

<p>Finally, the package in on <a href="http://melpa.org/#/avy">MELPA</a>, so it&#39;s convenient to install.  The only hassle is to decide where to bind all these commands.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/05/02/swiper-0.4.0/">
        Ivy-mode 0.4.0 is out
      </a>
    </h1>

    <span class="post-date">02 May 2015</span>

    <p>This is a feature-packed release with a lot of cool things like:</p>

<ul>
<li>Partial completion on <kbd>TAB</kbd></li>
<li>Resume the last completion session with <code>ivy-resume</code></li>
<li>Multi-tier regex matching</li>
</ul>

<p>The detailed release notes follow.</p>

<h2 id="fixes">Fixes</h2>

<h3 id="glob-expansion-in-rgrep">Glob expansion in <code>rgrep</code></h3>

<p>While completing file names, ivy expands the file name to
full. Unfortunately, <code>rgrep</code> uses <code>read-file-name-internal</code> and isn&#39;t
receptive to globs being expanded with the current directory.  A
work-around this is to use the generic strategy when ivy is in
trouble:</p>

<ul>
<li>enter the input text as if there was no completion.</li>
<li>exit with <kbd>C-u C-j</kbd> (forwards to <code>ivy-immediate-done</code>).</li>
</ul>

<p><code>ivy-immediate-done</code> is currently unbound by default. If you want, you
can bind it in your config like this:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">ivy-minibuffer-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c C-d&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-immediate-done</span><span class="p">)</span>
</code></pre></div>
<h3 id="exclude-a-couple-more-modes-from-font-lock">Exclude a couple more modes from font-lock</h3>

<p>This time, they are <code>jabber-chat-mode</code> and <code>elfeed-search-mode</code>.</p>

<h3 id="fix-a-flag-in-swiper-query-replace">Fix a flag in <code>swiper-query-replace</code></h3>

<p>You can launch a query replace with <kbd>M-q</kbd> from swiper.</p>

<h3 id="avoid-sorting-org-refile-candidates">Avoid sorting <code>org-refile</code> candidates</h3>

<p>By default, ivy completion candidates are sorted with
<code>string-lessp</code>. The sorting can be customized with
<code>ivy-sort-functions-alist</code>. While refiling, the natural order is
actually best, so the sorting is turned off in that case.</p>

<h3 id="reset-to-the-first-candidate-when-switching-directories">Reset to the first candidate when switching directories</h3>

<p>With <code>ivy-mode</code> you can select a file anywhere on your file system by
switching directories repeatedly with <kbd>C-j</kbd>
(<code>ivy-alt-done</code>). After moving to a new directory, the point should be
on the first candidate.</p>

<h3 id="fixup-the-face-order">Fixup the face order</h3>

<p>All this time there was an issue with the face order swapping between
1 and 2 groups.  This is now fixed.  Also, I&#39;ve made
<code>swiper-match-face-4</code> inherit from <code>isearch-fail</code>. It&#39;s important to
have all 4 faces be different.</p>

<h3 id="don&#39;t-error-on-bad-regex">Don&#39;t error on bad regex</h3>

<p>When the current input is a bad regex, just display no candidates and
continue. Don&#39;t throw an error.</p>

<h2 id="new-features">New Features</h2>

<h3 id="use-//-instead-of-/-to-move-to-root">Use <kbd>//</kbd> instead of <kbd>/</kbd> to move to root</h3>

<p>While completing file names, you can enter <kbd>//</kbd> to move to
the root directory.  This change was necessary in order to make it
possible to enter e.g. <code>/sudo:</code> or <code>/ssh:</code>.</p>

<h3 id="host-completion-for-/sudo:-and-/ssh:">Host completion for <code>/sudo:</code> and <code>/ssh:</code></h3>

<p>This feature is a bit flaky for now. But it works well on my
machine. It should get better after a few bug reports. You can start
the completion right after the method, e.g. <code>/ssh:</code> <kbd>RET</kbd>, or
after method+user, e.g. <code>/ssh:oleh@</code> <kbd>RET</kbd>.</p>

<h3 id="respect-confirm-nonexistent-file-or-buffer">Respect <code>confirm-nonexistent-file-or-buffer</code></h3>

<p>If you set <code>confirm-nonexistent-file-or-buffer</code> to t (it&#39;s nil by
default), you&#39;ll have to confirm when you create a new file or buffer
with ivy.</p>

<p><img src="https://raw.githubusercontent.com/wiki/abo-abo/swiper/images/ivy-confirm.png" alt="confirm.png"></p>

<h3 id="highlight-remote-buffers-with-ivy-remote-face">Highlight remote buffers with <code>ivy-remote</code> face</h3>

<p>Just some extra polish to make things look nicer. The buffers to which
you&#39;re connected through TRAMP will be highlighted with the new
<code>ivy-remote</code> face.</p>

<h3 id="change-the-prompt-for-match-required-interactions">Change the prompt for <code>match-required</code> interactions</h3>

<p>Sometimes, the Emacs functions that call completion specify to it that
a match is required, i.e. you can&#39;t just type in some random stuff -
you have to select one of the candidates given to you.  In that case
ivy will appropriately change the prompt like this:</p>

<p><img src="https://raw.githubusercontent.com/wiki/abo-abo/swiper/images/ivy-match-required.png" alt="match-required.png"></p>

<h3 id="improve-the-candidate-selection-while-using-history">Improve the candidate selection while using history</h3>

<p>While completing, you press <kbd>M-p</kbd> to select the previous
input. This update tries to select not just the first candidates that
matches, but the actual previous candidate that you selected before.</p>

<h3 id="use-alpha-compositing-to-add-ivy-current-match-face">Use alpha compositing to add <code>ivy-current-match-face</code></h3>

<p>This is only relevant for when the completion candidates have custom
face backgrounds. But in that case, the minibuffer looks a lot nicer.</p>

<h3 id="add-partial-completion">Add partial completion</h3>

<p>Press <kbd>TAB</kbd> to do call <code>ivy-partial-or-done</code> to complete the
current thing to the largest possible prefix. When called twice in a
row, it&#39;s the same as <kbd>C-j</kbd>, i.e. it will finish the
completion.</p>

<h3 id="improve-completion-of-hidden-buffers">Improve completion of hidden buffers</h3>

<p>In Emacs, hidden buffer names start with a space. To see them all,
press a single space while completing buffers in <code>ivy-mode</code>. You can
toggle between hidden and non-hidden buffers by editing the first
space in your input query. Remember that with <code>ivy-mode</code> the
minibuffer is a proper editable area, so <kbd>C-a</kbd> works properly
(unlike in <code>isearch</code> or <code>ido-mode</code>).</p>

<h3 id="allow-to-quote-spaces-while-matching">Allow to quote spaces while matching</h3>

<p>Spaces are wild while matching - they serve as group
boundaries. However, sometimes it would be useful to quote them. From
now on, you can quote <code>N</code> consecutive spaces by inputting <code>N+1</code>
consecutive spaces.</p>

<h2 id="add-multi-tier-regex-matching">Add multi-tier regex matching</h2>

<p>This is actually a really cool feature, so if you&#39;re paying attention
to any section, let it be this one.</p>

<h3 id="user-side">User side</h3>

<p>For example, I cloned
<a href="https://github.com/boostorg/boost/tree/boost-1.58.0">boost-1.58.0</a>
and called <code>counsel-git</code>, which is like a <code>find-file</code> for all files in
a git repository at once.</p>

<ul>
<li>Initially, it gives 45919 candidate files.</li>
<li>With input &quot;utility&quot;, there are 234 candidates.</li>
<li>With input &quot;utility hpp&quot;, there are 139 candidates.</li>
</ul>

<p>Now, the interesting part. If I want to exclude anything with &quot;hpp&quot; in
it, I change the input to &quot;utility !hpp&quot; (with <kbd>M-b !</kbd>) to
get 95 candidates (95=234-139, it checks out).  I could exclude some
more:</p>

<ul>
<li>with input &quot;utility !hpp cpp&quot; there are 57 candidates.</li>
<li>with input &quot;utility !hpp cpp ipp&quot; there are 46 candidates.</li>
<li>I can unify the regex to &quot;utility ![hic]pp&quot; and also get 46 candidates.</li>
<li>exclude htm with &quot;utility ![hic]pp htm&quot; to get only 17 candidates.</li>
</ul>

<p>You can use this strategy anywhere, not just for git file. For example, in <code>describe-function</code> or <code>swiper</code>.</p>

<h3 id="elisp-side">Elisp side</h3>

<p>You can customize <code>ivy-re-builders-alist</code> to make <code>ivy-mode</code> complete
in the way that you like.  The alist dispatches on the collection
type, so you can have one completion strategy for buffers, another for
files and still another for everything else.</p>

<p>Each function on the alist should turn the string input into a string
regex. So the simplest one would be <code>regexp-quote</code>. If you want to use
multi-tier matching, the function should instead return a list of
regexps of two types:</p>

<ul>
<li>the ones that should match (will be joined by <code>and</code>).</li>
<li>the ones that should not match (will be joined by <code>or</code>).</li>
</ul>

<h2 id="add-ivy-resume">Add <code>ivy-resume</code></h2>

<p>This feature is still a bit of a work-in-progress. But it allows you
to resume the last completion to the point before you entered
<kbd>RET</kbd> or <kbd>C-g</kbd> etc.  It only works for features that
specifically passed <code>:action</code> to <code>ivy-read</code>.  You could resume other
features, but nothing would be done when you select the candidate,
since <code>ivy-completing-read</code> has no idea what the function that called
it was going to do with the result.</p>

<p>Currently, you can resume:</p>

<ul>
<li><code>counsel-describe-variable</code></li>
<li><code>counsel-describe-function</code></li>
<li><code>lispy-goto</code></li>
<li><code>swiper</code></li>
</ul>

<p>Here&#39;s how I&#39;ve bound it in my config:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c C-r&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-resume</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="nv">[f6]</span> <span class="ss">&#39;ivy-resume</span><span class="p">)</span>
</code></pre></div>
<p>The <code>ivy-resume</code> feature adds <code>occur</code>-like functionality to <code>swiper</code>.
Calling <code>ivy-resume</code> is like switching to the <code>*Occur*</code> buffer.</p>

<h2 id="outro">Outro</h2>

<p>Big thanks to all who contributed, especially
<a href="https://github.com/tsdh">@tsdh</a> and
<a href="https://github.com/zhaojiangbin">@zhaojiangbin</a>.</p>

<p>If you&#39;re considering to switch from <code>ido-mode</code> to <code>ivy-mode</code>, now is
a good time, since the most glaring gaps have now been filled. You can
find some up-to-date info on the
<a href="https://github.com/abo-abo/swiper/wiki">swiper wiki</a>. I switched the
page syntax from markdown to org-mode, but Github makes the headings
way to big. So it might be easier to clone the wiki and view the org
files in Emacs:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">git clone https://github.com/abo-abo/swiper.wiki.git
</code></pre></div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/04/30/gcc-macros-auto-yasnippet/">
        GCC macros and auto-yasnippet
      </a>
    </h1>

    <span class="post-date">30 Apr 2015</span>

    <p>As one thing leads to another, it occurred to me that I didn&#39;t know
what <code>__GNUC__</code> macro does.  Which brought me to the manual page on
<a href="https://gcc.gnu.org/onlinedocs/cpp/Common-Predefined-Macros.html">Common Predefined Macros</a>.</p>

<h2 id="using-org-mode-babel-to-check-the-macro-values">Using <code>org-mode</code> Babel to check the macro values</h2>

<p>I decided that just skimming through the page wasn&#39;t enough, and I
wanted to brush up on my <code>org-mode</code> babel.  So I created this
<a href="https://raw.githubusercontent.com/abo-abo/oremacs/github/etc/org/wiki/C.org">wiki page</a>
to which you&#39;re welcome if you ever need to check <code>__BYTE_ORDER_</code> or
<code>__UINT_FAST16_TYPE__</code> on your system.</p>

<p>Here&#39;s a small excerpt of it:</p>
<div class="highlight"><pre><code class="language-C" data-lang="C"><span class="cp">#+begin_src C :results verbatim</span>
<span class="cp">#include &lt;stdio.h&gt;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// version stuff</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;__GNUC__ %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__GNUC__</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;__GNUC_MINOR__ %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__GNUC_MINOR__</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;__GNUC_PATCHLEVEL__ %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__GNUC_PATCHLEVEL__</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;__VERSION__ %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__VERSION__</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#+end_src</span>
</code></pre></div>
<p>When you navigate to any place in the code and press <kbd>C-c C-c</kbd>, which calls (sic) <code>org-ctrl-c-ctrl-c</code>,
it will re-compile and re-run your program.</p>

<p>I list here some of the <a href="https://github.com/abo-abo/oremacs/blob/github/oleh/modes/ora-org.el">config</a> to make it all work:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">org-babel-do-load-languages</span>
 <span class="ss">&#39;org-babel-load-languages</span>
 <span class="o">&#39;</span><span class="p">((</span><span class="nv">C</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
   <span class="c1">;; ...</span>
   <span class="p">))</span>

<span class="p">(</span><span class="k">setq</span> <span class="nv">org-babel-C-compiler</span> <span class="s">&quot;gcc -std=c99&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="new-auto-yasnippet-method">New <code>auto-yasnippet</code> method</h2>

<p>You can read up on what <code>auto-yasnippet</code> is in <a href="http://oremacs.com/2015/01/30/auto-yasnippet/">this post</a>.
For the wiki page, I had to insert the <code>printf</code> statements a bunch of times, some of them with triply-repeated symbols.
Take, for instance, this statement:</p>
<div class="highlight"><pre><code class="language-C" data-lang="C"><span class="n">printf</span><span class="p">(</span><span class="s">&quot;__INT32_TYPE__ %s (%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ESTR</span><span class="p">(</span><span class="n">__INT32_TYPE__</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">__INT32_TYPE__</span><span class="p">));</span>
</code></pre></div>
<p>With the old method, I would insert <code>~</code> before each <code>INT32</code> and call <code>aya-create</code>. But it would result in this snippet, which isn&#39;t optimal:</p>
<div class="highlight"><pre><code class="language-C" data-lang="C"><span class="n">printf</span><span class="p">(</span><span class="s">&quot;__$1 %s (%d)</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">,</span> <span class="n">ESTR</span><span class="p">(</span><span class="n">__</span><span class="err">$</span><span class="mi">1</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">__</span><span class="err">$</span><span class="mi">1</span><span class="p">));</span>
</code></pre></div>
<p>With the new method (the old one still works, it&#39;s just that the new one takes priority), I would only quote the first field like so:</p>
<div class="highlight"><pre><code class="language-C" data-lang="C"><span class="n">printf</span><span class="p">(</span><span class="s">&quot;__`INT32&#39;_TYPE__ %s (%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ESTR</span><span class="p">(</span><span class="n">__INT32_TYPE__</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">__INT32_TYPE__</span><span class="p">));</span>
</code></pre></div>
<p>Which results in this snippet:</p>
<div class="highlight"><pre><code class="language-C" data-lang="C"><span class="n">printf</span><span class="p">(</span><span class="s">&quot;__$1_TYPE__ %s (%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ESTR</span><span class="p">(</span><span class="n">__</span><span class="err">$</span><span class="mi">1</span><span class="n">_TYPE__</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">__</span><span class="err">$</span><span class="mi">1</span><span class="n">_TYPE__</span><span class="p">));</span>
</code></pre></div>
<p>Much better.</p>

<h2 id="oremacs-wiki-workflow"><code>oremacs</code> wiki workflow</h2>

<p>If you&#39;re crazy enough (in a good way) to follow <a href="https://github.com/abo-abo/oremacs">oremacs</a>, you&#39;ll get the
new wiki page delivered right to your config with</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">make install
</code></pre></div>
<p>which will also update to the latest <code>org-mode</code> and CEDET.</p>

<p>And here&#39;s how to access it:</p>

<ul>
<li>run <code>xmodmap etc/.Xmodmap</code> to make <kbd>;</kbd> into a modifier</li>
<li>press <kbd>;-k</kbd> to open a dispatch hydra</li>
<li>press <kbd>w</kbd> to select the wiki</li>
<li>select <code>C</code> (currently, the only other candidate is <code>git</code>)</li>
</ul>

<h2 id="outro">Outro</h2>

<p>Check out the new <code>auto-yasnippet</code> method, I think it&#39;s pretty
efficient.  I hope that you&#39;ll find the wiki page useful in your C
pursuits.  And a big thanks to Eric Schulte for <code>org-babel</code>.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/04/28/blending-faces/">
        Blending colors in Elisp
      </a>
    </h1>

    <span class="post-date">28 Apr 2015</span>

    <h2 id="intro">Intro</h2>

<p>This is a slightly obscure feature that I&#39;ve added today to
<a href="https://github.com/abo-abo/swiper">ivy-mode</a>. It&#39;s obscure, since
very few packages give their candidates a face with a custom
background.  Still, when that happens, a conflict arises:</p>

<blockquote>
<p>Which face to apply: <code>ivy-current-match</code> or the existing one?</p>
</blockquote>

<p>In the image below, I&#39;ve blended them both in a 50-50 mixture:</p>

<p><img src="/download/ivy-blend.png" alt="ivy-blend.png"></p>

<p>By the way, if you&#39;re wondering where the backgrounds come from in the
first place, it&#39;s <a href="https://github.com/abo-abo/lispy">lispy-goto</a>
function (if you know what <code>imenu</code> is, it&#39;s an advanced version of
that).  This function collects all the Elisp tags in the current
directory, and offers to jump to them. The functions that have
<code>interactive</code> in them, are highlighted with <code>lispy-command-name-face</code>.
In the above screenshot, the first 7 functions are interactive, and the other 2 are not.</p>

<p>If you&#39;re interested in how color blending is done, I&#39;ll describe it
shortly below.</p>

<h2 id="color-building-internals">Color-building internals</h2>

<p>First, a smaller and more clear example (I&#39;ve used <code>rainbow-mode</code> and <code>htmlize-buffer</code>):</p>

<style type="text/css">
    <!--
      .ATTRLIST {
        /* (:background "#800080") */
        background-color: #800080;
      }
      .ATTRLIST-1 {
        /* (:background "blue") */
        background-color: #0000ff;
      }
      .ATTRLIST-2 {
        /* (:foreground "white") */
        color: #ffffff;
      }
      .ATTRLIST-3 {
        /* (:background "red") */
        background-color: #ff0000;
      }
      .comment {
        /* font-lock-comment-face */
        color: #3F7F5F;
      }
      .comment-delimiter {
        /* font-lock-comment-delimiter-face */
        color: #3F7F5F;
      }
      .string {
        /* font-lock-string-face */
        color: #2A00FF;
      }
    -->
    </style>

<pre>
(colir-blend
 (color-values <span class="string">"</span><span class="ATTRLIST-3"><span class="ATTRLIST-2">red</span></span><span class="string">"</span>)
 (color-values <span class="string">"</span><span class="ATTRLIST-1"><span class="ATTRLIST-2">blue</span></span><span class="string">"</span>))
<span class="comment-delimiter">;; </span><span class="comment">=&gt; "</span><span class="ATTRLIST"><span class="ATTRLIST-2">#800080</span></span><span class="comment">"
</span></pre>

<p>Here, <code>colir-blend</code> is a very small function that I&#39;ll describe below,
and <code>color-values</code> is a function from faces.el that forwards to a C
function <code>xw-color-values</code> with this doc:</p>

<blockquote>
<p>Return a list of three integers, (RED GREEN BLUE), each between 0
and either 65280 or 65535 (the maximum depends on the system).</p>
</blockquote>

<p>Which is a bit weird, since the last time I checked, the standard for
colors was one-byte per channel, not two.  Granted, it was about 10
years ago that I checked, and indeed, the
<a href="http://en.wikipedia.org/wiki/RGB_color_model#Numeric_representations">entry on Wikipedia</a>
says:</p>

<blockquote>
<p>High-end digital image equipment are often able to deal with larger
integer ranges for each primary color, such as 0..1023 (10 bits),
0..65535 (16 bits) or even larger, by extending the 24-bits (three
8-bit values) to 32-bit, 48-bit, or 64-bit units</p>
</blockquote>

<p>Apparently, Emacs is outfitted to deal high-end digital image
equipment. But I&#39;m still pretty sure that most graphics cards that you
can buy only give 8 bits per each channel. Anyway, here&#39;s the code for
the basic functions:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">colir-join</span> <span class="p">(</span><span class="nv">r</span> <span class="nv">g</span> <span class="nv">b</span><span class="p">)</span>
  <span class="s">&quot;Build a color from R G B.</span>
<span class="s">Inverse of `color-values&#39;.&quot;</span>
  <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;#%02x%02x%02x&quot;</span>
          <span class="p">(</span><span class="nf">ash</span> <span class="nv">r</span> <span class="mi">-8</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">ash</span> <span class="nv">g</span> <span class="mi">-8</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">ash</span> <span class="nv">b</span> <span class="mi">-8</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">colir-blend</span> <span class="p">(</span><span class="nv">c1</span> <span class="nv">c2</span> <span class="kp">&amp;optional</span> <span class="nv">alpha</span><span class="p">)</span>
  <span class="s">&quot;Blend the two colors C1 and C2 with ALPHA.</span>
<span class="s">C1 and C2 are in the format of `color-values&#39;.</span>
<span class="s">ALPHA is a number between 0.0 and 1.0 which corresponds to the</span>
<span class="s">influence of C1 on the result.&quot;</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">alpha</span> <span class="p">(</span><span class="k">or</span> <span class="nv">alpha</span> <span class="mf">0.5</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">apply</span> <span class="nf">#&#39;</span><span class="nv">colir-join</span>
         <span class="p">(</span><span class="nv">cl-mapcar</span>
          <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">round</span> <span class="p">(</span><span class="nf">+</span> <span class="p">(</span><span class="nf">*</span> <span class="nv">x</span> <span class="nv">alpha</span><span class="p">)</span> <span class="p">(</span><span class="nf">*</span> <span class="nv">y</span> <span class="p">(</span><span class="nf">-</span> <span class="mi">1</span> <span class="nv">alpha</span><span class="p">)))))</span>
          <span class="nv">c1</span> <span class="nv">c2</span><span class="p">)))</span>
</code></pre></div>
<p>All pretty simple:</p>

<ol>
<li>Split each color into red, green, and blue integers with <code>color-values</code>.</li>
<li>Compute a mean for each color channel.</li>
<li>Build the new color by concatenating the hex components into a string.</li>
</ol>

<p>In the example above:</p>

<ul>
<li>The result of <code>(color-values &quot;red&quot;)</code> is <code>(65535 0 0)</code>.</li>
<li>The result of <code>(color-values &quot;blue&quot;)</code> is <code>(0 0 65535)</code>.</li>
<li>Their arithmetic mean is <code>(32768 0 32768)</code>.</li>
<li>Divided by <code>256</code> with <code>ash</code>, we get <code>(128 0 128)</code>.</li>
<li>Converted to hex, <code>(128 0 128)</code> is <code>(80 0 80)</code>.</li>
<li>And the final color is <code>&quot;#800080&quot;</code>.</li>
</ul>

<h2 id="outro">Outro</h2>

<p>I hope that you&#39;ve enjoyed this little venture into Elisp and colors.
People say rough things about Elisp sometimes, but hey: it offers
functions ranging from the assembly-level <code>ash</code>, all the way up to
Photoshop-grade color channel handling.</p>

<p>If only it could get a good optimization bump, like JavaScript got at
one point, and a small threading library, we&#39;d be all set.</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page6">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page4">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
