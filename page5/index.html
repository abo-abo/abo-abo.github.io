<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (or emacs &middot; irrelevant)
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://i.creativecommons.org/l/by-nc-sa/2.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/04/30/gcc-macros-auto-yasnippet/">
        GCC macros and auto-yasnippet
      </a>
    </h1>

    <span class="post-date">30 Apr 2015</span>

    <p>As one thing leads to another, it occurred to me that I didn&#39;t know
what <code>__GNUC__</code> macro does.  Which brought me to the manual page on
<a href="https://gcc.gnu.org/onlinedocs/cpp/Common-Predefined-Macros.html">Common Predefined Macros</a>.</p>

<h2 id="using-org-mode-babel-to-check-the-macro-values">Using <code>org-mode</code> Babel to check the macro values</h2>

<p>I decided that just skimming through the page wasn&#39;t enough, and I
wanted to brush up on my <code>org-mode</code> babel.  So I created this
<a href="https://raw.githubusercontent.com/abo-abo/oremacs/github/etc/org/wiki/C.org">wiki page</a>
to which you&#39;re welcome if you ever need to check <code>__BYTE_ORDER_</code> or
<code>__UINT_FAST16_TYPE__</code> on your system.</p>

<p>Here&#39;s a small excerpt of it:</p>
<div class="highlight"><pre><code class="language-C" data-lang="C"><span class="cp">#+begin_src C :results verbatim</span>
<span class="cp">#include &lt;stdio.h&gt;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// version stuff</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;__GNUC__ %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__GNUC__</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;__GNUC_MINOR__ %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__GNUC_MINOR__</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;__GNUC_PATCHLEVEL__ %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__GNUC_PATCHLEVEL__</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;__VERSION__ %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__VERSION__</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#+end_src</span>
</code></pre></div>
<p>When you navigate to any place in the code and press <kbd>C-c C-c</kbd>, which calls (sic) <code>org-ctrl-c-ctrl-c</code>,
it will re-compile and re-run your program.</p>

<p>I list here some of the <a href="https://github.com/abo-abo/oremacs/blob/github/oleh/modes/ora-org.el">config</a> to make it all work:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">org-babel-do-load-languages</span>
 <span class="ss">&#39;org-babel-load-languages</span>
 <span class="o">&#39;</span><span class="p">((</span><span class="nv">C</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
   <span class="c1">;; ...</span>
   <span class="p">))</span>

<span class="p">(</span><span class="k">setq</span> <span class="nv">org-babel-C-compiler</span> <span class="s">&quot;gcc -std=c99&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="new-auto-yasnippet-method">New <code>auto-yasnippet</code> method</h2>

<p>You can read up on what <code>auto-yasnippet</code> is in <a href="http://oremacs.com/2015/01/30/auto-yasnippet/">this post</a>.
For the wiki page, I had to insert the <code>printf</code> statements a bunch of times, some of them with triply-repeated symbols.
Take, for instance, this statement:</p>
<div class="highlight"><pre><code class="language-C" data-lang="C"><span class="n">printf</span><span class="p">(</span><span class="s">&quot;__INT32_TYPE__ %s (%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ESTR</span><span class="p">(</span><span class="n">__INT32_TYPE__</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">__INT32_TYPE__</span><span class="p">));</span>
</code></pre></div>
<p>With the old method, I would insert <code>~</code> before each <code>INT32</code> and call <code>aya-create</code>. But it would result in this snippet, which isn&#39;t optimal:</p>
<div class="highlight"><pre><code class="language-C" data-lang="C"><span class="n">printf</span><span class="p">(</span><span class="s">&quot;__$1 %s (%d)</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">,</span> <span class="n">ESTR</span><span class="p">(</span><span class="n">__</span><span class="err">$</span><span class="mi">1</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">__</span><span class="err">$</span><span class="mi">1</span><span class="p">));</span>
</code></pre></div>
<p>With the new method (the old one still works, it&#39;s just that the new one takes priority), I would only quote the first field like so:</p>
<div class="highlight"><pre><code class="language-C" data-lang="C"><span class="n">printf</span><span class="p">(</span><span class="s">&quot;__`INT32&#39;_TYPE__ %s (%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ESTR</span><span class="p">(</span><span class="n">__INT32_TYPE__</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">__INT32_TYPE__</span><span class="p">));</span>
</code></pre></div>
<p>Which results in this snippet:</p>
<div class="highlight"><pre><code class="language-C" data-lang="C"><span class="n">printf</span><span class="p">(</span><span class="s">&quot;__$1_TYPE__ %s (%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ESTR</span><span class="p">(</span><span class="n">__</span><span class="err">$</span><span class="mi">1</span><span class="n">_TYPE__</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">__</span><span class="err">$</span><span class="mi">1</span><span class="n">_TYPE__</span><span class="p">));</span>
</code></pre></div>
<p>Much better.</p>

<h2 id="oremacs-wiki-workflow"><code>oremacs</code> wiki workflow</h2>

<p>If you&#39;re crazy enough (in a good way) to follow <a href="https://github.com/abo-abo/oremacs">oremacs</a>, you&#39;ll get the
new wiki page delivered right to your config with</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">make install
</code></pre></div>
<p>which will also update to the latest <code>org-mode</code> and CEDET.</p>

<p>And here&#39;s how to access it:</p>

<ul>
<li>run <code>xmodmap etc/.Xmodmap</code> to make <kbd>;</kbd> into a modifier</li>
<li>press <kbd>;-k</kbd> to open a dispatch hydra</li>
<li>press <kbd>w</kbd> to select the wiki</li>
<li>select <code>C</code> (currently, the only other candidate is <code>git</code>)</li>
</ul>

<h2 id="outro">Outro</h2>

<p>Check out the new <code>auto-yasnippet</code> method, I think it&#39;s pretty
efficient.  I hope that you&#39;ll find the wiki page useful in your C
pursuits.  And a big thanks to Eric Schulte for <code>org-babel</code>.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/04/28/blending-faces/">
        Blending colors in Elisp
      </a>
    </h1>

    <span class="post-date">28 Apr 2015</span>

    <h2 id="intro">Intro</h2>

<p>This is a slightly obscure feature that I&#39;ve added today to
<a href="https://github.com/abo-abo/swiper">ivy-mode</a>. It&#39;s obscure, since
very few packages give their candidates a face with a custom
background.  Still, when that happens, a conflict arises:</p>

<blockquote>
<p>Which face to apply: <code>ivy-current-match</code> or the existing one?</p>
</blockquote>

<p>In the image below, I&#39;ve blended them both in a 50-50 mixture:</p>

<p><img src="/download/ivy-blend.png" alt="ivy-blend.png"></p>

<p>By the way, if you&#39;re wondering where the backgrounds come from in the
first place, it&#39;s <a href="https://github.com/abo-abo/lispy">lispy-goto</a>
function (if you know what <code>imenu</code> is, it&#39;s an advanced version of
that).  This function collects all the Elisp tags in the current
directory, and offers to jump to them. The functions that have
<code>interactive</code> in them, are highlighted with <code>lispy-command-name-face</code>.
In the above screenshot, the first 7 functions are interactive, and the other 2 are not.</p>

<p>If you&#39;re interested in how color blending is done, I&#39;ll describe it
shortly below.</p>

<h2 id="color-building-internals">Color-building internals</h2>

<p>First, a smaller and more clear example (I&#39;ve used <code>rainbow-mode</code> and <code>htmlize-buffer</code>):</p>

<style type="text/css">
    <!--
      .ATTRLIST {
        /* (:background "#800080") */
        background-color: #800080;
      }
      .ATTRLIST-1 {
        /* (:background "blue") */
        background-color: #0000ff;
      }
      .ATTRLIST-2 {
        /* (:foreground "white") */
        color: #ffffff;
      }
      .ATTRLIST-3 {
        /* (:background "red") */
        background-color: #ff0000;
      }
      .comment {
        /* font-lock-comment-face */
        color: #3F7F5F;
      }
      .comment-delimiter {
        /* font-lock-comment-delimiter-face */
        color: #3F7F5F;
      }
      .string {
        /* font-lock-string-face */
        color: #2A00FF;
      }
    -->
    </style>

<pre>
(colir-blend
 (color-values <span class="string">"</span><span class="ATTRLIST-3"><span class="ATTRLIST-2">red</span></span><span class="string">"</span>)
 (color-values <span class="string">"</span><span class="ATTRLIST-1"><span class="ATTRLIST-2">blue</span></span><span class="string">"</span>))
<span class="comment-delimiter">;; </span><span class="comment">=&gt; "</span><span class="ATTRLIST"><span class="ATTRLIST-2">#800080</span></span><span class="comment">"
</span></pre>

<p>Here, <code>colir-blend</code> is a very small function that I&#39;ll describe below,
and <code>color-values</code> is a function from faces.el that forwards to a C
function <code>xw-color-values</code> with this doc:</p>

<blockquote>
<p>Return a list of three integers, (RED GREEN BLUE), each between 0
and either 65280 or 65535 (the maximum depends on the system).</p>
</blockquote>

<p>Which is a bit weird, since the last time I checked, the standard for
colors was one-byte per channel, not two.  Granted, it was about 10
years ago that I checked, and indeed, the
<a href="http://en.wikipedia.org/wiki/RGB_color_model#Numeric_representations">entry on Wikipedia</a>
says:</p>

<blockquote>
<p>High-end digital image equipment are often able to deal with larger
integer ranges for each primary color, such as 0..1023 (10 bits),
0..65535 (16 bits) or even larger, by extending the 24-bits (three
8-bit values) to 32-bit, 48-bit, or 64-bit units</p>
</blockquote>

<p>Apparently, Emacs is outfitted to deal high-end digital image
equipment. But I&#39;m still pretty sure that most graphics cards that you
can buy only give 8 bits per each channel. Anyway, here&#39;s the code for
the basic functions:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">colir-join</span> <span class="p">(</span><span class="nv">r</span> <span class="nv">g</span> <span class="nv">b</span><span class="p">)</span>
  <span class="s">&quot;Build a color from R G B.</span>
<span class="s">Inverse of `color-values&#39;.&quot;</span>
  <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;#%02x%02x%02x&quot;</span>
          <span class="p">(</span><span class="nf">ash</span> <span class="nv">r</span> <span class="mi">-8</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">ash</span> <span class="nv">g</span> <span class="mi">-8</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">ash</span> <span class="nv">b</span> <span class="mi">-8</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">colir-blend</span> <span class="p">(</span><span class="nv">c1</span> <span class="nv">c2</span> <span class="kp">&amp;optional</span> <span class="nv">alpha</span><span class="p">)</span>
  <span class="s">&quot;Blend the two colors C1 and C2 with ALPHA.</span>
<span class="s">C1 and C2 are in the format of `color-values&#39;.</span>
<span class="s">ALPHA is a number between 0.0 and 1.0 which corresponds to the</span>
<span class="s">influence of C1 on the result.&quot;</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">alpha</span> <span class="p">(</span><span class="k">or</span> <span class="nv">alpha</span> <span class="mf">0.5</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">apply</span> <span class="nf">#&#39;</span><span class="nv">colir-join</span>
         <span class="p">(</span><span class="nv">cl-mapcar</span>
          <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">round</span> <span class="p">(</span><span class="nf">+</span> <span class="p">(</span><span class="nf">*</span> <span class="nv">x</span> <span class="nv">alpha</span><span class="p">)</span> <span class="p">(</span><span class="nf">*</span> <span class="nv">y</span> <span class="p">(</span><span class="nf">-</span> <span class="mi">1</span> <span class="nv">alpha</span><span class="p">)))))</span>
          <span class="nv">c1</span> <span class="nv">c2</span><span class="p">)))</span>
</code></pre></div>
<p>All pretty simple:</p>

<ol>
<li>Split each color into red, green, and blue integers with <code>color-values</code>.</li>
<li>Compute a mean for each color channel.</li>
<li>Build the new color by concatenating the hex components into a string.</li>
</ol>

<p>In the example above:</p>

<ul>
<li>The result of <code>(color-values &quot;red&quot;)</code> is <code>(65535 0 0)</code>.</li>
<li>The result of <code>(color-values &quot;blue&quot;)</code> is <code>(0 0 65535)</code>.</li>
<li>Their arithmetic mean is <code>(32768 0 32768)</code>.</li>
<li>Divided by <code>256</code> with <code>ash</code>, we get <code>(128 0 128)</code>.</li>
<li>Converted to hex, <code>(128 0 128)</code> is <code>(80 0 80)</code>.</li>
<li>And the final color is <code>&quot;#800080&quot;</code>.</li>
</ul>

<h2 id="outro">Outro</h2>

<p>I hope that you&#39;ve enjoyed this little venture into Elisp and colors.
People say rough things about Elisp sometimes, but hey: it offers
functions ranging from the assembly-level <code>ash</code>, all the way up to
Photoshop-grade color channel handling.</p>

<p>If only it could get a good optimization bump, like JavaScript got at
one point, and a small threading library, we&#39;d be all set.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/04/24/oremacs-config/">
        Oremacs config is on Github
      </a>
    </h1>

    <span class="post-date">24 Apr 2015</span>

    <p>I noticed that the packages that I&#39;ve published on
<a href="https://github.com/abo-abo">Github</a> in the last year did get a nice
boost in quality just from being published, viewed, used and commented
on.</p>

<p>So it makes sense to do the same for my full Emacs config, which lives in the <a href="https://github.com/abo-abo/oremacs">oremacs</a> repository as of today.</p>

<p>The config is personal in the sense that I&#39;m actually using it
verbatim, but it&#39;s been configured in a way that&#39;s it&#39;s easy to
replicate and modify it.</p>

<h2 id="who-can-benefit-from-this-config">Who can benefit from this config</h2>

<p>The audience is people like me, who like to tinker with Elisp just for
fun of it.  If you want things to just work, or you find learning
Elisp a chore, it&#39;s not for you.</p>

<p>The config won&#39;t work initially, it won&#39;t work always, but when it
finally does work (hopefully), it will be glorious!</p>

<h2 id="installation-and-running">Installation and Running</h2>

<h3 id="requirements">Requirements</h3>

<p>Emacs 24 is required. Obviously, newer versions are better, but the
default <code>emacs24</code> that you get from the package manager should work.</p>

<p>I&#39;m currently switching between Emacs 24.5.2 built from source and the
current master from <a href="https://savannah.gnu.org/git/?group=emacs">git</a>.</p>

<h3 id="install-command">Install command</h3>

<p>This config doesn&#39;t assume to become your main config when you install
it.  It installs in-place in the git directory and will start from
there without touching your main config.  But you still get access to
all your stuff, like bookmarks stored in your actual <code>~/.emacs.d/</code>
etc.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nb">cd</span> ~/git
git clone https://github.com/abo-abo/oremacs
<span class="nb">cd </span>oremacs
make install
</code></pre></div>
<h3 id="run-command">Run command</h3>

<p>Run without updating:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">make run
</code></pre></div>
<p>Run with an upstream + ELPA update:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">make up
</code></pre></div>
<p>Run with an upstream + ELPA + org-mode + CEDET update:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">make install
</code></pre></div>
<h2 id="perks">Perks</h2>

<h3 id="standalone">Standalone</h3>

<p>You can try it without messing up your current Emacs config.  I actually have multiple versions of this on my system to work-around incompatibility between versions. This way, I can use my full setup even in case I get a bug report for an older Emacs version.</p>

<h3 id="fast-start-up">Fast start up</h3>

<p>With a SSD, it starts in 1 second. Most features are autoloaded and it&#39;s easy to add new autoloaded features.</p>

<h3 id="tracks-the-most-recent-org-mode-and-cedet">Tracks the most recent org-mode and CEDET</h3>

<p>Since these packages take a long time to byte compile, they are updated not with <code>make up</code> but with <code>make install</code>. They are actually git submodules, which means that they won&#39;t update if I don&#39;t update them in the upstream.</p>

<h3 id="bankruptcy-proof">Bankruptcy-proof</h3>

<p>It&#39;s hard to become Emacs-bankrupt with this config, since the config is composed of many independent pieces that you can simply ignore if you don&#39;t need them.</p>

<h3 id="anti-rsi-qwerty-mod">Anti-RSI QWERTY mod</h3>

<p>The config comes with its own <code>.Xmodmap</code> that makes <kbd>;</kbd> into an additional modifier. RSI savers:</p>

<ul>
<li><kbd>;-v</kbd> instead of <kbd>Enter</kbd>.</li>
<li><kbd>;-o</kbd> instead of <kbd>Backspace</kbd>.</li>
<li><kbd>;-f</kbd> instead of <kbd>Shift-9</kbd> and <kbd>Shift-0</kbd>.</li>
<li><kbd>;-a</kbd> instead of <kbd>-</kbd>.</li>
<li><kbd>;-s</kbd> instead of <kbd>Shift--</kbd>.</li>
<li><kbd>;-q</kbd> instead of <kbd>Shift-&#39;</kbd>.</li>
<li><kbd>;-e</kbd> instead of <kbd>=</kbd>.</li>
<li><kbd>;-u</kbd> in addition / instead of <kbd>C-u</kbd>.</li>
</ul>

<p>And obviously the replacements for the two keys that the mod takes away:</p>

<ul>
<li><kbd>;-j</kbd> instead of <kbd>;</kbd>.</li>
<li><kbd>;-d</kbd> instead of <kbd>Shift-;</kbd>.</li>
</ul>

<p>One more Elisp-level RSI-saver is the swap between <kbd>C-p</kbd> and <kbd>C-h</kbd>. Moving up/down line is very important, and it&#39;s nice to have these keys close, which <kbd>C-n</kbd> and <kbd>C-h</kbd> are.</p>

<p>It also includes:</p>

<ul>
<li>a bunch of Hydras that save you key strokes.</li>
<li><code>lispy-mode</code> which quickens any LISP mode, especially Elisp.</li>
<li><code>worf-mode</code> which quickens <code>org-mode</code>.</li>
<li><code>ivy-mode</code> which quickens all completion.</li>
<li><code>swiper</code> which quickens <code>isearch</code> (by replacing it).</li>
<li>C/C++ is customized with <code>function-args-mode</code> and a bunch of hacks.</li>
</ul>

<h3 id="org-mode-starter">Org mode starter</h3>

<p>The config starts you off with a fully configured <code>org-mode</code> setup that includes:</p>

<ul>
<li>gtd.org for getting things done.</li>
<li>ent.org to track entertainment.</li>
<li>wiki folder for quickly starting and selecting wikis.</li>
</ul>

<h2 id="outro">Outro</h2>

<p>I hope that you try and enjoy the new config. Perhaps not verbatim,
but if you find the tips on this blog helpful, this config is their
actual implementation that you can use for reference.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/04/22/swiper-0.3.0/">
        Swiper 0.3.0 is out, with ivy-mode.
      </a>
    </h1>

    <span class="post-date">22 Apr 2015</span>

    <p>This <a href="https://github.com/abo-abo/swiper/releases/tag/0.3.0">release</a> packs more than 90 commits, which is quite a lot for me.
The most important part of this release is <code>ivy-mode</code>, which is a nice alternative to <code>ido-mode</code> or <code>helm-mode</code>.
I&#39;ve mentioned it already in <a href="http://oremacs.com/2015/04/16/ivy-mode/">an earlier post</a>,
I&#39;ll just review all the little details, changes and customizations here.</p>

<h2 id="important:-remove-the-old-ivy-package">Important: remove the old <code>ivy</code> package</h2>

<p>One important change related to MELPA is that the <code>ivy</code> package was merged into <code>swiper</code> package. So if you still have a stand-alone <code>ivy</code> package, you should delete it, or you&#39;ll get incompatibility problems.</p>

<h2 id="video-demo-of-counsel-git-grep">Video Demo of <code>counsel-git-grep</code></h2>

<p>If you like videos, you can watch the <a href="https://www.youtube.com/watch?v=AgRsYOJi6ao">this quick demo</a>
which mostly shows off the new <code>counsel-git-grep</code> function.</p>

<h2 id="fixes">Fixes</h2>

<h3 id="add-work-around-for-window-start-being-not-current">Add work-around for <code>window-start</code> being not current</h3>

<p>From now on, you won&#39;t encounter some un-highlighted matches when your window is scrolled.</p>

<h3 id="make-thing-at-point-work">Make <code>thing-at-point</code> work</h3>

<p><kbd>C-h v</kbd> and <kbd>C-h f</kbd> should select thing-at-point properly.</p>

<h3 id="don&#39;t-try-to-fontify-huge-buffers">Don&#39;t try to fontify huge buffers</h3>

<p>It&#39;s a nice feature of swiper that everything in the minibuffer is fontified.  However, this can cause a slowdown for buffers with x10000 lines. So this feature is automatically turned off for these large buffers.</p>

<h3 id="exclude-a-few-modes-from-font-locking">Exclude a few modes from font locking</h3>

<p>Some modes just misbehave when <code>font-lock-ensure</code> is called. Excluded:</p>

<ul>
<li><code>org-agenda-mode</code></li>
<li><code>dired-mode</code></li>
</ul>

<h2 id="new-features">New Features</h2>

<h3 id="ivy-mode:-complete-everything-with-ivy"><code>ivy-mode</code>: complete everything with Ivy</h3>

<p><code>ivy-mode</code> uses swiper&#39;s approach to completion for almost all completion in Emacs, like:</p>

<ul>
<li><code>execute-extended-command</code></li>
<li><code>package-install</code></li>
<li><code>find-file</code></li>
</ul>

<p>See the <a href="https://github.com/abo-abo/swiper/wiki/File-Completion">wiki page</a> for the details on the key bindings related to <code>ivy-mode</code>, which are especially important to know for <code>find-file</code>.  Also see the <a href="https://www.youtube.com/watch?v=VvnJQpTFVDc">intro video</a>.</p>

<h3 id="new-counsel-functions">New Counsel functions</h3>

<ul>
<li><code>counsel-describe-variable</code> - replacement for <kbd>C-h v</kbd>.</li>
<li><code>counsel-describe-function</code> - replacement for <kbd>C-h f</kbd>.</li>
<li><code>counsel-info-lookup-symbol</code> - just a wrapper around <code>info-lookup-symbol</code>, you get the same behavior by just calling <code>info-lookup-symbol</code> with <code>ivy-mode</code> on.</li>
<li><code>counsel-unicode-char</code> - replacement for <code>ucs-insert</code>.</li>
</ul>

<h3 id="counsel-git-grep"><code>counsel-git-grep</code></h3>

<p>This is a really cool command for grepping at once all the files in your current git repository. For smaller repositories (&lt;20000) lines, ivy handles the completion by itself.  For larger repositories, it defers the work to <code>git grep</code>. It works really well for the Emacs repo with its 3,000,000 lines, especially if you&#39;re using Emacs 25 (from <code>emacs-snapshot</code> or self-built).</p>

<p>This function makes use of <kbd>C-M-n</kbd> and <kbd>C-M-p</kbd> bindings, which switch between candidates without exiting the minibuffer. Also, they highlight the current candidate with the swiper faces. You can think of this command as multi-swiper.</p>

<p>Even for very large repos, it will always display the amount of matches correctly. Also note that swiper-style regex is used here (spaces are wild), and the case is ignored.</p>

<h3 id="the-arrows-can-take-numeric-arguments">The arrows can take numeric arguments</h3>

<p><kbd>C-n</kbd> / <kbd>C-p</kbd>, <kbd>C-s</kbd> / <kbd>C-r</kbd>, and <kbd>C-M-n</kbd> / <kbd>C-M-p</kbd> can all take numeric args, e.g. <kbd>M-5</kbd> or <kbd>C-u</kbd>.</p>

<h3 id="add-a-recenter-binding">Add a recenter binding</h3>

<p><kbd>C-l</kbd> will recenter the window in which swiper was called.</p>

<h3 id="look-up-ivy-key-bindings-with-c-h-m">Look up Ivy key bindings with <kbd>C-h m</kbd></h3>

<p>While in the minibuffer, press <kbd>C-h m</kbd> to see the active modes. Ivy also has a paragraph with its bindings.</p>

<h3 id="use-c-v-and-m-v-to-scroll">Use <kbd>C-v</kbd> and <kbd>M-v</kbd> to scroll</h3>

<p>You can use these bindings to speed up your minibuffer scrolling.</p>

<h3 id="allow-c-.-to-jump-to-definition">Allow <kbd>C-.</kbd> to jump-to-definition</h3>

<p>For <code>counsel-describe-variable</code> and <code>counsel-describe-function</code>:</p>

<ul>
<li>pressing <kbd>C-m</kbd> will actually describe the current candidate.</li>
<li>pressing <kbd>C-.</kbd> will instead jump to definition of the the current candidate.</li>
</ul>

<p>This is very useful for me, I jump to definitions more often that describe.</p>

<h3 id="bind-arrows">Bind arrows</h3>

<p>The actual arrow keys are also bound to the corresponding Emacs arrows.</p>

<h3 id="add-a-way-to-exit-ignoring-the-candidates">Add a way to exit ignoring the candidates</h3>

<p>If your current input matches a candidate, <kbd>C-m</kbd> and <kbd>C-j</kbd> will exit with that candidate.  If you want to exit with your exact input instead, press <kbd>C-u C-j</kbd>.  This is very useful for creating new files and directories.</p>

<h3 id="use-m-q-to-toggle-regexp-quote">Use <kbd>M-q</kbd> to toggle <code>regexp-quote</code></h3>

<p>This can be useful while completing file names (with a lot of dots). Pressing <kbd>M-q</kbd> toggles between regex and non-regex matching.</p>

<h3 id="customize-ivy-re-builders-alist">Customize <code>ivy-re-builders-alist</code></h3>

<p>This is pretty intricate, look up the variable to see the details. In short, you can use this to apply `regexp-quote&#39; for some types of completion if you want.</p>

<h3 id="customize-what-to-do-on-del-error">Customize what to do on <kbd>DEL</kbd> error</h3>

<p>The standard behavior on a <kbd>DEL</kbd> error (usually empty minibuffer) is to exit the minibuffer.  I like this behavior, since it&#39;s similar to the behavior to fixing wrongly typed chars: only in this case <kbd>DEL</kbd> &quot;fixes&quot; a wrongly typed command.</p>

<p>But if you want to customize it, just set <code>ivy-on-del-error-function</code> to something other than <code>minibuffer-keyboard-quit</code>.</p>

<h3 id="customize-ivy-extra-directories">Customize <code>ivy-extra-directories</code></h3>

<p>Customize this if you don&#39;t want to see <code>../</code> and <code>./</code> while completing file names.</p>

<h3 id="customize-ivy-sort-functions-alist">Customize <code>ivy-sort-functions-alist</code></h3>

<p>Use this variable to customize sorting, depending on what you&#39;re completing.  For example:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-sort-functions-alist</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="nv">read-file-name-internal</span> <span class="o">.</span> <span class="nv">ivy-sort-file-function-default</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">internal-complete-buffer</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">counsel-git-grep-function</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="no">t</span> <span class="o">.</span> <span class="nf">string-lessp</span><span class="p">)))</span>
</code></pre></div>
<h3 id="customize-ivy-subdir-face">Customize <code>ivy-subdir-face</code></h3>

<p>While completing file names, the directories will use <code>ivy-subdir-face</code>.</p>

<h2 id="outro">Outro</h2>

<p>Big thanks to all who contributed, especially <a href="https://github.com/tsdh">@tsdh</a>.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/04/19/git-grep-ivy/">
        Grep in a git repository using ivy
      </a>
    </h1>

    <span class="post-date">19 Apr 2015</span>

    <p>Just got this request a few minutes ago, and now this feature is in
the <a href="https://github.com/abo-abo/swiper/blob/master/counsel.el">swiper</a>
repository (available as <code>counsel</code> from MELPA).</p>

<p>The motivation was to write an ivy equivalent of <a href="https://github.com/yasuyk/helm-git-grep">helm-git-grep</a>.
I didn&#39;t use this feature before, but the only thing that I needed to get me started was this shell command:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">git --no-pager grep --full-name -n --no-color -i -e foobar
</code></pre></div>
<p>The rest of the code (just 20 lines) followed all by itself:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">counsel-git-grep-function</span> <span class="p">(</span><span class="nf">string</span> <span class="kp">&amp;optional</span> <span class="nv">_pred</span> <span class="kp">&amp;rest</span> <span class="nv">_u</span><span class="p">)</span>
  <span class="s">&quot;Grep in the current git repository for STRING.&quot;</span>
  <span class="p">(</span><span class="nv">split-string</span>
   <span class="p">(</span><span class="nv">shell-command-to-string</span>
    <span class="p">(</span><span class="nf">format</span>
     <span class="s">&quot;git --no-pager grep --full-name -n --no-color -i -e \&quot;%s\&quot;&quot;</span>
     <span class="nf">string</span><span class="p">))</span>
   <span class="s">&quot;\n&quot;</span>
   <span class="no">t</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">counsel-git-grep</span> <span class="p">()</span>
  <span class="s">&quot;Grep for a string in the current git repository.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">default-directory</span> <span class="p">(</span><span class="nv">locate-dominating-file</span>
                             <span class="nv">default-directory</span> <span class="s">&quot;.git&quot;</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">val</span> <span class="p">(</span><span class="nv">ivy-read</span> <span class="s">&quot;pattern: &quot;</span> <span class="ss">&#39;counsel-git-grep-function</span><span class="p">))</span>
        <span class="nv">lst</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">when</span> <span class="nv">val</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">lst</span> <span class="p">(</span><span class="nv">split-string</span> <span class="nv">val</span> <span class="s">&quot;:&quot;</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">find-file</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">lst</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">forward-line</span> <span class="p">(</span><span class="nf">1-</span> <span class="p">(</span><span class="nf">string-to-number</span> <span class="p">(</span><span class="nv">cadr</span> <span class="nv">lst</span><span class="p">)))))))</span>
</code></pre></div>
<p>Thanks to the push from Stefan Monnier, <code>ivy-read</code> also supports a
function to be passed instead of a static collection of strings. In
this case, it&#39;s <code>counsel-git-grep-function</code> that basically takes one
argument: the thing that we&#39;re looking for.</p>

<p>After this, <code>shell-command-to-string</code> is my go-to function to quickly
bring some shell output into Elisp. As you can see, it&#39;s enough to
pass it a shell command in a string form to get a string response.  I
transform the response into a list of line strings with
<code>split-string</code>, making sure to pass the <code>t</code> argument to avoid empty
strings.</p>

<p>One final trick that you can learn for your own Elisp programming is
the <code>let</code> / <code>default-directory</code> / <code>(locate-dominating-file default-directory &quot;.git&quot;)</code> combo.
It&#39;s quite useful for dealing with git shell commands.
And that&#39;s it, it only remains to open a file and jump to the selected line.</p>

<p>I think that <code>counsel-git-grep</code> might complement and slightly displace <code>rgrep</code> or <code>ag</code> in my setup.
So I&#39;ve given it a nice binding:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c j&quot;</span><span class="p">)</span> <span class="ss">&#39;counsel-git-grep</span><span class="p">)</span>
</code></pre></div>
<p>I hope that I&#39;ve made a good case of how easy it is to quickly write
something in Elisp, especially if it&#39;s just a shell command
wrapper. So if you&#39;re on the fence of whether to learn Elisp or not,
do yourself a favor and learn it: it pays off quickly and is a lot of
fun.</p>

<p>Side note: I&#39;ve mentioned <code>\bfun\b</code> in this blog 182 times, mostly as a variable representing a function (courtesy of <code>counsel-git-grep</code>).</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page6">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page4">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
