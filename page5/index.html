<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (or emacs &middot; irrelevant)
    
  </title>

  <link rel="canonical" href="https://oremacs.com/page5/" />

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://licensebuttons.net/l/by-sa/4.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/10/14/swiper-mc/">
        A simple multiple-cursors extension to swiper
      </a>
    </h1>

    <span class="post-date">14 Oct 2015</span>

    <p>When using Emacs, it happens sometimes that I accumulate too many
buffers. The usual next action is to close the buffers for the project
that I&#39;m not currently working on. Previously, I marked those buffers
in <code>*Buffer List*</code> by hand with <kbd>d</kbd> and
<kbd>C-n</kbd>. Today, I&#39;ll show a faster way.</p>

<p>It&#39;s very easy to select these buffers in <code>*Buffer List*</code> with
<a href="https://github.com/abo-abo/swiper">swiper</a>: just type a part the
shared directory name. Another example is to select all <code>dired</code>
buffers: a &quot;dired by&quot; input will usually match all of them, since they
all have <code>Dired by name</code> in their line.</p>

<p>Afterwards, I want to open
<a href="https://github.com/magnars/multiple-cursors.el">multiple-cursors</a> for
each matched line. I&#39;ve bound this action to <kbd>C-7</kbd>. Here&#39;s
the very simple code:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">swiper-mc</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;multiple-cursors</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;multiple-cursors isn&#39;t installed&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">cands</span> <span class="p">(</span><span class="nf">nreverse</span> <span class="nv">ivy--old-cands</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">string=</span> <span class="nv">ivy-text</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">ivy-set-action</span>
       <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">_</span><span class="p">)</span>
         <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">cand</span><span class="p">)</span>
           <span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">cand</span> <span class="p">(</span><span class="nb">pop</span> <span class="nv">cands</span><span class="p">))</span>
             <span class="p">(</span><span class="nv">swiper--action</span> <span class="nv">cand</span><span class="p">)</span>
             <span class="p">(</span><span class="nb">when</span> <span class="nv">cands</span>
               <span class="p">(</span><span class="nv">mc/create-fake-cursor-at-point</span><span class="p">))))</span>
         <span class="p">(</span><span class="nv">mc/maybe-multiple-cursors-mode</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-exit</span> <span class="ss">&#39;done</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">exit-minibuffer</span><span class="p">))))</span>
</code></pre></div>
<p>After <kbd>C-7</kbd>, here&#39;s the sequence to delete the selected buffers:</p>

<ul>
<li><kbd>d</kbd> (<code>Buffer-menu-delete</code>) to mark each item for deletion.</li>
<li><kbd>C-g</kbd> (<code>keyboard-quit</code>) to exit <code>multiple-cursors</code>.</li>
<li><kbd>x</kbd> (<code>Buffer-menu-execute</code>) to execute the deletions.</li>
</ul>

<p>And that&#39;s it: all selected buffers are now deleted.  To summarize,
<kbd>C-s</kbd> <code>dired by</code> <kbd>C-7 d C-g x</kbd> will close all
<code>dired</code> buffers from your <code>*Buffer List*</code>.</p>

<p>Other interesting applications are also possible, like mass renames in
<code>wdired</code>, or un-commenting everything in a function.  For example,
suppose that you have this code:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">progn</span>
  <span class="c1">;; (check-1)</span>
  <span class="p">(</span><span class="nv">foo</span><span class="p">)</span>
  <span class="c1">;; (check-2)</span>
  <span class="p">(</span><span class="nv">bar</span><span class="p">)</span>
  <span class="c1">;; (check-3)</span>
  <span class="p">(</span><span class="nv">baz</span><span class="p">))</span>
</code></pre></div>
<p>If it&#39;s a part of a larger buffer, you can narrow with <kbd>C-x nd</kbd> (<code>narrow-to-defun</code>)
or <kbd>C-x nn</kbd> (<code>narrow-to-region</code>).  Then <kbd>C-s ;; C-7 DEL DEL C-d C-g</kbd> to
remove all comments.</p>

<p>I have to say that the functionality intersects a bit with
<code>mc/mark-all-like-this</code>. Except you know the result ahead of time
(number and position of matches), and you can use a regex instead of a
literal string.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/10/02/swiper-visual-line/">
        Swiper and visual-line-mode
      </a>
    </h1>

    <span class="post-date">02 Oct 2015</span>

    <p>In case you encounter files with very long lines, the built-in
<kbd>M-x</kbd> <code>visual-line-mode</code> might come in handy.  Although 1MB
long one-line files are a disaster for Emacs, there&#39;s no problem
handling smaller files with long lines that result from bad markdown
renderers (notably Github).  They way <code>visual-line-mode</code> works, is it
inserts virtual newlines in appropriate positions, so that no line is
truncated.  The advantage is that these newlines aren&#39;t written to the
file when the buffer is saved (otherwise, a simple <kbd>M-q</kbd>
(<code>fill-paragraph</code>) would work too).</p>

<p>Today I&#39;ve added <code>visual-line-mode</code> support to
<a href="https://github.com/abo-abo/swiper">swiper</a>, so handling these files
should be even easier now. The change was surprisingly simple: just
two checks for <code>visual-line-mode</code> variable and these basic
replacements:</p>

<ul>
<li><code>forward-line</code> -&gt; <code>line-move</code>,</li>
<li><code>line-beginning-position</code> -&gt; <code>beginning-of-visual-line</code>,</li>
<li><code>line-end-position</code> -&gt; <code>end-of-visual-line</code>.</li>
</ul>

<p>By the way, <code>visual-line-mode</code> is one of the small number of commands
that I call by name instead of by key chord. But thanks to
<code>counsel-M-x</code> and <code>smex</code> calling this command by name is as short as
<kbd>C-t v RET</kbd>.  To explain a bit more, here&#39;s my setup:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="c1">;; make sure to install smex</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-t&quot;</span><span class="p">)</span> <span class="ss">&#39;counsel-M-x</span><span class="p">)</span>
</code></pre></div>
<p>The default command bound to <kbd>C-t</kbd> is <code>transpose-chars</code> - a
highly situational and ultimately counter-productive command
(<kbd>M-DEL</kbd> and re-typing the word is faster than surgically
navigating to the transpose point and calling <code>transpose-chars</code>, plus
it trains the hands to type the word correctly next time).  Anyway,
<kbd>C-t</kbd> is a prime binding for launching interactive commands.
And since <code>smex</code> is installed it remembers that my most used command
that starts with &quot;v&quot; is <code>visual-line-mode</code> - so it&#39;s the first one
that gets selected after <kbd>C-t v</kbd>. This means that I can just
press <kbd>RET</kbd> and be done with it.</p>

<p><img src="/download/swiper-visual-line-mode.png" alt="swiper-visual-line-mode.png"></p>

<p>Finally, related to <code>visual-line-mode</code>, here&#39;s a command I use to
negate <kbd>M-q</kbd> (<code>fill-paragraph</code>) (<a href="http://www.emacswiki.org/emacs/UnfillParagraph">source</a>):</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-M-q&quot;</span><span class="p">)</span> <span class="ss">&#39;ora-unfill-paragraph</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">ora-unfill-paragraph</span> <span class="p">()</span>
  <span class="s">&quot;Transform a paragraph into a single line.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">fill-column</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">fill-paragraph</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)))</span>
</code></pre></div>
<p>Thanks to <a href="https://github.com/joostkremers">@joostkremers</a> for the
suggestion in <a href="https://github.com/abo-abo/swiper/issues/227">#227</a>.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/09/29/tweak-ivy-faces/">
        More tweaks to Ivy minibuffer faces
      </a>
    </h1>

    <span class="post-date">29 Sep 2015</span>

    <p>This is a continuation of the thought that I started in the
<a href="http://oremacs.com/2015/09/04/ivy-fancy-minibuffer/">last post</a> a few
weeks ago.  I don&#39;t fancy myself a graphical designer, but I kind of
have a feeling of what I like - I certainly know it when I see it.</p>

<p>I wasn&#39;t quite happy with the color of the current selection in the
minibuffer.  Then it hit me that I like the way the Firefox address
bar does it: invert the selected text foreground to white and add a
flashy background. After that, it was only a matter of going though a
few random color permutations in the GIMP color selector to arrive to
a nice state:</p>

<p><img src="/download/counsel-M-x.png" alt="counsel-M-x.png"></p>

<p>I did add something similar for dark background themes, although I
rarely use them myself, since they contrast too much with Firefox,
with most websites having a light background:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defface</span> <span class="nv">ivy-current-match</span>
  <span class="o">&#39;</span><span class="p">((((</span><span class="nv">class</span> <span class="nv">color</span><span class="p">)</span> <span class="p">(</span><span class="nv">background</span> <span class="nv">light</span><span class="p">))</span>
     <span class="nb">:background</span> <span class="s">&quot;#1a4b77&quot;</span> <span class="nb">:foreground</span> <span class="s">&quot;white&quot;</span><span class="p">)</span>
    <span class="p">(((</span><span class="nv">class</span> <span class="nv">color</span><span class="p">)</span> <span class="p">(</span><span class="nv">background</span> <span class="nv">dark</span><span class="p">))</span>
     <span class="nb">:background</span> <span class="s">&quot;#65a7e2&quot;</span> <span class="nb">:foreground</span> <span class="s">&quot;black&quot;</span><span class="p">))</span>
  <span class="s">&quot;Face used by Ivy for highlighting first match.&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Of course, the standard recommendation follows to use
<a href="https://elpa.gnu.org/packages/rainbow-mode.html">rainbow-mode</a> in
buffers that deal with colors - it&#39;s great.</p>

<p>Finally, <code>counsel-git-grep</code> and <code>counsel-ag</code> now also add the proper
minibuffer coloring if you have it turned on:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-display-style</span> <span class="ss">&#39;fancy</span><span class="p">)</span>
</code></pre></div>
<p><img src="/download/counsel-ag.png" alt="counsel-ag"></p>

<p>If you&#39;re interested in how the face backgrounds are combined, you can
read my older article on
<a href="http://oremacs.com/2015/04/28/blending-faces/">color blending in Elisp</a>.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/09/04/ivy-fancy-minibuffer/">
        Fancy minibuffer faces for Ivy completion
      </a>
    </h1>

    <span class="post-date">04 Sep 2015</span>

    <p>Today, I&#39;ll describe a recent improvement to the display of Ivy completion.
To use it, add this code to your configuration:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-display-style</span> <span class="ss">&#39;fancy</span><span class="p">)</span>
</code></pre></div>
<p>After this, <a href="https://github.com/abo-abo/swiper">swiper</a> will look like this:</p>

<p><img src="/download/ivy-display-style-1.png" alt="ivy-display-style-1.png"></p>

<p>And <code>counsel-M-x</code> will look like this:</p>

<p><img src="/download/ivy-display-style-2.png" alt="ivy-display-style-2.png"></p>

<p>If you haven&#39;t used it before, <code>counsel-M-x</code> is part the counsel
package on MELPA, or part of swiper package if you&#39;re installing from
GNU ELPA. Basically, it&#39;s a <kbd>M-x</kbd> replacement (that I like to
bind to <kbd>C-t</kbd> for efficiency reasons), that doubles as
<code>find-function</code> (just press <kbd>C-.</kbd> instead of <kbd>RET</kbd>
to find the function instead of calling it). If you&#39;re using
<code>counsel-M-x</code> I highly recommend to also install <code>smex</code>, since then
<code>counsel-M-x</code> will use <code>smex</code> for sorting the matched commands.</p>

<p>The update will propertize the minibuffer contents with a new set of faces:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defcustom</span> <span class="nv">swiper-minibuffer-faces</span>
  <span class="o">&#39;</span><span class="p">(</span><span class="nv">swiper-minibuffer-match-face-1</span>
    <span class="nv">swiper-minibuffer-match-face-2</span>
    <span class="nv">swiper-minibuffer-match-face-3</span>
    <span class="nv">swiper-minibuffer-match-face-4</span><span class="p">)</span>
  <span class="s">&quot;List of </span><span class="ss">`swiper&#39;</span><span class="s"> faces for minibuffer group matches.&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Initially, when responding to
<a href="https://github.com/abo-abo/swiper/issues/212">#212</a>, I used the
original swiper faces in the minibuffer as well. But after some use,
their brightness became a bit annoying.  So I introduced a new set of
faces that can be customized separately.</p>

<p>Here are the settings that I&#39;m currently using:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">custom-set-faces</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">swiper-minibuffer-match-face-1</span>
   <span class="p">((</span><span class="no">t</span> <span class="nb">:background</span> <span class="s">&quot;#dddddd&quot;</span><span class="p">)))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">swiper-minibuffer-match-face-2</span>
   <span class="p">((</span><span class="no">t</span> <span class="nb">:background</span> <span class="s">&quot;#bbbbbb&quot;</span> <span class="nb">:weight</span> <span class="nv">bold</span><span class="p">)))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">swiper-minibuffer-match-face-3</span>
   <span class="p">((</span><span class="no">t</span> <span class="nb">:background</span> <span class="s">&quot;#bbbbff&quot;</span> <span class="nb">:weight</span> <span class="nv">bold</span><span class="p">)))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">swiper-minibuffer-match-face-4</span>
   <span class="p">((</span><span class="no">t</span> <span class="nb">:background</span> <span class="s">&quot;#ffbbff&quot;</span> <span class="nb">:weight</span> <span class="nv">bold</span><span class="p">))))</span>
</code></pre></div>
<p>It&#39;s similar to what the Firefox address bar uses: gray background and
bold font. Additionally, the matching parts are highlighted with pale
gray, blue and magenta colors. If you like the color scheme, it&#39;s part
of <a href="https://github.com/abo-abo/eclipse-theme">eclipse-theme</a>.  Another
choice, for even less distraction, could be to remove the background
from these faces, only leaving the bold part on the matches.</p>

<p>Thanks to <a href="https://github.com/Wilfred">@Wilfred</a> for nudging me to
finally implement this feature.  It&#39;s been on my list for a long time,
but I&#39;ve been putting it off.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/08/26/counsel-jedi/">
        Complete Python symbols using Ivy
      </a>
    </h1>

    <span class="post-date">26 Aug 2015</span>

    <p>I had a fascination with Python at one point, until I got too annoyed
with the indentation rules.  I still have a few scripts left over, so
I&#39;m sympathetic to Python support in Emacs.  The reason for
today&#39;s post comes from
<a href="http://emacs.stackexchange.com/questions/15032/insert-parens-while-completing-functions-in-company-mode">this question</a>
on Emacs StackExchange. Essentially, the user wants to insert parens
automatically when a function name is completed.</p>

<p>The completion candidates come from
<a href="https://github.com/tkf/emacs-jedi">jedi</a> plugin.  To quickly see
where the list of strings is coming from, I&#39;ve examined <code>ac-sources</code>
variable and saw that it contains <code>ac-source-jedi-direct</code>, which evaluates to:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">((</span><span class="nv">candidates</span> <span class="o">.</span> <span class="nv">jedi:ac-direct-matches</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">prefix</span> <span class="o">.</span> <span class="nv">jedi:ac-direct-prefix</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">init</span> <span class="o">.</span> <span class="nv">jedi:complete-request</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">requires</span> <span class="o">.</span> <span class="mi">-1</span><span class="p">))</span>
</code></pre></div>
<p>This means that <code>jedi:complete-request</code> has to be called at point,
followed by <code>jedi:ac-direct-matches</code> to obtain the list of strings. So
basically, this code:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">progn</span>
  <span class="p">(</span><span class="nv">deferred:sync!</span>
   <span class="p">(</span><span class="nv">jedi:complete-request</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">jedi:ac-direct-matches</span><span class="p">))</span>
</code></pre></div>
<p>Note the call to <code>deferred:sync!</code>. I had to add that one to make sure
that <code>jedi:complete-request</code> completes before <code>jedi:ac-direct-matches</code>
is called.</p>

<p>Testing with some Python code, where <code>|</code> is the point:</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span><span class="s2">&quot;bar&quot;</span><span class="p">}</span>
<span class="n">params</span><span class="o">.</span><span class="n">i</span>
</code></pre></div>
<p>The Elisp code above will return:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="o">#(</span><span class="s">&quot;items&quot;</span>
   <span class="mi">0</span> <span class="mi">5</span> <span class="p">(</span><span class="nv">summary</span>
        <span class="s">&quot;function: __builtin__.dict.items&quot;</span>
        <span class="nv">symbol</span>
        <span class="s">&quot;f&quot;</span>
        <span class="nv">document</span>
        <span class="s">&quot;items(self)</span>

<span class="s">D.items() -&gt; list of D&#39;s (key, value) pairs, as 2-tuples&quot;</span><span class="p">))</span>
  <span class="o">#(</span><span class="s">&quot;iteritems&quot;</span>
    <span class="mi">0</span> <span class="mi">9</span> <span class="p">(</span><span class="nv">summary</span>
         <span class="s">&quot;function: __builtin__.dict.iteritems&quot;</span>
         <span class="nv">symbol</span>
         <span class="s">&quot;f&quot;</span>
         <span class="nv">document</span>
         <span class="s">&quot;iteritems(self)</span>

<span class="s">D.iteritems() -&gt; an iterator over the (key, value) items of D&quot;</span><span class="p">))</span>
  <span class="o">#(</span><span class="s">&quot;iterkeys&quot;</span>
    <span class="mi">0</span> <span class="mi">8</span> <span class="p">(</span><span class="nv">summary</span>
         <span class="s">&quot;function: __builtin__.dict.iterkeys&quot;</span>
         <span class="nv">symbol</span>
         <span class="s">&quot;f&quot;</span>
         <span class="nv">document</span>
         <span class="s">&quot;iterkeys(self)</span>

<span class="s">D.iterkeys() -&gt; an iterator over the keys of D&quot;</span><span class="p">))</span>
  <span class="o">#(</span><span class="s">&quot;itervalues&quot;</span>
    <span class="mi">0</span> <span class="mi">10</span> <span class="p">(</span><span class="nv">summary</span>
          <span class="s">&quot;function: __builtin__.dict.itervalues&quot;</span>
          <span class="nv">symbol</span>
          <span class="s">&quot;f&quot;</span>
          <span class="nv">document</span>
          <span class="s">&quot;itervalues(self)</span>

<span class="s">D.itervalues() -&gt; an iterator over the values of D&quot;</span><span class="p">)))</span>
</code></pre></div>
<p>So these strings come with the symbol documentation and symbol type
encoded as string properties. After this, the rest of the Elisp code
follows very easily, you can find it as part of
<a href="https://github.com/abo-abo/swiper/blob/master/counsel.el">counsel</a>
package on MELPA:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">counsel-jedi</span> <span class="p">()</span>
  <span class="s">&quot;Python completion at point.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">bnd</span> <span class="p">(</span><span class="nv">bounds-of-thing-at-point</span> <span class="ss">&#39;symbol</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">if</span> <span class="nv">bnd</span>
        <span class="p">(</span><span class="k">progn</span>
          <span class="p">(</span><span class="k">setq</span> <span class="nv">counsel-completion-beg</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">bnd</span><span class="p">))</span>
          <span class="p">(</span><span class="k">setq</span> <span class="nv">counsel-completion-end</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">bnd</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">counsel-completion-beg</span> <span class="no">nil</span><span class="p">)</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">counsel-completion-end</span> <span class="no">nil</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">deferred:sync!</span>
   <span class="p">(</span><span class="nv">jedi:complete-request</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">ivy-read</span> <span class="s">&quot;Symbol name: &quot;</span> <span class="p">(</span><span class="nv">jedi:ac-direct-matches</span><span class="p">)</span>
            <span class="nb">:action</span> <span class="nf">#&#39;</span><span class="nv">counsel--py-action</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">counsel--py-action</span> <span class="p">(</span><span class="nv">symbol</span><span class="p">)</span>
  <span class="s">&quot;Insert SYMBOL, erasing the previous one.&quot;</span>
  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">symbol</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">with-ivy-window</span>
      <span class="p">(</span><span class="nb">when</span> <span class="nv">counsel-completion-beg</span>
        <span class="p">(</span><span class="nf">delete-region</span>
         <span class="nv">counsel-completion-beg</span>
         <span class="nv">counsel-completion-end</span><span class="p">))</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">counsel-completion-beg</span>
            <span class="p">(</span><span class="nv">move-marker</span> <span class="p">(</span><span class="nf">make-marker</span><span class="p">)</span> <span class="p">(</span><span class="nf">point</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">insert</span> <span class="nv">symbol</span><span class="p">)</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">counsel-completion-end</span>
            <span class="p">(</span><span class="nv">move-marker</span> <span class="p">(</span><span class="nf">make-marker</span><span class="p">)</span> <span class="p">(</span><span class="nf">point</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">equal</span> <span class="p">(</span><span class="nf">get-text-property</span> <span class="mi">0</span> <span class="ss">&#39;symbol</span> <span class="nv">symbol</span><span class="p">)</span> <span class="s">&quot;f&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">insert</span> <span class="s">&quot;()&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="k">setq</span> <span class="nv">counsel-completion-end</span>
              <span class="p">(</span><span class="nv">move-marker</span> <span class="p">(</span><span class="nf">make-marker</span><span class="p">)</span> <span class="p">(</span><span class="nf">point</span><span class="p">)))</span>
        <span class="p">(</span><span class="nf">backward-char</span> <span class="mi">1</span><span class="p">)))))</span>
</code></pre></div>
<p>Essentially, the last interesting part is <code>(equal (get-text-property 0
&#39;symbol symbol) &quot;f&quot;)</code> which test if the string corresponds to a
function or not. The rest of the code just fiddles with symbol markers
with ensure that the previous symbol is erased before the new symbol
is inserted if you press <kbd>C-M-n</kbd> (<code>ivy-next-line-and-call</code>),
or use <code>ivy-resume</code>. Just to describe how this would be useful for the
Python code above: I call <code>counsel-jedi</code>, followed by <kbd>C-M-n</kbd>
to get:</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span><span class="s2">&quot;bar&quot;</span><span class="p">}</span>
<span class="n">params</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="o">|</span><span class="p">)</span>
</code></pre></div>
<p>Pressing <kbd>C-M-n</kbd> again will result in:</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span><span class="s2">&quot;bar&quot;</span><span class="p">}</span>
<span class="n">params</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">(</span><span class="o">|</span><span class="p">)</span>
</code></pre></div>
<p>Once I&#39;m satisfied with my selected candidate, I can press either
<kbd>C-m</kbd> or <kbd>C-j</kbd> or <kbd>C-g</kbd>.  Most of the above
code can be used almost verbatim if you&#39;re a Helm fan and want to
implement <code>helm-jedi</code>. Basically, the approach I described (going
through <code>ac-sources</code>) can be used to implement alternative completion
in a lot of cases where <code>auto-complete-mode</code> completion is already
available.</p>

<p>Finally, if you like the idea of auto-inserting parens with completion
and are using C/C++, have a look at
<a href="https://github.com/abo-abo/function-args">function-args</a> - this
package does that too, with Ivy, Ido and Helm as available back ends.</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page6">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page4">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
