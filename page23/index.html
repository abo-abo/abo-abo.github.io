<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (or emacs &middot; irrelevant)
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://i.creativecommons.org/l/by-nc-sa/2.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/04/dired-nohup/">
        Start a process from dired
      </a>
    </h1>

    <span class="post-date">04 Jan 2015</span>

    <p>Here are the standard <code>dired</code> functions for starting processes:</p>

<ul>
<li><kbd>!</kbd> calls <code>dired-do-shell-command</code></li>
<li><kbd>&amp;</kbd> calls <code>dired-do-async-shell-command</code></li>
</ul>

<p>While the second one is usually better than the first one, having the
benefit of not locking up Emacs, it&#39;s still not convenient enough for
me. The reason is pretty simple: I want to keep the processes that I
started even when I close Emacs (like opened PDFs or videos).  This is
a non-issue for people with months-long <code>emacs-uptime</code>, but for me an
Emacs session lasts on the order of hours, since I mess about with
Elisp a lot. Below, I&#39;ll share some of my <code>dired</code> process-related
customizations.</p>

<h2 id="ignore-running-processes-when-closing-emacs">Ignore running processes when closing Emacs</h2>

<p>Usually there&#39;s nothing wrong with just killing a spawned process,
like an <code>ipython</code> shell or something.</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="c1">;; add `flet&#39;</span>
<span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;cl</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defadvice</span> <span class="nv">save-buffers-kill-emacs</span>
  <span class="p">(</span><span class="nv">around</span> <span class="nv">no-query-kill-emacs</span> <span class="nv">activate</span><span class="p">)</span>
  <span class="s">&quot;Prevent \&quot;Active processes exist\&quot; query on exit.&quot;</span>
  <span class="p">(</span><span class="nb">flet</span> <span class="p">((</span><span class="nf">process-list</span> <span class="p">()))</span> <span class="nv">ad-do-it</span><span class="p">))</span>
</code></pre></div>
<h2 id="guess-programs-by-file-extension">Guess programs by file extension</h2>

<p>With this setup, usually there&#39;s no need to manually type in the
command name.</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;dired-x</span><span class="p">)</span>

<span class="p">(</span><span class="k">setq</span> <span class="nv">dired-guess-shell-alist-user</span>
      <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;\\.pdf\\&#39;&quot;</span> <span class="s">&quot;evince&quot;</span> <span class="s">&quot;okular&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;\\.\\(?:djvu\\|eps\\)\\&#39;&quot;</span> <span class="s">&quot;evince&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;\\.\\(?:jpg\\|jpeg\\|png\\|gif\\|xpm\\)\\&#39;&quot;</span> <span class="s">&quot;eog&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;\\.\\(?:xcf\\)\\&#39;&quot;</span> <span class="s">&quot;gimp&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;\\.csv\\&#39;&quot;</span> <span class="s">&quot;libreoffice&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;\\.tex\\&#39;&quot;</span> <span class="s">&quot;pdflatex&quot;</span> <span class="s">&quot;latex&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;\\.\\(?:mp4\\|mkv\\|avi\\|flv\\|ogv\\)\\(?:\\.part\\)?\\&#39;&quot;</span>
         <span class="s">&quot;vlc&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;\\.\\(?:mp3\\|flac\\)\\&#39;&quot;</span> <span class="s">&quot;rhythmbox&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;\\.html?\\&#39;&quot;</span> <span class="s">&quot;firefox&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;\\.cue?\\&#39;&quot;</span> <span class="s">&quot;audacious&quot;</span><span class="p">)))</span>
</code></pre></div>
<h2 id="add-nohup">Add nohup</h2>

<p>According to <code>info nohup</code>:</p>

<blockquote>
<p>`nohup&#39; runs the given COMMAND with hangup signals ignored, so that
the command can continue running in the background after you log
out.</p>
</blockquote>

<p>In my case, it means that the processes started by Emacs can
continue running even when Emacs is closed.</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;dired-aux</span><span class="p">)</span>

<span class="p">(</span><span class="k">defvar</span> <span class="nv">dired-filelist-cmd</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;vlc&quot;</span> <span class="s">&quot;-L&quot;</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">dired-start-process</span> <span class="p">(</span><span class="nv">cmd</span> <span class="kp">&amp;optional</span> <span class="nv">file-list</span><span class="p">)</span>
  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">files</span> <span class="p">(</span><span class="nv">dired-get-marked-files</span>
                 <span class="no">t</span> <span class="nv">current-prefix-arg</span><span class="p">)))</span>
     <span class="p">(</span><span class="nf">list</span>
      <span class="p">(</span><span class="nv">dired-read-shell-command</span> <span class="s">&quot;&amp; on %s: &quot;</span>
                                <span class="nv">current-prefix-arg</span> <span class="nv">files</span><span class="p">)</span>
      <span class="nv">files</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">list-switch</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">start-process</span>
     <span class="nv">cmd</span> <span class="no">nil</span> <span class="nv">shell-file-name</span>
     <span class="nv">shell-command-switch</span>
     <span class="p">(</span><span class="nf">format</span>
      <span class="s">&quot;nohup 1&gt;/dev/null 2&gt;/dev/null %s \&quot;%s\&quot;&quot;</span>
      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">&gt;</span> <span class="p">(</span><span class="nf">length</span> <span class="nv">file-list</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
               <span class="p">(</span><span class="k">setq</span> <span class="nv">list-switch</span>
                     <span class="p">(</span><span class="nv">cadr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="nv">cmd</span> <span class="nv">dired-filelist-cmd</span><span class="p">))))</span>
          <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;%s %s&quot;</span> <span class="nv">cmd</span> <span class="nv">list-switch</span><span class="p">)</span>
        <span class="nv">cmd</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">mapconcat</span> <span class="nf">#&#39;expand-file-name</span> <span class="nv">file-list</span> <span class="s">&quot;\&quot; \&quot;&quot;</span><span class="p">)))))</span>
</code></pre></div>
<p>The <code>dired-filelist-cmd</code> is necessary because <code>vlc</code> weirdly
doesn&#39;t make a playlist when given a list of files.</p>

<p>Then I bind it to <kbd>r</kbd> - a nice shortcut not bound
by default in <code>dired</code>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">dired-mode-map</span> <span class="s">&quot;r&quot;</span> <span class="ss">&#39;dired-start-process</span><span class="p">)</span>
</code></pre></div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/03/time-flies/">
        Time flies
      </a>
    </h1>

    <span class="post-date">03 Jan 2015</span>

    <p>This is the 15th post on this blog. Thankfully, no heart attacks after
the 13th one or anything.  So I&#39;ll commemorate it with a post on
dealing with dates in <code>calc</code>.</p>

<h2 id="how-much-time-has-passed-since-i-started-this-blog?">How much time has passed since I started this blog?</h2>

<ol>
<li><p>Open <code>calc</code> with <kbd>C-x **</kbd>:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">--- Emacs Calculator Mode ---
    .
</code></pre></div></li>
<li><p>Enter <code>20 Dec 2014</code> with <kbd>&#39;&lt;12 20 14</kbd><kbd>RET</kbd>:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">--- Emacs Calculator Mode ---
1:  &lt;Sat Dec 20, 2014&gt;
    .
</code></pre></div></li>
<li><p>Enter current time with <kbd>tN</kbd>:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">--- Emacs Calculator Mode ---
2:  &lt;Sat Dec 20, 2014&gt;
1:  &lt;11:56:27am Sat Jan 3, 2015&gt;
    .
</code></pre></div></li>
<li><p>Subtract with <kbd>-</kbd>:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">--- Emacs Calculator Mode ---
1:  -14.498044
    .
</code></pre></div></li>
</ol>

<p>This means that, if I want to maintain my one-post-per-day streak, I
still have half of a day to post this. Unfortunately, I have only an
old version of the blog repository on this machine, and the current
one is on a laptop at home. So I&#39;ll post this in the evening.</p>

<h2 id="did-you-know-what-2015-looks-like-in-binary?">Did you know what 2015 looks like in binary?</h2>

<p>In your current <code>calc</code> session,</p>

<ol>
<li><p>Enter <kbd>2015</kbd> <kbd>SPC</kbd>:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">--- Emacs Calculator Mode ---
2:  -14.498044
1:  2015
    .
</code></pre></div></li>
<li><p>Switch to binary with <kbd>d2</kbd>:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">--- Emacs Calculator Mode ---
2:  -2#1110.011111110111111111001111110001
1:  2#11111011111
.
</code></pre></div></li>
<li><p>Wow, a palindrome. It&#39;s too spooky, switch back to decimal with <kbd>d0</kbd>:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">--- Emacs Calculator Mode ---
2:  -14.498044
1:  2015
    .
</code></pre></div></li>
</ol>

<p>If you&#39;re new to <code>calc</code>, you&#39;ll probably wonder why you can&#39;t enter
negative numbers with <kbd>-</kbd>. It can be done with <kbd>_</kbd>,
just like in
<a href="http://www.jsoftware.com/help/primer/negative_number.htm">J</a>. Find
out more in the
<a href="http://www.gnu.org/software/emacs/manual/html_mono/calc.html">info</a>;
the
<a href="http://www.gnu.org/software/emacs/manual/html_mono/calc.html#Tutorial">interactive tutorial</a>
is absolutely excellent.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/02/wrap-with-latex/">
        Wrap a region with a LaTeX environment
      </a>
    </h1>

    <span class="post-date">02 Jan 2015</span>

    <p>Prompted by <a href="http://stackoverflow.com/questions/27736102/wrap-text-around-a-selection-in-emacs">this StackOverflow question</a>,
I wrote down a new package called <a href="https://github.com/abo-abo/latex-wrap">latex-wrap</a>.
It&#39;s only a few hours old, but I like it a lot.
I&#39;ve grepped the sources of AUCTeX, and it doesn&#39;t seem to have this functionality.</p>

<h2 id="here&#39;s-how-it-works">Here&#39;s how it works</h2>

<p>You start with an active region:</p>

<pre><code><region>Homer
Marge
Bart
Lisa
Maggie<cursor> </cursor>
</region></code></pre>

<p>After calling <kbd>M-x</kbd> <code>latex-wrap-region</code> and selecting
<em>enumerate</em> from the list of environments (others being <em>itemize</em>,
<em>center</em> etc.), you get this:</p>

<div class="highlight"><pre><code class="language-latex" data-lang="latex"><span class="k">\begin</span><span class="nb">{</span>enumerate<span class="nb">}</span>
<span class="k">\item</span> Homer
<span class="k">\item</span> Marge
<span class="k">\item</span> Bart
<span class="k">\item</span> Lisa
<span class="k">\item</span> Maggie<cursor> </cursor>
<span class="k">\end</span><span class="nb">{</span>enumerate<span class="nb">}</span>
</code></pre></div>

<p>Let&#39;s mark everything, <kbd>M-x</kbd> <code>latex-wrap-region</code>, and select
<em>center</em>:</p>

<div class="highlight"><pre><code class="language-latex" data-lang="latex"><span class="k">\begin</span><span class="nb">{</span>center<span class="nb">}</span>
  <span class="k">\begin</span><span class="nb">{</span>enumerate<span class="nb">}</span>
  <span class="k">\item</span> Homer
  <span class="k">\item</span> Marge
  <span class="k">\item</span> Bart
  <span class="k">\item</span> Lisa
  <span class="k">\item</span> Maggie
  <span class="k">\end</span><span class="nb">{</span>enumerate<span class="nb">}</span><cursor> </cursor>
<span class="k">\end</span><span class="nb">{</span>center<span class="nb">}</span>
</code></pre></div>

<p>As you can see, I want to make sure that it&#39;s possible to conveniently
continue by always placing the point on the end of the last line of
the inserted environment.</p>

<h2 id="how-it-works-with-no-active-region">How it works with no active region</h2>

<p>If <code>(looking-back &quot;^ *&quot;)</code> is true, the current line is used as if it was
the region.  Otherwise, an empty environment is inserted after the
current line.</p>

<h2 id="using-the-code">Using the code</h2>

<p>If you like the idea, you can check out the code at
<a href="https://github.com/abo-abo/latex-wrap">github</a> and test it out.  If
you know of another package that already does this, do let me know,
otherwise I&#39;ll post the package on MELPA soon.  And if you have some
ideas, or want to add a few environments that I forgot to mention to
the list, just post
<a href="https://github.com/abo-abo/latex-wrap/issues">an issue</a>, I don&#39;t
bite.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/01/three-ansi-term-tips/">
        Three ansi-term tips
      </a>
    </h1>

    <span class="post-date">01 Jan 2015</span>

    <h2 id="tip-#1">Tip #1</h2>

<p>There&#39;s no reason not to have <code>/bin/bash</code> instead of <code>/bin/sh</code> as the
default choice when you <kbd>M-x</kbd> <code>term</code>.</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">explicit-shell-file-name</span> <span class="s">&quot;/bin/bash&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="tip-#2">Tip #2</h2>

<p>After you close the terminal, you get a useless buffer with no
process. It&#39;s probably left there for you to have a history of what
you did. I find it not useful, so here&#39;s a way to kill that buffer
automatically:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">oleh-term-exec-hook</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">buff</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">proc</span> <span class="p">(</span><span class="nf">get-buffer-process</span> <span class="nv">buff</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">set-process-sentinel</span>
     <span class="nv">proc</span>
     <span class="o">`</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">process</span> <span class="nv">event</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">string=</span> <span class="nv">event</span> <span class="s">&quot;finished\n&quot;</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">kill-buffer</span> <span class="o">,</span><span class="nv">buff</span><span class="p">))))))</span>

<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;term-exec-hook</span> <span class="ss">&#39;oleh-term-exec-hook</span><span class="p">)</span>
</code></pre></div>
<h2 id="tip-#3">Tip #3</h2>

<p>By default, <kbd>C-y</kbd> calls term&#39;s own <code>yank</code>, which is different
from Emacs&#39;s <code>yank</code>.  So, until recently, I was using
<kbd>S-&lt;insert&gt;</kbd> to paste stuff into <code>*term*</code>. Here&#39;s a
more ergonomic way:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">eval-after-load</span> <span class="s">&quot;term&quot;</span>
  <span class="o">&#39;</span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">term-raw-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c C-y&quot;</span><span class="p">)</span> <span class="ss">&#39;term-paste</span><span class="p">))</span>
</code></pre></div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/12/31/keymap-arms-race/">
        The keymap arms race
      </a>
    </h1>

    <span class="post-date">31 Dec 2014</span>

    <p>Sometimes new Emacs packages have to fight for their place in the sun,
as all the good bindings and huge keymap areas are already taken by
the older packages. This post will cover some practical problems that
you may encounter when your package needs to be aware of another
active package.</p>

<h2 id="ace-window-vs.-helm"><code>ace-window</code> vs. <code>helm</code></h2>

<p><a href="https://github.com/emacs-helm/helm">helm</a> is a wonderful package,
it&#39;s my goto-package when I need completion. All of the following
packages use it:</p>

<ul>
<li><a href="https://github.com/abo-abo/lispy">lispy</a></li>
<li><a href="https://github.com/abo-abo/function-args">function-args</a></li>
<li><a href="https://github.com/abo-abo/helm-make">helm-make</a></li>
<li><a href="https://github.com/abo-abo/worf">worf</a></li>
<li><a href="https://github.com/abo-abo/helm-j-cheatsheet">helm-j-cheatsheet</a></li>
</ul>

<p>But <code>helm</code> is super-greedy: once you&#39;re in the <code>helm</code>-minibuffer,
there&#39;s no way out except either a successful completion or a cancel.
But exiting the minibuffer for a short while may be useful. For
instance, you could copy some text and yank it in the
<code>helm</code>-minibuffer.  The default minibuffer functions, as well as <code>ido</code>
easily allow it.</p>

<p>I started to investigate into this when I got
<a href="https://github.com/abo-abo/ace-window/issues/15">issue #15: Does not work with helm in minibuffer</a>
for <code>ace-window</code>. I checked it, and indeed you could not <code>ace-window</code>
out of a <code>helm</code>-minibuffer. In fact, it was not possible to exit with
<code>other-window</code> either. This looked like good news, since I had an
inkling that it used to work at some point. So I checked out a
year-old version of <code>helm</code> and it did work.</p>

<h3 id="magit-bisect-to-the-rescue!"><code>magit-bisect</code> to the rescue!</h3>

<p>It&#39;s very simple:</p>

<ol>
<li>Check out the master of <code>helm</code></li>
<li>Call <code>magit-bisect-start</code> and mark <code>HEAD</code> as <em>bad</em></li>
<li><code>magit</code> will automatically check out a revision that is halfway
between a <em>bad</em> state and the initial commit. Now I exit Emacs and try
<code>helm</code> again to see if I can exit from the minibuffer.
It&#39;s kind of lame to have to exit Emacs, but somehow I don&#39;t trust
<code>unload-feature</code> to do the right thing. Anyway, if the thing works,
move to <code>helm</code>&#39;s repository and call <code>magit-bisect-good</code>, otherwise
call <code>magit-bisect-bad</code>.</li>
<li>Continue this process until termination. I needed 10 iterations
in this case.</li>
</ol>

<p>The culprit commit was <a href="https://github.com/emacs-helm/helm/commit/61e85df">this one</a>:</p>

<pre>
<span class="diff-context"><span class="region">     (let* ((source (helm-get-current-source))
            (kmap (and (listp source) ; Check if source is empty.
                       (assoc-default 'keymap source))))
</span></span><span class="diff-indicator-removed"><span class="region">-</span></span><span class="diff-removed"><span class="region">      (when kmap (setq overriding-local-map kmap)))))
</span></span><span class="diff-indicator-added"><span class="region">+</span></span><span class="diff-added"><span class="region">      (when kmap (set-transient-map kmap)))))</span></span></pre>

<h3 id="the-priority-of-maps">the priority of maps</h3>

<p>In Emacs, <code>set-transient-map</code> has priority over
<code>overriding-local-map</code>, which was exactly what <code>ace-window</code> was using.
It&#39;s also funny that <code>ace-window</code> used to work with <code>helm</code> for a week,
since it was published on <code>Mar 26</code> and <code>helm</code> switched to
<code>set-transient-map</code> on <code>Apr 2</code>. And I found out that it&#39;s not working only
now.</p>

<p>Here&#39;s what <code>helm</code> is using currently:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">fboundp</span> <span class="ss">&#39;set-transient-map</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">set-transient-map</span> <span class="nv">it</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">set-temporary-overlay-map</span> <span class="nv">it</span><span class="p">))</span>
</code></pre></div>
<p>So I&#39;ve amended <code>ace-window</code> with similar code. The way
<code>set-transient-map</code> works, the last call to it overrides the previous
one, so I thought that it would work out since <code>ace-window</code> is always
called after <code>helm</code>.</p>

<p>It didn&#39;t work out, because <code>helm</code> adds the code that calls
<code>set-transient-map</code> to <code>post-command-hook</code>.
In the end, this finally worked:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">remove-hook</span> <span class="ss">&#39;post-command-hook</span> <span class="ss">&#39;helm--maybe-update-keymap</span><span class="p">)</span>
</code></pre></div>
<h2 id="lispy-vs.-slime-and-cider"><code>lispy</code> vs. <code>SLIME</code> and <code>CIDER</code></h2>

<p>I thought that enabling <code>lispy-mode</code> for <code>slime-repl-mode</code> and
<code>cider-repl-mode</code> might be a good idea.
Extra navigation options are always good, and the ability to
call <code>raise</code> is just so useful.</p>

<p>For instance, you start with:</p>

<pre>
; SLIME 2014-11-28
<span class="slime-repl-prompt">CL-USER&gt; </span><span class="slime-repl-old">(expt (expt 2 10) 3)</span>
<span class="slime-repl-result"><span class="slime-repl-inputed-output">1073741824</span></span><span class="slime-repl-result">
</span><span class="slime-repl-prompt">CL-USER&gt; <cursor> </cursor></span></pre>

<p>With <code>lispy-mode</code> on you can: </p>

<ol>
<li><kbd>M-p</kbd> to get the previous input</li>
<li><kbd>f</kbd> to move the cursor after <code>(expt 2 10)</code></li>
<li><kbd>r</kbd> to raise <code>(expt 2 10)</code></li>
</ol>

<p>Here&#39;s the final state:</p>

<pre>
; SLIME 2014-11-28
<span class="slime-repl-prompt">CL-USER&gt; </span><span class="slime-repl-old">(expt (expt 2 10) 3)</span>
<span class="slime-repl-result"><span class="slime-repl-inputed-output">1073741824</span></span><span class="slime-repl-result">
</span><span class="slime-repl-prompt">CL-USER&gt;</span> (expt 2 10)<cursor> </cursor></pre>

<p>But the problem was that SLIME has <code>slime-repl-map-mode</code> minor mode on
that competes for <code>lispy</code>&#39;s shortcuts, and CIDER has something similar
as well.</p>

<blockquote>
<p>When two minor modes bind the same keys, which one wins?</p>
</blockquote>

<p>The answer is the first one on <code>minor-mode-map-alist</code>.
This function I&#39;ve found on the <a href="http://www.emacswiki.org/emacs/minor-mode-hack.el">wiki</a>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">lispy-raise-minor-mode</span> <span class="p">(</span><span class="nv">mode</span><span class="p">)</span>
  <span class="s">&quot;Make MODE the first on `minor-mode-map-alist&#39;.&quot;</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">x</span> <span class="p">(</span><span class="nf">assq</span> <span class="nv">mode</span> <span class="nv">minor-mode-map-alist</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="nv">x</span>
        <span class="p">(</span><span class="k">setq</span> <span class="nv">minor-mode-map-alist</span>
              <span class="p">(</span><span class="nf">cons</span> <span class="nv">x</span> <span class="p">(</span><span class="nf">delq</span> <span class="nv">mode</span> <span class="nv">minor-mode-map-alist</span><span class="p">))))))</span>
</code></pre></div>
<p>I didn&#39;t want <code>lispy-mode</code> to mess with <code>minor-mode-map-alist</code> too
actively, so I went with this approach: if <code>lispy-mode</code> is called
interactively, i.e. via a key binding or <kbd>M-x</kbd>, put it ahead:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="k">and</span> <span class="nv">lispy-mode</span> <span class="p">(</span><span class="nv">called-interactively-p</span> <span class="ss">&#39;any</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">mapc</span> <span class="nf">#&#39;</span><span class="nv">lispy-raise-minor-mode</span>
          <span class="p">(</span><span class="nf">cons</span> <span class="ss">&#39;lispy-mode</span> <span class="nv">lispy-known-verbs</span><span class="p">)))</span>
</code></pre></div>
<p>It&#39;s still a work in progress, currently only <code>lispy</code>&#39;s <kbd>RET</kbd>
properly yields to call <code>cider-repl-return</code> and <code>slime-repl-return</code>
respectively. I&#39;ll see if there are more key bindings that need to
yield. Happy coding in the New Year!</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page24">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page22">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
