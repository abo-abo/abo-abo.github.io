<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="flattr:id" content="9yl9ry">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (or emacs &middot; irrelevant)
    
  </title>

  <link rel="canonical" href="https://oremacs.com/page7/" />

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>
          <a class="sidebar-nav-item" href="/about/">About</a>
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
          <a class="sidebar-nav-item" href="/donate/">Donate</a>
        <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://licensebuttons.net/l/by-sa/4.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/03/16/counsel-linux-app/">
        Emacs completion for launching Linux desktop apps.
      </a>
    </h1>

    <span class="post-date">16 Mar 2016</span>

    <p>I&#39;d like to highlight the new command <code>counsel-linux-app</code> that I
recently added to the <a href="https://github.com/abo-abo/swiper">counsel</a>
package:</p>

<p><img src="/download/counsel-linux-app-1.png" alt="counsel-linux-app-1.png"></p>

<p>This command looks through your <code>/usr/share/applications/*.desktop</code>
and offers to launch them, just like the launcher that you normally
get when you press the super key. My current system is Ubuntu, and the
launcher here is really horrible, so I&#39;m glad to have a much faster
and reliable replacement.</p>

<p>Here&#39;s another screenshot, I open the keyboard settings quite often:</p>

<p><img src="/download/counsel-linux-app-2.png" alt="counsel-linux-app-2.png"></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/02/24/dired-rsync/">
        Using rsync in dired
      </a>
    </h1>

    <span class="post-date">24 Feb 2016</span>

    <p>Here&#39;s a code snippet I&#39;ve found long ago on the internet (the source
seems to be no longer accessible), that has proven valuable time and
time again:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">ora-dired-rsync</span> <span class="p">(</span><span class="nv">dest</span><span class="p">)</span>
  <span class="p">(</span><span class="k">interactive</span>
   <span class="p">(</span><span class="nf">list</span>
    <span class="p">(</span><span class="nf">expand-file-name</span>
     <span class="p">(</span><span class="nv">read-file-name</span>
      <span class="s">&quot;Rsync to:&quot;</span>
      <span class="p">(</span><span class="nv">dired-dwim-target-directory</span><span class="p">)))))</span>
  <span class="c1">;; store all selected files into &quot;files&quot; list</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">files</span> <span class="p">(</span><span class="nv">dired-get-marked-files</span>
                <span class="no">nil</span> <span class="nv">current-prefix-arg</span><span class="p">))</span>
        <span class="c1">;; the rsync command</span>
        <span class="p">(</span><span class="nv">tmtxt/rsync-command</span>
         <span class="s">&quot;rsync -arvz --progress &quot;</span><span class="p">))</span>
    <span class="c1">;; add all selected file names as arguments</span>
    <span class="c1">;; to the rsync command</span>
    <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">file</span> <span class="nv">files</span><span class="p">)</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">tmtxt/rsync-command</span>
            <span class="p">(</span><span class="nf">concat</span> <span class="nv">tmtxt/rsync-command</span>
                    <span class="p">(</span><span class="nv">shell-quote-argument</span> <span class="nv">file</span><span class="p">)</span>
                    <span class="s">&quot; &quot;</span><span class="p">)))</span>
    <span class="c1">;; append the destination</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">tmtxt/rsync-command</span>
          <span class="p">(</span><span class="nf">concat</span> <span class="nv">tmtxt/rsync-command</span>
                  <span class="p">(</span><span class="nv">shell-quote-argument</span> <span class="nv">dest</span><span class="p">)))</span>
    <span class="c1">;; run the async shell command</span>
    <span class="p">(</span><span class="nv">async-shell-command</span> <span class="nv">tmtxt/rsync-command</span> <span class="s">&quot;*rsync*&quot;</span><span class="p">)</span>
    <span class="c1">;; finally, switch to that window</span>
    <span class="p">(</span><span class="nv">other-window</span> <span class="mi">1</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">define-key</span> <span class="nv">dired-mode-map</span> <span class="s">&quot;Y&quot;</span> <span class="ss">&#39;ora-dired-rsync</span><span class="p">)</span>
</code></pre></div>
<p>Lets you copy huge files and directories without Emacs freezing up and
with convenient progress bar updates. That is all.</p>

<p>Thanks to <code>tmtxt</code>, the mysterious hacker-person from whom the snippet
likely originated .  Good luck with getting your blog back up.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/02/15/counsel-ffap/">
        Visiting URLs and issues with counsel-find-file
      </a>
    </h1>

    <span class="post-date">15 Feb 2016</span>

    <p>Many experienced Emacs users are aware of <code>ffap</code> command:</p>

<blockquote>
<p>Find FILENAME, guessing a default from text around point.
If <code>ffap-url-regexp</code> is not nil, the FILENAME may also be an URL.</p>
</blockquote>

<p>It&#39;s a great way to open an link, if you plan things in advance. But
for me it was usually <kbd>C-x C-f</kbd> (annoyed grunt) <kbd>C-g M-x
ffap RET</kbd>.</p>

<p>Now, thanks to <a href="https://github.com/abo-abo/swiper">counsel-find-file</a>,
it&#39;s <kbd>C-x C-f</kbd> (anticipated annoyance, followed by a sigh of
relief) <kbd>M-n</kbd>.</p>

<p>With Ivy completion, <kbd>M-n</kbd> calls <code>ivy-next-history-element</code>,
which tries to</p>

<p><a href="http://endlessparentheses.com/predicting-the-future-with-the-m-n-key.html">predict the history element</a>
in case you&#39;ve reached history&#39;s edge. The prediction usually simply
inserts thing-at-point into the minibuffer. My favorite applications
of this are:</p>

<ul>
<li><kbd>C-s M-n</kbd> - <code>swiper</code> thing-at-point, to get the occurrences
of the current symbol in the current file.</li>
<li><kbd>C-c j M-n</kbd> - <code>counsel-git-grep</code> thing-at-point, to get the
mentions within the current project.</li>
<li><kbd>C-c g M-n</kbd> - <code>counsel-git</code> thing-at-point to open a file
to which the current symbol links.</li>
</ul>

<p>One thing I&#39;ve recently added is the <code>\_&lt;...\_&gt;</code> wrapper for when
<code>major-mode</code> derives from <code>prog-mode</code>. Since the <code>\_&lt;</code> regex matches
the symbol start, and <code>\_&gt;</code> matches the symbol end, there&#39;s no chance
of getting partial matches. You can call <code>undo</code> or press
<kbd>M-n</kbd> again in case the symbol bounds aren&#39;t useful.</p>

<p>Finally, <kbd>C-x C-f M-n</kbd> can be used to open URLs. Recently,
I&#39;ve added functionality to <code>counsel-find-file</code> that allows me to also
visit Github issues by simply pointing at the plain issue number,
e.g. <code>#123</code> in either a version-controlled file or in a Magit buffer.
The command will query:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>$ git remote get-url origin
</code></pre></div>
<p>and fill in all the details. So I no longer bother with
<code>bug-reference-url-format</code> and <code>bug-reference-mode</code> - now it&#39;s all
automatic.</p>

<p>It&#39;s also possible to make it work for places other than Github, for
instance this code (already included in
<a href="http://melpa.org/#/counsel">counsel</a>) makes it work for the Emacs Git
repository:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">counsel-emacs-url-p</span> <span class="p">()</span>
  <span class="s">&quot;Return a Debbugs issue URL at point.&quot;</span>
  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">looking-at</span> <span class="s">&quot;#[0-9]+&quot;</span><span class="p">)</span>
             <span class="p">(</span><span class="k">or</span>
              <span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nv">vc-backend</span> <span class="p">(</span><span class="nf">buffer-file-name</span><span class="p">))</span> <span class="ss">&#39;Git</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">memq</span> <span class="nv">major-mode</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">magit-commit-mode</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">url</span> <span class="p">(</span><span class="nv">match-string-no-properties</span> <span class="mi">0</span><span class="p">))</span>
          <span class="p">(</span><span class="nv">origin</span> <span class="p">(</span><span class="nv">shell-command-to-string</span>
                   <span class="s">&quot;git remote get-url origin&quot;</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">string-match</span> <span class="s">&quot;git.sv.gnu.org:/srv/git/emacs.git&quot;</span>
                          <span class="nv">origin</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;http://debbugs.gnu.org/cgi/bugreport.cgi?bug=%s&quot;</span>
                <span class="p">(</span><span class="nf">substring</span> <span class="nv">url</span> <span class="mi">1</span><span class="p">))))))</span>

<span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;ivy-ffap-url-functions</span> <span class="ss">&#39;counsel-emacs-url-p</span><span class="p">)</span>
</code></pre></div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/01/23/avy-0.4.0/">
        avy 0.4.0 is out
      </a>
    </h1>

    <span class="post-date">23 Jan 2016</span>

    <p>This release consists of 77 commits done over the course of the last 7
months by me and many
<a href="https://github.com/abo-abo/avy/graphs/contributors">contributors</a>. Similarly
to the <code>0.3.0</code> release, the release notes are in
<a href="https://github.com/abo-abo/avy/blob/master/doc/Changelog.org">Changelog.org</a>.
You can read them either at
<a href="https://github.com/abo-abo/avy/releases/tag/0.4.0">github</a> or
<a href="https://raw.githubusercontent.com/abo-abo/avy/master/doc/Changelog.org">inside Emacs</a>.
Big thanks to all contributors.</p>

<p><img src="https://raw.githubusercontent.com/wiki/abo-abo/avy/images/avy-avatar-1.png" alt="avy.png"></p>

<h2 id="highlights">Highlights</h2>

<p>A lot of new code is just straight upgrades, you don&#39;t need to do
anything extra to use them. Below, I&#39;ll describe the other part of the
new code, which is new commands and custom vars.</p>

<h3 id="avy-goto-char-timer"><code>avy-goto-char-timer</code></h3>

<p>This command now allows as many characters as you like, which makes it
similar to a <code>isearch</code> + <code>avy-isearch</code> combination.  As you type, you
get an <code>isearch</code>-like highlight, then after a short delay you
automatically get the <code>avy</code> selection.</p>

<h3 id="switch-the-action-midway-from-goto-to-kill-mark-copy">Switch the action midway from goto to kill/mark/copy</h3>

<p>This is similar to the cool feature of
<a href="http://oremacs.com/2015/05/13/ace-window-0.9.0/">ace-window</a> that
allows you to switch the action after you get the avy prompt.</p>

<p>For example, suppose you have:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;M-t&quot;</span><span class="p">)</span> <span class="ss">&#39;avy-goto-word-1</span><span class="p">)</span>
</code></pre></div>
<p>Here&#39;s what you can do now to a word that starts with a &quot;w&quot; and is
select-able with &quot;a&quot;:</p>

<ul>
<li>To jump there: <kbd>M-t w a</kbd>.</li>
<li>To copy the word instead of jumping to it: <kbd>M-t w na</kbd></li>
<li>To mark the word after jumping to it: <kbd>M-t w ma</kbd>.</li>
<li>To kill the word after jumping to it: <kbd>M-t w xa</kbd>.</li>
</ul>

<p>You can customize <code>avy-dispatch-alist</code> to modify these actions, and
also ensure that it plays nicely with your <code>avy-keys</code>, if you
customized them.  By default, it works fine, since <code>avy-keys</code> is <code>&#39;(?a
?s ?d ?f ?g ?h ?j ?k ?l)</code> and the keys on <code>avy-dispatch-alist</code> are
<code>&#39;(?x ?m ?n)</code>.</p>

<h3 id="avy-pop-mark"><code>avy-pop-mark</code></h3>

<p>This command reverses <code>avy-push-mark</code> which most of avy commands call.
It has its own history and works across multiple windows and frames.
I&#39;m using it currently as an upgrade to my old <code>(set-mark-command 4)</code>
lambda:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;M-p&quot;</span><span class="p">)</span> <span class="ss">&#39;avy-pop-mark</span><span class="p">)</span>
</code></pre></div>
<p>Here&#39;s a line to make <code>avy-pop-mark</code> work also for <code>swiper</code>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;swiper</span> <span class="nb">:before</span> <span class="ss">&#39;avy-push-mark</span><span class="p">)</span>
</code></pre></div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/01/18/emacs-rhythmbox/">
        Using Emacs as system-wide Rhythmbox interface
      </a>
    </h1>

    <span class="post-date">18 Jan 2016</span>

    <p>In an
<a href="http://oremacs.com/2015/07/09/counsel-rhythmbox/">earlier post</a>, I
described how I&#39;ve been managing Rhythmbox from Emacs. I&#39;ve bound the
entry point to <kbd>C-S-o</kbd>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-S-o&quot;</span><span class="p">)</span> <span class="ss">&#39;counsel-rhythmbox</span><span class="p">)</span>
</code></pre></div>
<p>Obviously, this entry point won&#39;t work while outside Emacs. Today,
I&#39;ll describe how I&#39;ve made it work everywhere. Everywhere on Ubuntu
14.04, that is, although a similar approach should work for other
distributions.</p>

<h2 id="step-1-make-sure-the-emacs-server-is-running">Step 1: Make sure the Emacs server is running</h2>

<p>Here&#39;s the relevant part of my <a href="https://github.com/abo-abo/oremacs/blob/github/init.el">init.el</a>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;server</span><span class="p">)</span>
<span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nv">server-running-p</span><span class="p">)</span> <span class="p">(</span><span class="nv">server-start</span><span class="p">))</span>
</code></pre></div>
<p>Using <code>emacsclient</code> is essential to avoiding the extra startup time:
even a startup time of one second feels sluggish when all I need is to
open a menu with a song playlist.</p>

<h2 id="step-2-install-the-relevant-x-window-tool">Step 2: Install the relevant X window tool</h2>

<p>Initially, I only wrote a call to <code>emacsclient</code>, which resulted in the
Emacs window gaining focus in the end.  Then I thought it would be
nice to give the focus back the original window after the end of
selection, and raise it as well.</p>

<p>I wanted to do something with <code>wmctrl</code>, but I found that
<a href="http://superuser.com/questions/382616/detecting-currently-active-window">xdotool</a>
can do what I want in a simple way.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>sudo apt-get install xdotool
</code></pre></div>
<h2 id="step-3-write-a-shell-script">Step 3: Write a shell script</h2>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span><span class="ch">#!/bin/bash</span>
<span class="nv">wnd_id</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>xdotool getwindowfocus<span class="k">)</span><span class="s2">&quot;</span>
emacsclient --eval <span class="s2">&quot;(progn (x-focus-frame nil) (counsel-rhythmbox))&quot;</span>
xdotool windowfocus <span class="nv">$wnd_id</span>
xdotool windowraise <span class="nv">$wnd_id</span>
</code></pre></div>
<p>Here, <code>(x-focus-frame nil)</code> will raise the Emacs window and give the
keyboard input focus.  <code>emacsclient</code> will return as soon as I select
something or press <kbd>C-g</kbd>. At that point the keyboard focus
will be returned to whatever window had it when the script was
invoked.</p>

<p>By the way, here&#39;s a cool configuration that automatically makes a
file executable if it starts with <code>#!</code>.</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">add-hook</span>
 <span class="ss">&#39;after-save-hook</span>
 <span class="ss">&#39;executable-make-buffer-file-executable-if-script-p</span><span class="p">)</span>
</code></pre></div>
<h2 id="step-4-bind-the-shell-script-to-a-key">Step 4: Bind the shell script to a key</h2>

<p>Open this (possibly using <code>gnome-control-center</code> instead, if applicable):</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>unity-control-center keyboard
</code></pre></div>
<p>And add a new shortcut in <code>Shortcuts</code>/<code>Custom Shortcuts</code>. I&#39;ve bound
that one to <kbd>C-S-o</kbd> as well.</p>

<h2 id="the-final-result">The final result</h2>

<p>It&#39;s pretty convenient: as I&#39;m scrolling something I&#39;m reading in
Firefox with <kbd>j</kbd> (via
<a href="https://addons.mozilla.org/en-US/firefox/addon/firemacs/">Firemacs</a>),
I can seamlessly press <kbd>C-S-o moo RET</kbd> to play &quot;Sisters of
the Moon&quot;, and continue scrolling the web page with <kbd>j</kbd>.</p>

<p>What&#39;s more, Emacs has very nice support for input methods with
<kbd>C-\</kbd> (<code>toggle-input-method</code>), so I can also quickly select
Ukrainian-titled songs, while still keeping shortcuts like
<kbd>C-n</kbd> and <kbd>C-m</kbd> (<em>without</em> having to switch the
input method back).</p>

<p>The whole experience is similar to <code>gnome-do</code>/<code>synapse</code>, which I was
using a few years back, except better because now it&#39;s in Emacs.</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page8">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page6">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
