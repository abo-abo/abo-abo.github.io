<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (or emacs &middot; irrelevant)
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://i.creativecommons.org/l/by-nc-sa/2.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/01/three-ansi-term-tips/">
        Three ansi-term tips
      </a>
    </h1>

    <span class="post-date">01 Jan 2015</span>

    <h2 id="tip-#1">Tip #1</h2>

<p>There&#39;s no reason not to have <code>/bin/bash</code> instead of <code>/bin/sh</code> as the
default choice when you <kbd>M-x</kbd> <code>term</code>.</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">explicit-shell-file-name</span> <span class="s">&quot;/bin/bash&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="tip-#2">Tip #2</h2>

<p>After you close the terminal, you get a useless buffer with no
process. It&#39;s probably left there for you to have a history of what
you did. I find it not useful, so here&#39;s a way to kill that buffer
automatically:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">oleh-term-exec-hook</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">buff</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">proc</span> <span class="p">(</span><span class="nf">get-buffer-process</span> <span class="nv">buff</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">set-process-sentinel</span>
     <span class="nv">proc</span>
     <span class="o">`</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">process</span> <span class="nv">event</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">string=</span> <span class="nv">event</span> <span class="s">&quot;finished\n&quot;</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">kill-buffer</span> <span class="o">,</span><span class="nv">buff</span><span class="p">))))))</span>

<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;term-exec-hook</span> <span class="ss">&#39;oleh-term-exec-hook</span><span class="p">)</span>
</code></pre></div>
<h2 id="tip-#3">Tip #3</h2>

<p>By default, <kbd>C-y</kbd> calls term&#39;s own <code>yank</code>, which is different
from Emacs&#39;s <code>yank</code>.  So, until recently, I was using
<kbd>S-&lt;insert&gt;</kbd> to paste stuff into <code>*term*</code>. Here&#39;s a
more ergonomic way:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">eval-after-load</span> <span class="s">&quot;term&quot;</span>
  <span class="o">&#39;</span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">term-raw-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c C-y&quot;</span><span class="p">)</span> <span class="ss">&#39;term-paste</span><span class="p">))</span>
</code></pre></div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/12/31/keymap-arms-race/">
        The keymap arms race
      </a>
    </h1>

    <span class="post-date">31 Dec 2014</span>

    <p>Sometimes new Emacs packages have to fight for their place in the sun,
as all the good bindings and huge keymap areas are already taken by
the older packages. This post will cover some practical problems that
you may encounter when your package needs to be aware of another
active package.</p>

<h2 id="ace-window-vs.-helm"><code>ace-window</code> vs. <code>helm</code></h2>

<p><a href="https://github.com/emacs-helm/helm">helm</a> is a wonderful package,
it&#39;s my goto-package when I need completion. All of the following
packages use it:</p>

<ul>
<li><a href="https://github.com/abo-abo/lispy">lispy</a></li>
<li><a href="https://github.com/abo-abo/function-args">function-args</a></li>
<li><a href="https://github.com/abo-abo/helm-make">helm-make</a></li>
<li><a href="https://github.com/abo-abo/worf">worf</a></li>
<li><a href="https://github.com/abo-abo/helm-j-cheatsheet">helm-j-cheatsheet</a></li>
</ul>

<p>But <code>helm</code> is super-greedy: once you&#39;re in the <code>helm</code>-minibuffer,
there&#39;s no way out except either a successful completion or a cancel.
But exiting the minibuffer for a short while may be useful. For
instance, you could copy some text and yank it in the
<code>helm</code>-minibuffer.  The default minibuffer functions, as well as <code>ido</code>
easily allow it.</p>

<p>I started to investigate into this when I got
<a href="https://github.com/abo-abo/ace-window/issues/15">issue #15: Does not work with helm in minibuffer</a>
for <code>ace-window</code>. I checked it, and indeed you could not <code>ace-window</code>
out of a <code>helm</code>-minibuffer. In fact, it was not possible to exit with
<code>other-window</code> either. This looked like good news, since I had an
inkling that it used to work at some point. So I checked out a
year-old version of <code>helm</code> and it did work.</p>

<h3 id="magit-bisect-to-the-rescue!"><code>magit-bisect</code> to the rescue!</h3>

<p>It&#39;s very simple:</p>

<ol>
<li>Check out the master of <code>helm</code></li>
<li>Call <code>magit-bisect-start</code> and mark <code>HEAD</code> as <em>bad</em></li>
<li><code>magit</code> will automatically check out a revision that is halfway
between a <em>bad</em> state and the initial commit. Now I exit Emacs and try
<code>helm</code> again to see if I can exit from the minibuffer.
It&#39;s kind of lame to have to exit Emacs, but somehow I don&#39;t trust
<code>unload-feature</code> to do the right thing. Anyway, if the thing works,
move to <code>helm</code>&#39;s repository and call <code>magit-bisect-good</code>, otherwise
call <code>magit-bisect-bad</code>.</li>
<li>Continue this process until termination. I needed 10 iterations
in this case.</li>
</ol>

<p>The culprit commit was <a href="https://github.com/emacs-helm/helm/commit/61e85df">this one</a>:</p>

<pre>
<span class="diff-context"><span class="region">     (let* ((source (helm-get-current-source))
            (kmap (and (listp source) ; Check if source is empty.
                       (assoc-default 'keymap source))))
</span></span><span class="diff-indicator-removed"><span class="region">-</span></span><span class="diff-removed"><span class="region">      (when kmap (setq overriding-local-map kmap)))))
</span></span><span class="diff-indicator-added"><span class="region">+</span></span><span class="diff-added"><span class="region">      (when kmap (set-transient-map kmap)))))</span></span></pre>

<h3 id="the-priority-of-maps">the priority of maps</h3>

<p>In Emacs, <code>set-transient-map</code> has priority over
<code>overriding-local-map</code>, which was exactly what <code>ace-window</code> was using.
It&#39;s also funny that <code>ace-window</code> used to work with <code>helm</code> for a week,
since it was published on <code>Mar 26</code> and <code>helm</code> switched to
<code>set-transient-map</code> on <code>Apr 2</code>. And I found out that it&#39;s not working only
now.</p>

<p>Here&#39;s what <code>helm</code> is using currently:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">fboundp</span> <span class="ss">&#39;set-transient-map</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">set-transient-map</span> <span class="nv">it</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">set-temporary-overlay-map</span> <span class="nv">it</span><span class="p">))</span>
</code></pre></div>
<p>So I&#39;ve amended <code>ace-window</code> with similar code. The way
<code>set-transient-map</code> works, the last call to it overrides the previous
one, so I thought that it would work out since <code>ace-window</code> is always
called after <code>helm</code>.</p>

<p>It didn&#39;t work out, because <code>helm</code> adds the code that calls
<code>set-transient-map</code> to <code>post-command-hook</code>.
In the end, this finally worked:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">remove-hook</span> <span class="ss">&#39;post-command-hook</span> <span class="ss">&#39;helm--maybe-update-keymap</span><span class="p">)</span>
</code></pre></div>
<h2 id="lispy-vs.-slime-and-cider"><code>lispy</code> vs. <code>SLIME</code> and <code>CIDER</code></h2>

<p>I thought that enabling <code>lispy-mode</code> for <code>slime-repl-mode</code> and
<code>cider-repl-mode</code> might be a good idea.
Extra navigation options are always good, and the ability to
call <code>raise</code> is just so useful.</p>

<p>For instance, you start with:</p>

<pre>
; SLIME 2014-11-28
<span class="slime-repl-prompt">CL-USER&gt; </span><span class="slime-repl-old">(expt (expt 2 10) 3)</span>
<span class="slime-repl-result"><span class="slime-repl-inputed-output">1073741824</span></span><span class="slime-repl-result">
</span><span class="slime-repl-prompt">CL-USER&gt; <cursor> </cursor></span></pre>

<p>With <code>lispy-mode</code> on you can: </p>

<ol>
<li><kbd>M-p</kbd> to get the previous input</li>
<li><kbd>f</kbd> to move the cursor after <code>(expt 2 10)</code></li>
<li><kbd>r</kbd> to raise <code>(expt 2 10)</code></li>
</ol>

<p>Here&#39;s the final state:</p>

<pre>
; SLIME 2014-11-28
<span class="slime-repl-prompt">CL-USER&gt; </span><span class="slime-repl-old">(expt (expt 2 10) 3)</span>
<span class="slime-repl-result"><span class="slime-repl-inputed-output">1073741824</span></span><span class="slime-repl-result">
</span><span class="slime-repl-prompt">CL-USER&gt;</span> (expt 2 10)<cursor> </cursor></pre>

<p>But the problem was that SLIME has <code>slime-repl-map-mode</code> minor mode on
that competes for <code>lispy</code>&#39;s shortcuts, and CIDER has something similar
as well.</p>

<blockquote>
<p>When two minor modes bind the same keys, which one wins?</p>
</blockquote>

<p>The answer is the first one on <code>minor-mode-map-alist</code>.
This function I&#39;ve found on the <a href="http://www.emacswiki.org/emacs/minor-mode-hack.el">wiki</a>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">lispy-raise-minor-mode</span> <span class="p">(</span><span class="nv">mode</span><span class="p">)</span>
  <span class="s">&quot;Make MODE the first on `minor-mode-map-alist&#39;.&quot;</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">x</span> <span class="p">(</span><span class="nf">assq</span> <span class="nv">mode</span> <span class="nv">minor-mode-map-alist</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="nv">x</span>
        <span class="p">(</span><span class="k">setq</span> <span class="nv">minor-mode-map-alist</span>
              <span class="p">(</span><span class="nf">cons</span> <span class="nv">x</span> <span class="p">(</span><span class="nf">delq</span> <span class="nv">mode</span> <span class="nv">minor-mode-map-alist</span><span class="p">))))))</span>
</code></pre></div>
<p>I didn&#39;t want <code>lispy-mode</code> to mess with <code>minor-mode-map-alist</code> too
actively, so I went with this approach: if <code>lispy-mode</code> is called
interactively, i.e. via a key binding or <kbd>M-x</kbd>, put it ahead:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="k">and</span> <span class="nv">lispy-mode</span> <span class="p">(</span><span class="nv">called-interactively-p</span> <span class="ss">&#39;any</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">mapc</span> <span class="nf">#&#39;</span><span class="nv">lispy-raise-minor-mode</span>
          <span class="p">(</span><span class="nf">cons</span> <span class="ss">&#39;lispy-mode</span> <span class="nv">lispy-known-verbs</span><span class="p">)))</span>
</code></pre></div>
<p>It&#39;s still a work in progress, currently only <code>lispy</code>&#39;s <kbd>RET</kbd>
properly yields to call <code>cider-repl-return</code> and <code>slime-repl-return</code>
respectively. I&#39;ll see if there are more key bindings that need to
yield. Happy coding in the New Year!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/12/30/ace-link-eww/">
        Emacs Web Wowser (EWW) got ace-link
      </a>
    </h1>

    <span class="post-date">30 Dec 2014</span>

    <h2 id="emacs-goodness-incoming">Emacs goodness incoming</h2>

<p>I&#39;ve discovered a nice Emacs-related blog -
<a href="http://mbork.pl/Content_AND_Presentation">Content AND Presentation</a>.
Unlike <a href="http://axisofeval.blogspot.nl">The Axis of Eval</a>, the blog
that I mentioned yesterday, this one is pretty self-contained, i.e. it
doesn&#39;t link to many external information sources.  So I thought that
it&#39;s perfect for trying EWW to read it.</p>

<h2 id="not-so-fast!-configure-first.">Not so fast! Configure first.</h2>

<p>For modes that don&#39;t require to self-insert (and even for some that
do), I like to navigate with
<kbd>h</kbd>/<kbd>j</kbd>/<kbd>k</kbd>/<kbd>l</kbd> as arrows.  These
arrows are on the home row, so navigation becomes a pleasant and
relaxed experience.  But for EWW I decided to add a little twist: if
the point is in the first column, <kbd>j</kbd>/<kbd>k</kbd> will move
down/up not by one line, but by one paragraph.  This is great for
concentration: I navigate to a paragraph, read it, navigate to the
next one. The point shows me the paragraph that I&#39;m reading,
everything before the point I&#39;ve already read.  So every time I press
<kbd>j</kbd>, I get a tiny warm feeling of accomplishment.
I can also pair this with <kbd>v</kbd>, which I bind to recenter the
current line to the top.</p>

<p>So here&#39;s what my key setup currently looks like:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">oleh-eww-hook</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">eww-mode-map</span> <span class="s">&quot;j&quot;</span> <span class="ss">&#39;oww-down</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">eww-mode-map</span> <span class="s">&quot;k&quot;</span> <span class="ss">&#39;oww-up</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">eww-mode-map</span> <span class="s">&quot;l&quot;</span> <span class="ss">&#39;forward-char</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">eww-mode-map</span> <span class="s">&quot;L&quot;</span> <span class="ss">&#39;eww-back-url</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">eww-mode-map</span> <span class="s">&quot;h&quot;</span> <span class="ss">&#39;backward-char</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">eww-mode-map</span> <span class="s">&quot;v&quot;</span> <span class="ss">&#39;recenter-top-bottom</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">eww-mode-map</span> <span class="s">&quot;V&quot;</span> <span class="ss">&#39;eww-view-source</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">eww-mode-map</span> <span class="s">&quot;m&quot;</span> <span class="ss">&#39;eww-follow-link</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">eww-mode-map</span> <span class="s">&quot;a&quot;</span> <span class="ss">&#39;move-beginning-of-line</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">eww-mode-map</span> <span class="s">&quot;e&quot;</span> <span class="ss">&#39;move-end-of-line</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">eww-mode-map</span> <span class="s">&quot;o&quot;</span> <span class="ss">&#39;ace-link-eww</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">eww-mode-map</span> <span class="s">&quot;y&quot;</span> <span class="ss">&#39;eww</span><span class="p">))</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;eww-mode-hook</span> <span class="ss">&#39;oleh-eww-hook</span><span class="p">)</span>
</code></pre></div>
<p>As you see, I was careful to re-assign <code>eww-back-url</code> and
<code>eww-view-source</code> - the commands that I&#39;ve displaced from <kbd>l</kbd>
and <kbd>v</kbd>.  And here&#39;s the implementation of the arrows:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">oww-down</span> <span class="p">(</span><span class="nv">arg</span><span class="p">)</span>
  <span class="p">(</span><span class="k">interactive</span> <span class="s">&quot;p&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">bolp</span><span class="p">)</span>
      <span class="p">(</span><span class="k">progn</span>
        <span class="p">(</span><span class="nv">forward-paragraph</span> <span class="nv">arg</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">forward-line</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">line-move</span> <span class="nv">arg</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">oww-up</span> <span class="p">(</span><span class="nv">arg</span><span class="p">)</span>
  <span class="p">(</span><span class="k">interactive</span> <span class="s">&quot;p&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">bolp</span><span class="p">)</span>
      <span class="p">(</span><span class="k">progn</span>
        <span class="p">(</span><span class="nf">forward-line</span> <span class="mi">-1</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">backward-paragraph</span> <span class="nv">arg</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">forward-line</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">line-move</span> <span class="p">(</span><span class="nf">-</span> <span class="nv">arg</span><span class="p">))))</span>
</code></pre></div>
<h2 id="cherry-on-the-top">Cherry on the top</h2>

<p>And while I was at it, I&#39;ve added <a href="https://github.com/abo-abo/ace-link">ace-link</a> support for EWW.  It was
pretty easy, basically the same routine as for <code>help-mode</code> and
<code>info-mode</code>. The only hard part was to figure out what part of the
code keeps binding <code>shr-save-contents</code> to <kbd>o</kbd>, my preferred
binding for <code>ace-link</code>. Turns out it was <code>eww-link-keymap</code>, and not
<code>shr-map</code>. So here&#39;s the new key binding code:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">ace-link-setup-default</span> <span class="p">()</span>
  <span class="s">&quot;Setup the defualt shortcuts.&quot;</span>
  <span class="p">(</span><span class="nv">eval-after-load</span> <span class="s">&quot;info&quot;</span>
    <span class="o">&#39;</span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">Info-mode-map</span> <span class="s">&quot;o&quot;</span> <span class="ss">&#39;ace-link-info</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">eval-after-load</span> <span class="s">&quot;help-mode&quot;</span>
    <span class="o">&#39;</span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">help-mode-map</span> <span class="s">&quot;o&quot;</span> <span class="ss">&#39;ace-link-help</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">eval-after-load</span> <span class="s">&quot;eww&quot;</span>
    <span class="o">&#39;</span><span class="p">(</span><span class="k">progn</span>
      <span class="p">(</span><span class="nf">define-key</span> <span class="nv">eww-link-keymap</span> <span class="s">&quot;o&quot;</span> <span class="ss">&#39;ace-link-eww</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">define-key</span> <span class="nv">eww-mode-map</span> <span class="s">&quot;o&quot;</span> <span class="ss">&#39;ace-link-eww</span><span class="p">))))</span>
</code></pre></div>
<p>If you haven&#39;t tried <a href="https://github.com/abo-abo/ace-link">ace-link</a>
before, you can get it from MELPA.  The minimal configuration that you
need is this:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">ace-link-setup-default</span><span class="p">)</span>
</code></pre></div>
<p>Here&#39;s the setup that I&#39;m actually using:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">ace-link</span>
    <span class="nb">:load-path</span> <span class="s">&quot;~/git/ace-link&quot;</span>
    <span class="nb">:init</span> <span class="p">(</span><span class="nv">ace-link-setup-default</span><span class="p">))</span>
</code></pre></div>
<p>I&#39;m using it from my git folder since when I want to edit a project, I
like to use <a href="https://github.com/nonsequitur/smex">smex</a>&#39;s
jump-to-definition.</p>

<p>And <a href="https://github.com/jwiegley/use-package">use-package</a> is useful
for the cases when my <code>~/git/</code> happens not to contain <code>ace-link</code>.  In
that case, instead of getting a debugger error on starting Emacs, I
get only a polite &quot;Could not load package ace-link&quot; in my <code>*Messages*</code>
buffer.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/12/29/monkeying-around-with-javascript/">
        Monkeying around with JavaScript
      </a>
    </h1>

    <span class="post-date">29 Dec 2014</span>

    <h2 id="exciting-encounter">Exciting encounter</h2>

<p>Recently, I happened upon a wonderful blog called
<a href="http://axisofeval.blogspot.nl">The Axis of Eval</a>.  I knew that I&#39;d
love it just when I read the name. <a href="/">(or emacs</a> pales in comparison,
but I couldn&#39;t just sit on my hands for months or years while thinking
up a perfect blog name. If you think of a blog name as awesome as &quot;The
Axis of Eval&quot; and are willing to let me use it, I&#39;ll probably make the
switch.</p>

<p>The blog did not disappoint, featuring gems like this:</p>

<blockquote>
<p>In the Lisp world, new languages are built by combining large,
battle-tested building blocks, and polishing or updating them when
needed, instead of starting over from toothpicks and double-sided
duct tape. A large Lisp like Common Lisp is like a toolchain of
decades-old tools that have proven their worth, and have been
codified in standards, folklore, and implementations.</p>
</blockquote>

<p>The only thing in the way of extracting information and enjoyment from
this blog was the horrendous theme of black background, white
foreground and magenta links. Plus the RSS was kind of quirky, and I
couldn&#39;t just feed all of it into
<a href="https://github.com/skeeto/elfeed">Elfeed</a>.</p>

<h2 id="greasemonkey-to-the-rescue!">Greasemonkey to the rescue!</h2>

<p>In the previous post I&#39;ve mentioned that, in addition to using
<a href="http://www.gnu.org/software/emacs/">the best editor</a>, I&#39;m using
<a href="https://www.mozilla.org/en-US/firefox/new/">the best browser</a>.  Well,
this particular best browser has an extension called
<a href="https://addons.mozilla.org/en-US/firefox/addon/greasemonkey/">Greasemonkey</a>
that allows you to automatically run your own JavaScript on certain
websites.</p>

<p>I&#39;m not very proficient in JavaScript, the following code I just found
by searching around. The part to note is the <code>@include</code> - the pattern
of website names for which this script should be run automatically.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// ==UserScript==</span>
<span class="c1">// @name        background</span>
<span class="c1">// @namespace   abo-abo</span>
<span class="c1">// @include     http://axisofeval.blogspot.nl/*</span>
<span class="c1">// @version     1</span>
<span class="c1">// @grant       none</span>
<span class="c1">// ==/UserScript==</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nb">document</span>
        <span class="p">.</span><span class="nx">body</span>
        <span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;style&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;background-color: #ffffff; color:#000&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">nodesArray</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">nodesArray</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">nodesArray</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">})();</span>
</code></pre></div>
<p>I can barely stand to look at it. How could you take Scheme and turn
it into this monstrosity? Such a shame. But it works, so I guess
everyone should learn JavaScript. All hail the mighty
<s>HypnoToad</s> JavaScript!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/12/28/trying-abbrevs/">
        Throwing abbrevs into the mix
      </a>
    </h1>

    <span class="post-date">28 Dec 2014</span>

    <p>Currently, I&#39;m using two methods for completing Elisp: <code>company-mode</code>
and <code>helm-lisp-completion-at-point</code>. The latter is the cannon, the big
gun: it always gets the job done, but I don&#39;t want to shoot at
sparrows with it. So I only bring it out for hairy cases, like for
stuff that starts with <code>LaTeX-</code>. Hence, the <code>company-mode</code>.  But too
often have I typed <code>region-</code> only to find 7 candidates staring at me,
4 of them useless. Which prompted me to look for an additional
completion method.</p>

<h2 id="enter-abbrevs">Enter abbrevs</h2>

<p>According to the <a href="http://www.gnu.org/software/emacs/manual/html_node/emacs/Abbrevs.html">manual</a>,</p>

<blockquote>
<p>A defined &quot;abbrev&quot; is a word which &quot;expands&quot;, if you insert it, into
some different text</p>
</blockquote>

<p>Also,</p>

<blockquote>
<p>Abbrevs can have &quot;mode-specific&quot; definitions, active only in one
major mode</p>
</blockquote>

<p>Sounds like something that could solve my problem with <code>region-</code> commands:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">rb -&gt; region-beginning
re -&gt; region-end
ra -&gt; region-active-p
</code></pre></div>
<p>Also, obviously,</p>

<blockquote>
<p>Abbrevs expand only when Abbrev mode, a buffer-local minor mode, is
enabled</p>
</blockquote>

<p>Add it to the mix:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">oleh-emacs-lisp-hook</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">outline-regexp</span> <span class="s">&quot;;; ———&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">company-mode</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">abbrev-mode</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">set</span> <span class="p">(</span><span class="nf">make-local-variable</span> <span class="ss">&#39;company-backends</span><span class="p">)</span>
       <span class="o">&#39;</span><span class="p">((</span><span class="nv">company-elisp</span> <span class="nb">:with</span> <span class="nv">company-dabbrev-code</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">yas-minor-mode-on</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">lispy-mode</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">auto-compile-mode</span> <span class="mi">1</span><span class="p">))</span>
</code></pre></div>
<h2 id="some-data-acquisition">Some data acquisition</h2>

<p>I had the whole abbrev thing in the back of my mind until I saw a link
to the post
<a href="https://groups.google.com/forum/#!topic/gnu.emacs.help/kHvUcFdiXFM">Abbrevs for the most frequent elisp symbols</a>.
That&#39;s when I decided to act.
That post eventually links to a pastebin, where 1600 abbrevs are defined.
With my handy <a href="https://addons.mozilla.org/en-US/firefox/addon/its-all-text/">best extension</a>
for <a href="https://www.mozilla.org/en-US/firefox/new/">best browser</a> I&#39;ve opened
the paste in <s>Emacs</s> <a href="http://www.gnu.org/software/emacs/">best editor</a> by just clicking the <strong>edit</strong> button
in the <em>RAW Paste Data</em> section.</p>

<p>I had to <kbd>M-x</kbd> <code>emacs-lisp-mode</code>, since the file opened in
<code>text-mode</code>. And boy, it&#39;s big. In <code>lispy-mode</code>, I usually use
<kbd>99j</kbd> to navigate 99 sexps down and therefore to the end of
the list. Well, for this file even <kbd>999j</kbd> wasn&#39;t enough.
I quickly tired of deleting one-by-one the each individual useless abbrev.
I mean:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">ek -&gt; echo-keystrokes,
</code></pre></div>
<p>when is that ever going to be useful? So I wrote this throw-away code:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">foobar</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">lispy-mark-list</span> <span class="mi">2</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">str</span> <span class="p">(</span><span class="nf">read</span> <span class="p">(</span><span class="nv">lispy--string-dwim</span><span class="p">)))</span>
        <span class="nv">count</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">other-window</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">count</span> <span class="p">(</span><span class="nv">count-matches</span> <span class="nv">str</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">other-window</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">lispy-out-backward</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">deactivate-mark</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">&lt;</span> <span class="nv">count</span> <span class="mi">5</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">lispy-delete</span> <span class="mi">1</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">message</span> <span class="s">&quot;%d&quot;</span> <span class="nv">count</span><span class="p">))))</span>
<span class="p">(</span><span class="nv">local-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-.&quot;</span><span class="p">)</span> <span class="ss">&#39;foobar</span><span class="p">)</span>
</code></pre></div>
<p>After switching to a two-pane window layout, with point in the
pastebin buffer, calling <code>foobar</code> would count the amount of the abbrev
matches in
<a href="https://github.com/abo-abo/lispy/commits/master">my most frequent elisp buffer</a>.
If it was less than 5, the abbrev was auto-deleted, otherwise the
decision was up to me, as holding <kbd>C-.</kbd> would no longer
delete. In the end, there were only 56 abbrevs left out of 1600.</p>

<h2 id="the-final-result">The final result</h2>

<p>Here&#39;s what I have put into my <code>abbrev_defs</code>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">define-abbrev-table</span> <span class="ss">&#39;emacs-lisp-mode-abbrev-table</span>
    <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;sm&quot;</span> <span class="s">&quot;string-match&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;mm&quot;</span> <span class="s">&quot;major-mode&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;rb&quot;</span> <span class="s">&quot;region-beginning&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;ca&quot;</span> <span class="s">&quot;char-after&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;smd&quot;</span> <span class="s">&quot;save-match-data&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;mb&quot;</span> <span class="s">&quot;match-beginning&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;pm&quot;</span> <span class="s">&quot;point-min&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;ir&quot;</span> <span class="s">&quot;indent-region&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;sf&quot;</span> <span class="s">&quot;search-forward&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;ci&quot;</span> <span class="s">&quot;call-interactively&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;sn&quot;</span> <span class="s">&quot;symbol-name&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;se&quot;</span> <span class="s">&quot;save-excursion&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;scb&quot;</span> <span class="s">&quot;skip-chars-backward&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;fc&quot;</span> <span class="s">&quot;forward-char&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;ff&quot;</span> <span class="s">&quot;find-file&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;fs&quot;</span> <span class="s">&quot;forward-sexp&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;pa&quot;</span> <span class="s">&quot;prefix-arg&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;re&quot;</span> <span class="s">&quot;region-end&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;dc&quot;</span> <span class="s">&quot;delete-char&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;ms&quot;</span> <span class="s">&quot;match-string&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;tc&quot;</span> <span class="s">&quot;this-command&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;dd&quot;</span> <span class="s">&quot;default-directory&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;bc&quot;</span> <span class="s">&quot;backward-char&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;rsf&quot;</span> <span class="s">&quot;re-search-forward&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;snp&quot;</span> <span class="s">&quot;substring-no-properties&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;bsnp&quot;</span> <span class="s">&quot;buffer-substring-no-properties&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;lep&quot;</span> <span class="s">&quot;line-end-position&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;bs&quot;</span> <span class="s">&quot;buffer-substring&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;cc&quot;</span> <span class="s">&quot;condition-case&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;ul&quot;</span> <span class="s">&quot;up-list&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;bfn&quot;</span> <span class="s">&quot;buffer-file-name&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;lb&quot;</span> <span class="s">&quot;looking-back&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;tap&quot;</span> <span class="s">&quot;thing-at-point&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;rm&quot;</span> <span class="s">&quot;replace-match&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;fl&quot;</span> <span class="s">&quot;forward-line&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;df&quot;</span> <span class="s">&quot;declare-function&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;ntr&quot;</span> <span class="s">&quot;narrow-to-region&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;dr&quot;</span> <span class="s">&quot;delete-region&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;rsb&quot;</span> <span class="s">&quot;re-search-backward&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;scf&quot;</span> <span class="s">&quot;skip-chars-forward&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;wcb&quot;</span> <span class="s">&quot;with-current-buffer&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;ie&quot;</span> <span class="s">&quot;ignore-errors&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;gc&quot;</span> <span class="s">&quot;goto-char&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;jos&quot;</span> <span class="s">&quot;just-one-space&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;la&quot;</span> <span class="s">&quot;looking-at&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;ow&quot;</span> <span class="s">&quot;other-window&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;dk&quot;</span> <span class="s">&quot;define-key&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;dm&quot;</span> <span class="s">&quot;deactivate-mark&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;bod&quot;</span> <span class="s">&quot;beginning-of-defun&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;sic&quot;</span> <span class="s">&quot;self-insert-command&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;eol&quot;</span> <span class="s">&quot;end-of-line&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;me&quot;</span> <span class="s">&quot;match-end&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;nai&quot;</span> <span class="s">&quot;newline-and-indent&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;cb&quot;</span> <span class="s">&quot;current-buffer&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;atl&quot;</span> <span class="s">&quot;add-to-list&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;rris&quot;</span> <span class="s">&quot;replace-regexp-in-string&quot;</span><span class="p">)))</span>
</code></pre></div>
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page8">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page6">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
