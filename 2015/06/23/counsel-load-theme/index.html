<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      New video demo - counsel-load-theme &middot; (or emacs
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://i.creativecommons.org/l/by-nc-sa/2.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">New video demo - counsel-load-theme</h1>
  <span class="post-date">23 Jun 2015</span>
  <p>Without further ado, here&#39;s the <a href="https://youtu.be/V_whk214fec">video link</a>.</p>

<h2 id="the-code">The code</h2>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">counsel--load-theme-action</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
  <span class="s">&quot;Disable current themes and load theme X.&quot;</span>
  <span class="p">(</span><span class="k">condition-case</span> <span class="no">nil</span>
      <span class="p">(</span><span class="k">progn</span>
        <span class="p">(</span><span class="nf">mapc</span> <span class="nf">#&#39;</span><span class="nv">disable-theme</span> <span class="nv">custom-enabled-themes</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">load-theme</span> <span class="p">(</span><span class="nf">intern</span> <span class="nv">x</span><span class="p">))</span>
        <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">fboundp</span> <span class="ss">&#39;powerline-reset</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">powerline-reset</span><span class="p">)))</span>
    <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;Problem loading theme %s&quot;</span> <span class="nv">x</span><span class="p">)))</span>

<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">counsel-load-theme</span> <span class="p">()</span>
  <span class="s">&quot;Forward to `load-theme&#39;.</span>
<span class="s">Usable with `ivy-resume&#39;, `ivy-next-line-and-call&#39; and</span>
<span class="s">`ivy-previous-line-and-call&#39;.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">ivy-read</span> <span class="s">&quot;Load custom theme: &quot;</span>
            <span class="p">(</span><span class="nf">mapcar</span> <span class="ss">&#39;symbol-name</span>
                    <span class="p">(</span><span class="nv">custom-available-themes</span><span class="p">))</span>
            <span class="nb">:action</span> <span class="nf">#&#39;</span><span class="nv">counsel--load-theme-action</span><span class="p">))</span>
</code></pre></div>
<p>It looks almost trivial, the main idea is to disable all current
themes and load the new one. Additionally, try to reset the
<code>powerline</code>, since it has to match the <code>mode-line</code> face, which most
themes customize.</p>

<h2 id="the-interface">The Interface</h2>

<p>The interface of <code>ivy-read</code> is the same as the built-in
<code>completing-read</code> in first two arguments. The difference is that it
also accepts a callback through the <code>:action</code> argument.  This callback
will make the completion engine aware of what needs to be done with
the completion result. The presence of the callback allows these completion engine features to work:</p>

<ul>
<li><code>ivy-resume</code> will resume the last completion. Very useful if you
change your mind on the candidate, or want to examine a related
candidate.<br></li>
<li><code>ivy-next-line-and-call</code> selects the next matching candidate and executes the callback for it.</li>
<li><code>ivy-previous-line-and-call</code> selects the previous matching candidate and executes the callback for it.</li>
</ul>

<p>I like to think of <code>ivy-resume</code> as a <kbd>DEL</kbd> or
<kbd>&lt;left&gt;</kbd> for completion. As you can erase or go back
one character with the same <kbd>DEL</kbd> binding, regardless of the
last character inputted (<kbd>a</kbd> or <kbd>B</kbd> etc), in the
same way you can call the completion again with the same
<kbd>&lt;f6&gt;</kbd> binding, regardless of the command that required
completion (<code>counsel-git-grep</code> or <code>counsel-load-theme</code> or
<code>counsel-load-library</code> etc). <code>ivy-resume</code> isn&#39;t bound by default,
since it needs to be a global binding. I just use this in my config:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">global-set-key</span> <span class="nv">[f6]</span> <span class="ss">&#39;ivy-resume</span><span class="p">)</span>
</code></pre></div>
<p>For the functions that execute the callback while changing the
candidate, the idea is:</p>

<ul>
<li><kbd>C-M-n</kbd> (<code>ivy-next-line-and-call</code>) corresponds to <kbd>C-n</kbd> (<code>ivy-next-line</code>),</li>
<li><kbd>C-M-p</kbd> (<code>ivy-previous-line-and-call</code>) corresponds to <kbd>C-n</kbd> (<code>ivy-previous-line</code>).</li>
</ul>

<p>I&#39;ve also showed off a generic <code>ivy</code> feature: <kbd>M-j</kbd> will yank
the word at point into the minibuffer.  Think of it as the mirror of
<kbd>C-w</kbd> in <code>isearch</code>. It could not be <kbd>C-w</kbd>, since I
like <kbd>C-w</kbd> being bound to <code>kill-region</code>.</p>

<h2 id="the-command/insert-mode-split">The command/insert mode split</h2>

<p><img src="/download/counsel-load-theme.png" alt="counsel-load-theme.png"></p>

<p>Finally, I show off the equivalent
<a href="https://github.com/abo-abo/hydra">hydra</a>-based modal selection
method.  So instead of pressing <kbd>C-M-n C-M-n C-M-n C-M-p
C-M-p</kbd>, you can press the equivalent <kbd>C-o c jjjkk</kbd>.
Luckily, you don&#39;t need to remember a lot of bindings for this <code>hydra</code>
mode: just press <kbd>C-o</kbd> and read the hints. I&#39;ll just list the
exit points, since that&#39;s usually the more important stuff:</p>

<ul>
<li>To exit the &quot;command-mode&quot; completely, press <kbd>o</kbd> or the standard <kbd>C-g</kbd>.</li>
<li>To exit the &quot;command-mode&quot; with the current candidate, press <kbd>f</kbd> or <kbd>d</kbd>.</li>
<li>To exit the &quot;command-mode&quot; and once again edit the minibuffer, press <kbd>i</kbd>.</li>
</ul>

<p>You might ask why <kbd>f</kbd> and <kbd>d</kbd> do the same. They
actually mirror <kbd>C-j</kbd> (<code>ivy-alt-done</code>) and <kbd>C-m</kbd>
(<code>ivy-done</code>). And if you ask what the difference between those two is,
the answer is that <code>ivy-alt-done</code> will not exit the completion when
selecting directories during file name completion. It may be possible
to extend this to other types of completion where it makes sense to
select something but not to exit the minibuffer.</p>

<h2 id="outro">Outro</h2>

<p>If you&#39;re using <code>ivy-mode</code>, make sure to try the new features: the
action-using commands should work for any command that starts with
<code>counsel-</code>. For other commands, like <code>package-install</code>, you can only
select one candidate with <kbd>C-m</kbd>.</p>

<p>Also do try <kbd>C-M-n</kbd> with <code>counsel-find-file</code>: you&#39;ll be able
to cycle through all files in a directory without exiting the
completion. Same goes for <code>ivy-switch-buffer</code>, which should probably
be renamed to <code>counsel-switch-buffer</code> for consistency.</p>

</div>

<div class="twitter-share">
  <a href="https://twitter.com/share"
     class="twitter-share-button"
     data-via="_abo_abo"
     data-dnt="true">
    Tweet
  </a>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'oremacs'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<script>
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
</script>
<noscript>
  Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
