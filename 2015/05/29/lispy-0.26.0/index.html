<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      lispy 0.26.0 is out &middot; (or emacs
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://i.creativecommons.org/l/by-nc-sa/2.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">lispy 0.26.0 is out</h1>
  <span class="post-date">29 May 2015</span>
  <p>Lispy 0.25.0 came out 2 months ago; 177 commits later, comes version
0.26.0.  The release notes are stored
<a href="https://github.com/abo-abo/lispy/releases/tag/0.26.0">at Github</a>, and
I&#39;ll post them here as well.</p>

<p>The coolest changes are the new reader-based <kbd>M</kbd>, which:</p>

<ul>
<li>Gives out very pretty output, with minor diffs for actual code,
which is quite impressive considering all newline information is
discarded and then reconstructed.</li>
<li>Works for things that Elisp can&#39;t read, like <code>#&lt;marker ...&gt;</code> etc, very useful for debugging.</li>
<li>Customizable rule sets; rules for Elisp and Clojure come with the package.</li>
</ul>

<p>The improvements to <kbd>g</kbd> and <kbd>G</kbd> also great:</p>

<ul>
<li>Because of caching, the prettified tags can be displayed in less
than <code>0.15s</code> on Emacs&#39; <code>lisp/</code> directory, which has 21256 tags in 252 files.</li>
<li>The tags collector looks at file modification time, so you get the updated tags right after you save.</li>
</ul>

<p>The details for these and other features follow below.</p>

<h2 id="fixes">Fixes</h2>

<ul>
<li><kbd>C-k</kbd> should delete the whole multi-line string.</li>
<li><kbd>y</kbd> should work for all parens, not just <code>(</code>.</li>
<li><kbd>p</kbd> should actually eval in other window for <code>dolist</code>.</li>
<li>Prevent pairs inserting an extra space when at minibuffer start.</li>
<li><kbd>ol</kbd> works properly for active region.</li>
</ul>

<h2 id="new-features">New Features</h2>

<h3 id="misc">Misc</h3>

<ul>
<li><kbd>xf</kbd> will pretty-print the macros for Elisp.</li>
<li><kbd>M-m</kbd> works better when before <code>)</code>.</li>
<li>Fix <kbd>&#39;</kbd>, <kbd>^</kbd> after a <code>,</code>.</li>
<li>Improve <kbd>/</kbd> (splice) for quoted regions.</li>
<li><kbd>Z</kbd> works with <code>&amp;key</code> arguments.</li>
<li>The new <kbd>M</kbd> is used in <kbd>xf</kbd>.</li>
<li>Allow to flatten Elisp <code>defsubst</code>.</li>
<li><kbd>c</kbd> should insert an extra newline for top-level sexps.</li>
</ul>

<h3 id="paredit-key-bindings">Paredit key bindings</h3>

<p>You can have only Paredit + special key bindings by using this composition of key themes:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">lispy-set-key-theme</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">special</span> <span class="nv">paredit</span><span class="p">))</span>
</code></pre></div>
<p>The default setting is:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">lispy-set-key-theme</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">special</span> <span class="nv">lispy</span> <span class="nv">c-digits</span><span class="p">))</span>
</code></pre></div>
<h3 id="new-algorithm-for-multi-lining">New algorithm for multi-lining</h3>

<p><kbd>M</kbd> is now bound to <code>lispy-alt-multiline</code> instead of
<code>lispy-multiline</code>.  It has a much better and more customizable
algorithm.</p>

<p>See these variables for customization:</p>

<ul>
<li><code>lispy-multiline-threshold</code></li>
<li><code>lispy--multiline-take-3</code></li>
<li><code>lispy--multiline-take-3-arg</code></li>
<li><code>lispy--multiline-take-2</code></li>
<li><code>lispy--multiline-take-2-arg</code></li>
</ul>

<p>They are set to reasonable defaults. But you can customize them if you feel that a particular form should be multi-lined in a different way.</p>

<p><code>lispy-multiline-threshold</code> is a bit of ad-hoc to make things nice. Set this to nil if you want a completely rigorous multi-line. With the default setting of 32, expressions shorter than this won&#39;t be multi-lined. This makes 95% of the code look really good.</p>

<p>The algorithm has a safety check implemented for Elisp: if <code>read</code> on the transformed expression returns something different than <code>read</code> on the original expression, an error will be signaled and no change will be made. For expressions that can&#39;t be <code>read</code>, like buffers/markers/windows/cyclic lists/overlays, only a warning will be issued (<code>lispy</code> can read them, unlike <code>read</code>).</p>

<h3 id="d-and-&gt;-give-priority-to-lispy-right"><kbd>d</kbd> and <kbd>&gt;</kbd> give priority to <code>lispy-right</code></h3>

<p>For the expression <code>(a)|(b)</code>, <code>(a)</code> will be considered the sexp at point, instead of <code>(b)</code>. This is consistent with <code>show-paren-mode</code>.  If a space is present, all ambiguities are resolved anyway.</p>

<h3 id="b-works-fine-even-if-the-buffer-changes"><kbd>b</kbd> works fine even if the buffer changes</h3>

<p>I&#39;ve switched the point and mark history to markers instead of points. When the buffer is changed, the markers are updated, so <kbd>b</kbd> will work fine.</p>

<h3 id="extend-clojure-reader">Extend Clojure reader</h3>

<p>In order for <kbd>i</kbd> (prettify code) to work for Clojure, it must be able to read the current expression. I&#39;ve been extending the Elisp reader to understand Clojure.  In the past commits, support was added for:</p>

<ul>
<li>empty sets</li>
<li>commas</li>
<li>auto-symbols, like <code>p1__7041#</code></li>
</ul>

<h3 id="extend-elisp-reader">Extend Elisp reader</h3>

<p>It should be possible to read any <code>#&lt;...&gt;</code> form, as well as <code>#1</code>-type forms.</p>

<h3 id="g-and-g-get-a-persistent-action-for-ivy"><kbd>g</kbd> and <kbd>G</kbd> get a persistent action for <code>ivy</code></h3>

<p>This is a powerful feature that the <code>helm</code> back end has had for a long time.  When you press <kbd>g</kbd>, <kbd>C-n</kbd> and <kbd>C-p</kbd> will change the current selection.  But <kbd>C-M-n</kbd> and <kbd>C-M-p</kbd> will change the current selection <em>and</em> move there, without exiting the completion.</p>

<p>This also means that you can call <code>ivy-resume</code> to resume either <kbd>g</kbd> (<code>lispy-goto</code>) or
<kbd>G</kbd> (<code>lispy-goto-local</code>).</p>

<h3 id="e-works-with-defvar-local"><kbd>e</kbd> works with <code>defvar-local</code></h3>

<p>As you might know, the regular <kbd>C-x C-e</kbd> or <code>eval-buffer</code> will not reset the values of <code>defvar</code>, <code>defcustom</code> and such (you need <kbd>C-M-x</kbd> instead). But <kbd>e</kbd> does it, now also for <code>defvar-local</code>.</p>

<h3 id="improve-faces-for-dark-backgrounds">Improve faces for dark backgrounds</h3>

<p>I normally use a light background, so I didn&#39;t notice before that the faces looked horrible with a dark background.</p>

<h3 id="the-&#96;-will-quote-the-region">The <kbd>&#96;</kbd> will quote the region</h3>

<p>If you have a region selected, pressing <kbd>&#96;</kbd> will result in:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">`symbol&#39;
</code></pre></div>
<h3 id="customize-the-file-selection-back-end-for-v">Customize the file selection back end for <kbd>V</kbd></h3>

<p><kbd>V</kbd> (<code>lispy-visit</code>) allows to open a file in current project. Previously, it used <code>projectile</code>.
Now it uses <code>find-file-in-project</code> by default, with the option to customize to <code>projectile</code>.</p>

<h3 id="fixup-calls-to-looking-back">Fixup calls to <code>looking-back</code></h3>

<p>Apparently, <code>looking-back</code> isn&#39;t very efficient, so it&#39;s preferable to avoid it or at least add a search bound to improve efficiency. Also the bound became mandatory in 25, while it was optional before.</p>

<h3 id="m-m-will-work-better-in-strings-and-comments."><kbd>M-m</kbd> will work better in strings and comments.</h3>

<p>See the relevant test:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">should</span> <span class="p">(</span><span class="nv">string=</span> <span class="p">(</span><span class="nv">lispy-with</span> <span class="s">&quot;\&quot;See `plu|mage&#39;.\&quot;&quot;</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;M-m&quot;</span><span class="p">))</span>
                 <span class="s">&quot;\&quot;See ~`plumage&#39;|.\&quot;&quot;</span><span class="p">))</span>
</code></pre></div>
<p>Thanks to this, to e.g. get the value of a quoted var in a docstring or a comment, or jump to its definition, you can <kbd>M-m</kbd>. Then, you can step-in with <kbd>i</kbd> to select the symbol without quotes.</p>

<h3 id="update-the-tags-strategy">Update the tags strategy</h3>

<p>A much better algorithm with caching an examining of file modification time is used now.  This means that the tags should be up-to-date 99% of the time, even immediately after a save, and no necessary re-parsing will be done. And it all works fine with the <code>lispy-tag-arity</code> modifications.</p>

<p>1% of the time, <code>lispy-tag-arity</code> stops working, I don&#39;t know why, since it&#39;s hard to reproduce. You can then pass a prefix arg to refresh tags bypassing the cache, e.g <kbd>2g</kbd> or <kbd>2G</kbd>.</p>

<p>Also a bug is fixed in Clojure tag navigation, where the tag start positions were off by one char.</p>

<p>The fetched tags retrieval is fast: less than <code>0.15s</code> on Emacs&#39;
<code>lisp/</code> directory to retrieve 21256 tags from 252 files.  Which means
it&#39;s lightning fast on smaller code bases (<code>lispy</code> has only 651 tags).</p>

<h3 id="xj-can-also-step-into-macros"><kbd>xj</kbd> can also step into macros</h3>

<p><code>lispy-debug-step-in</code>, bound to <kbd>xj</kbd> locally and <kbd>C-x C-j</kbd> globally can now step into macros, as well as into functions. This command is very useful for Edebug-less debugging.  Stepping into macros with <code>&amp;rest</code> parameters should work fine as well.</p>

<h3 id="p-can-now-lax-eval-function-and-macro-arguments"><kbd>p</kbd> can now lax-eval function and macro arguments</h3>

<p>When positioned at function or macro args, <kbd>p</kbd> will set them as if the function or macro was called with empty args, or the appropriate amount of nils. If the function is interned and interactive, use its interactive form to set the arguments appropriately.</p>

<p>Again, this is very useful for debugging.</p>

<h3 id="allow-to-paste-anywhere-in-the-list-using-a-numeric-arg">Allow to paste anywhere in the list using a numeric arg</h3>

<p>As you might know, <kbd>P</kbd> (<code>lispy-paste</code>) is a powerful command that:</p>

<ul>
<li>Replaces selection with current kill when the region is active.</li>
<li>Yanks the current kill before or after the current list otherwise.</li>
</ul>

<p>Now, you can:</p>

<ul>
<li>Yank the current kill to become the second element of the list with <kbd>2P</kbd></li>
<li>Yank the current kill to become the third element of the list with <kbd>3P</kbd></li>
<li>...</li>
</ul>

<p>It&#39;s OK to pass a larger arg than the length of the current list. In
that case, the paste will be made into the last element of the list.</p>

<h3 id="update-the-way-/-(lispy-splice)-works">Update the way <kbd>/</kbd> (<code>lispy-splice</code>) works</h3>

<p>When there&#39;s no next element within parent, jump to parent from
appropriate side. When the region is active, don&#39;t deactivate it. When
splicing region, remove random quotes at region bounds.</p>

<p>This change makes the splice a lot more manageable. For example,
starting with this Clojure code, with <code>|</code> marking the current point:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="kd">defn </span><span class="nv">read-resource</span>
  <span class="s">&quot;Read a resource into a string&quot;</span>
  <span class="p">[</span><span class="nv">path</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">read-string</span>
   <span class="err">|</span><span class="p">(</span><span class="nb">slurp </span><span class="p">(</span><span class="nf">clojure.java.io/resource</span> <span class="nv">path</span><span class="p">))))</span>
</code></pre></div>
<p>A double splice <kbd>//</kbd> will result in:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="kd">defn </span><span class="nv">read-resource</span>
  <span class="s">&quot;Read a resource into a string&quot;</span>
  <span class="p">[</span><span class="nv">path</span><span class="p">]</span>
  <span class="err">|</span><span class="p">(</span><span class="nf">read-string</span>
   <span class="nb">slurp </span><span class="nv">clojure.java.io/resource</span> <span class="nv">path</span><span class="p">))</span>
</code></pre></div>
<p>After <kbd>xR</kbd> (reverse list), <kbd>2 SPC</kbd> (same as
<kbd>C-f</kbd>), <code>-&gt;</code> (plain insert),
<kbd>[M</kbd> (back to parent and multi-line), the final result:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="kd">defn </span><span class="nv">read-resource</span>
  <span class="s">&quot;Read a resource into a string&quot;</span>
  <span class="p">[</span><span class="nv">path</span><span class="p">]</span>
  <span class="err">|</span><span class="p">(</span><span class="nb">-&gt; </span><span class="nv">path</span>
      <span class="nv">clojure.java.io/resource</span>
      <span class="nv">slurp</span>
      <span class="nv">read-string</span><span class="p">))</span>
</code></pre></div>
<p>This also shows off <kbd>xR</kbd> - <code>lispy-reverse</code>, which reverses
the current list.  Finally, reverting from the last code to the
initial one can be done simply with <kbd>xf</kbd> - it will flatten
the <code>-&gt;</code> macro call.</p>

<h2 id="outro">Outro</h2>

<p>Thanks to all who contributed, enjoy the new stuff. Would also be nice
to get some more feedback and bug reports. Currently, it might seem
that a large part of the features are either perfect or unused.</p>

</div>

<div class="twitter-share">
  <a href="https://twitter.com/share"
     class="twitter-share-button"
     data-via="_abo_abo"
     data-dnt="true">
    Tweet
  </a>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'oremacs'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<script>
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
</script>
<noscript>
  Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
