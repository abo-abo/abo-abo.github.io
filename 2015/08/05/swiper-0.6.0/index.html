<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Ivy-mode 0.6.0 is out &middot; (or emacs
    
  </title>

  <link rel="canonical" href="https://oremacs.com/2015/08/05/swiper-0.6.0/" />

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://licensebuttons.net/l/by-sa/4.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Ivy-mode 0.6.0 is out</h1>
  <span class="post-date">05 Aug 2015</span>
  <p>For those who don&#39;t keep up,
<a href="https://github.com/abo-abo/swiper">ivy-mode</a> is a completion method
that&#39;s similar to <code>ido</code>, but with emphasis on simplicity and
customizability.  Currently, there are two related packages on MELPA:
<code>swiper</code> and <code>counsel</code>:</p>

<ul>
<li><code>swiper</code> provides an <code>isearch</code> replacement, using <code>ivy-read</code> for completion, as well as the basic <code>ivy-mode</code>.</li>
<li><code>counsel</code> provides some extra commands, like <code>-M-x</code>, <code>-ag</code>, <code>-load-theme</code> etc.</li>
</ul>

<p>The reasoning behind the split into two packages is that there&#39;s less
update overhead if only one of them is updated.</p>

<h2 id="completing-read-function-conundrum"><code>completing-read-function</code> conundrum</h2>

<p>This is to explain a bit the presence of the <code>counsel</code>
package. Initially, I hoped that <code>ivy-mode</code> could do most of the work,
via the Emacs&#39; <code>completing-read-function</code> interface. How it works:
most built-in packages will call <code>completing-read</code> when they require
completion.  That function will forward the completion to
<code>completing-read-function</code> if it&#39;s set. This is the way how things
like <code>icomplete-mode</code> or <code>ivy-mode</code> or <code>helm-mode</code> work.</p>

<p>Unfortunately, the interface rather limits what you can do in
<code>completing-read-function</code>. Essentially, you&#39;re given a list of
strings and you have to return a string. You have no idea which
function called you, so you can&#39;t do any fancy stuff depending on the
caller, short of examining <code>this-command</code> which isn&#39;t very reliable.
You have no idea what will be done with the one string that you
return, so you can&#39;t do something fancy like select two or three
strings and perform that action for each of them.</p>

<p>The result is that sometimes I have to replace the built-in functions,
instead of re-using them. So instead of re-using <code>find-file</code>, I wrote
my own <code>counsel-find-file</code> that looks like this:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">counsel-find-file</span> <span class="p">()</span>
  <span class="s">&quot;Forward to </span><span class="ss">`find-file&#39;</span><span class="s">.&quot;</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">ivy-read</span> <span class="s">&quot;Find file: &quot;</span> <span class="ss">&#39;read-file-name-internal</span>
            <span class="nb">:matcher</span> <span class="nf">#&#39;</span><span class="nv">counsel--find-file-matcher</span>
            <span class="nb">:action</span>
            <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
              <span class="p">(</span><span class="nv">with-ivy-window</span>
                <span class="p">(</span><span class="nv">find-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="nv">x</span> <span class="nv">ivy--directory</span><span class="p">))))</span>
            <span class="nb">:preselect</span> <span class="p">(</span><span class="nb">when</span> <span class="nv">counsel-find-file-at-point</span>
                         <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;ffap</span><span class="p">)</span>
                         <span class="p">(</span><span class="nv">ffap-guesser</span><span class="p">))</span>
            <span class="nb">:require-match</span> <span class="ss">&#39;confirm-after-completion</span>
            <span class="nb">:history</span> <span class="ss">&#39;file-name-history</span>
            <span class="nb">:keymap</span> <span class="nv">counsel-find-file-map</span><span class="p">))</span>
</code></pre></div>
<p>It&#39;s still possible to call the original <code>find-file</code>, and you&#39;ll get
<code>ivy-read</code> completion for it, but:</p>

<ul>
<li><code>ivy-resume</code> won&#39;t work, since <code>ivy-read</code> doesn&#39;t know what to do with the string that you select.</li>
<li><kbd>C-M-n</kbd> (<code>ivy-next-line-and-call</code>) won&#39;t work to select another file within the same completion session, for the same reason.</li>
<li><kbd>M-o</kbd> (<code>ivy-dispatching-done</code>) may work with some
customization, but since it dispatches on <code>this-command</code> to get the
extra actions, it can cause a problem if the command wasn&#39;t called
directly.</li>
</ul>

<p>I think it would be cool to extend the built-in
<code>completing-read-function</code> interface in the future Emacs
versions. Both Ivy and Helm (which uses the same strategy of passing
the action to the completion) would benefit from this.</p>

<h2 id="release-summary-and-highlights">Release summary and highlights</h2>

<p>It&#39;s been two months and 150 commits since the last version. The full
release notes can be found inside the repository in
<a href="https://github.com/abo-abo/swiper/blob/master/doc/Changelog.org">Changelog.org</a>
or at Github&#39;s
<a href="https://github.com/abo-abo/swiper/releases/tag/0.6.0">release</a> tab.</p>

<p>I recommend to look through the whole list to see if anything catches your attention.
I&#39;ll highlight a few things that I think the users might be interested in most.</p>

<h3 id="fuzzy-completion">Fuzzy completion</h3>

<p>This is off by default, since I think having less candidates is better than having more.
You can customize this for all commands or per-command. For example:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-re-builders-alist</span>
      <span class="o">&#39;</span><span class="p">((</span><span class="no">t</span> <span class="o">.</span> <span class="nv">ivy--regex-fuzzy</span><span class="p">)))</span>
</code></pre></div>
<h3 id="swiper-has-a-case-fold-search-optimization"><code>swiper</code> has a <code>case-fold-search</code> optimization</h3>

<p>Binds case-fold-search to t when the input is all lower-case:</p>

<ul>
<li>input &quot;the&quot; matches both &quot;the&quot; and &quot;The&quot;.</li>
<li>input &quot;The&quot; matches only &quot;The&quot;.</li>
</ul>

<h3 id="anzu-things">Anzu things</h3>

<p>To see not only the number of matched candidates, but also the index of the current one, set this:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-count-format</span> <span class="s">&quot;(%d/%d) &quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="customize-additional-exit-points-for-any-command">Customize additional exit points for any command</h3>

<p>For any command that uses <code>ivy-read</code> that is. Example for <code>ivy-switch-to-buffer</code>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">ivy-set-actions</span>
 <span class="ss">&#39;ivy-switch-buffer</span>
 <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;k&quot;</span>
    <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">kill-buffer</span> <span class="nv">x</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">ivy--reset-state</span> <span class="nv">ivy-last</span><span class="p">))</span>
    <span class="s">&quot;kill&quot;</span><span class="p">)</span>
   <span class="p">(</span><span class="s">&quot;j&quot;</span>
    <span class="nv">ivy--switch-buffer-other-window-action</span>
    <span class="s">&quot;other&quot;</span><span class="p">)))</span>
</code></pre></div>
<p>After this:</p>

<ul>
<li>Use <kbd>M-o k</kbd> to kill a buffer.</li>
<li>Use <kbd>M-o j</kbd> to switch to a buffer in other window.</li>
</ul>

<p>You can always use <kbd>M-o o</kbd> to access the default action. When there is
only one action, <kbd>M-o</kbd> does the same as <kbd>C-m</kbd>.</p>

<h3 id="more-descriptions-with-a-built-in-hydra">More descriptions with a built-in Hydra</h3>

<p>Toggle <kbd>C-o</kbd> in any completion session to get an overview of
the things that you can do.</p>

<h3 id="many-commands-that-interface-with-shell-calls">Many commands that interface with shell calls</h3>

<p>The following commands will call the appropriate shell tool to give you a list of candidates:</p>

<ul>
<li><code>counsel-git-grep</code></li>
<li><code>counsel-ag</code></li>
<li><code>counsel-locate</code></li>
<li><code>counsel-recoll</code></li>
</ul>

<p>These commands will refresh after each new letter entered, and they
account for the fact that the shell call will usually take more time
than the time it takes to input a new letter. So the process will be
killed and restarted, resulting in virtually no keyboard delay and no
downtime.</p>

<h3 id="many-commands-that-offer-more-options-than-the-built-in-counterparts">Many commands that offer more options than the built-in counterparts</h3>

<p>This list includes:</p>

<ul>
<li><code>counsel-find-file</code>,</li>
<li><code>counsel-M-x</code>,</li>
<li><code>counsel-load-theme</code>,</li>
<li><code>counsel-org-tag</code> and <code>counsel-org-tag-agenda</code>.</li>
</ul>

<p>Most extra things that you can do are:</p>

<ul>
<li>Doing stuff with multiple candidates through <kbd>C-M-n</kbd> like in <a href="https://www.youtube.com/watch?v=V_whk214fec">this video</a>.</li>
<li>Using <code>ivy-resume</code> to resume the last completion session.</li>
</ul>

<p>Make sure to try <code>counsel-org-tag</code>, this one is a bit tricky for
completion, since it requires to return multiple candidates at once.
So you can toggle each tag with <kbd>C-M-m</kbd> (<code>ivy-call</code>) and then
exit with <kbd>C-m</kbd> (<code>ivy-done</code>). The currently selected tags
will be displayed in the prompt.</p>

<h2 id="outro">Outro</h2>

<p>A big thanks to all people who contributed code and issues towards
this release.  I&#39;m really happy that you&#39;re helping me to refine this
nice package.</p>

</div>

<div class="twitter-share">
  <a href="https://twitter.com/share"
     class="twitter-share-button"
     data-via="_abo_abo"
     data-dnt="true">
    Tweet
  </a>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'oremacs'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<script>
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
</script>
<noscript>
  Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
