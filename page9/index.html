<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (or emacs &middot; irrelevant)
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://licensebuttons.net/l/by-sa/4.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/03/25/swiper-0.2.0/">
        Swiper 0.2.0 is out
      </a>
    </h1>

    <span class="post-date">25 Mar 2015</span>

    <p>I forgot to mark the <code>0.1.0</code> release, so I&#39;m giving an overview of all the fixes and new features
since the first commit in <a href="https://github.com/abo-abo/swiper/releases/0.2.0">the release notes</a>.</p>

<h2 id="fixes">Fixes</h2>

<h3 id="fix-font-locking-in-certain-modes">Fix font locking in certain modes</h3>

<p>Some major modes try to optimize the font locking (highlighting text with various faces) by only
doing it for the visible portion of the text. But since <code>swiper</code> needs to access all lines at once,
it&#39;s necessary to font lock the whole buffer. This is done in <code>swiper-font-lock-ensure</code>. For some
modes, the buffer becomes discolored after calling <code>swiper-font-lock-ensure</code>. In theory, this should
not happen. As a work-around, I exclude these modes from ensuring font lock:</p>

<ul>
<li><code>package-menu-mode</code></li>
<li><code>gnus-summary-mode</code></li>
<li><code>gnus-article-mode</code></li>
<li><code>gnus-group-mode</code></li>
<li><code>emms-playlist-mode</code></li>
<li><code>erc-mode</code></li>
</ul>

<p>If you see a discoloration in one of your favorite major modes while using <code>swiper</code>, just let me
know and I&#39;ll add it to the list.</p>

<h3 id="fix-face-changes-in-the-minibuffer-propagating-to-the-main-buffer">Fix face changes in the minibuffer propagating to the main buffer</h3>

<p>This was a quite interesting <a href="https://github.com/abo-abo/swiper/issues/22">bug</a>. At that moment, I was using <code>add-face-text-property</code> to add faces to the copies of strings in the minibuffer. However, this function destructively modifies the properties, so the change to the properties of a string copy (obtained with <code>concat</code> or <code>copy-sequence</code>) was propagated to the properties of the original string. This was fixed by using <code>font-lock-append-text-property</code> instead of <code>add-face-text-property</code>.</p>

<h3 id="ivy-read-returns-immediately-for-0-1-candidates"><code>ivy-read</code> returns immediately for 0-1 candidates</h3>

<p>An obvious improvement.</p>

<h3 id="clean-up-overlays-better-for-c-g">Clean up overlays better for <kbd>C-g</kbd></h3>

<p>The hidden overlays revealed during the search will be re-hidden if you cancel the search with
<kbd>C-g</kbd>.</p>

<h3 id="ensure-that-candidates-don&#39;t-have-read-only-property">Ensure that candidates don&#39;t have read-only property</h3>

<p>This issue was causing a bug while using <code>swiper</code> in <code>erc-mode</code>, since it marks all of the buffer
content to <code>read-only</code>. So once a string with <code>read-only</code> property is inserted into the minibuffer,
you can&#39;t delete it unless you set <code>inhibit-read-only</code>.</p>

<h2 id="new-features">New Features</h2>

<h3 id="optional-initial-input">Optional initial input</h3>

<p>If you call <code>(swiper &quot;fix&quot;)</code>, you&#39;ll start searching with initial input <code>&quot;fix&quot;</code>.</p>

<h3 id="restore-the-initial-point-on-canceling">Restore the initial point on canceling</h3>

<p>If you cancel the search with e.g. <kbd>C-g</kbd> (or <kbd>DEL</kbd> when there&#39;s no input), the
initial point will be restored.</p>

<h3 id="inherit-standard-faces">Inherit standard faces</h3>

<p>To give a more standard default appearance, <code>swiper</code> faces inherit the default faces:</p>

<ul>
<li><code>isearch-lazy-highlight-face</code></li>
<li><code>isearch</code></li>
<li><code>match</code></li>
<li><code>isearch</code> again</li>
<li><code>highlight</code></li>
</ul>

<p>Most themes customize these faces, so by re-using them <code>swiper</code> blends in better.
If you want the cool (my opinion) original faces, have a look at <a href="https://github.com/abo-abo/eclipse-theme">eclipse-theme</a>.</p>

<h3 id="reveal-invisible-overlays">Reveal invisible overlays</h3>

<p>This is quite important for searches in <code>org-mode</code> buffers. I tried to make it as close as possible
to what <code>isearch</code> is doing.</p>

<h3 id="mark-is-saved-for-successful-searches">Mark is saved for successful searches</h3>

<p>This is the behavior of <code>isearch</code>. After you complete a search, you can go back to the search start with
<kbd>C-x C-SPC</kbd> (<code>pop-global-mark</code>).</p>

<h3 id="the-current-candidate-is-anchored-to-the-current-position">The current candidate is anchored to the current position</h3>

<p>This means that if many candidates are matching the current input, the one which is closest to the
current line (going forwards) is selected. This is important for not losing the context of what
you&#39;re searching.</p>

<h3 id="don&#39;t-recenter-unless-necessary">Don&#39;t recenter unless necessary</h3>

<p>This is similar to the behavior of <code>isearch</code>: a scroll is performed only if the candidate is out of
the window bounds. An alternate strategy of keeping the current candidate always centered in the
window is more distracting.</p>

<h3 id="decouple-helm-back-end">Decouple helm back end</h3>

<p><code>swiper</code> command uses only <code>ivy</code> now. If you want to use <code>helm</code>, have a look at
<a href="https://github.com/abo-abo/swiper-helm">swiper-helm</a>.</p>

<h3 id="add-history-handling">Add history handling</h3>

<p><kbd>M-n</kbd> will select the next history element, and <kbd>M-p</kbd> will select the previous
history element.</p>

<p>When there is no input, both <kbd>C-s</kbd> and <kbd>C-r</kbd> will select the last history element.
This is to make it similar to <code>isearch</code>.</p>

<p>When there is no input, and only once during the search, <kbd>M-n</kbd> will select symbol-at-point
as the current input.</p>

<h3 id="truncate-candidates-to-window-width-in-the-minibuffer">Truncate candidates to window width in the minibuffer</h3>

<p>If a candidate is longer than the window width, it will be appropriately truncated with <code>...</code>.
You can still match the invisible parts.</p>

<h3 id="warn-for-empty-buffer">Warn for empty buffer</h3>

<p>Obviously there&#39;s nothing to search for in an empty buffer.</p>

<h3 id="bring-the-last-history-candidate-to-front">Bring the last history candidate to front</h3>

<p>In case of a successful search, the current input will be removed from history, and then re-added to
the front.</p>

<h3 id="make-c-n-and-c-p-differ-from-c-s-and-c-r">Make <kbd>C-n</kbd> and <kbd>C-p</kbd> differ from <kbd>C-s</kbd> and <kbd>C-r</kbd></h3>

<p>The arrows will not recall the last history element in case the input is empty.
Otherwise, <kbd>C-n</kbd> matches to <kbd>C-s</kbd> and <kbd>C-p</kbd> matches to <kbd>C-r</kbd>.</p>

<h3 id="ivy-read-now-displays-the-number-of-candidates-in-the-prompt"><code>ivy-read</code> now displays the number of candidates in the prompt</h3>

<p>The prompt argument can hold a <code>format</code>-style expression, e.g. <code>&quot; [% 3d] pattern:&quot;</code>, and the integer
parameter will be updated with the current amount of matches.
You can also customize <code>ivy-count-format</code>, that defaults to <code>&quot;%-4d &quot;</code>.</p>

<h3 id="custom-amount-of-chars-to-start-highlighting">Custom amount of chars to start highlighting</h3>

<p>Customize <code>swiper-min-highlight</code> for this. It defaults to 2, which means that the current buffer
will be highlighted when the input has 2 chars or more. You can set it to <code>1</code> if you want, I found
it slightly distracting, since there will be a lot of highlights for just one char input.
Or you can set it to a larger value if you want the highlights to appear later.</p>

<h3 id="customize-wrapping-for-c-n-and-c-p">Customize wrapping for <kbd>C-n</kbd> and <kbd>C-p</kbd></h3>

<p>This feature being on by default in <code>helm-swoop</code> was very distracting for me, and one of the reasons
that I wrote <code>swiper</code>. So it&#39;s off by default, but you can set it if you want. Calling
<kbd>C-p</kbd> on line number 0 will cycle to the last candidate etc.</p>

<h3 id="update-copyright">Update Copyright</h3>

<p>Since <code>swiper</code> was added to <a href="https://elpa.gnu.org/packages/">GNU ELPA</a>, I had to assign the
Copyright to the FSF. This also means that you also need an FSF Copyright assignment for Emacs in
order to contribute more than total of 15 lines to the <code>swiper</code> code. It&#39;s really easy to get and is
already necessary to contribute to any package that is part of Emacs.</p>

<h3 id="add-swiper-query-replace">Add <code>swiper-query-replace</code></h3>

<p>You can start a query replace operation starting with the current candidate with <kbd>M-q</kbd>.  If
you want to query replace in whole buffer, just do <kbd>M-&lt; M-q</kbd>. And remember that
<kbd>!</kbd> will auto-replace all matches for the current query.</p>

<p>The default binding of <kbd>M-q</kbd> is <code>fill-paragraph</code>. This function is useless in the minibuffer,
so I chose that binding for query-replace, which is normally bound to sub-optimal <kbd>M-%</kbd>.
Although there are worse bindings than <kbd>M-%</kbd> (hold three keys at once), for instance, there&#39;s
<kbd>C-M-%</kbd> (hold <strong>four</strong> keys at once) that calls <code>query-replace-regexp</code>.</p>

<h2 id="outro">Outro</h2>

<p>Enjoy the new features, and a big thanks to all who contributed!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/03/23/region-to-toilet/">
        Transform region into ASCII art
      </a>
    </h1>

    <span class="post-date">23 Mar 2015</span>

    <p>Here&#39;s a command that I&#39;ve found laying around my config that you might find interesting:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">ora-figlet-region</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">b</span> <span class="nv">e</span><span class="p">)</span>
  <span class="p">(</span><span class="k">interactive</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">shell-command-on-region</span> <span class="nv">b</span> <span class="nv">e</span> <span class="s">&quot;toilet&quot;</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">)</span> <span class="no">t</span><span class="p">))</span>
</code></pre></div>
<p>You can install the <code>toilet</code> shell utility from your package manager.
Here&#39;s an example result:</p>

<pre>
    #"
   m"    mmm    m mm          mmm   mmmmm   mmm    mmm    mmm
   #    #" "#   #"  "        #"  #  # # #  "   #  #"  "  #   "
   #    #   #   #            #""""  # # #  m"""#  #       """m
    #   "#m#"   #            "#mm"  # # #  "mm"#  "#mm"  "mmm"
     "
</pre>

<p>If you don&#39;t mind the strange name, the output looks quite nice.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/03/22/hydra-0.12.0/">
        Hydra 0.12.0 is out
      </a>
    </h1>

    <span class="post-date">22 Mar 2015</span>

    <p>With a month&#39;s time and almost 50 commits since that last one, a new version of Hydra has emerged.
As usual, I&#39;ll just re-state the
<a href="https://github.com/abo-abo/hydra/releases/tag/0.12.0">release notes</a>.</p>

<h2 id="fixes">Fixes</h2>

<ul>
<li>Handling of heads with duplicate <code>cmd</code> was improved.</li>
<li>Don&#39;t bind <code>nil</code> in outside keymaps.</li>
<li>Work-around <code>golden-ratio-mode</code> in <code>lv-window</code>.</li>
<li><kbd>C-g</kbd> (<code>hydra-keyboard-quit</code>) should run <code>:post</code>.</li>
<li>Bind <code>[switch-frame]</code> to <code>hydra-keyboard-quit</code>.</li>
<li><code>:post</code> is called for <code>:timeout</code>.</li>
</ul>

<h2 id="new-features">New Features</h2>

<ul>
<li><code>hydra-key-format-spec</code> is a new defcustom for the keys format in the docstring. It&#39;s <code>&quot;%s&quot;</code> by
default, but you can set it to e.g. <code>&quot;%-4s&quot;</code> if you like.</li>
<li>The key regex was extended to include most common key binding characters.</li>
<li><code>hydra-repeat</code> is a hydra-specific <code>repeat</code> function. It behaves as you would expect <code>repeat</code> to behave.</li>
<li>New body option - <code>:timeout</code>. Use e.g. <code>:timeout 2.0</code> to set the timer. After the first head is called,
a timer is started to disable the hydra. Each new head call resets this timer, so the hydra won&#39;t disappear as long as you keep typing.</li>
<li>Lines are truncated in <code>lv-message</code>. This is useful for large docstring not to become misaligned when the window
becomes too small.</li>
</ul>

<h3 id="allow-for-a-%s(test)-spec-in-the-docstring">Allow for a <code>%s(test)</code> spec in the docstring</h3>

<p>The spec that&#39;s used for e.g. <code>(test)</code> is <code>%S</code>. So if <code>(test)</code> returns a string, it will be quoted.
This may not be desired, hence the new feature.
Example:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defhydra</span> <span class="nv">hydra-marked-items</span> <span class="p">(</span><span class="nv">dired-mode-map</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
  <span class="s">&quot;</span>
<span class="s">Number of marked items: %(length (dired-get-marked-files))</span>
<span class="s">Directory size: %s(shell-command-to-string \&quot;du -hs\&quot;)</span>
<span class="s">&quot;</span>
  <span class="p">(</span><span class="s">&quot;m&quot;</span> <span class="nv">dired-mark</span> <span class="s">&quot;mark&quot;</span><span class="p">))</span>
</code></pre></div>
<h3 id="the-pink/amaranth-override-is-set-recursively">The pink/amaranth override is set recursively</h3>

<p>This fixes the issue in this hydra:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defhydra</span> <span class="nv">hydra-test</span> <span class="p">(</span><span class="nb">:color</span> <span class="nv">amaranth</span><span class="p">)</span>
  <span class="s">&quot;foo&quot;</span>
  <span class="p">(</span><span class="s">&quot;fo&quot;</span> <span class="p">(</span><span class="nf">message</span> <span class="s">&quot;yay&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;q&quot;</span> <span class="no">nil</span><span class="p">))</span>
</code></pre></div>
<p>Before, pressing e.g. <kbd>fp</kbd> would not issue a warning, since <kbd>f</kbd> started its own
keymap. This is now fixed.</p>

<h3 id="an-option-to-specify-the-hint-for-all-heads-in-body">An option to specify the hint for all heads in body</h3>

<p>When you write a large docstring, you usually pass <code>nil</code> as the hint for most heads.
Now you can omit it, if you set <code>:hint nil</code> in body.
Example:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defhydra</span> <span class="nv">hydra-org-template</span> <span class="p">(</span><span class="nb">:color</span> <span class="nv">blue</span> <span class="nb">:hint</span> <span class="no">nil</span><span class="p">)</span>
  <span class="s">&quot;</span>
<span class="s">_c_enter  _q_uote    _L_aTeX:</span>
<span class="s">_l_atex   _e_xample  _i_ndex:</span>
<span class="s">_a_scii   _v_erse    _I_NCLUDE:</span>
<span class="s">_s_rc     ^ ^        _H_TML:</span>
<span class="s">_h_tml    ^ ^        _A_SCII:</span>
<span class="s">&quot;</span>
  <span class="p">(</span><span class="s">&quot;s&quot;</span> <span class="p">(</span><span class="nv">hot-expand</span> <span class="s">&quot;&lt;s&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;e&quot;</span> <span class="p">(</span><span class="nv">hot-expand</span> <span class="s">&quot;&lt;e&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;q&quot;</span> <span class="p">(</span><span class="nv">hot-expand</span> <span class="s">&quot;&lt;q&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;v&quot;</span> <span class="p">(</span><span class="nv">hot-expand</span> <span class="s">&quot;&lt;v&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;c&quot;</span> <span class="p">(</span><span class="nv">hot-expand</span> <span class="s">&quot;&lt;c&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;l&quot;</span> <span class="p">(</span><span class="nv">hot-expand</span> <span class="s">&quot;&lt;l&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;h&quot;</span> <span class="p">(</span><span class="nv">hot-expand</span> <span class="s">&quot;&lt;h&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;a&quot;</span> <span class="p">(</span><span class="nv">hot-expand</span> <span class="s">&quot;&lt;a&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;L&quot;</span> <span class="p">(</span><span class="nv">hot-expand</span> <span class="s">&quot;&lt;L&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;i&quot;</span> <span class="p">(</span><span class="nv">hot-expand</span> <span class="s">&quot;&lt;i&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;I&quot;</span> <span class="p">(</span><span class="nv">hot-expand</span> <span class="s">&quot;&lt;I&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;H&quot;</span> <span class="p">(</span><span class="nv">hot-expand</span> <span class="s">&quot;&lt;H&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;A&quot;</span> <span class="p">(</span><span class="nv">hot-expand</span> <span class="s">&quot;&lt;A&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;&lt;&quot;</span> <span class="nf">self-insert-command</span> <span class="s">&quot;ins&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;o&quot;</span> <span class="no">nil</span> <span class="s">&quot;quit&quot;</span><span class="p">))</span>
</code></pre></div>
<h3 id="emulate-org-mode-export-dispatch-with-hydra-ox">Emulate org-mode export dispatch with hydra-ox</h3>

<p>You can also look at that code to see how nested hydras work.  Several other examples were added to
hydra-examples.el.</p>

<h2 id="outro">Outro</h2>

<p>I hope that you enjoy all the new features/fixes, and thanks to all the people that contributed to
them. Happy hacking!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/03/21/some-fun-with-hydra/">
        Some fun with Hydra
      </a>
    </h1>

    <span class="post-date">21 Mar 2015</span>

    <p>The code from this post has very little application. But it&#39;s kind of fun, so I&#39;ll post it.  Star
Trek: TNG is one of my favorite shows, so I&#39;ve added some TNG characters to one of the Hydra
features that I&#39;m testing.</p>

<h2 id="defhydradio-statement"><code>defhydradio</code> statement</h2>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;hydra</span><span class="p">)</span>
<span class="p">(</span><span class="nv">defhydradio</span> <span class="nv">hydra-tng</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">picard</span> <span class="s">&quot;_p_ Captain Jean Luc Picard:&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">riker</span> <span class="s">&quot;_r_ Commander William Riker:&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">data</span> <span class="s">&quot;_d_ Lieutenant Commander Data:&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">worf</span> <span class="s">&quot;_w_ Worf:&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">la-forge</span> <span class="s">&quot;_f_ Geordi La Forge:&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">troi</span> <span class="s">&quot;_t_ Deanna Troi:&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">dr-crusher</span> <span class="s">&quot;_c_ Doctor Beverly Crusher:&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">phaser</span> <span class="s">&quot;_h_ Set phasers to &quot;</span> <span class="nv">[stun</span> <span class="nv">kill]</span><span class="p">))</span>
</code></pre></div>
<p>The <code>defhydradio</code> macro is akin to a namespace construct that defines multiple variables that can
assume only certain values (either <code>t</code> or <code>nil</code> by default), and functions to cycle those values.</p>

<h2 id="defhydradio-implementation"><code>defhydradio</code> implementation</h2>

<p>Here&#39;s what you may see after a <code>macroexpand</code>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">progn</span>
  <span class="p">(</span><span class="k">defvar</span> <span class="nv">hydra-tng/picard</span> <span class="no">nil</span>
    <span class="s">&quot;_p_ Captain Jean Luc Picard:&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">put</span> <span class="p">(</span><span class="k">quote</span> <span class="nv">hydra-tng/picard</span><span class="p">)</span>
       <span class="p">(</span><span class="k">quote</span> <span class="nv">range</span><span class="p">)</span>
       <span class="nv">[nil</span> <span class="nv">t]</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">hydra-tng/picard</span> <span class="no">nil</span>
    <span class="p">(</span><span class="nv">hydra--cycle-radio</span> <span class="p">(</span><span class="k">quote</span> <span class="nv">hydra-tng/picard</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">defvar</span> <span class="nv">hydra-tng/riker</span> <span class="no">nil</span>
    <span class="s">&quot;_r_ Commander William Riker:&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">put</span> <span class="p">(</span><span class="k">quote</span> <span class="nv">hydra-tng/riker</span><span class="p">)</span>
       <span class="p">(</span><span class="k">quote</span> <span class="nv">range</span><span class="p">)</span>
       <span class="nv">[nil</span> <span class="nv">t]</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">hydra-tng/riker</span> <span class="no">nil</span> <span class="p">(</span><span class="nv">hydra--cycle-radio</span> <span class="p">(</span><span class="k">quote</span> <span class="nv">hydra-tng/riker</span><span class="p">)))</span>
  <span class="c1">;; ...</span>
  <span class="p">(</span><span class="k">defvar</span> <span class="nv">hydra-tng/names</span>
    <span class="o">&#39;</span><span class="p">(</span><span class="nv">hydra-tng/picard</span> <span class="nv">hydra-tng/riker</span>
      <span class="nv">hydra-tng/data</span> <span class="nv">hydra-tng/worf</span> <span class="nv">hydra-tng/la-forge</span>
      <span class="nv">hydra-tng/troi</span> <span class="nv">hydra-tng/dr-crusher</span> <span class="nv">hydra-tng/phaser</span><span class="p">)))</span>
</code></pre></div>
<p>As you can see, each list passed to <code>defhydradio</code>:</p>

<ul>
<li>gets a prefixed variable definition</li>
<li>gets a <code>range</code> property for the prefixed symbol</li>
<li>gets a prefixed function definition that cycles the variable value based on the <code>range</code> property</li>
<li>gets added to <code>hydra-tng/names</code></li>
</ul>

<h2 id="defhydra-statement"><code>defhydra</code> statement</h2>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defhydra</span> <span class="nv">hydra-tng</span> <span class="p">(</span><span class="nb">:foreign-keys</span> <span class="nv">run</span> <span class="nb">:hint</span> <span class="no">nil</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nv">hydra--table</span> <span class="nv">hydra-tng/names</span> <span class="mi">7</span> <span class="mi">2</span>
                        <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;  % -30s %% -3`%s&quot;</span>
                          <span class="s">&quot;%s %%`%s&quot;</span><span class="p">))</span>
          <span class="s">&quot;\n\n&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;p&quot;</span> <span class="p">(</span><span class="nv">hydra-tng/picard</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="nv">hydra-tng/riker</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;d&quot;</span> <span class="p">(</span><span class="nv">hydra-tng/data</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;w&quot;</span> <span class="p">(</span><span class="nv">hydra-tng/worf</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;f&quot;</span> <span class="p">(</span><span class="nv">hydra-tng/la-forge</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;t&quot;</span> <span class="p">(</span><span class="nv">hydra-tng/troi</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;c&quot;</span> <span class="p">(</span><span class="nv">hydra-tng/dr-crusher</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;h&quot;</span> <span class="p">(</span><span class="nv">hydra-tng/phaser</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;b&quot;</span> <span class="nv">beam-down</span> <span class="s">&quot;beam down&quot;</span> <span class="nb">:exit</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;o&quot;</span> <span class="p">(</span><span class="nv">hydra-reset-radios</span> <span class="nv">hydra-tng/names</span><span class="p">)</span> <span class="s">&quot;reset&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;q&quot;</span> <span class="no">nil</span> <span class="s">&quot;cancel&quot;</span><span class="p">))</span>
</code></pre></div>
<p>The interesting statement in place of the docstring will actually evaluate to this docstring:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="s">&quot;  _p_ Captain Jean Luc Picard:   % -3`hydra-tng/picard^^^^    _h_ Set phasers to  %`hydra-tng/phaser</span>
<span class="s">  _r_ Commander William Riker:   % -3`hydra-tng/riker^^^^^</span>
<span class="s">  _d_ Lieutenant Commander Data: % -3`hydra-tng/data^^^^^^</span>
<span class="s">  _w_ Worf:                      % -3`hydra-tng/worf^^^^^^</span>
<span class="s">  _f_ Geordi La Forge:           % -3`hydra-tng/la-forge^^</span>
<span class="s">  _t_ Deanna Troi:               % -3`hydra-tng/troi^^^^^^</span>
<span class="s">  _c_ Doctor Beverly Crusher:    % -3`hydra-tng/dr-crusher</span>

<span class="s">&quot;</span>
</code></pre></div>
<p>The first line overflows a bit, but it&#39;s clear what it is. There&#39;s some flexibility in using
<code>hydra--table</code>, since you can:</p>

<ul>
<li>redefine the row-column format (e.g. from 7x2 to 5x3)</li>
<li>add more variables to <code>hydra-tng/names</code></li>
</ul>

<p>Note also, that since <code>hydra-tng/names</code> holds all the names, and all the names know their default
values through <code>range</code>, it&#39;s possible to reset them all at once with <code>hydra-reset-radios</code>.</p>

<p>Finally, here&#39;s a simple implementation of <code>beam-down</code>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">beam-down</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">message</span>
   <span class="s">&quot;Beaming down: %s.&quot;</span>
   <span class="p">(</span><span class="nf">mapconcat</span>
    <span class="nf">#&#39;identity</span>
    <span class="p">(</span><span class="nf">delq</span> <span class="no">nil</span>
          <span class="p">(</span><span class="nf">mapcar</span>
           <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">symbol-value</span> <span class="nv">p</span><span class="p">)</span>
                    <span class="p">(</span><span class="nf">substring</span> <span class="p">(</span><span class="nf">symbol-name</span> <span class="nv">p</span><span class="p">)</span> <span class="mi">10</span><span class="p">)))</span>
           <span class="o">&#39;</span><span class="p">(</span><span class="nv">hydra-tng/picard</span>
             <span class="nv">hydra-tng/riker</span>
             <span class="nv">hydra-tng/data</span>
             <span class="nv">hydra-tng/worf</span>
             <span class="nv">hydra-tng/la-forge</span>
             <span class="nv">hydra-tng/troi</span>
             <span class="nv">hydra-tng/dr-crusher</span><span class="p">)))</span>
    <span class="s">&quot;, and &quot;</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c C-,&quot;</span><span class="p">)</span> <span class="ss">&#39;hydra-tng/body</span><span class="p">)</span>
</code></pre></div>
<h2 id="outro">Outro</h2>

<p>And that&#39;s it. There actually is an application of <code>defhydradio</code> in
<a href="https://github.com/abo-abo/hydra/blob/master/hydra-ox.el">hydra-ox.el</a>.  It&#39;s not fully finished,
but you can already try it as an alternative to <code>org-mode</code> export dispatch widget, most things are
working.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/03/20/managing-emacs-packages/">
        Emacs package management
      </a>
    </h1>

    <span class="post-date">20 Mar 2015</span>

    <p>Lately, I&#39;ve been spending some time to automate and publish my Emacs config.  Being able to quickly
reproduce your config has many advantages, the main one being that you no longer have to spend time
to make your config reproducible.</p>

<p>Happily, most of my config is already published in many packages, I only have to figure out a nice
layer to glue them together. Below, I&#39;ll show some automation for the packages managed by
<code>package.el</code>.</p>

<h2 id="step-1:-get-the-main-directory">Step 1: get the main directory</h2>

<p>This is an important step that many other peoples&#39; configs miss, even the ones that are designed to
be distributed. You can&#39;t just assume that the config will be located in <code>~/.emacs.d</code> and rely on
Emacs defaults. Instead, it&#39;s nice to be able to clone the config into a random directory and launch
an Emacs from there, without messing with the currently installed Emacs.</p>

<p>It&#39;s also useful for having multiple repositories for different versions of Emacs. ELPA packages are
byte-compiled, and the byte code can be incompatible between versions (for instance, 24.3 and 24.4).
Having two independent checkouts with ELPA directory auto-generated really helps in that case.</p>

<p>So here is the code to get the main directory and define an ELPA directory with respect to that:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">defconst</span> <span class="nv">emacs-d</span>
  <span class="p">(</span><span class="nf">file-name-directory</span>
   <span class="p">(</span><span class="nv">file-chase-links</span> <span class="nv">load-file-name</span><span class="p">))</span>
  <span class="s">&quot;The giant turtle on which the world rests.&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">setq</span> <span class="nv">package-user-dir</span>
      <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&quot;elpa&quot;</span> <span class="nv">emacs-d</span><span class="p">))</span>
</code></pre></div>
<h2 id="step-2:-decide-what-you-like">Step 2: decide what you like</h2>

<p>Next, I initialize the package and define some of the packages that I like, omitting the
dependencies that they bring. Note that the code of the whole post is stored in a separate file
<code>packages.el</code> that is not intended to be loaded on start up, so it&#39;s fine to call
<code>package-refresh-contents</code> here:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">package-initialize</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">package-archives</span>
      <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;melpa&quot;</span> <span class="o">.</span> <span class="s">&quot;http://melpa.milkbox.net/packages/&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;gnu&quot;</span> <span class="o">.</span> <span class="s">&quot;http://elpa.gnu.org/packages/&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="nv">package-refresh-contents</span><span class="p">)</span>

<span class="p">(</span><span class="k">defconst</span> <span class="nv">ora-packages</span>
  <span class="o">&#39;</span><span class="p">(</span><span class="nv">auto-compile</span> <span class="nv">auto-yasnippet</span> <span class="nv">ace-link</span> <span class="nv">ace-window</span>
    <span class="nv">company</span> <span class="nv">eclipse-theme</span> <span class="nv">flx-ido</span> <span class="nv">function-args</span>
    <span class="nv">headlong</span> <span class="nv">ido-occasional</span> <span class="nv">ido-vertical-mode</span> <span class="nv">lispy</span>
    <span class="nv">magit</span> <span class="nv">smex</span> <span class="nv">swiper</span> <span class="nb">use-package</span> <span class="nv">guide-key</span>
    <span class="nv">powerline</span> <span class="nv">projectile</span> <span class="nv">slime</span> <span class="nv">cider</span> <span class="nv">worf</span>
    <span class="nv">org-download</span> <span class="nv">make-it-so</span> <span class="nv">ukrainian-holidays</span>
    <span class="nv">netherlands-holidays</span> <span class="nv">j-mode</span><span class="p">)</span>
  <span class="s">&quot;List of packages that I like.&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="step-3:-install-and-upgrade">Step 3: install and upgrade</h2>

<p>The install step is pretty straightforward: install a package unless it&#39;s already installed.
I tried to do something fancier for the upgrade, but in the end it was much more simple to
just call the interactive interface. The last two lines are basically equivalent to pressing
<kbd>Uxy</kbd> interactively:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="c1">;; install required</span>
<span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">package</span> <span class="nv">ora-packages</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">package-installed-p</span> <span class="nv">package</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">package-install</span> <span class="nv">package</span><span class="p">)))</span>

<span class="c1">;; upgrade installed</span>
<span class="p">(</span><span class="nb">save-window-excursion</span>
  <span class="p">(</span><span class="nv">package-list-packages</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">package-menu-mark-upgrades</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">package-menu-execute</span> <span class="no">t</span><span class="p">))</span>
</code></pre></div>
<h2 id="step-4:-make-it-callable">Step 4: make it callable</h2>

<p>Finally, I just create a Makefile with the following contents:</p>
<div class="highlight"><pre><code class="language-Makefile" data-lang="Makefile"><span class="nv">emacs</span> <span class="o">?=</span> emacs
<span class="nf">upgrade</span><span class="o">:</span>
    <span class="k">$(</span>emacs<span class="k">)</span> -batch -l packages.el

<span class="nf">run</span><span class="o">:</span>
    <span class="k">$(</span>emacs<span class="k">)</span> -Q -l init.el

<span class="nf">up</span><span class="o">:</span> <span class="n">upgrade</span> <span class="n">run</span>
</code></pre></div>
<p>Thanks to the first line, I can issue stuff like this on the shell:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">emacs</span><span class="o">=</span>emacs24 make up
</code></pre></div>
<p>This will use the <code>emacs24</code> executable, instead of whatever <code>emacs</code> points to.  Since the <code>up</code>
target depends on <code>upgrade</code> and <code>run</code> targets, they will be executed in that order:</p>

<ul>
<li>the <code>upgrade</code> will install / upgrade all packages in a non-interactive Emacs</li>
<li>the <code>run</code> target will start an interactive Emacs with already updated packages</li>
</ul>

<p>I really like putting stuff in Makefiles, since they are very flexible, yet so easy to call.  In the
very same Makefile, I have a <code>profile</code> target from
<a href="http://oremacs.com/2015/02/24/emacs-speed-test/">the post on profiling Emacs start up</a>.  I also
wrote two packages related to Makefiles: <a href="https://github.com/abo-abo/helm-make">helm-make</a> and
<a href="https://github.com/abo-abo/make-it-so">make-it-so</a>. The latter one is actually very interesting and
deserves its own post, I should maybe just clean it up a bit.</p>

<h2 id="outro">Outro</h2>

<p>I&#39;ll just cite Gall&#39;s law here:</p>

<blockquote>
<p>A complex system that works is invariably found to have evolved from a simple system that
worked. A complex system designed from scratch never works and cannot be patched up to make it
work. You have to start over with a working simple system.</p>
</blockquote>

<p>I think it applies from both sides w.r.t. my Emacs config: it kind of works, but I really wish it
was reproducible from the start, before making it complex.</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page10">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page8">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
