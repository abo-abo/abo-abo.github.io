<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (or emacs &middot; irrelevant)
    
  </title>

  <link rel="canonical" href="https://oremacs.com/page10/" />

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://licensebuttons.net/l/by-sa/4.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/06/08/describe-variable-tip/">
        More productive describe-variable
      </a>
    </h1>

    <span class="post-date">08 Jun 2015</span>

    <p>I refer to <code>counsel-describe-variable</code> here, which you can get from
the MELPA <code>counsel</code> package, or from
<a href="https://github.com/abo-abo/swiper">Github</a>. If you&#39;re not familiar, <code>counsel</code> contains specialized functions using <code>ivy-mode</code> completion. Being specialized means that you can do more than usual, for instance here are the exit points of <code>counsel-describe-variable</code>:</p>

<ul>
<li><kbd>RET</kbd> calls <code>describe-variable</code>: a plain <code>describe-variable</code> with <code>ivy-mode</code> on
looks like <code>counsel-describe-variable</code>, but has only this exit point.</li>
<li><kbd>C-.</kbd> calls <code>counsel-find-symbol</code>: jump to symbol declaration.</li>
<li><kbd>C-,</kbd> calls <code>counsel--info-lookup-symbol</code>: jump to symbol reference in <code>*Info*</code>.</li>
</ul>

<p>These can also be extended by binding new commands in <code>counsel-describe-map</code>.</p>

<p>I&#39;ll just describe one useful scenario that happened just now. I was working on <a href="http://debbugs.gnu.org/cgi/bugreport.cgi?bug=20754">a <code>checkdoc.el</code> change</a>
and was testing it with <code>avy.el</code>. And I got a few style warnings for this code, which I got from a <a href="https://github.com/abo-abo/avy/pull/59">contributor</a> (thanks for the code btw):</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">defvar</span> <span class="nv">avy-translate-char-function</span> <span class="nf">#&#39;identity</span>
  <span class="s">&quot;Function to translate user input key. This can be useful for</span>
<span class="s">adding mirror key. E.g. one can make SPACE an alternative of &#39;a&#39;,</span>
<span class="s">by adding:</span>

<span class="s">\(setq avy-translate-char-function</span>
<span class="s">      (lambda (c) (if (= c 32) ?a c)))</span>

<span class="s">to allow typing SPACE instead of character &#39;a&#39; to jump to the location</span>
<span class="s">highlighted by &#39;a&#39;.&quot;</span><span class="p">)</span>
</code></pre></div>
<p>One of the warnings that <code>avy-translate-char-function</code> should be quoted while inside the docstring like so:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="s">&quot;</span><span class="ss">`avy-translate-char-function&#39;</span><span class="s">&quot;</span>
</code></pre></div>
<p>Of course that wouldn&#39;t play well with <code>setq</code>, so I wanted to see if
any other variables that end in <code>-function</code> provide an example of use
like here, and, if so, how they quote.</p>

<p>This is my <a href="https://github.com/abo-abo/oremacs/blob/github/oleh/keys.el">personal configuration</a>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;&lt;f1&gt; v&quot;</span><span class="p">)</span> <span class="ss">&#39;counsel-describe-variable</span><span class="p">)</span>
</code></pre></div>
<p>So I did <kbd>&lt;f1&gt; v</kbd> <code>function$</code> to describe a variable that ends with <code>function</code>.
Here, <code>$</code> is a part of <a href="http://www.emacswiki.org/emacs/RegularExpression">a regular expression</a>, which should be a priority to learn if you want to be a (not just) Emacs Power User.</p>

<p>And now the key part: instead of pressing <kbd>RET</kbd> to describe just the current candidate, I repeatedly press <kbd>C-M-n</kbd> (<code>ivy-next-line-and-call</code>). After each <kbd>C-M-n</kbd>, the next candidate will be selected and the <code>*Help*</code> window will be updated.</p>

<p>With this trick I was able to skim through the 346 matches in seconds. The conclusion was that an example isn&#39;t usually provided, with <code>nnmail-expiry-wait-function</code> being an exemption.
In the end, I decided not to provide such an explicit example and shorten the doc to this:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">defvar</span> <span class="nv">avy-translate-char-function</span> <span class="nf">#&#39;identity</span>
  <span class="s">&quot;Function to translate user input key into another key.</span>
<span class="s">For example, to make SPC do the same as ?a, use</span>
<span class="s">\(lambda (c) (if (= c 32) ?a c)).&quot;</span><span class="p">)</span>
</code></pre></div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/06/04/git-grep-ivy-2/">
        counsel-git-grep, in async
      </a>
    </h1>

    <span class="post-date">04 Jun 2015</span>

    <h2 id="introduction">Introduction</h2>

<p>It took me quite a while to figure out, but finally
<code>counsel-git-grep</code>, which I&#39;ve described
<a href="http://oremacs.com/2015/04/19/git-grep-ivy/">before</a> works completely
asynchronously, which means it&#39;s very fast and smooth even for huge
repositories.</p>

<p>If you don&#39;t know what <code>git grep</code> is: it allows you to search for a
regular expression in your Git repository. In a way, it&#39;s just a
<code>find</code> / <code>grep</code> combo, but very concise and fast.  It&#39;s particularly
great for finding all uses and references to a symbol.</p>

<p>It can be useful even for non-programmers. One great application is to
stick all your org-mode files into a Git repository. Then you can
search all your files at once very fast: all my org stuff takes more
than 1000,000 lines and there&#39;s no lag while searching. I really
should remove some pdfs from the repository at some point.</p>

<h2 id="the-video-demo">The Video Demo</h2>

<p>Check out the speed and the various command in this <a href="https://www.youtube.com/watch?v=OEmXQNS7ofo">Video Demo</a>. Each key stroke starts two asynchronous shell calls, while canceling the current ones if they are still running.  Here are the example calls:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>$ git --no-pager grep --full-name -n --no-color <span class="se">\</span>
    -i -e <span class="s2">&quot;forward-line 1&quot;</span> <span class="p">|</span> head -n <span class="m">200</span>
$ git grep -i -c <span class="s1">&#39;forward-line 1&#39;</span> <span class="se">\</span>
    <span class="p">|</span> sed <span class="s1">&#39;s/.*:\\(.*\\)/\\1/g&#39;</span> <span class="se">\</span>
    <span class="p">|</span> awk <span class="s1">&#39;{s+=$1} END {print s}&#39;</span>
</code></pre></div>
<h2 id="the-elisp-side">The Elisp side</h2>

<p>I figure since I was interested in this topic, probably a few more people are as well.
So I&#39;ll explain below how async processing is done (in this case):</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">counsel--gg-count</span> <span class="p">(</span><span class="nv">regex</span> <span class="kp">&amp;optional</span> <span class="nv">no-async</span><span class="p">)</span>
  <span class="s">&quot;Quickly count the amount of git grep REGEX matches.</span>
<span class="s">When NO-ASYNC is non-nil, do it synchronously.&quot;</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">default-directory</span> <span class="nv">counsel--git-grep-dir</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">cmd</span> <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;git grep -i -c &#39;%s&#39;&quot;</span>
                             <span class="nv">regex</span><span class="p">)</span>
                     <span class="s">&quot; | sed &#39;s/.*:\\(.*\\)/\\1/g&#39;&quot;</span>
                     <span class="s">&quot; | awk &#39;{s+=$1} END {print s}&#39;&quot;</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">counsel-ggc-process</span> <span class="s">&quot; *counsel-gg-count*&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="k">if</span> <span class="nv">no-async</span>
        <span class="p">(</span><span class="nf">string-to-number</span> <span class="p">(</span><span class="nv">shell-command-to-string</span> <span class="nv">cmd</span><span class="p">))</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">proc</span> <span class="p">(</span><span class="nf">get-process</span> <span class="nv">counsel-ggc-process</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">buff</span> <span class="p">(</span><span class="nf">get-buffer</span> <span class="nv">counsel-ggc-process</span><span class="p">)))</span>
        <span class="p">(</span><span class="nb">when</span> <span class="nv">proc</span>
          <span class="p">(</span><span class="nf">delete-process</span> <span class="nv">proc</span><span class="p">))</span>
        <span class="p">(</span><span class="nb">when</span> <span class="nv">buff</span>
          <span class="p">(</span><span class="nf">kill-buffer</span> <span class="nv">buff</span><span class="p">))</span>
        <span class="p">(</span><span class="k">setq</span> <span class="nv">proc</span> <span class="p">(</span><span class="nv">start-process-shell-command</span>
                    <span class="nv">counsel-ggc-process</span>
                    <span class="nv">counsel-ggc-process</span>
                    <span class="nv">cmd</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">set-process-sentinel</span>
         <span class="nv">proc</span>
         <span class="nf">#&#39;</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">process</span> <span class="nv">event</span><span class="p">)</span>
             <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">string=</span> <span class="nv">event</span> <span class="s">&quot;finished\n&quot;</span><span class="p">)</span>
               <span class="p">(</span><span class="nb">with-current-buffer</span>
                   <span class="p">(</span><span class="nf">process-buffer</span> <span class="nv">process</span><span class="p">)</span>
                 <span class="p">(</span><span class="k">setq</span> <span class="nv">ivy--full-length</span>
                       <span class="p">(</span><span class="nf">string-to-number</span>
                        <span class="p">(</span><span class="nf">buffer-string</span><span class="p">))))</span>
               <span class="p">(</span><span class="nv">ivy--insert-minibuffer</span>
                <span class="p">(</span><span class="nv">ivy--format</span> <span class="nv">ivy--all-candidates</span><span class="p">)))))))))</span>
</code></pre></div>
<ol>
<li>Since we&#39;re calling a shell command, it&#39;s important to set <code>default-directory</code> to a proper value: the shell command will be run there.</li>
<li>The output from the process will be channeled into a buffer. I start the buffer name with a space to make it hidden: it will not be shown in the buffer list and <code>switch-to-buffer</code> completion.</li>
<li>I leave the sync option and use <code>shell-command-to-string</code> for that. Sometimes it&#39;s necessary to know the amount of candidates without a delay.</li>
<li>If <code>get-process</code> and <code>get-buffer</code> return something it means that the shell command is still running from the previous input. But the input has changed and that data has become useless, so I kill both the process and the buffer.</li>
<li>Then I start a new process with <code>start-process-shell-command</code>- a convenience wrapper around the basic <code>start-process</code> that&#39;s useful for passing a full shell command with arguments.</li>
<li>Finally, I let <code>counsel--gg-count</code> return without waiting for <code>git grep</code> to finish. But something needs to be done when it finishes, so I use <code>set-process-sentinel</code>. Emacs will call my lambda when there&#39;s a new event from the process.</li>
</ol>

<h2 id="outro">Outro</h2>

<p>To check out the new stuff, just install or upgrade <code>counsel</code> from MELPA. Or clone <a href="https://github.com/abo-abo/swiper">the source</a>. I hope that my Elisp explanations were useful, async stuff is awesome, and I hope to see more of it in future Emacs packages.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/05/29/lispy-0.26.0/">
        lispy 0.26.0 is out
      </a>
    </h1>

    <span class="post-date">29 May 2015</span>

    <p>Lispy 0.25.0 came out 2 months ago; 177 commits later, comes version
0.26.0.  The release notes are stored
<a href="https://github.com/abo-abo/lispy/releases/tag/0.26.0">at Github</a>, and
I&#39;ll post them here as well.</p>

<p>The coolest changes are the new reader-based <kbd>M</kbd>, which:</p>

<ul>
<li>Gives out very pretty output, with minor diffs for actual code,
which is quite impressive considering all newline information is
discarded and then reconstructed.</li>
<li>Works for things that Elisp can&#39;t read, like <code>#&lt;marker ...&gt;</code> etc, very useful for debugging.</li>
<li>Customizable rule sets; rules for Elisp and Clojure come with the package.</li>
</ul>

<p>The improvements to <kbd>g</kbd> and <kbd>G</kbd> also great:</p>

<ul>
<li>Because of caching, the prettified tags can be displayed in less
than <code>0.15s</code> on Emacs&#39; <code>lisp/</code> directory, which has 21256 tags in 252 files.</li>
<li>The tags collector looks at file modification time, so you get the updated tags right after you save.</li>
</ul>

<p>The details for these and other features follow below.</p>

<h2 id="fixes">Fixes</h2>

<ul>
<li><kbd>C-k</kbd> should delete the whole multi-line string.</li>
<li><kbd>y</kbd> should work for all parens, not just <code>(</code>.</li>
<li><kbd>p</kbd> should actually eval in other window for <code>dolist</code>.</li>
<li>Prevent pairs inserting an extra space when at minibuffer start.</li>
<li><kbd>ol</kbd> works properly for active region.</li>
</ul>

<h2 id="new-features">New Features</h2>

<h3 id="misc">Misc</h3>

<ul>
<li><kbd>xf</kbd> will pretty-print the macros for Elisp.</li>
<li><kbd>M-m</kbd> works better when before <code>)</code>.</li>
<li>Fix <kbd>&#39;</kbd>, <kbd>^</kbd> after a <code>,</code>.</li>
<li>Improve <kbd>/</kbd> (splice) for quoted regions.</li>
<li><kbd>Z</kbd> works with <code>&amp;key</code> arguments.</li>
<li>The new <kbd>M</kbd> is used in <kbd>xf</kbd>.</li>
<li>Allow to flatten Elisp <code>defsubst</code>.</li>
<li><kbd>c</kbd> should insert an extra newline for top-level sexps.</li>
</ul>

<h3 id="paredit-key-bindings">Paredit key bindings</h3>

<p>You can have only Paredit + special key bindings by using this composition of key themes:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">lispy-set-key-theme</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">special</span> <span class="nv">paredit</span><span class="p">))</span>
</code></pre></div>
<p>The default setting is:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">lispy-set-key-theme</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">special</span> <span class="nv">lispy</span> <span class="nv">c-digits</span><span class="p">))</span>
</code></pre></div>
<h3 id="new-algorithm-for-multi-lining">New algorithm for multi-lining</h3>

<p><kbd>M</kbd> is now bound to <code>lispy-alt-multiline</code> instead of
<code>lispy-multiline</code>.  It has a much better and more customizable
algorithm.</p>

<p>See these variables for customization:</p>

<ul>
<li><code>lispy-multiline-threshold</code></li>
<li><code>lispy--multiline-take-3</code></li>
<li><code>lispy--multiline-take-3-arg</code></li>
<li><code>lispy--multiline-take-2</code></li>
<li><code>lispy--multiline-take-2-arg</code></li>
</ul>

<p>They are set to reasonable defaults. But you can customize them if you feel that a particular form should be multi-lined in a different way.</p>

<p><code>lispy-multiline-threshold</code> is a bit of ad-hoc to make things nice. Set this to nil if you want a completely rigorous multi-line. With the default setting of 32, expressions shorter than this won&#39;t be multi-lined. This makes 95% of the code look really good.</p>

<p>The algorithm has a safety check implemented for Elisp: if <code>read</code> on the transformed expression returns something different than <code>read</code> on the original expression, an error will be signaled and no change will be made. For expressions that can&#39;t be <code>read</code>, like buffers/markers/windows/cyclic lists/overlays, only a warning will be issued (<code>lispy</code> can read them, unlike <code>read</code>).</p>

<h3 id="d-and-give-priority-to-lispy-right"><kbd>d</kbd> and <kbd>&gt;</kbd> give priority to <code>lispy-right</code></h3>

<p>For the expression <code>(a)|(b)</code>, <code>(a)</code> will be considered the sexp at point, instead of <code>(b)</code>. This is consistent with <code>show-paren-mode</code>.  If a space is present, all ambiguities are resolved anyway.</p>

<h3 id="b-works-fine-even-if-the-buffer-changes"><kbd>b</kbd> works fine even if the buffer changes</h3>

<p>I&#39;ve switched the point and mark history to markers instead of points. When the buffer is changed, the markers are updated, so <kbd>b</kbd> will work fine.</p>

<h3 id="extend-clojure-reader">Extend Clojure reader</h3>

<p>In order for <kbd>i</kbd> (prettify code) to work for Clojure, it must be able to read the current expression. I&#39;ve been extending the Elisp reader to understand Clojure.  In the past commits, support was added for:</p>

<ul>
<li>empty sets</li>
<li>commas</li>
<li>auto-symbols, like <code>p1__7041#</code></li>
</ul>

<h3 id="extend-elisp-reader">Extend Elisp reader</h3>

<p>It should be possible to read any <code>#&lt;...&gt;</code> form, as well as <code>#1</code>-type forms.</p>

<h3 id="g-and-g-get-a-persistent-action-for-ivy"><kbd>g</kbd> and <kbd>G</kbd> get a persistent action for <code>ivy</code></h3>

<p>This is a powerful feature that the <code>helm</code> back end has had for a long time.  When you press <kbd>g</kbd>, <kbd>C-n</kbd> and <kbd>C-p</kbd> will change the current selection.  But <kbd>C-M-n</kbd> and <kbd>C-M-p</kbd> will change the current selection <em>and</em> move there, without exiting the completion.</p>

<p>This also means that you can call <code>ivy-resume</code> to resume either <kbd>g</kbd> (<code>lispy-goto</code>) or
<kbd>G</kbd> (<code>lispy-goto-local</code>).</p>

<h3 id="e-works-with-defvar-local"><kbd>e</kbd> works with <code>defvar-local</code></h3>

<p>As you might know, the regular <kbd>C-x C-e</kbd> or <code>eval-buffer</code> will not reset the values of <code>defvar</code>, <code>defcustom</code> and such (you need <kbd>C-M-x</kbd> instead). But <kbd>e</kbd> does it, now also for <code>defvar-local</code>.</p>

<h3 id="improve-faces-for-dark-backgrounds">Improve faces for dark backgrounds</h3>

<p>I normally use a light background, so I didn&#39;t notice before that the faces looked horrible with a dark background.</p>

<h3 id="the-will-quote-the-region">The <kbd>&#96;</kbd> will quote the region</h3>

<p>If you have a region selected, pressing <kbd>&#96;</kbd> will result in:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>`symbol&#39;
</code></pre></div>
<h3 id="customize-the-file-selection-back-end-for-v">Customize the file selection back end for <kbd>V</kbd></h3>

<p><kbd>V</kbd> (<code>lispy-visit</code>) allows to open a file in current project. Previously, it used <code>projectile</code>.
Now it uses <code>find-file-in-project</code> by default, with the option to customize to <code>projectile</code>.</p>

<h3 id="fixup-calls-to-looking-back">Fixup calls to <code>looking-back</code></h3>

<p>Apparently, <code>looking-back</code> isn&#39;t very efficient, so it&#39;s preferable to avoid it or at least add a search bound to improve efficiency. Also the bound became mandatory in 25, while it was optional before.</p>

<h3 id="m-m-will-work-better-in-strings-and-comments"><kbd>M-m</kbd> will work better in strings and comments.</h3>

<p>See the relevant test:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">should</span> <span class="p">(</span><span class="nv">string=</span> <span class="p">(</span><span class="nv">lispy-with</span> <span class="s">&quot;\&quot;See </span><span class="ss">`plu|mage&#39;</span><span class="s">.\&quot;&quot;</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;M-m&quot;</span><span class="p">))</span>
                 <span class="s">&quot;\&quot;See ~</span><span class="ss">`plumage&#39;</span><span class="s">|.\&quot;&quot;</span><span class="p">))</span>
</code></pre></div>
<p>Thanks to this, to e.g. get the value of a quoted var in a docstring or a comment, or jump to its definition, you can <kbd>M-m</kbd>. Then, you can step-in with <kbd>i</kbd> to select the symbol without quotes.</p>

<h3 id="update-the-tags-strategy">Update the tags strategy</h3>

<p>A much better algorithm with caching an examining of file modification time is used now.  This means that the tags should be up-to-date 99% of the time, even immediately after a save, and no necessary re-parsing will be done. And it all works fine with the <code>lispy-tag-arity</code> modifications.</p>

<p>1% of the time, <code>lispy-tag-arity</code> stops working, I don&#39;t know why, since it&#39;s hard to reproduce. You can then pass a prefix arg to refresh tags bypassing the cache, e.g <kbd>2g</kbd> or <kbd>2G</kbd>.</p>

<p>Also a bug is fixed in Clojure tag navigation, where the tag start positions were off by one char.</p>

<p>The fetched tags retrieval is fast: less than <code>0.15s</code> on Emacs&#39;
<code>lisp/</code> directory to retrieve 21256 tags from 252 files.  Which means
it&#39;s lightning fast on smaller code bases (<code>lispy</code> has only 651 tags).</p>

<h3 id="xj-can-also-step-into-macros"><kbd>xj</kbd> can also step into macros</h3>

<p><code>lispy-debug-step-in</code>, bound to <kbd>xj</kbd> locally and <kbd>C-x C-j</kbd> globally can now step into macros, as well as into functions. This command is very useful for Edebug-less debugging.  Stepping into macros with <code>&amp;rest</code> parameters should work fine as well.</p>

<h3 id="p-can-now-lax-eval-function-and-macro-arguments"><kbd>p</kbd> can now lax-eval function and macro arguments</h3>

<p>When positioned at function or macro args, <kbd>p</kbd> will set them as if the function or macro was called with empty args, or the appropriate amount of nils. If the function is interned and interactive, use its interactive form to set the arguments appropriately.</p>

<p>Again, this is very useful for debugging.</p>

<h3 id="allow-to-paste-anywhere-in-the-list-using-a-numeric-arg">Allow to paste anywhere in the list using a numeric arg</h3>

<p>As you might know, <kbd>P</kbd> (<code>lispy-paste</code>) is a powerful command that:</p>

<ul>
<li>Replaces selection with current kill when the region is active.</li>
<li>Yanks the current kill before or after the current list otherwise.</li>
</ul>

<p>Now, you can:</p>

<ul>
<li>Yank the current kill to become the second element of the list with <kbd>2P</kbd></li>
<li>Yank the current kill to become the third element of the list with <kbd>3P</kbd></li>
<li>...</li>
</ul>

<p>It&#39;s OK to pass a larger arg than the length of the current list. In
that case, the paste will be made into the last element of the list.</p>

<h3 id="update-the-way-lispy-splice-works">Update the way <kbd>/</kbd> (<code>lispy-splice</code>) works</h3>

<p>When there&#39;s no next element within parent, jump to parent from
appropriate side. When the region is active, don&#39;t deactivate it. When
splicing region, remove random quotes at region bounds.</p>

<p>This change makes the splice a lot more manageable. For example,
starting with this Clojure code, with <code>|</code> marking the current point:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span></span><span class="p">(</span><span class="kd">defn </span><span class="nv">read-resource</span>
  <span class="s">&quot;Read a resource into a string&quot;</span>
  <span class="p">[</span><span class="nv">path</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">read-string</span>
   <span class="err">|</span><span class="p">(</span><span class="nb">slurp </span><span class="p">(</span><span class="nf">clojure.java.io/resource</span> <span class="nv">path</span><span class="p">))))</span>
</code></pre></div>
<p>A double splice <kbd>//</kbd> will result in:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span></span><span class="p">(</span><span class="kd">defn </span><span class="nv">read-resource</span>
  <span class="s">&quot;Read a resource into a string&quot;</span>
  <span class="p">[</span><span class="nv">path</span><span class="p">]</span>
  <span class="err">|</span><span class="p">(</span><span class="nf">read-string</span>
   <span class="nb">slurp </span><span class="nv">clojure.java.io/resource</span> <span class="nv">path</span><span class="p">))</span>
</code></pre></div>
<p>After <kbd>xR</kbd> (reverse list), <kbd>2 SPC</kbd> (same as
<kbd>C-f</kbd>), <code>-&gt;</code> (plain insert),
<kbd>[M</kbd> (back to parent and multi-line), the final result:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span></span><span class="p">(</span><span class="kd">defn </span><span class="nv">read-resource</span>
  <span class="s">&quot;Read a resource into a string&quot;</span>
  <span class="p">[</span><span class="nv">path</span><span class="p">]</span>
  <span class="err">|</span><span class="p">(</span><span class="nb">-&gt; </span><span class="nv">path</span>
      <span class="nv">clojure.java.io/resource</span>
      <span class="nv">slurp</span>
      <span class="nv">read-string</span><span class="p">))</span>
</code></pre></div>
<p>This also shows off <kbd>xR</kbd> - <code>lispy-reverse</code>, which reverses
the current list.  Finally, reverting from the last code to the
initial one can be done simply with <kbd>xf</kbd> - it will flatten
the <code>-&gt;</code> macro call.</p>

<h2 id="outro">Outro</h2>

<p>Thanks to all who contributed, enjoy the new stuff. Would also be nice
to get some more feedback and bug reports. Currently, it might seem
that a large part of the features are either perfect or unused.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/05/23/swiper-0.5.0/">
        Ivy-mode 0.5.0 is out
      </a>
    </h1>

    <span class="post-date">23 May 2015</span>

    <p>At this point, <a href="https://github.com/abo-abo/swiper">swiper</a> is only a
fraction of <code>ivy-mode</code>&#39;s functionality.  Still, it&#39;s nice to keep them
all, together with <a href="http://melpa.org/#/counsel">counsel</a>, in a single
repository: <code>counsel-git-grep</code> works much better this way.</p>

<p>Anyway, I&#39;ll echo <a href="https://github.com/abo-abo/swiper/releases/tag/0.5.0">the release notes</a> here, there are quite a few exciting new features.</p>

<h2 id="fixes">Fixes</h2>

<ul>
<li><kbd>TAB</kbd> shouldn&#39;t delete input when there&#39;s no candidate.</li>
<li><kbd>TAB</kbd> should switch directories properly.</li>
<li>require <code>dired</code> when completing file names, so that the directory face is loaded.</li>
<li><kbd>TAB</kbd> should work with <code>confirm-nonexistent-file-or-buffer</code>.</li>
<li><kbd>TAB</kbd> should handle empty input.</li>
<li>work around <code>grep-read-files</code>: it should be possible to simply <kbd>M-x</kbd> <code>rgrep</code> <kbd>RET RET RET</kbd>.</li>
<li>Fix the transition from a bad regex to a good one - you can input a bad regex to get 0 candidates, the candidates come back once the regex is fixed.</li>
<li><code>ivy-switch-buffer</code> should pre-select <code>other-buffer</code> just like <code>switch-buffer</code> does it.</li>
<li>Fix selecting &quot;C:\&quot; on Windows.</li>
<li><code>counsel-git-grep</code> should warn if not in a repository.</li>
<li><kbd>C-M-n</kbd> shouldn&#39;t try to call action if there isn&#39;t one.</li>
<li>Turn on sorting for <code>counsel-info-lookup-symbol</code>.</li>
<li><code>ivy-read</code> should check for an outdated cons initial-input.</li>
</ul>

<h2 id="new-features">New Features</h2>

<h3 id="out-of-order-matching">Out of order matching</h3>

<p>I actually like in-order matching, meaning the input &quot;in ma&quot; will match &quot;in-order matching&quot;, but not &quot;made in&quot;. But the users can switch to out-of-order matching if they use this code:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-re-builders-alist</span>
          <span class="o">&#39;</span><span class="p">((</span><span class="no">t</span> <span class="o">.</span> <span class="nv">ivy--regex-ignore-order</span><span class="p">)))</span>
</code></pre></div>
<p><code>ivy-re-builders-alist</code> is the flexible way to customize the regex builders per-collection.  Using <code>t</code> here, means to use this regex builder for everything. You could choose to have in-order for files, and out-of-order for buffers and so on.</p>

<h3 id="new-defcustom-ivy-tab-space">New defcustom: <code>ivy-tab-space</code></h3>

<p>Use this to have a space inserted each time you press <kbd>TAB</kbd>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-tab-space</span> <span class="no">t</span><span class="p">)</span>
</code></pre></div>
<h3 id="ignore-case-for-tab">ignore case for TAB</h3>

<p>&quot;pub&quot; can expand to &quot;Public License&quot;.</p>

<h3 id="new-command-counsel-load-library">New command: <code>counsel-load-library</code></h3>

<p>This command is much better than the standard <code>load-libary</code> that it
upgrades.  It applies a sort of <code>uniquify</code> effect to all your
libraries, which is very useful:</p>

<p><img src="https://cloud.githubusercontent.com/assets/2937359/7783947/7da9395e-0154-11e5-86cd-45d38c0f2c17.png" alt="counsel-load-library"></p>

<p>In this case, I have <code>avy</code> installed both from the package manager and
manually. I can easily distinguish them.</p>

<p>Another cool feature is that instead of using <code>find-library</code> (which is
also bad, since it would report two versions of <code>avy</code> with the same
name and no way to distinguish them), you can simply use
<code>counsel-load-library</code> and type <kbd>C-.</kbd> instead of
<kbd>RET</kbd> to finalize.</p>

<p>Here&#39;s another scenario: first load the library, then call
<code>ivy-resume</code> and immediately open the library file.</p>

<h3 id="new-command-ivy-partial">New command: <code>ivy-partial</code></h3>

<p>Does a partial complete without exiting. Use this code to replace
<code>ivy-partial-or-done</code> with this command:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">ivy-minibuffer-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;TAB&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-partial</span><span class="p">)</span>
</code></pre></div>
<h3 id="allow-to-use-in-swiper">Allow to use <code>^</code> in <code>swiper</code></h3>

<p>In regex terms, <code>^</code> is the beginning of line. You can now use this in
<code>swiper</code> to filter your matches.</p>

<h3 id="new-command-swiper-avy">New command: <code>swiper-avy</code></h3>

<p>This command is crazy good: it combines the best features of <code>swiper</code>
(all buffer an once, flexible input length) and <code>avy</code> (quickly select
one candidate once you&#39;ve narrowed to about 10-20 candidates).</p>

<p>For instance, I can enter &quot;to&quot; into <code>swiper</code> to get around 10 matches.  Instead of using <kbd>C-n</kbd> a bunch of times to select the one of 10 that I want, I just press <kbd>C-&#39;</kbd>, followed by <kbd>a</kbd> or <kbd>s</kbd> or <kbd>d</kbd> ... to select one of the matches visible on screen.</p>

<p>So both packages use their best feature to cover up the others worst drawback.</p>

<h3 id="add-support-for-virtual-buffers">Add support for virtual buffers</h3>

<p>I was never a fan of <code>recentf</code> until now. The virtual buffers feature works in the same way as <code>ido-use-virtual-buffers</code>: when you call <code>ivy-switch-buffer</code>, your recently visited files as well as all your bookmarks are appended to the end of the buffer list.</p>

<p>Suppose you killed a buffer and want to bring it back: now you do it as if you didn&#39;t kill the buffer and instead buried it. The bookmarks access is also nice.</p>

<p>Here&#39;s how to configure it, along with some customization of <code>recentf</code>:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-use-virtual-buffers</span> <span class="no">t</span><span class="p">)</span>

<span class="p">(</span><span class="nb">use-package</span> <span class="nv">recentf</span>
  <span class="nb">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">recentf-exclude</span>
        <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;COMMIT_MSG&quot;</span> <span class="s">&quot;COMMIT_EDITMSG&quot;</span> <span class="s">&quot;github.*txt$&quot;</span>
          <span class="s">&quot;.*png$&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">recentf-max-saved-items</span> <span class="mi">60</span><span class="p">))</span>
</code></pre></div>
<h3 id="add-a-few-wrapper-commands-for-the-minibuffer">Add a few wrapper commands for the minibuffer</h3>

<p>All these commands just forward to their built-in counterparts, only trying not to exit the first line of the minibuffer.</p>

<ul>
<li><kbd>M-DEL</kbd> calls <code>ivy-backward-kill-word</code></li>
<li><kbd>C-d</kbd> calls <code>ivy-delete-char</code></li>
<li><kbd>M-d</kbd> calls <code>ivy-kill-word</code></li>
<li><kbd>C-f</kbd> calls <code>ivy-forward-char</code></li>
</ul>

<h3 id="allow-to-customize-the-minibuffer-formatter">Allow to customize the minibuffer formatter</h3>

<p>See <a href="https://github.com/abo-abo/swiper/wiki/Customize-candidate-menu-style">the wiki</a> on how to customize
the minibuffer display to look like this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>100 Find file: ~/
  file1
  file2
&gt; file3
  file4
</code></pre></div>
<h3 id="when-completing-file-names-tab-should-defer-to-minibuffer-complete">When completing file names, <kbd>TAB</kbd> should defer to <code>minibuffer-complete</code></h3>

<p>Thanks to this, you can <kbd>TAB</kbd>-complete your ssh hosts, e.g.:</p>

<ul>
<li><code>/ss</code> <kbd>TAB</kbd> -&gt; <code>/ssh</code></li>
<li><code>/ssh:ol</code> <kbd>TAB</kbd> -&gt; <code>/ssh:oleh@</code></li>
</ul>

<h3 id="more-commands-work-with-ivy-resume">More commands work with <code>ivy-resume</code></h3>

<p>I&#39;ve added:</p>

<ul>
<li><code>counsel-git-grep</code></li>
<li><code>counsel-git</code></li>
</ul>

<p>Others (that start with <code>counsel-</code>) should work fine as well. Also don&#39;t forget that you can use <kbd>C-M-n</kbd> and <kbd>C-M-p</kbd> to:</p>

<ul>
<li>switch candidate</li>
<li>call the action for the candidate</li>
<li>stay in the minibuffer</li>
</ul>

<p>This is especially powerful for <code>counsel-git-grep</code>: you can easily check the whole repository for something with just typing in the query and holding <kbd>C-M-n</kbd>. The matches will be highlighted <code>swiper</code>-style, of course.</p>

<h3 id="allow-to-recenter-during-counsel-git-grep">Allow to recenter during <code>counsel-git-grep</code></h3>

<p>Use <kbd>C-l</kbd> to recenter.</p>

<h3 id="update-the-quoting-of-spaces">Update the quoting of spaces</h3>

<p>Split only on single spaces, from all other space groups, remove one space.</p>

<p>As you might know, a space is used in place of <code>.*</code> in <code>ivy</code>. In case
you want an actual space, you can now quote them even easier.</p>

<h2 id="outro">Outro</h2>

<p>Thanks to all who contributed, check out the new stuff, and make sure
to bind <code>ivy-resume</code> to something short: it has become a really nice
feature.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/05/22/define-word/">
        New on MELPA - define word at point
      </a>
    </h1>

    <span class="post-date">22 May 2015</span>

    <p>Doing things in Emacs is <em>superlatively</em> better than having to switch
to another application.</p>

<p>In this case, &quot;doing things&quot; is getting the dictionary definition of
word at point, and &quot;<em>superlatively</em>&quot; is a word that I didn&#39;t know - a
straw that broke the camel&#39;s back and caused me to finally automate
the process of getting the definition of a word that I encounter in an
Emacs buffer.</p>

<p>The whole process of writing the <code>define-word</code> package took around 30
minutes, I just had to:</p>

<ul>
<li>See which engine DuckDuckGo uses.</li>
<li>Follow to <a href="https://www.wordnik.com/words/superlative">wordnik</a>.</li>
<li>Try to get an API key, read their draconian TOS and decide that I don&#39;t want
to agree to it just to get their key.</li>
<li>Examine the HTML that it returns and note that it&#39;s quite regular.</li>
<li>Write a 10 line function with <code>re-search-forward</code> to extract the word
definitions from a sample page that I saved with <code>wget</code>.</li>
</ul>

<p>Then just wrap the function in an <code>url-retrieve</code> and done.  It&#39;s a
good thing that I learned to use <code>url-retrieve</code> when I wrote
<a href="https://github.com/abo-abo/org-download">org-download</a>.</p>

<p>Here&#39;s how it looks like in action, the word under point is &quot;Authors&quot;
and instead of visiting
<a href="https://www.wordnik.com/words/authors">this page</a>, you can see it
right away in your Echo Area:</p>

<p><img src="https://raw.githubusercontent.com/wiki/abo-abo/define-word/images/define-word.png" alt="demo"></p>

<p>The result is displayed simply with <code>message</code>, so it doesn&#39;t mess with
your window config.  You read it, press any key and the Echo Area
popup will vanish automatically.</p>

<p>Install the package from MELPA or check it out at <a href="https://github.com/abo-abo/define-word">github</a>.
You just need to decide where to bind it:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c d&quot;</span><span class="p">)</span> <span class="ss">&#39;define-word-at-point</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c D&quot;</span><span class="p">)</span> <span class="ss">&#39;define-word</span><span class="p">)</span>
</code></pre></div>
<p>At less than 50 lines, the source is very easy to understand. So if
you&#39;re looking to write some Elisp that retrieves and parses some HTML
from a web service, it&#39;s nice to look at a simple implementation of
how it&#39;s done.</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page11">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page9">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
