<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (or emacs &middot; irrelevant)
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item active" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://licensebuttons.net/l/by-sa/4.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/07/29/brand-new-swiper-all/">
        Swipe all the files!
      </a>
    </h1>

    <span class="post-date">29 Jul 2016</span>

    <p>If you&#39;ve ever tried the <code>swiper-all</code> from
<a href="https://github.com/abo-abo/swiper">swiper</a>, forget everything about
it.  The command was super-awkward, since it had to parse all your
open files before giving you a chance enter anything, resulting in
dozens of seconds before the prompt.</p>

<p>Recently, I&#39;ve had some time to examine and improve it and the result
looks very promising. The new command is now async, which means
there&#39;s no delay before the prompt comes up. Here&#39;s a result I got
with no delay while having around 50 buffers open:</p>

<p><img src="/download/swiper-all.png" alt="swiper-all.png"></p>

<p>The shortcut I&#39;m using:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c u&quot;</span><span class="p">)</span> <span class="ss">&#39;swiper-all</span><span class="p">)</span>
</code></pre></div>
<p>For efficiency&#39;s sake a small trade off had to be made: the line
numbers are no longer displayed. This actually results in an advantage
that you can select different candidates on the same line.</p>

<p>There are still a few things I plan to try for the new command, like
adding file-less buffers, caching for incremental regexes and maybe
even newlines in wild cards, but even now it seems very usable. So
give it a try, enjoy and happy hacking!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/06/27/ivy-push-view/">
        Bookmark the current window layout with Ivy
      </a>
    </h1>

    <span class="post-date">27 Jun 2016</span>

    <p>Today&#39;s post is about the newest feature related to the
<a href="https://github.com/abo-abo/swiper">ivy-switch-buffer</a> command. If you
use <code>ivy-mode</code>, you&#39;re probably already using <code>ivy-switch-buffer</code>
since it overwrites the built-in <code>switch-to-buffer</code>.</p>

<p>The cool thing about <code>ivy-switch-buffer</code> is that it&#39;s not only buffers
that are offered for completion. Other buffer-like entities can be
there as well: bookmarks, recently opened files (<code>recentf</code>), and
finally, window layouts. Since all of those are relatively the same
concept, it&#39;s very convenient to have them all in one place available
for completion.</p>

<p>Here are the relevant settings:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="c1">;; Enable bookmarks and recentf</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-use-virtual-buffers</span> <span class="no">t</span><span class="p">)</span>

<span class="c1">;; Example setting for ivy-views</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-views</span>
      <span class="o">`</span><span class="p">((</span><span class="s">&quot;dutch + notes {}&quot;</span>
         <span class="p">(</span><span class="nv">vert</span>
          <span class="p">(</span><span class="nv">file</span> <span class="s">&quot;dutch.org&quot;</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">buffer</span> <span class="s">&quot;notes&quot;</span><span class="p">)))</span>
        <span class="p">(</span><span class="s">&quot;ivy.el {}&quot;</span>
         <span class="p">(</span><span class="nv">horz</span>
          <span class="p">(</span><span class="nv">file</span> <span class="o">,</span><span class="p">(</span><span class="nv">find-library-name</span> <span class="s">&quot;ivy&quot;</span><span class="p">))</span>
          <span class="p">(</span><span class="nv">buffer</span> <span class="s">&quot;*scratch*&quot;</span><span class="p">)))))</span>
</code></pre></div>
<p>I did mention <code>ivy-views</code> before in the
<a href="http://oremacs.com/2016/04/26/ivy-0.8.0/">ivy-0.8.0 release</a> post.
But now, instead of setting <code>ivy-views</code> by hand, you can also bind
<code>ivy-push-view</code> to a key and store as many window configurations as
you like, really fast. </p>

<p>What gets stored:</p>

<ul>
<li>The window list - all windows open on the current frame.</li>
<li>The window splits relative to each other as a tree. Currently, the
size of the split isn&#39;t saved, all windows are split equally.</li>
<li>The point positions in each window. If you use just one window,
you&#39;ve got something similar to <code>bookmark-set</code>.</li>
</ul>

<h2 id="recommended-key-bindings">Recommended key bindings</h2>

<p>Here&#39;s what I use currently:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c v&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-push-view</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c V&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-pop-view</span><span class="p">)</span>
</code></pre></div>
<h2 id="typical-workflow">Typical workflow</h2>

<p>Suppose I have two files open: the file <code>2016-06-23-ivy-push-view.md</code>
and the <code>_posts</code> directory. By pressing <kbd>C-c v</kbd> I am prompted
for a view name with the default being e.g. 
<code>{} 2016-06-23-ivy-push-view.md _posts 2</code>.</p>

<p>I can still name the view however I want, but I typically just press
<kbd>RET</kbd>.  The parts of the automatic view name are:</p>

<ul>
<li><code>{}</code> - this is a simple string marker to distinguish the views in
the buffer view. If I enter only <code>{}</code> into <code>ivy-switch-buffer</code>
prompt, the candidates will normally filter to only views, since
very rarely will a file or a buffer name match <code>{}</code>.</li>
<li><code>2016-06-23-ivy-push-view.md _posts</code> is the list of buffers stored
in the view. This view has only two buffers, but <code>ivy-push-view</code> can
handle as many windows as you can cram into a single frame.</li>
<li><code>2</code> means that I already have two views with the same buffers, each
new view with the same buffers gets an increased number for the
suggested name. And it&#39;s not useless to have many views for the same
buffers, since the views also store point positions, not just the
window list.</li>
</ul>

<p>Here&#39;s the beauty of it for me: when I type <code>_posts</code> into
<code>ivy-switch-buffer</code> I can chose to open the <code>_posts</code> directory in a
variety of ways:</p>

<ul>
<li>If the buffer is currently open, I can just switch there.</li>
<li>If the buffer is currently closed, I can re-open it, thanks to <code>recentf</code>.</li>
<li>I can open the buffer as part of a stored view(s) in <code>ivy-views</code>.</li>
</ul>

<p>Finally, if I decide that I don&#39;t need a particular view any more, I
can delete it with <kbd>C-c V</kbd> (<code>ivy-pop-view</code>). It&#39;s possible to
delete many views at once by pressing <kbd>C-M-m</kbd> (<code>ivy-call</code>),
as usual with most <code>ivy</code> completion functions.</p>

<h2 id="breaking-api-change">Breaking API change</h2>

<p>While implementing <code>ivy-set-view</code> I decided that the current way alist
collections are handled together with actions is sub-optimal.  Here&#39;s
the new way of working:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">res</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">ivy-with</span>
   <span class="o">&#39;</span><span class="p">(</span><span class="nv">ivy-read</span> <span class="s">&quot;test: &quot;</span>
     <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;one&quot;</span> <span class="o">.</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;three&quot;</span> <span class="o">.</span> <span class="mi">3</span><span class="p">))</span>
     <span class="nb">:action</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">res</span> <span class="nv">x</span><span class="p">)))</span>
   <span class="s">&quot;t C-m&quot;</span><span class="p">)</span>
  <span class="nv">res</span><span class="p">)</span>
<span class="c1">;; =&gt;</span>
<span class="c1">;; (&quot;three&quot; . 3)</span>
</code></pre></div>
<p>Previously, the return result would be <code>3</code>, i.e. the <code>cdr</code> of the
selected candidate. Any code using <code>ivy-read</code> with an alist-type
collection will break. I fixed all instances in <code>counsel.el</code>, and
there actually aren&#39;t too many uses in the published third party
packages.</p>

<p>A simple fix to the problem is to use <code>cdr</code> in the action function.
Additionally, having more information available in the action function
will serve to improve the code.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/06/06/counsel-set-variable/">
        Set an Emacs variable with double completion
      </a>
    </h1>

    <span class="post-date">06 Jun 2016</span>

    <p>I&#39;d like to show off a certain Elisp productivity booster that I&#39;ve
had in an unfinished state for a while and finished just today.  </p>

<p>A large part of tweaking Elisp is simply setting variables. The new
command, <a href="https://github.com/abo-abo/swiper">counsel-set-variable</a>,
allows to set them quite a bit faster.</p>

<h2 id="completion-stage-1">Completion stage 1:</h2>

<p>First of all, you get completion for all variables that you have defined:</p>

<p><img src="/download/counsel-set-variable-1.png" alt="counsel-set-variable-1.png"></p>

<h2 id="completion-stage-2">Completion stage 2:</h2>

<p>Once a symbol is selected, the code checks whether the symbol is a
<code>defcustom</code> with type <code>&#39;boolean</code> or <code>&#39;radio</code>. Since then it is
possible to offer all values that the symbol is allowed to become for
completion.</p>

<p>For example, here&#39;s a typical <code>&#39;radio</code>-type definition:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defcustom</span> <span class="nv">avy-style</span> <span class="ss">&#39;at-full</span>
  <span class="s">&quot;The default method of displaying the overlays.</span>
<span class="s">Use `avy-styles-alist&#39; to customize this per-command.&quot;</span>
  <span class="nb">:type</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">choice</span>
          <span class="p">(</span><span class="nv">const</span> <span class="nb">:tag</span> <span class="s">&quot;Pre&quot;</span> <span class="nv">pre</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">const</span> <span class="nb">:tag</span> <span class="s">&quot;At&quot;</span> <span class="nv">at</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">const</span> <span class="nb">:tag</span> <span class="s">&quot;At Full&quot;</span> <span class="nv">at-full</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">const</span> <span class="nb">:tag</span> <span class="s">&quot;Post&quot;</span> <span class="nv">post</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">const</span> <span class="nb">:tag</span> <span class="s">&quot;De Bruijn&quot;</span> <span class="nv">de-bruijn</span><span class="p">)))</span>
</code></pre></div>
<p>And here&#39;s a completion screen offered for this variable:</p>

<p><img src="/download/counsel-set-variable-2.png" alt="counsel-set-variable-2.png"></p>

<p>It is worth noting that the current value of the variable is
pre-selected, to give a nice reference point for the new setting.</p>

<h3 id="in-case-the-symbol-isn-39-t-a-boolean-or-a-radio">In case the symbol isn&#39;t a boolean or a radio</h3>

<p>Then you get a completion session similar to <kbd>M-x</kbd>
<code>read-expression</code>, but with the initial contents already filled
in. For example:</p>

<p><img src="/download/counsel-set-variable-3.png" alt="counsel-set-variable-3.png"></p>

<p>The <code>read-expression</code> part combines well with this setting in my config:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">conditionally-enable-lispy</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">this-command</span> <span class="ss">&#39;eval-expression</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">lispy-mode</span> <span class="mi">1</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">add-hook</span>
 <span class="ss">&#39;minibuffer-setup-hook</span>
 <span class="ss">&#39;conditionally-enable-lispy</span><span class="p">)</span>
</code></pre></div>
<p>Here&#39;s a series of commands using
<a href="https://github.com/abo-abo/lispy">lispy-mode</a> that I would typically
use for the screenshot above, to set <code>ivy-re-builders-alist</code> to a new
value:</p>

<ol>
<li><kbd>C-f</kbd> (<code>forward-char</code>) to get into special.</li>
<li><kbd>-e</kbd> (<code>lispy-ace-subword</code>) to mark the <code>plus</code> part of the code.</li>
<li><kbd>C-d</kbd> (<code>lispy-delete</code>) to delete the active region.</li>
</ol>

<p>After the <kbd>C-f -e C-d</kbd> chain of bindings, the minibuffer contents become:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-re-builders-alist</span> <span class="o">&#39;</span><span class="p">((</span><span class="no">t</span> <span class="o">.</span> <span class="nv">ivy--regex-</span><span class="err">|</span><span class="p">)))</span>
</code></pre></div>
<p>I press <kbd>C-M-i</kbd> (<code>completion-at-point</code>) to get completion for
all symbols that start with <code>ivy--regex-</code>. Since I have <code>ivy-mode</code> on,
<kbd>C-M-i</kbd> starts a recursive completion session. I highly
recommend adding these settings to your config:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="c1">;; Allow to read from minibuffer while in minibuffer.</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">enable-recursive-minibuffers</span> <span class="no">t</span><span class="p">)</span>

<span class="c1">;; Show the minibuffer depth (when larger than 1)</span>
<span class="p">(</span><span class="nv">minibuffer-depth-indicate-mode</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<p>Finally, I would e.g. select e.g. <code>ivy--regex-fuzzy</code> and <kbd>RET
RET</kbd> to finalize the eval. The first <kbd>RET</kbd> exits from
<code>completion-at-point</code> and the second <kbd>RET</kbd> exits from
<code>counsel-set-variable</code>.</p>

<h2 id="outro">Outro</h2>

<p>I think this command, especially the newly added <code>read-expression</code>
part, is quite a bit faster than what I did before. That is switching
to <code>*scratch*</code> and typing in the <code>setq</code> manually and evaluating with
<kbd>C-j</kbd>. Here&#39;s my binding for the new command:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;&lt;f2&gt; j&quot;</span><span class="p">)</span> <span class="ss">&#39;counsel-set-variable</span><span class="p">)</span>
</code></pre></div>
<p>It&#39;s not very mnemonic, but it&#39;s really fast. Just a suggestion, in
case you don&#39;t know where to bind it. Happy hacking!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/04/26/ivy-0.8.0/">
        Ivy 0.8.0 is out
      </a>
    </h1>

    <span class="post-date">26 Apr 2016</span>

    <h2 id="intro">Intro</h2>

<p><a href="https://github.com/abo-abo/swiper">Ivy</a> is a completion method that&#39;s
similar to <code>Ido</code>, but with emphasis on simplicity and customizability.</p>

<h2 id="new-package-names">New package names</h2>

<h3 id="changes-on-melpa">Changes on MELPA</h3>

<p>Due to multiple requests, in an attempt to simplify things a new
package <code>ivy</code> has been released on MELPA. The old package <code>swiper</code>,
which used to provide most of the <code>ivy</code> features, now only provides
<code>swiper.el</code> and depends on <code>ivy</code>. The third package <code>counsel</code>, which
provides most of the goodies using <code>ivy</code> hasn&#39;t been changed and is
still on MELPA. All three packages have the version <code>0.8.0</code> currently.</p>

<p>To reiterate the dependencies:</p>

<ul>
<li><code>ivy</code> depends on Emacs version larger than 24.1, preferably at least 24.3 (the most common one bundled currently with Linux distributions).</li>
<li><code>swiper</code> depends on <code>ivy</code> and provides basically 3 commands: <code>swiper</code>, <code>swiper-multi</code> and <code>swiper-all</code>.</li>
<li><code>counsel</code> depends on <code>swiper</code> and provides around 50 commands for all kinds of stuff. My favorites are <code>counsel-M-x</code>, <code>counsel-git-grep</code>, <code>counsel-rhythmbox</code> and <code>counsel-grep-or-swiper</code>.</li>
</ul>

<h3 id="changes-on-gnu-elpa">Changes on GNU ELPA</h3>

<p>On <a href="http://elpa.gnu.org/packages/">GNU ELPA</a>, a single package
<code>ivy-0.8.0</code> has replaced the previous stable version <code>swiper-0.7.0</code>.
This package provides all the files combined of the three separate
MELPA packages.</p>

<h2 id="release-summary">Release summary</h2>

<p>The release consists of 282 commits over 5 months by 15 authors. The
detailed Changelog is available
<a href="http://oremacs.com/swiper/Changelog.html#0.8.0">here</a>, thanks to the
ever useful Org mode export. The raw Org file is in
<a href="https://github.com/abo-abo/swiper/blob/master/doc/Changelog.org#080">doc/Changelog.org</a>
in the main repository.</p>

<p>The detailed documentation is available as an <code>(ivy)</code> Info node and
also in HTML form <a href="http://oremacs.com/swiper/">here</a>. If anyone wants
to document something that&#39;s missing there, I&#39;d appreciate the help:
simply edit
<a href="https://github.com/abo-abo/swiper/blob/master/doc/ivy.org">doc/ivy.org</a>
and send me a PR.</p>

<h2 id="release-highlights">Release highlights</h2>

<p>Below, I&#39;ll highlight some of the new features.</p>

<h3 id="allow-to-compose-collections">Allow to compose collections</h3>

<p>For example, to stack the top 10 elements of <code>recentf</code> on top of <code>counsel-locate</code>, use this code:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">small-test</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">cl-subseq</span> <span class="nv">recentf-list</span> <span class="mi">0</span> <span class="mi">10</span><span class="p">))</span>

<span class="p">(</span><span class="nv">ivy-set-sources</span>
 <span class="ss">&#39;counsel-locate</span>
 <span class="o">&#39;</span><span class="p">((</span><span class="nv">small-test</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">original-source</span><span class="p">)))</span>
</code></pre></div>
<p>Here, <code>(original-source)</code> represents the async candidates of
counsel-locate. All extra sources are static - each function is called
once to generate a list of strings, which will be filtered later.</p>

<p>See <a href="https://github.com/abo-abo/swiper/issues/373">#373</a> for more info.</p>

<h3 id="improved-documentation">Improved documentation</h3>

<p>If you&#39;re not yet familiar with Ivy, you can get a quick reference
card by pressing <kbd>C-h m</kbd> during any completion session.  It
will pop up an Org-mode buffer that describes most of the minibuffer
key bindings.</p>

<p>Additionally, <kbd>C-o</kbd> (<code>hydra-ivy/body</code>), which serves a quick
reference as well, received a small restructuring and a new
binding. Press <kbd>D</kbd> to go to the definition of this
hydra. This is useful to see what each key does, you might even want
to customize some of it.</p>

<h3 id="completion-in-region">Completion in region</h3>

<p>From now on, <code>ivy-mode</code> will also set
<code>completion-in-region-function</code>. This means that functions like:</p>

<ul>
<li><kbd>C-M-i</kbd> <code>complete-symbol</code> in many major modes, </li>
<li><kbd>TAB</kbd> while in the <kbd>M-:</kbd> (<code>eval-expression</code>) minibuffer,</li>
<li><kbd>TAB</kbd> in a <code>shell</code> buffer,</li>
</ul>

<p>will use <code>ivy</code> for completion.</p>

<h3 id="many-improvements-to-ivy-occur-mode">Many improvements to <code>ivy-occur-mode</code></h3>

<p>You can &quot;permanently&quot; save any completion session by pressing <kbd>C-c
C-o</kbd> (<code>ivy-occur</code>).  This will generate a new buffer in
<code>ivy-occur-mode</code> with all your current candidates inserted there.
Clicking or pressing <kbd>f</kbd> on any of the candidates in that
buffer will result in the appropriate action being called with that
candidate.</p>

<p><img src="/download/ivy-occur-mode.png" alt="ivy-occur-mode.png"></p>

<p>The <code>*ivy-occur ...*</code> buffers can actually be customized per
collection type. Specifically for <code>swiper</code>, <code>counsel-git-grep</code>,
<code>counsel-grep</code> and <code>counsel-ag</code>, the customizations are already in
place that allow you to:</p>

<ul>
<li>Edit the buffer with <code>wgrep</code> by pressing <kbd>C-x C-q</kbd>
(<code>ivy-wgrep-change-to-wgrep-mode</code>).</li>
<li>Refresh the buffer due to the original files being changed by pressing <kbd>g</kbd> (<code>ivy-occur-revert-buffer</code>).</li>
</ul>

<p>The second feature is often useful to me when I want to somehow change
a symbol throughout the project. First I make a list of all
occurrences via e.g. <code>swiper</code> and <code>ivy-occur</code>. After I went through
some of the occurrences, I can press <kbd>g</kbd> to refresh the
search for the same symbol and see how many I still have left.</p>

<p>Yet another cool feature is to press <kbd>c</kbd>
(<code>ivy-occur-toggle-calling</code>) to toggle calling the action after each
line movement and cycle through candidates by holding either
<kbd>j</kbd> (<code>ivy-occur-next-line</code>) or <kbd>k</kbd>
(<code>ivy-occur-previous-line</code>).</p>

<h3 id="ivy-set-action-can-work-on-all-commands"><code>ivy-set-action</code> can work on all commands</h3>

<p>Here&#39;s the code I&#39;m using currently in my config:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">ivy-insert-action</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">with-ivy-window</span>
    <span class="p">(</span><span class="nf">insert</span> <span class="nv">x</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">ivy-set-actions</span>
 <span class="no">t</span>
 <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;I&quot;</span> <span class="nv">ivy-insert-action</span> <span class="s">&quot;insert&quot;</span><span class="p">)))</span>
</code></pre></div>
<p>This allows me to press <kbd>M-o I</kbd> to insert the current
candidate into the buffer. For instance, if I want to quote an Emacs
command, I can <kbd>M-x</kbd> (<code>counsel-M-x</code>), select the command I
want and press <kbd>M-o I</kbd> to insert it instead of calling it.</p>

<h3 id="virtual-views-in-ivy-switch-buffer">Virtual views in <code>ivy-switch-buffer</code></h3>

<p>Here, &quot;virtual&quot; buffer means something that&#39;s close to a buffer but
not an actual buffer. If you were using the setting
<code>ivy-use-virtual-buffers</code>, you&#39;d have your bookmarks and <code>recentf</code>
items available to you as virtual buffers.</p>

<p>The new feature allows to select a whole window configuration with
many buffers inside nested horizontal and vertical splits from
<code>ivy-switch-buffer</code>.</p>

<p>To use it, set <code>ivy-views</code>, since it&#39;s nil by default. For instance,
here&#39;s what I have in my config:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">ivy-views</span>
      <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;dutch + notes {}&quot;</span>
         <span class="p">(</span><span class="nv">vert</span>
          <span class="p">(</span><span class="nv">file</span> <span class="s">&quot;dutch.org&quot;</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">buffer</span> <span class="s">&quot;notes&quot;</span><span class="p">)))</span>
        <span class="p">(</span><span class="s">&quot;ivy {}&quot;</span>
         <span class="p">(</span><span class="nv">horz</span>
          <span class="p">(</span><span class="nv">file</span> <span class="s">&quot;ivy.el&quot;</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">buffer</span> <span class="s">&quot;*scratch*&quot;</span><span class="p">)))))</span>
</code></pre></div>
<p>For a more elaborate and detailed use, see
<a href="http://informatica.boccaperta.com/m-x-emacs-piu-rapidi-con-ivy-views/">this post</a>
by Manuel Uberti.</p>

<h3 id="magic-slash-in-file-name-completion">Magic slash in file name completion</h3>

<p>From now on, if you want to enter a directory, simply select a
candidate which is a directory and press <kbd>/</kbd>. You can still
use the old binding <kbd>C-j</kbd> (<code>ivy-alt-done</code>), but <kbd>/</kbd>
is shorter and easier to get used to if you&#39;re switching from Ido.</p>

<p>Note that this does not prevent the use of old functionality like:</p>

<ul>
<li><kbd>//</kbd> to enter the root directory,</li>
<li><code>/ssh:</code> <kbd>RET</kbd> to connect via TRAMP.</li>
</ul>

<h3 id="a-better-way-to-search-with-counsel-grep-or-swiper">A better way to search with <code>counsel-grep-or-swiper</code></h3>

<p>If you&#39;ve ever been annoyed with the long start-up time of <code>swiper</code> in
huge buffers, switch to this setting:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nv">global-set-key</span> <span class="s">&quot;\C-s&quot;</span> <span class="ss">&#39;counsel-grep-or-swiper</span><span class="p">)</span>
</code></pre></div>
<p>This command will use <code>swiper</code> for small buffers, and <code>counsel-grep</code> for large buffers.</p>

<p>Something very similar to this command was highlighted in
<a href="http://karl-voit.at/2016/04/09/chosing-emacs-search-method/">this post</a>
by Karl Voit.</p>

<p>Just to give you an idea of how fast <code>counsel-grep</code> is:</p>

<ul>
<li>It has 0s start-up time, since it&#39;s async.</li>
<li>For a two million line file weighing 50MB produced by copying
<code>org.el</code> a few times, it takes 0.2s to find the 17,664 occurrences
of the word <code>hook</code>. It still takes 7.5s to search for <code>org</code> in that
file, simply because there are 500,000 candidates and it takes time
for Emacs to simply receive that input.</li>
</ul>

<h3 id="a-list-of-all-new-commands">A list of all new commands</h3>

<p>The new commands since <code>0.7.0</code> are: <code>counsel-tmm</code>, <code>counsel-imenu</code>,
<code>counsel-decbinds</code>, <code>counsel-list-processes</code>,
<code>ivy-switch-buffer-other-window</code>, <code>counsel-git-stash</code>,
<code>counsel-git-log</code>, <code>counsel-pt</code>, <code>counsel-linux-app</code>,
<code>counsel-ace-link</code>, <code>counsel-esh-history</code>, <code>counsel-shell-history</code>,
<code>counsel-grep-or-swiper</code>.</p>

<p>If any of those sound interesting, go ahead and try them out.</p>

<h2 id="outro">Outro</h2>

<p>Thanks to all the contributors. Happy hacking!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/04/04/hydra-doc-syntax/">
        Extended syntax for hydra docstrings
      </a>
    </h1>

    <span class="post-date">04 Apr 2016</span>

    <p>I&#39;ve been getting more and more organized in tracking my tasks and
time with Org-mode. Still using the usual suspects, of course: GTD and
Pomodoro, I&#39;m just getting more diligent with them than in the
previous years.</p>

<p>So today I wanted to prettify the good old
<code>org-agenda-view-mode-dispatch</code>, which is bound to <kbd>v</kbd> in
<code>org-agenda-mode</code>. Currently, it&#39;s just a boring static <code>message</code> and
<code>read-char</code> combination. Why not do it with a
<a href="https://github.com/abo-abo/hydra">hydra</a> instead?</p>

<p>Here&#39;s the current full code, that uses the newly extended doc syntax:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">org-agenda-mode-map</span>
    <span class="s">&quot;v&quot;</span> <span class="ss">&#39;hydra-org-agenda-view/body</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">org-agenda-cts</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">args</span> <span class="p">(</span><span class="nf">get-text-property</span>
               <span class="p">(</span><span class="nf">min</span> <span class="p">(</span><span class="nf">1-</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span> <span class="p">(</span><span class="nf">point</span><span class="p">))</span>
               <span class="ss">&#39;org-last-args</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">nth</span> <span class="mi">2</span> <span class="nv">args</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defhydra</span> <span class="nv">hydra-org-agenda-view</span> <span class="p">(</span><span class="nb">:hint</span> <span class="no">nil</span><span class="p">)</span>
  <span class="s">&quot;</span>
<span class="s">_d_: ?d? day        _g_: time grid=?g? _a_: arch-trees</span>
<span class="s">_w_: ?w? week       _[_: inactive      _A_: arch-files</span>
<span class="s">_t_: ?t? fortnight  _f_: follow=?f?    _r_: report=?r?</span>
<span class="s">_m_: ?m? month      _e_: entry =?e?    _D_: diary=?D?</span>
<span class="s">_y_: ?y? year       _q_: quit          _L__l__c_: ?l?&quot;</span>
  <span class="p">(</span><span class="s">&quot;SPC&quot;</span> <span class="nv">org-agenda-reset-view</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;d&quot;</span> <span class="nv">org-agenda-day-view</span>
       <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="ss">&#39;day</span> <span class="p">(</span><span class="nv">org-agenda-cts</span><span class="p">))</span>
           <span class="s">&quot;[x]&quot;</span> <span class="s">&quot;[ ]&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;w&quot;</span> <span class="nv">org-agenda-week-view</span>
       <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="ss">&#39;week</span> <span class="p">(</span><span class="nv">org-agenda-cts</span><span class="p">))</span>
           <span class="s">&quot;[x]&quot;</span> <span class="s">&quot;[ ]&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;t&quot;</span> <span class="nv">org-agenda-fortnight-view</span>
       <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="ss">&#39;fortnight</span> <span class="p">(</span><span class="nv">org-agenda-cts</span><span class="p">))</span>
           <span class="s">&quot;[x]&quot;</span> <span class="s">&quot;[ ]&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;m&quot;</span> <span class="nv">org-agenda-month-view</span>
       <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="ss">&#39;month</span> <span class="p">(</span><span class="nv">org-agenda-cts</span><span class="p">))</span> <span class="s">&quot;[x]&quot;</span> <span class="s">&quot;[ ]&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;y&quot;</span> <span class="nv">org-agenda-year-view</span>
       <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="ss">&#39;year</span> <span class="p">(</span><span class="nv">org-agenda-cts</span><span class="p">))</span> <span class="s">&quot;[x]&quot;</span> <span class="s">&quot;[ ]&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;l&quot;</span> <span class="nv">org-agenda-log-mode</span>
       <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;% -3S&quot;</span> <span class="nv">org-agenda-show-log</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;L&quot;</span> <span class="p">(</span><span class="nv">org-agenda-log-mode</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
  <span class="p">(</span><span class="s">&quot;c&quot;</span> <span class="p">(</span><span class="nv">org-agenda-log-mode</span> <span class="ss">&#39;clockcheck</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;f&quot;</span> <span class="nv">org-agenda-follow-mode</span>
       <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;% -3S&quot;</span> <span class="nv">org-agenda-follow-mode</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;a&quot;</span> <span class="nv">org-agenda-archives-mode</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;A&quot;</span> <span class="p">(</span><span class="nv">org-agenda-archives-mode</span> <span class="ss">&#39;files</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;r&quot;</span> <span class="nv">org-agenda-clockreport-mode</span>
       <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;% -3S&quot;</span> <span class="nv">org-agenda-clockreport-mode</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;e&quot;</span> <span class="nv">org-agenda-entry-text-mode</span>
       <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;% -3S&quot;</span> <span class="nv">org-agenda-entry-text-mode</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;g&quot;</span> <span class="nv">org-agenda-toggle-time-grid</span>
       <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;% -3S&quot;</span> <span class="nv">org-agenda-use-time-grid</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;D&quot;</span> <span class="nv">org-agenda-toggle-diary</span>
       <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;% -3S&quot;</span> <span class="nv">org-agenda-include-diary</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&quot;!&quot;</span> <span class="nv">org-agenda-toggle-deadlines</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;[&quot;</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">org-agenda-include-inactive-timestamps</span> <span class="no">t</span><span class="p">))</span>
     <span class="p">(</span><span class="nv">org-agenda-check-type</span> <span class="no">t</span> <span class="ss">&#39;timeline</span> <span class="ss">&#39;agenda</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">org-agenda-redo</span><span class="p">)))</span>
  <span class="p">(</span><span class="s">&quot;q&quot;</span> <span class="p">(</span><span class="nf">message</span> <span class="s">&quot;Abort&quot;</span><span class="p">)</span> <span class="nb">:exit</span> <span class="no">t</span><span class="p">))</span>
</code></pre></div>
<p>And here&#39;s how it looks like in action, I simply pressed <kbd>v</kbd> while in the agenda:</p>

<p><img src="/download/hydra-sexp-docstring.png" alt="hydra-sexp-docstring.png"></p>

<p>Since many functions that <code>org-agenda-view-mode-dispatch</code> calls are
toggles, it makes sense for <code>hydra-org-agenda-view</code> to display the
status of these toggles.</p>

<p>And it&#39;s actually convenient to toggle a whole lot of things at once,
and the default red hydra keys really come in handy here.</p>

<h2 id="quick-explanation-of-the-syntax">Quick explanation of the syntax</h2>

<p>Each head of a hydra looks like:</p>

<blockquote>
<p>(key cmd &amp;optional doc &amp;rest plist)</p>
</blockquote>

<p>The fairly new bit that I&#39;m using here is the ability to use a sexp
instead of a plain string in the <code>doc</code> part.  This sexp will be
evaluated each time the doc is re-displayed. This means that it can
represent a changing variable, for instance the state of a minor mode
or a variable.</p>

<p>And here&#39;s the best part: the doc of each head can be quoted in the
hydra&#39;s docstring by using the corresponding key, e.g. <code>?g?</code>.  This
allows to have very complex docstrings while keeping them easily
aligned in a tabular format.</p>

<p>Here is only the hydra&#39;s docstring, copied from the above code:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">_d_: ?d? day        _g_: time grid=?g? _a_: arch-trees
_w_: ?w? week       _[_: inactive      _A_: arch-files
_t_: ?t? fortnight  _f_: follow=?f?    _r_: report=?r?
_m_: ?m? month      _e_: entry =?e?    _D_: diary=?D?
_y_: ?y? year       _q_: quit          _L__l__c_: ?l?
</code></pre></div>
<p>Doesn&#39;t that look simple?</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page2">Older</a>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
