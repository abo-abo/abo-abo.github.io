<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="flattr:id" content="9yl9ry">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (or emacs &middot; irrelevant)
    
  </title>

  <link rel="canonical" href="https://oremacs.com/" />

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/octicons.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- <div class="sidebar-item"> -->
  <!--   <p>unused</p> -->
  <!-- </div> -->

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item active" href="/">Home</a>
          <a class="sidebar-nav-item" href="/about/">About</a>
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
          <a class="sidebar-nav-item" href="/donate/">Donate</a>
        <div id="github" class="sidebar-nav-item">
      <button type="button"
              class="btn btn-info"
              data-toggle="collapse"
              data-target="#github-projects">
        <span class="octicon octicon-mark-github"></span> My Emacs Projects
      </button>
      <div id="github-projects" class="collapse">
        <ul style="margin-bottom:0em;">
          <li>
            <a href="https://github.com/abo-abo/lispy">lispy</a>
            <p>vi-like Paredit</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/worf">worf</a>
            <p>vi-like bindings for org-mode</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-window">ace-window</a>
            <p>switch windows with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/ace-link">ace-link</a>
            <p>follow links with <code>ace-jump-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/function-args">function-args</a>
            <p>enhance <code>CEDET</code> for C++</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/helm-make">helm-make</a>
            <p>select a Makefile target with <code>helm</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/make-it-so">make-it-so</a>
            <p>transform files with Makefile recipes</p>
          </li>
          <li>
            <a href="https://github.com/abo-abo/org-download">org-download</a>
            <p>drag-and-drop images to <code>org-mode</code></p>
          </li>
          <li>
            <a href="https://github.com/abo-abo?tab=repositories">
              <span class="octicon octicon-octoface"></span>
              and more
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
        <img alt="Creative Commons License"
             style="border-width:0;opacity: 0.3;"
             src="https://licensebuttons.net/l/by-sa/4.0/88x31.png"/>
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">(or emacs</a>
            <small>irrelevant)</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2019/10/16/ivy-0.13.0/">
        Ivy 0.13.0 is out
      </a>
    </h1>

    <span class="post-date">16 Oct 2019</span>

    <h2 id="intro">Intro</h2>

<p><a href="https://github.com/abo-abo/swiper">Ivy</a> is a completion method that&#39;s
similar to <code>Ido</code>, but with emphasis on simplicity and customizability.</p>

<h2 id="overview">Overview</h2>

<p>The current release constitutes of 183 commits and 3 months of
progress since <code>0.12.0</code>. Many issues ranging from
<a href="https://github.com/abo-abo/swiper/issues/2153">#2153</a> to
<a href="https://github.com/abo-abo/swiper/issues/2278">#2278</a> were fixed.
The number of people who contributed code as grown to form 148 to
<a href="https://github.com/abo-abo/swiper/graphs/contributors">160</a>. Thanks,
everyone!</p>

<h2 id="details-on-changes">Details on changes</h2>

<p><code>Changelog.org</code> has been a part of the repository since <code>0.6.0</code>, you
can get the details of the current and past changes:</p>

<ul>
<li>in <a href="https://github.com/abo-abo/swiper/blob/master/doc/Changelog.org#0130">org-mode</a></li>
<li>in <a href="http://oremacs.com/swiper/Changelog#0.13.0">HTML</a></li>
</ul>

<h2 id="highlights">Highlights</h2>

<p>Many improvements are incremental and don&#39;t require any extra code to
enable.  I&#39;ll go over a few selected features that require a bit of
information to make a good use of them.</p>

<h3 id="new-bindings">New bindings</h3>

<ul>
<li><code>counsel-find-file</code>

<ul>
<li><kbd>~~</kbd> to move to the local home directory from remote or <code>/sudo::</code>.</li>
<li><kbd>/ RET ~</kbd> achieves the same thing, but is longer.</li>
<li><kbd>M-o R</kbd> calls <code>find-file-read-only</code>.</li>
</ul></li>
<li><code>counsel-git-grep</code>

<ul>
<li><kbd>C-x C-d</kbd> to switch the current directory.</li>
</ul></li>
<li><code>swiper-isearch</code>

<ul>
<li><kbd>M-o w</kbd> to copy the current line and go back to where you started.</li>
</ul></li>
</ul>

<h2 id="new-features">New features</h2>

<h3 id="counsel-package"><code>counsel-package</code></h3>

<p>The idea of <code>counsel-package</code> is to install and remove packages with a single binding:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c P&quot;</span><span class="p">)</span> <span class="ss">&#39;counsel-package</span><span class="p">)</span>
</code></pre></div>
<p>But if the package contents weren&#39;t up to date, a separate <kbd>M-x</kbd> <code>package-refresh-contents</code>
had to be triggered, which was an annoying overhead. Now <code>counsel-package</code> will look at the time
stamps of the appropriate <code>archive-contents</code> files, and call <code>package-refresh-contents</code> if the
timestamp is outdated by more than 4 hours.</p>

<h3 id="counsel-m-x"><code>counsel-M-x</code></h3>

<p>Some commands are intended to be called only via their key binding. Make them disappear
from <code>counsel-M-x</code> like this:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nf">put</span> <span class="ss">&#39;counsel-find-symbol</span> <span class="ss">&#39;no-counsel-M-x</span> <span class="no">t</span><span class="p">)</span>
</code></pre></div>
<h3 id="counsel-rg"><code>counsel-rg</code></h3>

<p>The default setting of <code>ivy-case-fold-search-default</code> is <code>&#39;auto</code>, which means:</p>

<ul>
<li>the input &quot;emacs&quot; matches &quot;emacs&quot;, &quot;EMACS&quot;, and &quot;Emacs&quot;</li>
<li>the input &quot;Emacs&quot; matches only &quot;Emacs&quot;</li>
</ul>

<p>This now also applies to <code>counsel-rg</code>: Ivy will pass the <code>-i</code> flag to <code>ripgrep</code> appropriately, based
on <code>ivy-case-fold-search-default</code>. You should remove the <code>-S</code> flag from <code>counsel-rg-base-command</code> if
you customized it.</p>

<h3 id="ivy-update-candidates"><code>ivy-update-candidates</code></h3>

<p>This is a new API for asynchronous calls. To use it, pass to <code>ivy-read</code>: <code>:dynamic-collection t</code>,
and a collection function that takes a user input string, starts some asynchronous process based on
that input, and returns <code>0</code>. The <code>0</code> return result tells Ivy that no candidates were returned;
instead, <code>ivy-update-candidates</code> is used in the async callback.</p>

<p>See <code>counsel-google</code> for a reference implementation.</p>

<h3 id="ivy-use-virtual-buffers"><code>ivy-use-virtual-buffers</code></h3>

<p>You can now choose between: recent files, or bookmarks, or both, or none. Don&#39;t forget that
<code>counsel-set-variable</code> makes it very easy to set customization options.</p>

<h2 id="new-commands">New Commands</h2>

<p>I have put these separately so they don&#39;t get lost in the crowd. Be sure to try them out.</p>

<ul>
<li><code>counsel-buffer-or-recentf</code> - list buffers visiting files (highlighted) then the <code>recentf</code> file
list.</li>
<li><code>counsel-fonts</code> - show a list of all supported font families for a particular frame.</li>
<li><code>counsel-google</code> - asynchronously query the Google predictive search API.</li>
<li><code>counsel-major</code> - switch <code>major-mode</code>.</li>
<li><code>counsel-slime-repl-history</code> - browse SLIME REPL history.</li>
</ul>

<h2 id="outro">Outro</h2>

<p>Again, thanks to all the contributors. Happy hacking!</p>

<p>PS. Thanks to everyone who supports me on <a href="https://liberapay.com/abo-abo">Liberapay</a> and
<a href="https://www.patreon.com/abo_abo">Patreon</a>!</p>

<p>I am now also on <a href="https://github.com/users/abo-abo/sponsorship">Github sponsors</a>, which is an
interesting new effort by Github. The cool thing is that&#39;s more integrated with Github, there are
less transaction fees, and Github matches every donation for up to $5000 for a whole year.
Please consider joining there, since every $1 per month that you donate is doubled by Github.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2019/07/20/ivy-0.12.0/">
        Ivy 0.12.0 is out
      </a>
    </h1>

    <span class="post-date">20 Jul 2019</span>

    <h2 id="intro">Intro</h2>

<p><a href="https://github.com/abo-abo/swiper">Ivy</a> is a completion method that&#39;s
similar to <code>Ido</code>, but with emphasis on simplicity and customizability.</p>

<h2 id="overview">Overview</h2>

<p>The current release constitutes of 398 commits and 6 months of
progress since <code>0.11.0</code>. Many issues ranging from
<a href="https://github.com/abo-abo/swiper/issues/1904">#1904</a> to
<a href="https://github.com/abo-abo/swiper/issues/2151">#2151</a> were fixed.
The number of people who contributed code as grown to
<a href="https://github.com/abo-abo/swiper/graphs/contributors">148</a>. Thanks,
everyone!</p>

<h2 id="details-on-changes">Details on changes</h2>

<p><code>Changelog.org</code> has been a part of the repository since <code>0.6.0</code>, you
can get the details of the current and past changes:</p>

<ul>
<li>in <a href="https://github.com/abo-abo/swiper/blob/master/doc/Changelog.org#0120">org-mode</a></li>
<li>in <a href="http://oremacs.com/swiper/Changelog#0.12.0">HTML</a></li>
</ul>

<h2 id="highlights">Highlights</h2>

<p>Many improvements are incremental and don&#39;t require any extra code to
enable.  I&#39;ll go over a few selected features that require a bit of
information to make a good use of them.</p>

<h3 id="new-bindings">New bindings</h3>

<ul>
<li><code>counsel-descbinds</code>

<ul>
<li><kbd>M-o x</kbd> execute action.</li>
</ul></li>
<li><code>counsel-file-jump</code>

<ul>
<li><kbd>M-o d</kbd> dired.</li>
</ul></li>
<li><code>counsel-find-file</code>

<ul>
<li><kbd>M-o c</kbd> copy file.</li>
<li><kbd>&#96;</kbd> bookmarks: efficiently jump between recent directories.</li>
<li><kbd>$</kbd> directories stored in environment variables.</li>
<li><kbd>C-DEL</kbd> go up directory. Customize: <code>counsel-up-directory-level</code>.</li>
<li><kbd>RET</kbd> open file. Customize: <code>counsel-find-file-extern-extensions</code>.</li>
<li><kbd>//</kbd> when on remote, cd to remote root.</li>
<li><kbd>/ C-j</kbd> select local root.</li>
<li><kbd>~</kbd> when on remote, cd to remote home.</li>
<li><kbd>/ C-j ~</kbd> cd to local home from remote.</li>
</ul></li>
<li><code>counsel-git-log</code>

<ul>
<li><kbd>M-o v</kbd> open the current commit in <code>magit</code>.</li>
</ul></li>
<li><code>counsel-rg</code>

<ul>
<li><kbd>C-x C-d</kbd> change the current directory for grep.</li>
</ul></li>
<li><code>ivy-avy</code>

<ul>
<li><kbd>C-v</kbd> to scroll down.</li>
<li><kbd>M-v</kbd> to scroll up.</li>
</ul></li>
<li><code>ivy-read</code> <kbd>C-o</kbd>

<ul>
<li><kbd>m</kbd> mark and move down.</li>
<li><kbd>u</kbd> unmark and move down.</li>
<li><kbd>DEL</kbd> move up and unmark.</li>
<li><kbd>t</kbd> toggle marks.</li>
<li><kbd>d</kbd> perform the action on all marked elements.</li>
</ul></li>
<li><code>ivy-switch-buffer</code>

<ul>
<li><kbd>C-k</kbd> kill buffer.</li>
<li><kbd>M-o x</kbd> open buffer file externally.</li>
</ul></li>
<li><code>ivy-reverse-i-search</code>

<ul>
<li><kbd>C-k</kbd> remove item from the history.</li>
</ul></li>
</ul>

<h2 id="new-commands-extensions">New Commands extensions</h2>

<p>These commands are new variants and adaptations of existing commands.</p>

<p>Thing at point variants:</p>

<ul>
<li><code>swiper-all-thing-at-point</code>.</li>
<li><code>swiper-isearch-thing-at-point</code>.</li>
<li><code>swiper-thing-at-point</code>.</li>
</ul>

<p>Search variants that go backwards:</p>

<ul>
<li><code>swiper-backward</code>.</li>
<li><code>counsel-grep-or-swiper-backward</code>.</li>
<li><code>swiper-isearch-backward.</code></li>
</ul>

<p>A variant of <code>ivy-switch-buffer</code> with live preview:</p>

<ul>
<li><code>counsel-switch-buffer</code>.</li>
<li><code>counsel-switch-buffer-other-window</code>.</li>
</ul>

<p>And finally:</p>

<ul>
<li><code>counsel-dired</code> - like <code>counsel-find-file</code>, but open <code>dired</code>.</li>
<li><code>swiper-isearch-toggle</code> - toggle between <code>swiper</code> and <code>isearch</code>.</li>
</ul>

<h2 id="new-commands">New Commands</h2>

<p>I have put these separately so they don&#39;t get lost in the crowd. Be sure to try them out.</p>

<ul>
<li><code>counsel-compile</code> - completion for <code>compile</code>.</li>
<li><code>counsel-register</code> - completion for registers.</li>
<li><code>counsel-minor</code> - completion for minor modes.</li>
<li><code>swiper-isearch</code> - a faster <code>swiper</code> that&#39;s not line-based.</li>
</ul>

<h2 id="outro">Outro</h2>

<p>Again, thanks to all the contributors. Happy hacking!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2019/07/09/ivy-reverse-i-search/">
        Ivy reverse-i-search
      </a>
    </h1>

    <span class="post-date">09 Jul 2019</span>

    <h2 id="introduction">Introduction</h2>

<p>I&#39;m sure many are aware of the <kbd>C-r</kbd> functionality in <a href="https://www.gnu.org/software/bash/manual/html_node/Commands-For-History.html#Commands-For-History">bash</a> (a whole lot of Emacs
bindings are valid in bash and do the same thing). I also like the quirky Emacs-style prompt, that
uses a backquote to open and a straight quote to close a your quoted input:</p>

<p><img src="/download/bash-reverse-i-search.png" alt="bash-reverse-i-search.png"></p>

<p>So when you want to <code>cd</code> to somewhere where you were before you do <kbd>C-r</kbd> <code>cd</code>. And then the
<kbd>C-r</kbd> &quot;roulette&quot; begins: you keep pressing <kbd>C-r</kbd> over and over, in the hopes to find
what you were looking for.</p>

<h2 id="getting-better-history-completion-with-ivy">Getting better history completion with Ivy</h2>

<p><a href="https://github.com/abo-abo/swiper">Ivy</a> improves the &quot;roulette&quot; situation in two ways:</p>

<ul>
<li>You get an overview of the matching candidates and their count,</li>
<li>You can quickly narrow down the candidates with fuzzy matching.</li>
</ul>

<p>Here&#39;s the basic setup to enable <kbd>C-r</kbd> completion using ivy:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">minibuffer-local-map</span>
    <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-r&quot;</span><span class="p">)</span> <span class="ss">&#39;counsel-minibuffer-history</span><span class="p">)</span>
<span class="p">(</span><span class="nf">define-key</span> <span class="nv">shell-mode-map</span>
    <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-r&quot;</span><span class="p">)</span> <span class="ss">&#39;counsel-shell-history</span><span class="p">)</span>
</code></pre></div>
<p>The first key binding is also part of <code>counsel-mode</code>, while the second needs to be set up separately,
after <code>shell-mode</code> was loaded.</p>

<p>And here&#39;s how <code>counsel-shell-history</code> looks like:</p>

<p><img src="/download/counsel-shell-history.png" alt="counsel-shell-history.png"></p>

<p>The cool thing is that <code>ivy-reverse-i-search</code> applies to <em>any</em> Ivy command, not just for shell
command completion. I find it especially useful for:</p>

<ul>
<li><code>counsel-find-file</code></li>
<li><code>eval-expression</code></li>
</ul>

<h2 id="recent-improvement-delete-history-items">Recent improvement: delete history items</h2>

<p>While searching with regexes is great, it&#39;s not so great when the old stuff that we won&#39;t ever need
gets in the way. So now you can delete it with <kbd>C-k</kbd>. Since <kbd>C-k</kbd> also has to
serve as <code>ivy-kill-line</code>, the history deleting behavior will only come into effect when the point is
at the end of the line (so that <code>ivy-kill-line</code> does not make sense anyway).</p>

<p><img src="/download/ivy-reverse-i-search-kill.png" alt="ivy-reverse-i-search-kill.png"></p>

<p>This way, your typos don&#39;t stay around to haunt you.</p>

<h2 id="outro">Outro</h2>

<p>I hope you&#39;ll find <code>ivy-reverse-i-search</code> a useful boost to your completion needs. Happy hacking!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2019/06/27/ivy-directory-improvements/">
        Ivy usability improvements when dealing with directories
      </a>
    </h1>

    <span class="post-date">27 Jun 2019</span>

    <h2 id="introduction">Introduction</h2>

<p>When <a href="https://github.com/abo-abo/swiper">Ivy</a> just started out as a completion framework, the
functionality was supposed to be simple: select one string from a list of strings. The UI is simple
enough:</p>

<ul>
<li>Show the list of strings that match the entered text,</li>
<li>Use <kbd>C-n</kbd> and <kbd>C-p</kbd> to navigate them,</li>
<li>Use <kbd>C-m</kbd> or <kbd>C-j</kbd> to submit.</li>
</ul>

<p>Emacs has three key bindings that mean &quot;Enter&quot;: <kbd>RET</kbd>, <kbd>C-m</kbd>, and
<kbd>C-j</kbd>. But in terminal mode, <code>emacs -nw</code>, <kbd>RET</kbd> and <kbd>C-m</kbd> are the same
binding: Emacs can&#39;t distinguish them. So we have at most two bindings. Fortunately, the world of
completion is simple at the moment, and we only need one binding.</p>

<h2 id="file-name-completion">File name completion</h2>

<p>Enter file name completion. When you&#39;re completing file names, you are selecting not one string, but
many strings in succession while moving from one directory to the next. So we need at least two key
bindings:</p>

<ul>
<li>Use <kbd>C-m</kbd> (<code>ivy-done</code>) to select the current candidate and exit completion.</li>
<li>Use <kbd>C-j</kbd> (<code>ivy-alt-done</code>) to change the current directory to the current candidate without exiting completion.</li>
</ul>

<p>What to do when <kbd>C-j</kbd> is used on a file and not on a directory? Might as well open the
file: same action as <kbd>C-m</kbd>. OK, we had two key bindings, and we have used them. Hopefully
nothing else comes up.</p>

<p>Enter creating a new file, i.e. selecting something that&#39;s not on the list of strings.
Suppose I call <code>find-file</code>, enter &quot;do&quot;, and the only match is a directory named &quot;doc&quot;:</p>

<ul>
<li>Pressing <kbd>C-m</kbd> will end completion with the &quot;doc&quot; directory selected.</li>
<li>Pressing <kbd>C-j</kbd> will continue completion inside the &quot;doc&quot; directory.</li>
</ul>

<p>So creating a file named &quot;do&quot; is the third action. Our two &quot;Enter&quot; keybindings are already taken by
the first two different useful actions. So we need a third key binding. The one I chose is
<kbd>C-M-j</kbd> (<code>ivy-immediate-done</code>).  It means: I don&#39;t care that the current input is not on
the list of candidate strings, submit it anyway.</p>

<h2 id="directory-creation">Directory creation</h2>

<p>Enter directory creation: <code>dired-create-directory</code> and <code>make-directory</code>. These built-in Emacs
commands request file name completion, but what they tell Ivy is no different from what <code>find-file</code>
tells: &quot;I want to select a file&quot;. However, for these commands, the <kbd>C-M-j</kbd> action is the
one that makes most sense. Here it would be nice for Ivy to take the back seat and just act like an
interactive <code>ls</code>, since the user will enter a completely new string that&#39;s not on the list of
candidates.</p>

<p>For a long time, you still had to use <kbd>C-M-j</kbd> with those commands, to much frustration of
new but also existing users, including myself. But a few days ago, I looked at the prompt that
<code>dired-create-directory</code> uses: &quot;Create directory: &quot;. That prompt is passed to Ivy. Using the prompt
to detect the intention of the command is a bit of a hack, but I think in this case it&#39;s
justifiable. So now Ivy will recognize that the intention commands that request file name completion
and pass the &quot;Create directory: &quot; prompt is to create a directory, and all key bindings will do just
that: <kbd>C-m</kbd>, <kbd>C-j</kbd>, and <kbd>C-M-j</kbd> will behave the same in this case.</p>

<h2 id="an-alternative-key-binding-scheme">An alternative key binding scheme</h2>

<p>Note that <kbd>C-m</kbd> and <kbd>C-j</kbd> behave differently only for directories. But thanks to
the fact that &quot;.&quot; is always the first candidate, <kbd>C-m</kbd> for directories is equivalent to
<kbd>C-j C-j</kbd>. So we can get away with just using <code>ivy-alt-done</code>, and bind <kbd>C-m</kbd> to
<code>ivy-immediate-done</code>. Or swap the two meanings:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">ivy-minibuffer-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-j&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-immediate-done</span><span class="p">)</span>
<span class="p">(</span><span class="nf">define-key</span> <span class="nv">ivy-minibuffer-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-m&quot;</span><span class="p">)</span> <span class="ss">&#39;ivy-alt-done</span><span class="p">)</span>
</code></pre></div>
<p>The price to pay here is the extra context switch when we simply want to select a directory.  We
could the bind <code>ivy-done</code> to <kbd>C-M-j</kbd> and avoid the context switch, but then we&#39;re back to
three bindings once more. Still, I thought that swapping the bindings is an interesting idea worth
sharing.</p>

<h2 id="canceling-dired-dwim-target">Canceling <code>dired-dwim-target</code></h2>

<p>Setting <code>dired-dwim-target</code> is a nice productivity boost. It allows to use Emacs in a similar way to
a two-pane file explorer, like <a href="https://linux.die.net/man/1/mc">mc(1)</a>. But it was really annoying when I was in <code>dir-1</code> with the
intention to copy a file to a different name in <code>dir-1</code> (e.g. create a backup, or copy a template),
but the current directory was set to <code>dir-2</code> because of a random <code>dired</code> window I had open. In that
case, I had to call <code>delete-other-windows</code>, perform the copy, and then restore the window
configuration with <code>winner-undo</code>.</p>

<p>I did the above many times over many years, until I finally dug into the code of <code>dired.el</code> to see
how <code>dired-dwim-target</code> worked. Turns out it was storing <code>dir-1</code> in the <code>minibuffer-defaults</code>
variable.  So now Ivy will use that variable when I press <kbd>M-n</kbd>. All in all, it was a five
minute fix.  But rather than regret that I didn&#39;t do it years ago, I&#39;m glad I did it now. It only
remains to build some muscle memory to press <kbd>M-n</kbd> in that situation.</p>

<p>I&#39;m guesstimating that <code>dired-dwim-target</code> works to my advantage 90% of the time when I press
<kbd>C</kbd> in <code>dired</code>.  For the other 10% of the times, I can now press <kbd>M-n</kbd>.</p>

<h2 id="outro">Outro</h2>

<p>I hope you find the new functionality useful. I&#39;m always open to <a href="https://github.com/abo-abo/swiper/issues/">new ideas and pull
requests</a>. Happy hacking!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2019/05/18/hydra-0.15.0/">
        hydra 0.15.0 is out
      </a>
    </h1>

    <span class="post-date">18 May 2019</span>

    <p>This release consists of 45 commits done over the course of the last 2 years. With this version, I
have introduced a
<a href="https://github.com/abo-abo/hydra/blob/f27fce1b2f0a9162e159557bdeb2c0c94defb4d2/doc/Changelog.org#0150">Changelog.org</a>,
similar to what <a href="https://github.com/abo-abo/swiper/blob/master/doc/Changelog.org">ivy</a> and
<a href="https://github.com/abo-abo/avy/blob/master/doc/Changelog.org">avy</a> have.</p>

<p><img src="/download/Hydra.jpg" alt="hydra"></p>

<h2 id="highlights">Highlights</h2>

<h3 id="display-hints-using-posframe">Display hints using posframe</h3>

<p>A new defcustom <code>hydra-hint-display-type</code> was introduced that can be either <code>lv</code> (the default),
<code>message</code>, or <code>posframe</code>.</p>

<p><a href="https://github.com/tumashu/posframe">Posframe</a> is a package that leverages a new feature in Emacs
26.1: the ability to display child frames. The advantage of using child frames is that you can
easily position them anywhere within your frame area. For example, the default setting is to put it
in the center of the current window, which is closer to where your eyes are focused than the
minibuffer. Child frames don&#39;t interfere with the content of the buffers which they
overlap. Finally, you can select a different font for the child frame.</p>

<p><img src="/download/hydra-posframe.png" alt="hydra-posframe"></p>

<h3 id="less-boilerplate-in-defhydra">Less boilerplate in defhydra</h3>

<p>You no longer have to add <code>:hint nil</code>, and you can skip the docstring as well:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">defhydra</span> <span class="nv">hydra-clock</span> <span class="p">(</span><span class="nb">:exit</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;q&quot;</span> <span class="no">nil</span> <span class="s">&quot;quit&quot;</span> <span class="nb">:column</span> <span class="s">&quot;Clock&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;c&quot;</span> <span class="nv">org-clock-cancel</span> <span class="s">&quot;cancel&quot;</span> <span class="nb">:column</span> <span class="s">&quot;Do&quot;</span> <span class="nb">:exit</span> <span class="no">nil</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;d&quot;</span> <span class="nv">org-clock-display</span> <span class="s">&quot;display&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;e&quot;</span> <span class="nv">org-clock-modify-effort-estimate</span> <span class="s">&quot;effort&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;i&quot;</span> <span class="nv">org-clock-in</span> <span class="s">&quot;in&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;j&quot;</span> <span class="nv">org-clock-goto</span> <span class="s">&quot;jump&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;o&quot;</span> <span class="nv">org-clock-out</span> <span class="s">&quot;out&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;r&quot;</span> <span class="nv">org-clock-report</span> <span class="s">&quot;report&quot;</span><span class="p">))</span>
</code></pre></div>
<h3 id="add-heads-to-an-existing-hydra">Add heads to an existing hydra</h3>

<p>You can now add heads to an existing hydra like this:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">defhydra</span> <span class="nv">hydra-extendable</span> <span class="p">()</span>
  <span class="s">&quot;extendable&quot;</span>
  <span class="p">(</span><span class="s">&quot;j&quot;</span> <span class="nv">next-line</span> <span class="s">&quot;down&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="nv">defhydra+</span> <span class="nv">hydra-extendable</span> <span class="p">()</span>
  <span class="p">(</span><span class="s">&quot;k&quot;</span> <span class="nv">previous-line</span> <span class="s">&quot;up&quot;</span><span class="p">))</span>
</code></pre></div>
<p>The new macro <code>defhydra+</code> takes the same arguments as <code>defhydra</code>, so it&#39;s quite easy to split up or
join your hydras.</p>

<p>The use case of <code>defhydra+</code> is when you have many packages that want to add heads to an existing
hydra. Some of them may be optional or loaded lazily.</p>

<p>You can now have a base <code>defhydra</code>, and then use <code>defhydra+</code> to add heads to it when a new package
is loaded. Example:</p>
<div class="highlight"><pre><code class="language-elisp" data-lang="elisp"><span></span><span class="p">(</span><span class="nv">defhydra</span> <span class="nv">hydra-toggle</span> <span class="p">()</span>
  <span class="p">(</span><span class="s">&quot;q&quot;</span> <span class="no">nil</span> <span class="s">&quot;quit&quot;</span> <span class="nb">:column</span> <span class="s">&quot;Exit&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;w&quot;</span> <span class="nv">whitespace-mode</span>
       <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;whitespace-mode: %S&quot;</span> <span class="nv">whitespace-mode</span><span class="p">)</span>
       <span class="nb">:column</span> <span class="s">&quot;Toggles&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="nb">use-package</span> <span class="nv">org</span>
    <span class="nb">:config</span>
  <span class="p">(</span><span class="nv">defhydra+</span> <span class="nv">hydra-toggle</span> <span class="p">()</span>
    <span class="p">(</span><span class="s">&quot;l&quot;</span> <span class="nv">org-toggle-link-display</span>
         <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;org link display: %S&quot;</span> <span class="nv">org-descriptive-links</span><span class="p">))))</span>
</code></pre></div>
<h2 id="outro">Outro</h2>

<p>Big thanks to all contributors, and I hope you enjoy the new release. Happy hacking!</p>

<p>PS. Thanks to everyone who supports me on <a href="https://liberapay.com/abo-abo">Liberapay</a> and
<a href="https://www.patreon.com/abo_abo">Patreon</a>!</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page2">Older</a>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
